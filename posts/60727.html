<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>053 网络层 —— IP 协议 | 小米里的大麦</title><meta name="keywords" content="Linux,网络"><meta name="author" content="小米里的大麦"><meta name="copyright" content="小米里的大麦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="053 网络层 —— IP 协议"><meta name="application-name" content="053 网络层 —— IP 协议"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="053 网络层 —— IP 协议"><meta property="og:url" content="https://www.minbit.top/posts/60727.html"><meta property="og:site_name" content="小米里的大麦"><meta property="og:description" content="网络层 —— IP 协议 网络层协议 ——— IP 协议 | CSDN 网络层 IP 协议 | CSDN 为什么大家的 IP 都是 192.168 开头的？| B 站（荐） 【硬核科普】IP 地址是什么东西？IPV6 和 IPV4 有什么区别？公网 IP 和私有 IP 又是什么？| B 站（荐）"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://zycs-img-8kd.pages.dev/v2/uH1MN2u.png?_r_=86bfdbff-e801-cb71-51c7-49f92f8b1ef9"><meta property="article:author" content="小米里的大麦"><meta property="article:tag" content="技术博客,Linux,C++,后端开发,编程学习,个人博客,技术分享"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://zycs-img-8kd.pages.dev/v2/uH1MN2u.png?_r_=86bfdbff-e801-cb71-51c7-49f92f8b1ef9"><meta name="description" content="网络层 —— IP 协议 网络层协议 ——— IP 协议 | CSDN 网络层 IP 协议 | CSDN 为什么大家的 IP 都是 192.168 开头的？| B 站（荐） 【硬核科普】IP 地址是什么东西？IPV6 和 IPV4 有什么区别？公网 IP 和私有 IP 又是什么？| B 站（荐）"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "053 网络层 —— IP 协议",
  "description": "网络层 —— IP 协议 网络层协议 ——— IP 协议 | CSDN 网络层 IP 协议 | CSDN 为什么大家的 IP 都是 192.168 开头的？| B 站（荐） 【硬核科普】IP 地址是什么东西？IPV6 和 IPV4 有什么区别？公网 IP 和私有 IP 又是什么？| B 站（荐）",
  "image": "https://zycs-img-8kd.pages.dev/v2/uH1MN2u.png?_r_=86bfdbff-e801-cb71-51c7-49f92f8b1ef9",
  "datePublished": "2025-10-08T04:00:00.000Z",
  "dateModified": "2025-10-08T04:00:00.000Z",
  "author": {
    "@type": "Person",
    "name": "小米里的大麦",
    "url": "https://www.minbit.top"
  },
  "publisher": {
    "@type": "Organization",
    "name": "小米里的大麦",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.minbit.top/img/minbit.png"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.minbit.top/posts/60727.html"
  },
  "keywords": "Linux, 网络"
}</script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "首页",
      "item": "https://www.minbit.top"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "053 网络层 —— IP 协议",
      "item": "https://www.minbit.top/posts/60727.html"
    }
  ]
}</script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "小米里的大麦",
  "url": "https://www.minbit.top",
  "image": "https://www.minbit.top/img/minbit.png",
  "description": "时间好像总会留下点什么，或许是一个人，或许是一个梦，或许……是一段有意义的经历~"
}</script><link rel="shortcut icon" href="/img/icons/funny.svg"><link rel="canonical" href="https://www.minbit.top/posts/60727.html"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//bsz.dusays.com:9001"><meta name="google-site-verification" content="Cd-RTVhRO2mndEhicN2cvLXbsNxPqFC6fSn6ql80eVg"><meta name="baidu-site-verification" content="codeva-1H2kM6MEtN"><meta name="msvalidate.01" content="6DF744D82FE6D1FD11CE18658760B59D"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"><link rel="mask-icon" href="/img/siteicon/apple-icon-180.png" color="#5bbad5"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"><link rel="bookmark" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={linkPageTop:{enable:!0,title:"友链 + 外链 + 无限进步！欢迎欣赏和贡献！",addFriendPlaceholder:"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},peoplecanvas:void 0,postHeadAiDescription:{enable:!0,gptName:"小米里的大麦",mode:"local",switchBtn:!1,btnLink:"https://afdian.net/item/886a79d4db6711eda42a52540025c377",randomNum:4,basicWordCount:1999,key:"93d1622eadde491eb0594b68ade51723.kaEiDD6A3KPzb7xv",Referer:"https://www.minbit.top/"},diytitle:{enable:!0,leaveTitle:"w(ﾟДﾟ)w 不要走！再看看嘛！",backTitle:"♪(^∇^*)欢迎肥来！"},LA51:{enable:!0,ck:"Jp8wwGQpp21utaFQ",LingQueMonitorID:"Jp8ztDRrxmTf7LDj"},greetingBox:{enable:!0,default:"晚上好👋",list:[{greeting:"晚安😴",startTime:0,endTime:5},{greeting:"早上好鸭👋, 祝你一天好心情！",startTime:6,endTime:9},{greeting:"上午好👋, 状态很好，鼓励一下～",startTime:10,endTime:10},{greeting:"11点多啦, 在坚持一下就吃饭啦～",startTime:11,endTime:11},{greeting:"午安👋, 宝贝",startTime:12,endTime:14},{greeting:"🌈充实的一天辛苦啦！",startTime:14,endTime:18},{greeting:"19点喽, 奖励一顿丰盛的大餐吧🍔。",startTime:19,endTime:19},{greeting:"晚上好👋, 在属于自己的时间好好放松😌~",startTime:20,endTime:24}]},twikooEnvId:"https://twikoo.minbit.top/",commentBarrageConfig:{enable:!0,maxBarrage:10,barrageTime:5e3,accessToken:"25c96851dd8a790c4819ad4bfbaf153c",mailMd5:"7b12ebc2be80f9159099f6ab0e16573c"},music_page_default:"nav_music",root:"/",preloader:{source:3},friends_vue_info:void 0,navMusic:!0,mainTone:{mode:"both",api:"https://img2color-go.vercel.app/api?img=",cover_change:!0},authorStatus:{skills:["🧐 准备中，就快好了，真的！😭","📚 正在学习中，加油！","🎵 喜欢听音乐，喜欢看动漫"]},algolia:void 0,localSearch:{path:"/search.xml",preload:!0,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简",rightMenuMsgToTraditionalChinese:"转为繁体",rightMenuMsgToSimplifiedChinese:"转为简体"},noticeOutdate:{limitDay:365,position:"top",messagePrev:"It has been",messageNext:"days since the last update, the content of the article may be outdated."},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:330},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,simplehomepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{copy:!0,copyrightEbable:!0,limitCount:150,languages:{author:"作者: 小米里的大麦",link:"链接: ",source:"来源: 小米里的大麦",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。",copySuccess:"复制成功，复制和转载请标注本文地址"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#425AEF",bgDark:"#1f1f1f",position:"top-right"},source:{justifiedGallery:{js:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js",css:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,shortcutKey:void 0,autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"小米里的大麦",title:"053 网络层 —— IP 协议",postAI:"这篇文章讲述了IP协议在网络层中的核心作用，详细介绍了IP地址的本质和划分基础，包括网络号和主机号的规律、CIDR和无类别域间路由的概念、子网划分的目的和方法，以及子网掩码的应用。文章还解析了IPv4协议报头结构，解释了路由器的本质和核心功能，以及特殊的IP地址类型。此外，文章探讨了IPv4地址数量限制和解决方法，如动态分配IP、NAT技术、IPv6的引入等，并详细说明了私有IP地址和公网IP地址的区别和关系，以及NAT技术的核心作用和三种常见类型。最后，文章介绍了路由转发原理和IP分片机制，以及数据链路层在局域网内点对点通信中的作用。",pageFillDescription:"网络层 —— IP 协议, 1. IP 地址的本质：网络号 + 主机号, 2. IP 地址划分基础, 1. 划分目的, 2. CIDR 是什么？, 3. 什么是子网（Subnet）—— 网络号相同的一组主机, 4. 子网掩码（Subnet Mask）, 1. 举个实际例子, 3. IP（IPv4） 协议报头解析, 4. 路由器到底是什么？, 1. 路由器本质是一台多网卡的专用主机, 2. 路由器必须至少连接两个子网, 3. 路由器接口 IP 通常是 .1但不是强制规定！, 4. 路由器的核心功能, 5. 特殊的 IP 地址, 6. IPv4 地址数量限制, 1. 为什么43 亿 IP 地址不够用？, 2. 如何解决 IPv4 地址枯竭？, 1. 动态分配 IP（DHCP）, 2. NAT（网络地址转换）—— 最广泛应用！, 3. IPv6 —— 终极解决方案, 3. 杂谈, 1. 为什么不能一键切换 IPv4 → IPv6？, 7. 私网 IP 地址和公网 IP 地址, 1. 私有 IP 与 公网 IP：谁负责内部谁负责对外, 2. 运营商：互联网的基建狂魔, 3. 全球互联网与网段划分 —— 大学的层级管理, 4. 私有网络与公网的关系：靠 NAT 桥接, 8. NAT 技术的核心作用：让有限的公网 IP 服务更多设备, 1. NAT 是什么？, 2. 为什么需要 NAT？, 3. NAT 的工作过程, 4. NAT 的三种常见类型（按转换粒度区分）, 9. 路由转发原理：IP 报文如何找到回家的路, 1. 基本逻辑, 2. 查找路由表的过程, 3. 大概转发过程, 10. IP 分片机制：大报文如何被拆开传输？, 1. 为什么要分片？, 2. 分片的字段结构, 3. 分片与组装, 4. 为什么不建议分片？, 11. 数据链路层简述：局域网内的一跳通信, 1. 主要作用, 2. 通信过程（以以太网为例）, 3. 数据帧长度与碰撞网络层协议网络层协议协议网络层协议为什么大家的都是开头的站荐硬核科普地址是什么东西和有什么区别公网和私有又是什么站荐地址的本质网络号主机号地址由两部分组成部分作用举例网络号表示属于哪个子网主机号表示子网内的哪台主机规律同一子网内网络号相同主机号不同不同子网网络号不同主机号可以重复举例子网子网两个子网的主机号范围都可是不冲突因为网络号不同地址划分基础划分目的根本目的就是为了高效管理节省地址提升安全和性能最初互联网只分为类地址分类地址但从年起正式引入无类别域间路由子网掩码灵活划分彻底取代了类的刚性结构于是就出现了现代地址分类图类别起始位首字节范围网络号位数主机号位数用途典型示例类特大型网络类中型网络类小型网络家庭小公司类多播组播类保留实验未来问题某公司有台主机用类不够用类又太多浪费资源有限这样分配太粗而且所有主机在一个广播域广播风暴安全隔离都成问题所以必须打破类的限制按实际需求切分地址块这就是子网划分的核心目的于是子网划分就此出现是什么无类别域间路由核心思想不再看第一个字节的前几位来判断是而是用斜杠数字表示网络位长度例如不管它是类我们说前位是网络号不管它是类我们说前位是网络号不管它是类我们说前位是网络号现在所有网络设备路由器交换机都支持而我们只需要记住私有地址范围面试常问类类类公有地址由分配全球唯一可用于互联网访问子网划分完全基于和子网掩码与无关什么是子网网络号相同的一组主机同一子网网络号相同的一组主机不同子网网络号不同的主机后文会提到子网把原来的一个网络再细分成多个更小的网络称为子网每个子网都能独立使用这样做有两个核心目的节约地址合理利用地址空间便于网络管理不同部门楼层或业务线用不同子网方便隔离与路由子网掩码子网划分的关键就是子网掩码它用来区分网络号和主机号它和地址配合告诉设备哪些位是网络部分哪些是主机部分常见写法等价于等价于等价于记住后面的数字网络位的总位数从左往右数的个数举个实际例子有一个类地址默认只能有个网络台主机但公司有个部门希望彼此隔离财务研发销售怎么办划分子网把改成网络位从位位多借位可用子网数个子网每个子网主机数台减是去掉网络地址和广播地址子网划分结果子网网络地址可用范围广播地址协议报头解析报头字节起包含版本长度总长标志偏移协议校验和源目的其中用于防环协议号决定上层协议校验和只保护报头分片靠偏移标志控制现代网络主要用和选项基本废弃报头标准长度字节无选项时报头最大长度字节带选项时本质是内核里的结构体中定义在字段名位数作用说明版本指定协议版本为为首部长度表示报头长度单位字节常见值为字节最大字节服务类型指导路由器如何转发可指定最小延迟最大吞吐最高可靠最低成本总长度报文整体长度头数据最大字节标识数据分片标识同一报文的所有分片使用相同标志控制分片行为含不分片和后续有分片片偏移当前分片在原报文中的偏移位置单位为字节生存时间报文能经过的最大路由跳数每过一跳减为时丢弃防止死循环协议指明的有效载荷交付上层的协议类型首部校验和检查报头是否被破坏每个路由器都要重新计算一次源地址发送端地址地址目的地址接收端地址地址可选项可变一些特殊用途如时间戳安全路由记录等路由器到底是什么路由器有多张网卡的特殊主机路由器本质是一台多网卡的专用主机每个物理逻辑接口网卡连接一个子网每个接口必须配置一个属于该子网的地址它在每个连接的子网中都相当于一台普通主机所以路由器本身属于多个子网但它不是普通主机不跑业务应用只转发路由器必须至少连接两个子网一张网卡对应一个子网两张网卡以上才能转发不同子网的数据所以路由器一定同时属于多个子网否则就叫单臂路由或根本不是路由器比如家用光猫只接一个其实是桥接接口连接子网配置这样它就能把子网和子网互联路由器接口通常是但不是强制规定一般路由器是子网中第一台设备方便识别所以它的地址常为网络号例如路由器常用因为网络地址不能用广播地址不能用最顺手易记这不是硬性规定而是一种行业约定便于统一管理但可以设成只要在子网范围内就行关键所有主机的默认网关要指向这个路由器的核心功能功能说明数据转发根据路由表选择下一跳把报文送到目标子网子网构建可以划分并管理局域网分配自动给新主机分配服务器功能转换私网公网转换实现上网访问防火墙过滤限制特定流量路由器不构建子网它连接子网子网是由地址子网掩码定义的逻辑网络物理上靠交换机网线连接逻辑上靠路由器互联子网是由地址和子网掩码定义的逻辑网络路由器通过多个接口连接不同子网每个接口配置对应子网的通常为负责跨子网转发和广播隔离子网划分基于仅用于自动分配地址非路由器核心功能特殊的地址我们把的位地址分成两部分网络号和主机号根据主机号的取值全全特殊段出现了几种特殊地址类型主机号情况举例含义特点网络地址主机号全为主机位全如表示整个子网不能分配给具体主机广播地址主机号全为主机位全如用于给子网内所有主机广播发包局域网广播不能分配给主机环回地址段常用回环测试本机通信仅本机可用不经过网卡私有地址特定保留段局域网内部使用即内网专用不能上公网可在局域网自由使用不可直接访问公网公网地址非保留段例由分配用于互联网通信唯一可路由特殊源地址具体含义需结合使用场景上下文进行判断不是真实地址而是占位符表示任意地址本机未配置默认路由等不能配置给主机路由表中表示默认网关提示主机号全代表网络本身主机号全代表该网络内的广播为什么不能通因为是网络地址不是主机地址数量限制为什么亿地址不够用是位二进制地址理论总数约亿实际可用远少于亿有大量地址被保留例如环回私网广播等每个设备的每张网卡都要一个一台服务器常常有多个网卡就要多个早期大公司如拿走了整段类地址万个导致地址分配不均造成巨大浪费网络分段地址浪费如传统类不能按主机数分配即使一台电脑也可能配多个虚拟主机容器等如何解决地址枯竭动态分配原理地址池共享设备上线时分配下线时回收优点提高利用率局限无法解决同时在线设备数可用公网的问题场景家庭公司路由器台设备但只有人同时在线只需个学校机房台电脑但分批使用复用网络地址转换最广泛应用原理内网用私有如出公网时由路由器将私有端口映射为一个公网不同端口效果成千上万台内网设备共享个公网上网公网看不到内网结构还提升了安全性类型源内网外网最常见目的外网内网如端口映射公网内网实现的或规则是解决地址不足的核心技术通过端口复用实现多对一映射终极解决方案地址长度位地址数地球每平方米可分配个特点无理论上每个设备都有公网自动配置报头更简洁支持流标签安全扩展虽然是未来但因历史包袱和成本仍是当前主流杂谈中国的技术目前遥遥领先中国的互联网设备数量庞大光是手机电脑物联网设备加起来早已超过这个数十倍所以必须找一个更大的地址空间方案就是对中国来说这意味着从根本上解决地址短缺层层嵌套等痛点问题从国家战略层面来说是为了实现自主可控下一代网络主导权是未来网络的核心基础涉及骨干网物联网云计算等所有领域早早布局可以减少对旧技术的依赖在全球网络标准中占据话语权为什么不能一键切换这点很多人误解了并不是的升级包而是一个全新的协议体系具体困难主要在三点不兼容设计和报头结构完全不同无法直接理解报文例如校验和地址长度都不同所以网络设备路由器应用软件都得重新支持全球网络规模太庞大互联网中有无数旧设备老系统银行工厂政府网络等仍在用不可能让全球数十亿设备在同一时刻同时换协议转换与过渡成本太高企业需要重新配置网络防火墙安全策略用户端还要兼容双栈运行否则很多旧网站上不了所以现在全球都采用双栈机制和并行运行慢慢过渡私网地址和公网地址私有用于内网通信公网全球唯一运营商通过光纤基站和分配构建网络基础设施全球互联网像大学层级体系靠子网掩码和路由表实现高效寻址技术将私有映射为公网使内网设备能访问互联网是时代解决地址枯竭的核心机制私有与公网谁负责内部谁负责对外对比私有公网定义仅在局域网内有效不能在互联网上路由不可直接上公网全球唯一可在互联网上直接通信用途局域网内部设备通信手机电脑摄像头全球互联网上通信全球唯一地址范围除私有地址保留地址外的所有地址谁分配用户管理员自行规划如家用路由器自动分配由如运营商逐级分配能否重复可以不同公司都用不可重复举例家用公司内网云服务器网站私有就像宿舍楼房间号只有本楼人懂公网是身份证号全国唯一运营商互联网的基建狂魔运营商即互联网服务提供商它们的作用可以分为两层基础设施建设铺设光纤建基站建骨干网机房等就像大学建教学楼宿舍楼操场提供物理层环境提供网络接入分配公网家庭宽带移动数据企业专线等提供接入服务光猫调制解调器把光纤信号转成电信号路由器再分发给内网设备路由器再给每台设备分配私有并通过技术借用一个公网出门上网维护骨干网确保跨省跨国流量高效转发全球互联网与网段划分大学的层级管理互联网的地址分配体系非常像大学的组织结构网络层级对应类比大学体系国际互联网数字分配管理机构全球地址总管家教育部统一分配全国高校编号区域互联网注册机构如等按大洲分配地址块教育厅给各省分配高校名额运营商如中国电信移动向用户企业提供公网省教育厅给某大学分配学号段如企业家庭网络使用私有或少量公网大学内部院系年级班级学生子网掩码划分网络边界学号结构前位院系中间位年级后位个人编号路由器跨子网转发班主任院办校务处负责信息在不同层级间传递学号类比每个学生设备都有唯一学号通常学号前几位能看出学院年级专业就像子网掩码划分出的网段如果学生证丢了被其他学院的人另一个网络捡到也能通过学号前缀快速查出属于哪个学院网段这就是路由转发原理私有网络与公网的关系靠桥接问题私有不能上公网因为公网路由器不认识会直接丢弃而且全球有无数个无法区分解决方案网络地址转换工作过程你访问路由器收到包把源改成自己的公网如端口映射为发往公网源目的百度回包给路由器查表还原为转发给你效果成千上万台内网设备共享个公网外网无法主动访问内网天然防火墙节省公网资源核心价值云服务器为什么需要公网因为我们要主动访问它如服务它必须有一个全球可达的地址所以云厂商会分配公网或通过弹性绑定技术的核心作用让有限的公网服务更多设备是什么网络地址转换它的本质是在数据包经过路由器时动态修改地址以及端口号以便多个内网设备共用一个公网上网为什么需要只有约亿个地址个但设备早就远超这个数量于是每个家庭公司内部设备电脑手机打印机都使用私有路由器对外只暴露一个公网技术负责在出入网时做翻译的工作过程假设家庭内网你的电脑路由器公网你访问百度时源目的百度在出网时做了替换源公网端口目的路由器保存一条映射表当百度返回数据时目的路由器查表发现要转给内网的于是数据成功回到你的电脑好处成千上万设备共享一个公网屏蔽内网结构提高安全性有效缓解地址不足问题的三种常见类型按转换粒度区分类型说明典型场景静态一对一映射内网服务器要对外提供服务动态多对多临时映射企业网络动态分配公网地址池端口复用多对一通过端口区分家用路由器校园网公司常用家用路由器几乎都是端口复用型因为只有一个公网但要让几十台设备同时上网必须通过不同端口区分大公司网络虽与家用网络共享路由原理但采用精细规划多层架构和有限策略对外服务通常直接使用公网以保障性能与可靠性其高昂费用主要来自公网专线带宽和高可用基础设施家庭路由器是的小型实现大公司机房是它的企业级放大版运营商卖的不是网速而是带宽公网资源可靠性路由转发原理报文如何找到回家的路基本逻辑所有报文的转发都是根据目的地址来决定的与源无关无论是主机还是路由器都维护着一张路由表都靠本地路由表决定下一跳去哪路由表每一项通常包括项目含义目的网络目标网段子网掩码区分网络号和主机号下一跳报文应该转发给的下一个路由器地址出口接口报文应从哪块网卡发出查找路由表的过程当主机要发送数据时它会先判断目标是否在同一网段用自己的与目标分别和子网掩码做按位与若结果相同同一网段直接通过局域网找通信若不同不同网段交给默认网关通常是路由器路由器转发时路由器查自己的路由表对每一条记录执行目标子网掩码找出最长匹配的网段即最长前缀匹配原则按照该记录指示的接口或下一跳转发比喻理解主机查路由表就像问路有人告诉你到市中心走这条路有明确路有人说我不知道但我知道到高速入口怎么走下一跳若没人知道就交给默认路由缺省出口大概转发过程主机家用路由器运营商路由器目标网络路由器主机每经过一个路由器路由器查路由表目的不变源目的每跳都会变数据链路层负责关键点网络层靠地址确定去哪数据链路层靠地址确定怎么到下一跳分片机制大报文如何被拆开传输为什么要分片因为不同链路的最大传输单元不同比如以太网字节若报文超过字节就必须拆分否则底层帧发不出去分片的字段结构报头里有三个关键字段字段作用位标识标识同一份数据同一报文分片的共同编号位标志控制分片行为位片偏移表示该分片在原报文中的偏移位置单位字节含义如下保留是否允许分片是否还有后续分片举例表示后面还有分片且表示仅此一个分片分片与组装分片在发送端或中间路由器完成组装必须在接收端完成如果一个分片丢了即使其他分片都到了整份报文也无法重组只能重传增加延迟和负担因此网络设计时会尽量避免分片会在三次握手阶段协商控制单次传输不超过常见字节为什么不建议分片增加路由器开销增加丢包概率丢一个片就得重传整个报文对实时性要求高的通信极其不利如视频流所以实际网络中分片尽量只在端系统进行路由器最好只转发不分片数据链路层简述局域网内的一跳通信报文转发靠查路由表逐跳找到目标网络若目标过大层会按进行分片接收端再组装而每一跳之间的实际传输靠帧完成只在局域网内有效虽然之后会细讲但这里要先有个框架可以先做一个简单了解主要作用负责点对点或点对多点的数据传输以帧为基本传输单位通过地址标识网络设备通信过程以以太网为例发送方将报文封装为帧帧头包含目的源类型字段所有主机都能收到这个帧只有目的匹配的主机才会上交给上层处理这一层只在局域网中有效数据一旦跨路由器转发地址必然变化数据帧长度与碰撞有效载荷字节过短帧会触发填充过长则被丢弃交换机通过分隔碰撞域减少冲突",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-10-08 12:00:00",postMainColor:""}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:(e,t,a)=>{if(0===a)return;const o={value:t,expiry:Date.now()+864e5*a};localStorage.setItem(e,JSON.stringify(o))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const a=JSON.parse(t);if(!(Date.now()>a.expiry))return a.value;localStorage.removeItem(e)}},e.getScript=(e,t={})=>new Promise((a,o)=>{const c=document.createElement("script");c.src=e,c.async=!0,c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},Object.keys(t).forEach(e=>{c.setAttribute(e,t[e])}),document.head.appendChild(c)}),e.getCSS=(e,t=!1)=>new Promise((a,o)=>{const c=document.createElement("link");c.rel="stylesheet",c.href=e,t&&(c.id=t),c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},document.head.appendChild(c)}),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#18171d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#f7f9fe")};const t=saveToLocal.get("theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches,o=window.matchMedia("(prefers-color-scheme: light)").matches,c=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!a&&!o&&!c;if(void 0===t){if(o)activateLightMode();else if(a)activateDarkMode();else if(c||n){const e=(new Date).getHours();e<=10||e>=20?activateDarkMode():activateLightMode()}window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>{void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode():activateLightMode())})}else"light"===t?activateLightMode():activateDarkMode();const d=saveToLocal.get("aside-status");void 0!==d&&("hide"===d?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/custom/css/font.css"><link rel="stylesheet" href="/custom/css/bilibili.css"><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="小米里的大麦" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/minbit.png"><div class="loading-image-dot"></div></div></div><script>const preloader={endLoading:()=>{document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",()=>{preloader.endLoading()}),setTimeout((function(){preloader.endLoading()}),1e4),document.addEventListener("pjax:send",()=>{preloader.initLoading()}),document.addEventListener("pjax:complete",()=>{preloader.endLoading()})</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">社交</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub"><img class="back-menu-item-icon" src="/img/icons/lollipop.svg" alt="GitHub"><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://leetcode.cn/u/nifty-faradayzqn" title="力扣"><img class="back-menu-item-icon" src="/img/icons/thinking-glass.svg" alt="力扣"><span class="back-menu-item-text">力扣</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="哔哩哔哩"><img class="back-menu-item-icon" src="/img/icons/wink.svg" alt="哔哩哔哩"><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/huang-cancan-xbc" title="Gitee"><img class="back-menu-item-icon" src="/img/icons/laugh.svg" alt="Gitee"><span class="back-menu-item-text">Gitee</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.csdn.net/Huangcancan666?type=blog" title="CSDN"><img class="back-menu-item-icon" src="/img/icons/celebrate.svg" alt="CSDN"><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3230789931118109" title="稀土掘金"><img class="back-menu-item-icon" src="/img/icons/kiss.svg" alt="稀土掘金"><span class="back-menu-item-text">稀土掘金</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">小米里的大麦</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 外链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div id="nav-naoDark"><div class="container"><div class="components"><div class="main-button"><div class="moon"></div><div class="moon"></div><div class="moon"></div></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="cloud"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="cloud-light"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="stars"><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div></div></div></div></div><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/wechat.webp" target="_blank"><img class="post-qr-code-img" alt="微信" src="/img/wechat.webp"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.webp" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/img/alipay.webp"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size:1.05rem">AI<sup>1</sup></a><a href="/tags/C/" style="font-size:1.05rem">C++<sup>8</sup></a><a href="/tags/ChatGPT/" style="font-size:1.05rem">ChatGPT<sup>1</sup></a><a href="/tags/Git/" style="font-size:1.05rem">Git<sup>3</sup></a><a href="/tags/IO/" style="font-size:1.05rem">IO<sup>5</sup></a><a href="/tags/Linux/" style="font-size:1.05rem">Linux<sup>58</sup></a><a href="/tags/MySQL/" style="font-size:1.05rem">MySQL<sup>4</sup></a><a href="/tags/Obsidian/" style="font-size:1.05rem">Obsidian<sup>1</sup></a><a href="/tags/Redis/" style="font-size:1.05rem">Redis<sup>2</sup></a><a href="/tags/STL/" style="font-size:1.05rem">STL<sup>2</sup></a><a href="/tags/VS-Code/" style="font-size:1.05rem">VS Code<sup>1</sup></a><a href="/tags/%E4%B8%B4%E6%97%B6%E9%82%AE%E7%AE%B1/" style="font-size:1.05rem">临时邮箱<sup>1</sup></a><a href="/tags/%E4%BF%A1%E5%8F%B7/" style="font-size:1.05rem">信号<sup>3</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size:1.05rem">内存管理<sup>1</sup></a><a href="/tags/%E5%8E%86%E7%A8%8B/" style="font-size:1.05rem">历程<sup>1</sup></a><a href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" style="font-size:1.05rem">地址空间<sup>6</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size:1.05rem">数学<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size:1.05rem">模板<sup>1</sup></a><a href="/tags/%E7%AE%A1%E9%81%93/" style="font-size:1.05rem">管道<sup>2</sup></a><a href="/tags/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" style="font-size:1.05rem">类与对象<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size:1.05rem">线程<sup>4</sup></a><a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size:1.05rem">网站<sup>3</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size:1.05rem">网络<sup>11</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size:1.05rem">进程<sup>15</sup></a></div></div><hr></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多"> <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/11/"><span class="card-archive-list-date">十一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">十月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">八月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div id="console-naoDark"><div class="container"><div class="components"><div class="main-button"><div class="moon"></div><div class="moon"></div><div class="moon"></div></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="cloud"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="cloud-light"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="stars"><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div></div></div></div></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Linux/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>Linux</span></a><a class="article-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>网络</span></a></span></div></div><h1 class="post-title" itemprop="name headline">053 网络层 —— IP 协议</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-10-08T04:00:00.000Z" title="发表于 2025-10-08 12:00:00">2025-10-08</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-10-08T04:00:00.000Z" title="更新于 2025-10-08 12:00:00">2025-10-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">6.7k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" data-flag-title="053 网络层 —— IP 协议"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"> </span><span class="post-meta-position" title="作者IP属地为西安"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>西安</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://zycs-img-8kd.pages.dev/v2/uH1MN2u.png?_r_=86bfdbff-e801-cb71-51c7-49f92f8b1ef9"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">小米里的大麦 GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://www.minbit.top/posts/60727.html"><header><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a><a href="/tags/Linux/" tabindex="-1" itemprop="url">Linux</a><a href="/tags/%E7%BD%91%E7%BB%9C/" tabindex="-1" itemprop="url">网络</a><h1 id="CrawlerTitle" itemprop="name headline">053 网络层 —— IP 协议</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">小米里的大麦</span><time itemprop="dateCreated datePublished" datetime="2025-10-08T04:00:00.000Z" title="发表于 2025-10-08 12:00:00">2025-10-08</time><time itemprop="dateCreated datePublished" datetime="2025-10-08T04:00:00.000Z" title="更新于 2025-10-08 12:00:00">2025-10-08</time></header><h1 id="网络层-——-IP-协议"><a href="#网络层-——-IP-协议" class="headerlink" title="网络层 —— IP 协议"></a>网络层 —— IP 协议</h1><blockquote><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chenlong_cxy/article/details/125837340">网络层协议 ——— IP 协议 | CSDN</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_73281594/article/details/147008726">网络层 IP 协议 | CSDN</a></p><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1HL41117tZ/?share_source=copy_web&vd_source=872e5e3ccf44874c39edaf42e30ab0de">为什么大家的 IP 都是 192.168 开头的？| B 站（荐）</a></p><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1DD4y127r4/?share_source=copy_web&vd_source=872e5e3ccf44874c39edaf42e30ab0de">【硬核科普】IP 地址是什么东西？IPV6 和 IPV4 有什么区别？公网 IP 和私有 IP 又是什么？| B 站（荐）</a></p></blockquote><h2 id="1-IP-地址的本质：网络号-主机号"><a href="#1-IP-地址的本质：网络号-主机号" class="headerlink" title="1. IP 地址的本质：网络号 + 主机号"></a>1. IP 地址的本质：网络号 + 主机号</h2><p>IP 地址由两部分组成：</p><table><thead><tr><th>部分</th><th>作用</th><th>举例</th></tr></thead><tbody><tr><td><strong>网络号 (Network ID)</strong></td><td>表示属于哪个子网</td><td>192.168.10.<strong>0</strong></td></tr><tr><td><strong>主机号 (Host ID)</strong></td><td>表示子网内的哪台主机</td><td>192.168.10.<strong>15</strong></td></tr></tbody></table><p><strong>规律：</strong></p><ul><li><strong>同一子网内</strong>：网络号相同，主机号不同。</li><li><strong>不同子网</strong>：网络号不同，主机号可以重复。</li></ul><p><strong>举例：</strong></p><ul><li>子网 A：192.168.1.0&#x2F;24</li><li>子网 B：192.168.2.0&#x2F;24</li></ul><p>两个子网的主机号范围都可是 1–254，不冲突，因为网络号不同。</p><h2 id="2-IP-地址划分基础"><a href="#2-IP-地址划分基础" class="headerlink" title="2. IP 地址划分基础"></a>2. IP 地址划分基础</h2><h3 id="1-划分目的"><a href="#1-划分目的" class="headerlink" title="1. 划分目的"></a>1. 划分目的</h3><blockquote><p><strong>根本目的就是为了高效管理、节省地址、提升安全和性能。</strong></p></blockquote><p>最初，互联网只分为 <strong>A、B、C 类地址</strong>（分类地址），但从 1993 年起，RFC 1519 正式引入 CIDR，<strong>CIDR（无类别域间路由） + 子网掩码灵活划分</strong> 彻底取代了 A&#x2F;B&#x2F;C 类的刚性结构，于是就出现了现代 IP 地址分类图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20251007173226991.png" alt="PixPin_2025-10-07_17-32-21"></p><table><thead><tr><th>类别</th><th>起始位</th><th>首字节范围</th><th>网络（号）位数</th><th>主机（号）位数</th><th>用途</th><th>典型示例</th></tr></thead><tbody><tr><td>A 类</td><td>0</td><td>0–127</td><td>8</td><td>24</td><td>特大型网络</td><td>10.0.0.0</td></tr><tr><td>B 类</td><td>10</td><td>128–191</td><td>16</td><td>16</td><td>中型网络</td><td>172.16.0.0</td></tr><tr><td>C 类</td><td>110</td><td>192–223</td><td>24</td><td>8</td><td>小型网络（家庭&#x2F;小公司）</td><td>192.168.0.0</td></tr><tr><td>D 类</td><td>1110</td><td>224–239</td><td>——</td><td>——</td><td>多播&#x2F;组播（Multicast）</td><td>224.0.0.1</td></tr><tr><td>E 类</td><td>11110</td><td>240–255</td><td>——</td><td>——</td><td>保留（实验&#x2F;未来）</td><td>240.0.0.0</td></tr></tbody></table><p><strong>问题</strong>：</p><ul><li>某公司有 1000 台主机，用 C 类不够（254），用 B 类又太多（浪费），IP 资源有限，这样分配太粗。</li><li>而且所有主机在一个广播域，广播风暴、安全隔离都成问题。</li></ul><p><strong>所以，必须打破 A&#x2F;B&#x2F;C 类的限制，按实际需求“切分”IP 地址块</strong> —— 这就是 <strong>子网划分</strong> 的核心目的，于是 <strong>子网划分</strong> 就此出现。</p><h3 id="2-CIDR-是什么？"><a href="#2-CIDR-是什么？" class="headerlink" title="2. CIDR 是什么？"></a>2. CIDR 是什么？</h3><p><strong>CIDR &#x3D; Classless Inter-Domain Routing（无类别域间路由），核心思想：不再看第一个字节的前几位来判断是 A&#x2F;B&#x2F;C，而是用“斜杠 + 数字”表示网络位长度。</strong> 例如：</p><ul><li><code>192.168.1.0/24</code> → 不管它是 C 类，我们说“前 24 位是网络号”</li><li><code>10.0.0.0/8</code> → 不管它是 A 类，我们说“前 8 位是网络号”</li><li><code>172.16.0.0/16</code> → 不管它是 B 类，我们说“前 16 位是网络号”</li></ul><p><strong>现在所有网络设备（路由器、交换机、Linux、Windows）都支持 CIDR！</strong> 而我们只需要记住：</p><ol><li><strong>私有 IP 地址范围（面试常问！）</strong><ul><li>A 类：<code>10.0.0.0/8</code> → 10.0.0.0 ~ 10.255.255.255。</li><li>B 类：<code>172.16.0.0/12</code> → 172.16.0.0 ~ 172.31.255.255。</li><li>C 类：<code>192.168.0.0/16</code> → 192.168.0.0 ~ 192.168.255.255。</li></ul></li><li><strong>公有 IP 地址</strong> → 由 ISP 分配，全球唯一，可用于互联网访问。</li><li><strong>子网划分完全基于 CIDR 和子网掩码，与 A&#x2F;B&#x2F;C 无关！</strong></li></ol><h3 id="3-什么是子网（Subnet）——-网络号相同的一组主机"><a href="#3-什么是子网（Subnet）——-网络号相同的一组主机" class="headerlink" title="3. 什么是子网（Subnet）—— 网络号相同的一组主机"></a>3. 什么是子网（Subnet）—— 网络号相同的一组主机</h3><blockquote><p><strong>同一子网：网络号相同的一组主机；不同子网：网络号不同的主机。后文会提到。</strong></p></blockquote><p><strong>子网</strong>：把原来的一个网络再细分成多个更小的网络（称为“子网”），每个子网都能独立使用。这样做有两个核心目的：</p><ol><li><strong>节约 IP 地址</strong> —— 合理利用地址空间。</li><li><strong>便于网络管理</strong> —— 不同部门、楼层或业务线用不同子网，方便隔离与路由。</li></ol><h3 id="4-子网掩码（Subnet-Mask）"><a href="#4-子网掩码（Subnet-Mask）" class="headerlink" title="4. 子网掩码（Subnet Mask）"></a>4. 子网掩码（Subnet Mask）</h3><p>子网划分的关键就是 <strong>子网掩码</strong>，它用来区分“网络号”和“主机号”。它和 IP 地址配合，告诉设备：“哪些位是网络部分，哪些是主机部分”。常见写法：</p><ul><li><code>255.255.255.0</code>（等价于 <code>/24</code>）。</li><li><code>255.255.0.0</code>（等价于 <code>/16</code>）。</li><li><code>255.255.255.128</code>（等价于 <code>/25</code>）。</li></ul><blockquote><p><strong>记住：&#x2F;后面的数字 &#x3D; 网络位的总位数（从左往右数 1 的个数）</strong></p></blockquote><h4 id="1-举个实际例子"><a href="#1-举个实际例子" class="headerlink" title="1. 举个实际例子"></a>1. 举个实际例子</h4><p>有一个 C 类地址：<code>192.168.1.0/24</code>，默认只能有 1 个网络，254 台主机（192.168.1.1 ~ 192.168.1.254）。但公司有 <strong>3 个部门</strong>，希望彼此隔离（财务、研发、销售），怎么办？</p><p><strong>划分子网！</strong> 把 <code>/24</code> 改成 <code>/26</code>：</p><ul><li>网络位从 24 位 → 26 位（多借 2 位）。</li><li>可用子网数：2² &#x3D; <strong>4 个子网</strong>。</li><li>每个子网主机数：2^(32-26) - 2 &#x3D; 64 - 2 &#x3D; <strong>62 台</strong>（减 2 是去掉网络地址和广播地址）。</li></ul><p>子网划分结果：</p><table><thead><tr><th>子网</th><th>网络地址</th><th>可用 IP 范围</th><th>广播地址</th></tr></thead><tbody><tr><td>1</td><td>192.168.1.0</td><td>192.168.1.1 ~ 192.168.1.62</td><td>192.168.1.63</td></tr><tr><td>2</td><td>192.168.1.64</td><td>192.168.1.65 ~ 192.168.1.126</td><td>192.168.1.127</td></tr><tr><td>3</td><td>192.168.1.128</td><td>…</td><td>192.168.1.191</td></tr><tr><td>4</td><td>192.168.1.192</td><td>…</td><td>192.168.1.255</td></tr></tbody></table><hr><h2 id="3-IP（IPv4）-协议报头解析"><a href="#3-IP（IPv4）-协议报头解析" class="headerlink" title="3. IP（IPv4） 协议报头解析"></a>3. IP（IPv4） 协议报头解析</h2><blockquote><p>IPv4 报头 20 字节起，包含版本、长度、TOS、总长、ID、标志、偏移、TTL、协议、校验和、源&#x2F;目的 IP。其中 TTL 用于防环，协议号决定上层协议，校验和只保护报头，分片靠 ID + 偏移 + 标志控制。现代网络主要用 CIDR 和 TTL&#x2F;Protocol，选项基本废弃。</p><ul><li><strong>IP 报头标准长度 &#x3D; 20 字节</strong>（无选项时）</li><li><strong>IP 报头最大长度 &#x3D; 60 字节</strong>（带选项时）</li><li><strong>本质是内核里的结构体</strong>：<code>struct iphdr</code>（Linux 中定义在 <code>&lt;linux/ip.h&gt;</code>）</li></ul></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20251007174941328.png" alt="PixPin_2025-10-07_17-49-36"></p><table><thead><tr><th>字段名</th><th>位数</th><th>作用</th><th>说明</th></tr></thead><tbody><tr><td><strong>版本 (Version)</strong></td><td>4</td><td>指定 IP 协议版本</td><td>IPv4 为 4，IPv6 为 6</td></tr><tr><td><strong>首部长度 (IHL)</strong></td><td>4</td><td>表示报头长度（单位：4 字节）</td><td>常见值为 5 → 5×4 &#x3D; 20 字节；最大 15→60 字节</td></tr><tr><td><strong>服务类型 (TOS &#x2F; DSCP)</strong></td><td>8</td><td>指导路由器如何转发（QoS）</td><td>可指定最小延迟、最大吞吐、最高可靠、最低成本</td></tr><tr><td><strong>总长度 (Total Length)</strong></td><td>16</td><td>报文整体长度（头 + 数据）</td><td>最大 65535 字节</td></tr><tr><td><strong>标识 (Identification)</strong></td><td>16</td><td>数据分片标识</td><td>同一报文的所有分片使用相同 ID</td></tr><tr><td><strong>标志 (Flags)</strong></td><td>3</td><td>控制分片行为</td><td>含 DF（不分片）和 MF（后续有分片）</td></tr><tr><td><strong>片偏移 (Fragment Offset)</strong></td><td>13</td><td>当前分片在原报文中的偏移位置</td><td>单位为 8 字节</td></tr><tr><td><strong>生存时间 (TTL)</strong></td><td>8</td><td>报文能经过的最大路由跳数</td><td>每过一跳减 1，为 0 时丢弃，防止死循环</td></tr><tr><td><strong>协议 (Protocol)</strong></td><td>8</td><td>指明 IP 的有效载荷交付上层的协议类型</td><td>TCP &#x3D; 6，UDP &#x3D; 17，ICMP &#x3D; 1</td></tr><tr><td><strong>首部校验和 (Header Checksum)</strong></td><td>16</td><td>检查报头是否被破坏</td><td>每个路由器都要重新计算一次</td></tr><tr><td><strong>源 IP 地址 (Source Address)</strong></td><td>32</td><td>发送端地址</td><td>IPv4 地址</td></tr><tr><td><strong>目的 IP 地址 (Destination Address)</strong></td><td>32</td><td>接收端地址</td><td>IPv4 地址</td></tr><tr><td><strong>可选项 (Options)</strong></td><td>可变</td><td>一些特殊用途</td><td>如时间戳、安全、路由记录等</td></tr></tbody></table><hr><h2 id="4-路由器到底是什么？"><a href="#4-路由器到底是什么？" class="headerlink" title="4. 路由器到底是什么？"></a>4. 路由器到底是什么？</h2><blockquote><p><strong>路由器 &#x3D; 有多张网卡的特殊主机。</strong></p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20251007183027623.png" alt="PixPin_2025-10-07_18-30-22"></p><h3 id="1-路由器本质是一台多网卡的专用主机"><a href="#1-路由器本质是一台多网卡的专用主机" class="headerlink" title="1. 路由器本质是一台多网卡的专用主机"></a>1. 路由器本质是一台多网卡的专用主机</h3><p>每个物理&#x2F;逻辑接口（网卡）连接一个子网，每个接口必须配置一个 <strong>属于该子网的 IP 地址</strong>，它在每个连接的子网中，都相当于一台普通主机。所以：<strong>路由器本身“属于”多个子网</strong>，但它 <strong>不是普通主机</strong>（不跑业务应用，只转发）。</p><h3 id="2-路由器必须至少连接两个子网"><a href="#2-路由器必须至少连接两个子网" class="headerlink" title="2. 路由器必须至少连接两个子网"></a>2. 路由器必须至少连接两个子网</h3><p>一张网卡对应一个子网，两张网卡以上才能“转发”不同子网的数据，所以路由器一定“同时属于多个子网”。否则就叫“单臂路由”或根本不是路由器（比如家用光猫只接一个 LAN，其实是桥接）。</p><table><thead><tr><th>接口</th><th>连接子网</th><th>配置 IP</th></tr></thead><tbody><tr><td>eth0</td><td>192.168.1.0&#x2F;24</td><td>192.168.1.1</td></tr><tr><td>eth1</td><td>192.168.2.0&#x2F;24</td><td>192.168.2.1</td></tr></tbody></table><p>这样它就能把 A 子网和 B 子网互联。</p><h3 id="3-路由器接口-IP-通常是-1，但不是强制规定！"><a href="#3-路由器接口-IP-通常是-1，但不是强制规定！" class="headerlink" title="3. 路由器接口 IP 通常是 .1，但不是强制规定！"></a>3. 路由器接口 IP 通常是 .1，但不是强制规定！</h3><p>一般路由器是子网中第一台设备（方便识别）。所以它的地址常为 <strong>“网络号 + .1”</strong>。例如：192.168.10.0&#x2F;24 → 路由器常用 IP：192.168.10.1，因为：</p><ul><li><p>网络地址（.0）不能用、广播地址（.255）不能用</p></li><li><p>.1 最顺手、易记（这不是硬性规定，而是一种行业约定，便于统一管理）。</p></li><li><p>但可以设成 .254、.100，只要在子网范围内就行！</p></li></ul><p><strong>关键</strong>：所有主机的“默认网关”要指向这个 IP。</p><h3 id="4-路由器的核心功能"><a href="#4-路由器的核心功能" class="headerlink" title="4. 路由器的核心功能"></a>4. 路由器的核心功能</h3><table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td><strong>数据转发</strong></td><td>根据路由表选择下一跳，把 IP 报文送到目标子网</td></tr><tr><td><strong>子网构建</strong></td><td>可以划分并管理局域网（LAN）</td></tr><tr><td><strong>DHCP 分配</strong></td><td>自动给新主机分配 IP（DHCP 服务器功能）</td></tr><tr><td><strong>NAT 转换</strong></td><td>私网 IP ↔ 公网 IP 转换，实现上网访问</td></tr><tr><td><strong>防火墙 &#x2F; ACL</strong></td><td>过滤、限制特定流量</td></tr></tbody></table><blockquote><p><strong>路由器不“构建”子网，它“连接”子网！</strong> 子网是由 <strong>IP 地址 + 子网掩码</strong> 定义的逻辑网络，物理上靠交换机&#x2F;网线连接，逻辑上靠路由器互联。</p></blockquote><blockquote><p>“子网是由 IP 地址和子网掩码定义的逻辑网络，路由器通过多个接口连接不同子网，每个接口配置对应子网的 IP（通常为 .1），负责跨子网 IP 转发和广播隔离。子网划分基于 CIDR，DHCP 仅用于自动分配地址，非路由器核心功能。”</p></blockquote><hr><h2 id="5-特殊的-IP-地址"><a href="#5-特殊的-IP-地址" class="headerlink" title="5. 特殊的 IP 地址"></a>5. 特殊的 IP 地址</h2><p>我们把 IPv4 的 32 位地址分成两部分：<strong>网络号（Net ID）</strong> 和 <strong>主机号（Host ID）</strong>。根据主机号的取值（全 0、全 1、特殊段），出现了几种特殊地址：</p><table><thead><tr><th>类型</th><th>主机号情况</th><th>举例</th><th>含义</th><th>特点</th></tr></thead><tbody><tr><td><strong>网络地址</strong></td><td>主机号全为 0</td><td><code>xxx.xxx.xxx.0</code>（主机位全 0） 如 <code>192.168.1.0/24</code></td><td>表示整个子网</td><td>不能分配给具体主机</td></tr><tr><td><strong>广播地址</strong></td><td>主机号全为 1</td><td><code>xxx.xxx.xxx.255</code>（主机位全 1） 如&#96;&#96;192.168.1.255&#x2F;24&#96;</td><td>用于给子网内所有主机广播&#x2F;发包</td><td>局域网广播，不能分配给主机</td></tr><tr><td><strong>环回地址</strong></td><td><code>127.0.0.0/8</code> 段</td><td>常用 <code>127.0.0.1</code></td><td>回环测试（本机通信）</td><td>仅本机可用，不经过网卡</td></tr><tr><td><strong>私有地址</strong></td><td>特定保留段</td><td><code>10.0.0.0/8</code>&#x2F;<code>172.16.0.0/12</code>&#x2F;<code>192.168.0.0/16</code></td><td>局域网内部使用，即内网专用，不能上公网</td><td>可在局域网自由使用，不可直接访问公网</td></tr><tr><td><strong>公网地址</strong></td><td>非保留段</td><td>例：<code>8.8.8.8</code></td><td>由 ISP 分配，用于互联网通信</td><td>唯一、可路由</td></tr><tr><td><strong>0.0.0.0</strong></td><td>特殊源地址</td><td>具体含义需结合使用场景、上下文进行判断</td><td>不是真实地址，而是占位符。表示“任意地址”&#x2F;“本机未配置 IP”&#x2F;“默认路由” 等</td><td>不能配置给主机，路由表中表示默认网关</td></tr></tbody></table><blockquote><p>提示：</p><ul><li>主机号全 0：代表“网络本身”。</li><li>主机号全 1：代表“该网络内的广播”。</li><li>“为什么不能 ping 通 192.168.1.0？” → 因为是网络地址，不是主机。</li></ul></blockquote><h2 id="6-IPv4-地址数量限制"><a href="#6-IPv4-地址数量限制" class="headerlink" title="6. IPv4 地址数量限制"></a>6. IPv4 地址数量限制</h2><h3 id="1-为什么“43-亿”-IP-地址不够用？"><a href="#1-为什么“43-亿”-IP-地址不够用？" class="headerlink" title="1. 为什么“43 亿” IP 地址不够用？"></a>1. 为什么“43 亿” IP 地址不够用？</h3><p><strong>IPv4 是 32 位二进制地址，理论总数：2³² &#x3D; 4,294,967,296（约 43 亿）。 实际可用远少于 43 亿：</strong></p><ul><li>有大量地址被保留（例如环回、私网、广播等）。</li><li>每个设备的 <strong>每张网卡</strong> 都要一个 IP（一台服务器常常有多个网卡，就要多个 IP）。</li><li>早期大公司（如 MIT、Ford）拿走了整段 A 类地址（1600 万个 IP），导致 <strong>地址分配不均</strong>，造成巨大浪费。</li><li>网络分段、地址浪费（如传统 A&#x2F;B&#x2F;C 类）。</li><li><strong>不能按主机数分配</strong>：即使一台电脑，也可能配多个 IP（虚拟主机、容器等）。</li></ul><h3 id="2-如何解决-IPv4-地址枯竭？"><a href="#2-如何解决-IPv4-地址枯竭？" class="headerlink" title="2. 如何解决 IPv4 地址枯竭？"></a>2. 如何解决 IPv4 地址枯竭？</h3><h4 id="1-动态分配-IP（DHCP）"><a href="#1-动态分配-IP（DHCP）" class="headerlink" title="1. 动态分配 IP（DHCP）"></a>1. 动态分配 IP（DHCP）</h4><p><strong>原理：IP 地址池共享，设备上线时分配，下线时回收。优点：提高利用率，局限：无法解决“同时在线设备数 &gt; 可用公网 IP”的问题。</strong> 场景：</p><ul><li>家庭&#x2F;公司路由器：100 台设备，但只有 50 人同时在线 → 只需 50 个 IP。</li><li>学校机房：500 台电脑，但分批使用 → IP 复用。</li></ul><h4 id="2-NAT（网络地址转换）——-最广泛应用！"><a href="#2-NAT（网络地址转换）——-最广泛应用！" class="headerlink" title="2. NAT（网络地址转换）—— 最广泛应用！"></a>2. NAT（网络地址转换）—— 最广泛应用！</h4><p><strong>原理：内网用私有 IP（如 192.168.x.x），出公网时由路由器将 私有 IP + 端口 映射为 一个公网 IP + 不同端口。</strong></p><ul><li><strong>效果：</strong> 成千上万台内网设备，<strong>共享 1 个公网 IP</strong> 上网，公网看不到内网结构，还提升了安全性。</li><li><strong>类型：</strong><ul><li><strong>SNAT（源 NAT）</strong>：内网 → 外网（最常见）。</li><li><strong>DNAT（目的 NAT）</strong>：外网 → 内网（如端口映射：公网 80 → 内网 192.168.1.100:80）。</li></ul></li><li><strong>Linux 实现</strong>：<code>iptables</code> &#x2F; <code>nftables</code> 的 <code>MASQUERADE</code> 或 <code>SNAT</code> 规则。</li></ul><blockquote><p>NAT 是解决 IPv4 地址不足的核心技术，通过端口复用实现多对一映射。</p></blockquote><h4 id="3-IPv6-——-终极解决方案"><a href="#3-IPv6-——-终极解决方案" class="headerlink" title="3. IPv6 —— 终极解决方案"></a>3. IPv6 —— 终极解决方案</h4><p><strong>地址长度</strong>：128 位 → 地址数 &#x3D; 2¹²⁸ ≈ <strong>3.4×10³⁸</strong>（地球每平方米可分配 10²⁸ 个 IP！）。特点：</p><ul><li>无 NAT（理论上每个设备都有公网 IP）。</li><li>自动配置（SLAAC）。</li><li>报头更简洁，支持流标签、安全扩展。</li></ul><blockquote><p>虽然 IPv6 是未来，但因历史包袱和成本，IPv4 + NAT 仍是当前主流。</p></blockquote><h3 id="3-杂谈"><a href="#3-杂谈" class="headerlink" title="3. 杂谈"></a>3. 杂谈</h3><blockquote><p>中国的 IPv6 技术目前遥遥领先！</p></blockquote><p>中国的互联网设备数量庞大——光是手机、电脑、物联网设备加起来，早已超过这个数十倍。所以必须找一个更大的地址空间方案，就是 IPv6。对中国来说，这意味着 <strong>从根本上解决地址短缺、NAT 层层嵌套等痛点问题。从国家战略层面来说：是为了实现自主可控 + 下一代网络主导权：</strong></p><ul><li>IPv6 是未来网络的核心基础，涉及骨干网、物联网、云计算、AI 等所有领域。</li><li>早早布局 IPv6，可以减少对旧技术的依赖，<strong>在全球网络标准中占据话语权</strong>。</li></ul><h4 id="1-为什么不能“一键切换”-IPv4-→-IPv6？"><a href="#1-为什么不能“一键切换”-IPv4-→-IPv6？" class="headerlink" title="1. 为什么不能“一键切换” IPv4 → IPv6？"></a>1. 为什么不能“一键切换” IPv4 → IPv6？</h4><p>这点很多人误解了。IPv6 并不是 IPv4 的“升级包”，而是一个 <strong>全新的协议体系</strong>。具体困难主要在三点：</p><ol><li><strong>不兼容设计：</strong> IPv4 和 IPv6 报头结构完全不同，IPv6 无法直接理解 IPv4 报文（例如校验和、地址长度都不同）。所以 IPv4 网络设备、路由器、应用软件都得重新支持 IPv6。</li><li><strong>全球网络规模太庞大：</strong> 互联网中有无数旧设备、老系统（银行、工厂、政府网络等）仍在用 IPv4，不可能让全球数十亿设备在同一时刻同时换协议。</li><li><strong>转换与过渡成本太高：</strong> 企业需要重新配置网络、防火墙、DNS、安全策略，用户端还要兼容双栈（IPv4 + IPv6）运行，否则很多旧网站上不了。<strong>所以现在全球都采用“双栈机制”：IPv4 和 IPv6 并行运行，慢慢过渡。</strong></li></ol><hr><h2 id="7-私网-IP-地址和公网-IP-地址"><a href="#7-私网-IP-地址和公网-IP-地址" class="headerlink" title="7. 私网 IP 地址和公网 IP 地址"></a>7. 私网 IP 地址和公网 IP 地址</h2><blockquote><p>私有 IP 用于内网通信，公网 IP 全球唯一；运营商通过光纤、基站和 IP 分配构建网络基础设施；全球互联网像大学层级体系，靠子网掩码和路由表实现高效寻址；NAT 技术将私有 IP 映射为公网 IP，使内网设备能访问互联网，是 IPv4 时代解决地址枯竭的核心机制。</p></blockquote><h3 id="1-私有-IP-与-公网-IP：谁负责“内部”，谁负责“对外”"><a href="#1-私有-IP-与-公网-IP：谁负责“内部”，谁负责“对外”" class="headerlink" title="1. 私有 IP 与 公网 IP：谁负责“内部”，谁负责“对外”"></a>1. 私有 IP 与 公网 IP：谁负责“内部”，谁负责“对外”</h3><table><thead><tr><th align="center">对比</th><th>私有 IP</th><th>公网 IP</th></tr></thead><tbody><tr><td align="center"><strong>定义</strong></td><td>仅在局域网内有效，<strong>不能在互联网上路由（不可直接上公网）</strong></td><td>全球唯一，<strong>可在互联网上直接通信</strong></td></tr><tr><td align="center"><strong>用途</strong></td><td>局域网内部设备通信（手机、电脑、摄像头）</td><td>全球互联网上通信（全球唯一）</td></tr><tr><td align="center"><strong>地址范围</strong></td><td>-<code>10.0.0.0/8</code>（10.x.x.x） -<code>172.16.0.0/12</code>（172.16~31.x.x） -<code>192.168.0.0/16</code>（192.168.x.x）</td><td>除私有地址、保留地址外的所有 IPv4 地址</td></tr><tr><td align="center"><strong>谁分配</strong></td><td>用户&#x2F;管理员自行规划（如家用路由器自动分配）</td><td>由 <strong>IANA → RIR（如 APNIC）→ ISP（运营商）</strong> 逐级分配</td></tr><tr><td align="center"><strong>能否重复</strong></td><td>可以（不同公司都用 192.168.1.0&#x2F;24）</td><td>不可重复</td></tr><tr><td align="center"><strong>举例</strong></td><td>家用 WiFi、公司内网</td><td>云服务器、网站 IP</td></tr></tbody></table><blockquote><p>私有 IP 就像“宿舍楼房间号”，只有本楼人懂；公网 IP 是“身份证号”，全国唯一。</p></blockquote><h3 id="2-运营商：互联网的“基建狂魔”"><a href="#2-运营商：互联网的“基建狂魔”" class="headerlink" title="2. 运营商：互联网的“基建狂魔”"></a>2. 运营商：互联网的“基建狂魔”</h3><p>运营商即互联网服务提供商，它们的作用可以分为两层：</p><ol><li><p><strong>基础设施建设：</strong> 铺设光纤、建基站、建骨干网、机房、IDC 等，就像大学建教学楼、宿舍楼、操场，提供“物理层”环境。</p></li><li><p><strong>提供网络接入：</strong></p><ul><li><p><strong>分配公网 IP</strong>：家庭宽带、移动数据、企业专线等。</p></li><li><p><strong>提供接入服务</strong>：光猫（调制解调器）把光纤信号转成电信号，路由器再分发给内网设备，路由器再给每台设备分配 <strong>私有 IP</strong>，并通过 NAT 技术“借用”一个 <strong>公网 IP</strong> 出门上网。</p></li><li><p><strong>维护骨干网</strong>：确保跨省、跨国流量高效转发。</p></li></ul></li></ol><hr><h3 id="3-全球互联网与网段划分-——-大学的“层级管理”"><a href="#3-全球互联网与网段划分-——-大学的“层级管理”" class="headerlink" title="3. 全球互联网与网段划分 —— 大学的“层级管理”"></a>3. 全球互联网与网段划分 —— 大学的“层级管理”</h3><p>互联网的 IP 地址分配体系非常像大学的组织结构：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20251008003448484.png" alt="PixPin_2025-10-08_00-34-43"></p><table><thead><tr><th>网络层级</th><th>对应</th><th>类比：大学体系</th></tr></thead><tbody><tr><td><strong>IANA</strong>（国际互联网数字分配&#x2F;管理机构）</td><td>全球 IP 地址总管家</td><td>教育部：统一分配全国高校编号</td></tr><tr><td><strong>RIR</strong>（区域互联网注册机构，如 APNIC、ARIN 等）</td><td>按大洲分配地址块</td><td>教育厅：给各省分配高校名额</td></tr><tr><td><strong>ISP</strong>（运营商，如中国电信、移动）</td><td>向用户&#x2F;企业提供公网 IP</td><td>省教育厅 → 给某大学分配学号段（如 20250001~20259999）</td></tr><tr><td><strong>企业&#x2F;家庭网络</strong></td><td>使用私有 IP 或少量公网 IP</td><td>大学内部：院系 → 年级 → 班级 → 学生</td></tr><tr><td><strong>子网掩码</strong></td><td>划分网络边界</td><td>学号结构：前 4 位 &#x3D; 院系，中间 2 位 &#x3D; 年级，后 4 位 &#x3D; 个人编号</td></tr><tr><td><strong>路由器</strong></td><td>跨子网转发</td><td>班主任、院办、校务处：负责信息在不同层级间传递</td></tr></tbody></table><p><strong>学号类比：</strong> 每个学生（设备）都有唯一“学号”（IP），通常学号前几位能看出学院、年级、专业（就像子网掩码划分出的网段），如果学生证（IP）丢了，被其他学院的人（另一个网络）捡到，也能通过学号前缀快速查出属于哪个学院（网段）——这就是 <strong>路由转发原理</strong>。</p><hr><h3 id="4-私有网络与公网的关系：靠-NAT-桥接"><a href="#4-私有网络与公网的关系：靠-NAT-桥接" class="headerlink" title="4. 私有网络与公网的关系：靠 NAT 桥接"></a>4. 私有网络与公网的关系：靠 NAT 桥接</h3><p><strong>问题：</strong> 私有 IP 不能上公网！因为公网路由器 <strong>不认识</strong> <code>192.168.1.100</code>，会直接丢弃，而且全球有无数个 <code>192.168.1.100</code>，无法区分。</p><p><strong>解决方案：NAT（网络地址转换）</strong>，工作过程：</p><ol><li>你（<code>192.168.1.100:50000</code>）访问 <code>www.baidu.com:80</code>。</li><li>路由器收到包，<strong>把源 IP 改成自己的公网 IP</strong>（如 <code>203.0.113.45</code>），端口映射为 <code>60000</code>。</li><li>发往公网：<code>源=203.0.113.45:60000</code>，目的 &#x3D; <code>110.242.68.4:80</code>。</li><li>百度回包给 <code>203.0.113.45:60000</code>。</li><li>路由器查 NAT 表，<strong>还原为 <code>192.168.1.100:50000</code></strong>，转发给你。</li></ol><p><strong>效果</strong>：成千上万台内网设备，<strong>共享 1 个公网 IP</strong>，外网无法主动访问内网（天然防火墙），节省公网 IP 资源（核心价值！）。</p><blockquote><p><strong>云服务器为什么需要公网 IP？</strong> 因为我们要主动访问它（如 SSH、Web 服务），它必须有一个 <strong>全球可达的地址</strong>，所以云厂商会分配公网 IP（或通过 EIP 弹性绑定）。</p></blockquote><hr><h2 id="8-NAT-技术的核心作用：让有限的公网-IP-服务更多设备"><a href="#8-NAT-技术的核心作用：让有限的公网-IP-服务更多设备" class="headerlink" title="8. NAT 技术的核心作用：让有限的公网 IP 服务更多设备"></a>8. NAT 技术的核心作用：让有限的公网 IP 服务更多设备</h2><h3 id="1-NAT-是什么？"><a href="#1-NAT-是什么？" class="headerlink" title="1. NAT 是什么？"></a>1. NAT 是什么？</h3><p><strong>NAT（Network Address Translation）</strong> —— 网络地址转换。它的本质是：在数据包经过路由器时，<strong>动态修改 IP 地址（以及端口号）</strong>，以便多个内网设备共用一个公网 IP 上网。</p><h3 id="2-为什么需要-NAT？"><a href="#2-为什么需要-NAT？" class="headerlink" title="2. 为什么需要 NAT？"></a>2. 为什么需要 NAT？</h3><p>IPv4 只有约 43 亿个地址（2³² 个），但设备早就远超这个数量。于是：每个家庭、公司内部设备（电脑、手机、打印机…）都使用 <strong>私有 IP</strong>，路由器对外只暴露一个 <strong>公网 IP</strong>，NAT 技术负责在出入网时做“翻译”。</p><h3 id="3-NAT-的工作过程"><a href="#3-NAT-的工作过程" class="headerlink" title="3. NAT 的工作过程"></a>3. NAT 的工作过程</h3><p>假设：</p><ul><li>家庭内网：192.168.0.10（你的电脑）。</li><li>路由器公网 IP：42.101.8.5。</li></ul><p>你访问百度时：<code>源 IP = 192.168.0.10 → 目的 IP = 180.101.49.12（百度）</code>，在出网时，NAT 做了替换：<code>源 IP = 42.101.8.5:40001（公网IP+端口） → 目的 IP = 180.101.49.12</code>，路由器保存一条映射表：<code>42.101.8.5:40001 ↔ 192.168.0.10:12345</code>，当百度返回数据时：<code>目的 IP = 42.101.8.5:40001</code>。路由器查表，发现要转给内网的 192.168.0.10，于是数据成功回到你的电脑。</p><p><strong>好处：</strong> 成千上万设备共享一个公网 IP，屏蔽内网结构，提高安全性，有效缓解 IPv4 地址不足问题。</p><h3 id="4-NAT-的三种常见类型（按转换粒度区分）"><a href="#4-NAT-的三种常见类型（按转换粒度区分）" class="headerlink" title="4. NAT 的三种常见类型（按转换粒度区分）"></a>4. NAT 的三种常见类型（按转换粒度区分）</h3><table><thead><tr><th>类型</th><th>说明</th><th>典型场景</th></tr></thead><tbody><tr><td><strong>静态 NAT</strong></td><td>一对一映射</td><td>内网服务器要对外提供服务</td></tr><tr><td><strong>动态 NAT</strong></td><td>多对多临时映射</td><td>企业网络动态分配公网地址池</td></tr><tr><td><strong>端口复用 NAT（PAT）</strong></td><td>多对一，通过端口区分</td><td>家用路由器、校园网、公司常用</td></tr></tbody></table><p><strong>家用路由器几乎都是 PAT（端口复用型 NAT）</strong>。因为只有一个公网 IP，但要让几十台设备同时上网，必须通过不同端口区分。</p><blockquote><p><strong>大公司网络虽与家用网络共享 IP 路由原理，但采用精细 IP 规划、多层架构和有限 NAT 策略，对外服务通常直接使用公网 IP 以保障性能与可靠性，其高昂费用主要来自公网 IP、专线带宽和高可用基础设施。家庭路由器是 NAT 的小型实现，大公司机房是它的企业级放大版。运营商卖的不是“网速”，而是带宽 + 公网资源 + 可靠性。</strong></p></blockquote><hr><h2 id="9-路由转发原理：IP-报文如何找到“回家的路”"><a href="#9-路由转发原理：IP-报文如何找到“回家的路”" class="headerlink" title="9. 路由转发原理：IP 报文如何找到“回家的路”"></a>9. 路由转发原理：IP 报文如何找到“回家的路”</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20251008161932828.png" alt="PixPin_2025-10-08_16-19-12"></p><h3 id="1-基本逻辑"><a href="#1-基本逻辑" class="headerlink" title="1. 基本逻辑"></a>1. 基本逻辑</h3><p>所有 IP 报文的转发都是根据 <strong>目的 IP 地址</strong> 来决定的，<strong>与源 IP 无关</strong>。无论是主机还是路由器，都维护着一张 <strong>路由表</strong>，都靠 <strong>本地路由表</strong> 决定“下一跳去哪”。路由表每一项通常包括：</p><table><thead><tr><th>项目</th><th>含义</th></tr></thead><tbody><tr><td>目的网络（Destination）</td><td>目标网段</td></tr><tr><td>子网掩码（Netmask）</td><td>区分网络号和主机号</td></tr><tr><td>下一跳（Next Hop）</td><td>报文应该转发给的下一个路由器地址</td></tr><tr><td>出口接口（Interface）</td><td>报文应从哪块网卡发出</td></tr></tbody></table><h3 id="2-查找路由表的过程"><a href="#2-查找路由表的过程" class="headerlink" title="2. 查找路由表的过程"></a>2. 查找路由表的过程</h3><p>当主机要发送数据时，它会：</p><ol><li><strong>先判断目标是否在同一网段</strong>：<ul><li>用自己的 IP 与目标 IP 分别和子网掩码做按位与；</li><li>若结果相同 → 同一网段，直接通过局域网（ARP 找 MAC）通信；</li><li>若不同 → 不同网段，交给默认网关（通常是路由器）。</li></ul></li><li><strong>路由器转发时</strong>：<ul><li>路由器查自己的路由表；</li><li>对每一条记录执行 <code>(目标IP &amp; 子网掩码)</code>；</li><li>找出最长匹配的网段（即 <strong>最长前缀匹配原则</strong>）；</li><li>按照该记录指示的接口或下一跳转发。</li></ul></li></ol><blockquote><p>比喻理解：主机查路由表就像问路</p><ul><li>有人告诉你“到市中心走这条路”（有明确路）。</li><li>有人说“我不知道，但我知道到高速入口怎么走”（下一跳）。</li><li>若没人知道，就交给默认路由（缺省出口）。</li></ul></blockquote><h3 id="3-大概转发过程"><a href="#3-大概转发过程" class="headerlink" title="3. 大概转发过程"></a>3. 大概转发过程</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[主机A] → [家用路由器] → [运营商路由器] → [目标网络路由器] → [主机B]</span><br></pre></td></tr></table></figure><p>每经过一个路由器：路由器查路由表，目的 IP <strong>不变</strong>，源 MAC、目的 MAC <strong>每跳都会变</strong>（数据链路层负责）。</p><blockquote><p><strong>关键点：网络层靠 IP 地址确定“去哪”，数据链路层靠 MAC 地址确定“怎么到下一跳”。</strong></p></blockquote><hr><h2 id="10-IP-分片机制：大报文如何被拆开传输？"><a href="#10-IP-分片机制：大报文如何被拆开传输？" class="headerlink" title="10. IP 分片机制：大报文如何被拆开传输？"></a>10. IP 分片机制：大报文如何被拆开传输？</h2><h3 id="1-为什么要分片？"><a href="#1-为什么要分片？" class="headerlink" title="1. 为什么要分片？"></a>1. 为什么要分片？</h3><p>因为不同链路的最大传输单元（MTU）不同。比如：以太网 MTU &#x3D; <strong>1500 字节</strong>，若 IP 报文超过 1500 字节，就必须拆分，否则底层帧发不出去。</p><h3 id="2-分片的字段结构"><a href="#2-分片的字段结构" class="headerlink" title="2. 分片的字段结构"></a>2. 分片的字段结构</h3><p>IP 报头里有三个关键字段：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20251008161058351.png" alt="PixPin_2025-10-08_16-10-46"></p><table><thead><tr><th>字段</th><th>作用</th></tr></thead><tbody><tr><td><strong>16 位标识（Identification）</strong></td><td>标识同一份数据（同一 IP 报文分片的共同编号）</td></tr><tr><td><strong>3 位标志（Flags）</strong></td><td>控制分片行为</td></tr><tr><td><strong>13 位片偏移（Fragment Offset）</strong></td><td>表示该分片在原报文中的偏移位置（单位 8 字节）</td></tr></tbody></table><p><strong>Flags 含义如下：</strong></p><ul><li>bit0：保留。</li><li>bit1：DF（Don’t Fragment）是否允许分片。</li><li>bit2：MF（More Fragment）是否还有后续分片。</li></ul><p>举例：<code>MF = 1</code> 表示后面还有分片，<code>MF = 0</code> 且 <code>Offset = 0</code> 表示仅此一个分片。</p><h3 id="3-分片与组装"><a href="#3-分片与组装" class="headerlink" title="3. 分片与组装"></a>3. 分片与组装</h3><p><strong>分片在发送端或中间路由器完成，组装必须在接收端完成。</strong> 如果一个分片丢了，即使其他分片都到了，整份报文也无法重组，只能重传，增加延迟和负担。因此：网络设计时会 <strong>尽量避免分片</strong>，TCP 会在三次握手阶段协商 MSS，控制单次传输不超过 MTU（常见 1460 字节）。</p><h3 id="4-为什么不建议分片？"><a href="#4-为什么不建议分片？" class="headerlink" title="4. 为什么不建议分片？"></a>4. 为什么不建议分片？</h3><ul><li>增加路由器 CPU 开销；</li><li>增加丢包概率；</li><li>丢一个片就得重传整个报文；</li><li>对实时性要求高的通信极其不利（如视频流）。</li></ul><p><strong>所以实际网络中：分片尽量只在端系统进行，路由器最好只转发，不分片。</strong></p><h2 id="11-数据链路层简述：局域网内的一跳通信"><a href="#11-数据链路层简述：局域网内的一跳通信" class="headerlink" title="11. 数据链路层简述：局域网内的一跳通信"></a>11. 数据链路层简述：局域网内的一跳通信</h2><blockquote><p>IP 报文转发靠查路由表，逐跳找到目标网络；若目标过大，IP 层会按 MTU 进行分片，接收端再组装；而每一跳之间的实际传输靠 MAC 帧完成，MAC 只在局域网内有效。</p></blockquote><p>虽然之后会细讲，但这里要先有个框架，可以先做一个简单了解。</p><h3 id="1-主要作用"><a href="#1-主要作用" class="headerlink" title="1. 主要作用"></a>1. 主要作用</h3><p>负责 <strong>点对点或点对多点的数据传输</strong>，以 <strong>MAC 帧（Frame）</strong> 为基本传输单位，通过 <strong>MAC 地址</strong> 标识网络设备。</p><h3 id="2-通信过程（以以太网为例）"><a href="#2-通信过程（以以太网为例）" class="headerlink" title="2. 通信过程（以以太网为例）"></a>2. 通信过程（以以太网为例）</h3><p>发送方将 IP 报文封装为 MAC 帧，MAC 帧头包含：目的 MAC、源 MAC、类型字段，所有主机都能收到这个帧，只有目的 MAC 匹配的主机才会上交给上层处理。这一层只在局域网中有效，数据一旦跨路由器转发，<strong>MAC 地址必然变化</strong>。</p><h3 id="3-数据帧长度与碰撞"><a href="#3-数据帧长度与碰撞" class="headerlink" title="3. 数据帧长度与碰撞"></a>3. 数据帧长度与碰撞</h3><p>有效载荷：46–1500 字节，过短帧会触发填充，过长则被丢弃，交换机通过分隔碰撞域减少冲突。</p></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/minbit.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/minbit.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">小米里的大麦</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://www.minbit.top/posts/60727.html">原创</a><a class="post-copyright-title"><span onclick='rm.copyPageUrl("https://www.minbit.top/posts/60727.html")'>053 网络层 —— IP 协议</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/wechat.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.webp" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.webp" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.minbit.top/posts/60727.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=053 网络层 —— IP 协议&amp;url=https://www.minbit.top/posts/60727.html&amp;pic=https://zycs-img-8kd.pages.dev/v2/uH1MN2u.png?_r_=86bfdbff-e801-cb71-51c7-49f92f8b1ef9" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)</a> 许可协议。转载请注明来自 <a href="https://www.minbit.top" target="_blank">小米里的大麦</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Linux/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span>Linux<span class="tagsPageCount">58</span></a><a class="post-meta__box__tags" href="/tags/%E7%BD%91%E7%BB%9C/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>网络<span class="tagsPageCount">11</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://zycs-img-8kd.pages.dev/v2/Jci6x23.png?_r_=cd6ab6d9-777f-ddf2-7e99-67e102f8beb2" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/23032.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/PXXdojm.png?_r_=2bff3c9b-7bd5-16f1-9164-2365e460c060" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">052 传输层 —— TCP（下）</div></div></a></div><div class="next-post pull-right"><a href="/posts/55230.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/uH1MN2u.png?_r_=ee21f9f4-1858-6159-4f09-ba821b9bd398" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">054 数据链路层</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/47537.html" title="045 网络基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/aKlysyx.png?_r_=3163eb3c-1b77-3014-d82d-03f81b706753" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-12</div><div class="title">045 网络基础</div></div></a></div><div><a href="/posts/63840.html" title="048 HTTP 协议"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/Jci6x23.png?_r_=c9859442-c801-6b1d-2ef9-2a7c6759d552" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-25</div><div class="title">048 HTTP 协议</div></div></a></div><div><a href="/posts/40348.html" title="046 网络编程套接字"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/uH1MN2u.png?_r_=fe08dd4b-45c4-bf3b-2c71-cf477eb043b3" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-15</div><div class="title">046 网络编程套接字</div></div></a></div><div><a href="/posts/34998.html" title="049 HTTPS 协议原理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/Jci6x23.png?_r_=22a1c05c-7d50-f198-9647-5698fdfa59f6" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-28</div><div class="title">049 HTTPS 协议原理</div></div></a></div><div><a href="/posts/62772.html" title="050 传输层 —— UDP"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/Jci6x23.png?_r_=04c1849e-c047-9316-1d2e-28c9757e1775" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-09-12</div><div class="title">050 传输层 —— UDP</div></div></a></div><div><a href="/posts/38905.html" title="047 网络传输基础：TCP 连接建立与数据序列化"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/aKlysyx.png?_r_=86ada8a3-ae58-00d4-0bcd-3ddd3b45acd2" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-22</div><div class="title">047 网络传输基础：TCP 连接建立与数据序列化</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/minbit.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"></div></div><div class="author-info__description">时间好像总会留下点什么,或许是一个人,或许是一个梦,或许……是一段有意义的经历~</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">小米里的大麦</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/huangcancan-xbc" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><span>👋🏻 Hi，我是 <a target="_blank" href="https://huangcancan-xbc.github.io" rel="external nofollow noreferrer noopener" style="font-weight:700;font-size:1.1em;color:#5166f0">小米里的大麦</a>，欢迎来看我的博客鸭！</span><br><span>👉 建议优先查看置顶的 <a target="_blank" href="https://huangcancan-xbc.github.io/posts/17934.html" rel="external nofollow noreferrer noopener" style="font-weight:700;font-size:1.1em;color:#5166f0">网站说明</a>，如有问题欢迎评论区交流！</span><br><span>😫 页面异常？尝试<kbd>Ctrl</kbd>+<kbd>F5</kbd></span><br><span>📩 联系我：<a href="mailto:hc1960074081@qq.com" rel="external nofollow noreferrer"><b>给我发送邮件🚀</b></a></span></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82-%E2%80%94%E2%80%94-IP-%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.</span> <span class="toc-text">网络层 —— IP 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-IP-%E5%9C%B0%E5%9D%80%E7%9A%84%E6%9C%AC%E8%B4%A8%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%8F%B7-%E4%B8%BB%E6%9C%BA%E5%8F%B7"><span class="toc-number">1.1.</span> <span class="toc-text">1. IP 地址的本质：网络号 + 主机号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-IP-%E5%9C%B0%E5%9D%80%E5%88%92%E5%88%86%E5%9F%BA%E7%A1%80"><span class="toc-number">1.2.</span> <span class="toc-text">2. IP 地址划分基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%92%E5%88%86%E7%9B%AE%E7%9A%84"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. 划分目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-CIDR-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. CIDR 是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AD%90%E7%BD%91%EF%BC%88Subnet%EF%BC%89%E2%80%94%E2%80%94-%E7%BD%91%E7%BB%9C%E5%8F%B7%E7%9B%B8%E5%90%8C%E7%9A%84%E4%B8%80%E7%BB%84%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. 什么是子网（Subnet）—— 网络号相同的一组主机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%EF%BC%88Subnet-Mask%EF%BC%89"><span class="toc-number">1.2.4.</span> <span class="toc-text">4. 子网掩码（Subnet Mask）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%B8%BE%E4%B8%AA%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">1. 举个实际例子</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-IP%EF%BC%88IPv4%EF%BC%89-%E5%8D%8F%E8%AE%AE%E6%8A%A5%E5%A4%B4%E8%A7%A3%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">3. IP（IPv4） 协议报头解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.4.</span> <span class="toc-text">4. 路由器到底是什么？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%B7%AF%E7%94%B1%E5%99%A8%E6%9C%AC%E8%B4%A8%E6%98%AF%E4%B8%80%E5%8F%B0%E5%A4%9A%E7%BD%91%E5%8D%A1%E7%9A%84%E4%B8%93%E7%94%A8%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.4.1.</span> <span class="toc-text">1. 路由器本质是一台多网卡的专用主机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%B7%AF%E7%94%B1%E5%99%A8%E5%BF%85%E9%A1%BB%E8%87%B3%E5%B0%91%E8%BF%9E%E6%8E%A5%E4%B8%A4%E4%B8%AA%E5%AD%90%E7%BD%91"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. 路由器必须至少连接两个子网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%B7%AF%E7%94%B1%E5%99%A8%E6%8E%A5%E5%8F%A3-IP-%E9%80%9A%E5%B8%B8%E6%98%AF-1%EF%BC%8C%E4%BD%86%E4%B8%8D%E6%98%AF%E5%BC%BA%E5%88%B6%E8%A7%84%E5%AE%9A%EF%BC%81"><span class="toc-number">1.4.3.</span> <span class="toc-text">3. 路由器接口 IP 通常是 .1，但不是强制规定！</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%B7%AF%E7%94%B1%E5%99%A8%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-number">1.4.4.</span> <span class="toc-text">4. 路由器的核心功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%89%B9%E6%AE%8A%E7%9A%84-IP-%E5%9C%B0%E5%9D%80"><span class="toc-number">1.5.</span> <span class="toc-text">5. 特殊的 IP 地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-IPv4-%E5%9C%B0%E5%9D%80%E6%95%B0%E9%87%8F%E9%99%90%E5%88%B6"><span class="toc-number">1.6.</span> <span class="toc-text">6. IPv4 地址数量限制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E2%80%9C43-%E4%BA%BF%E2%80%9D-IP-%E5%9C%B0%E5%9D%80%E4%B8%8D%E5%A4%9F%E7%94%A8%EF%BC%9F"><span class="toc-number">1.6.1.</span> <span class="toc-text">1. 为什么“43 亿” IP 地址不够用？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3-IPv4-%E5%9C%B0%E5%9D%80%E6%9E%AF%E7%AB%AD%EF%BC%9F"><span class="toc-number">1.6.2.</span> <span class="toc-text">2. 如何解决 IPv4 地址枯竭？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8A%A8%E6%80%81%E5%88%86%E9%85%8D-IP%EF%BC%88DHCP%EF%BC%89"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">1. 动态分配 IP（DHCP）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-NAT%EF%BC%88%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%EF%BC%89%E2%80%94%E2%80%94-%E6%9C%80%E5%B9%BF%E6%B3%9B%E5%BA%94%E7%94%A8%EF%BC%81"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">2. NAT（网络地址转换）—— 最广泛应用！</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-IPv6-%E2%80%94%E2%80%94-%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">3. IPv6 —— 终极解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9D%82%E8%B0%88"><span class="toc-number">1.6.3.</span> <span class="toc-text">3. 杂谈</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E2%80%9C%E4%B8%80%E9%94%AE%E5%88%87%E6%8D%A2%E2%80%9D-IPv4-%E2%86%92-IPv6%EF%BC%9F"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">1. 为什么不能“一键切换” IPv4 → IPv6？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E7%A7%81%E7%BD%91-IP-%E5%9C%B0%E5%9D%80%E5%92%8C%E5%85%AC%E7%BD%91-IP-%E5%9C%B0%E5%9D%80"><span class="toc-number">1.7.</span> <span class="toc-text">7. 私网 IP 地址和公网 IP 地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%A7%81%E6%9C%89-IP-%E4%B8%8E-%E5%85%AC%E7%BD%91-IP%EF%BC%9A%E8%B0%81%E8%B4%9F%E8%B4%A3%E2%80%9C%E5%86%85%E9%83%A8%E2%80%9D%EF%BC%8C%E8%B0%81%E8%B4%9F%E8%B4%A3%E2%80%9C%E5%AF%B9%E5%A4%96%E2%80%9D"><span class="toc-number">1.7.1.</span> <span class="toc-text">1. 私有 IP 与 公网 IP：谁负责“内部”，谁负责“对外”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%BF%90%E8%90%A5%E5%95%86%EF%BC%9A%E4%BA%92%E8%81%94%E7%BD%91%E7%9A%84%E2%80%9C%E5%9F%BA%E5%BB%BA%E7%8B%82%E9%AD%94%E2%80%9D"><span class="toc-number">1.7.2.</span> <span class="toc-text">2. 运营商：互联网的“基建狂魔”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%A8%E7%90%83%E4%BA%92%E8%81%94%E7%BD%91%E4%B8%8E%E7%BD%91%E6%AE%B5%E5%88%92%E5%88%86-%E2%80%94%E2%80%94-%E5%A4%A7%E5%AD%A6%E7%9A%84%E2%80%9C%E5%B1%82%E7%BA%A7%E7%AE%A1%E7%90%86%E2%80%9D"><span class="toc-number">1.7.3.</span> <span class="toc-text">3. 全球互联网与网段划分 —— 大学的“层级管理”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%A7%81%E6%9C%89%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%85%AC%E7%BD%91%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9A%E9%9D%A0-NAT-%E6%A1%A5%E6%8E%A5"><span class="toc-number">1.7.4.</span> <span class="toc-text">4. 私有网络与公网的关系：靠 NAT 桥接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-NAT-%E6%8A%80%E6%9C%AF%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BD%9C%E7%94%A8%EF%BC%9A%E8%AE%A9%E6%9C%89%E9%99%90%E7%9A%84%E5%85%AC%E7%BD%91-IP-%E6%9C%8D%E5%8A%A1%E6%9B%B4%E5%A4%9A%E8%AE%BE%E5%A4%87"><span class="toc-number">1.8.</span> <span class="toc-text">8. NAT 技术的核心作用：让有限的公网 IP 服务更多设备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-NAT-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.8.1.</span> <span class="toc-text">1. NAT 是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-NAT%EF%BC%9F"><span class="toc-number">1.8.2.</span> <span class="toc-text">2. 为什么需要 NAT？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-NAT-%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B"><span class="toc-number">1.8.3.</span> <span class="toc-text">3. NAT 的工作过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-NAT-%E7%9A%84%E4%B8%89%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%B1%BB%E5%9E%8B%EF%BC%88%E6%8C%89%E8%BD%AC%E6%8D%A2%E7%B2%92%E5%BA%A6%E5%8C%BA%E5%88%86%EF%BC%89"><span class="toc-number">1.8.4.</span> <span class="toc-text">4. NAT 的三种常见类型（按转换粒度区分）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E8%B7%AF%E7%94%B1%E8%BD%AC%E5%8F%91%E5%8E%9F%E7%90%86%EF%BC%9AIP-%E6%8A%A5%E6%96%87%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%E2%80%9C%E5%9B%9E%E5%AE%B6%E7%9A%84%E8%B7%AF%E2%80%9D"><span class="toc-number">1.9.</span> <span class="toc-text">9. 路由转发原理：IP 报文如何找到“回家的路”</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E9%80%BB%E8%BE%91"><span class="toc-number">1.9.1.</span> <span class="toc-text">1. 基本逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9F%A5%E6%89%BE%E8%B7%AF%E7%94%B1%E8%A1%A8%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">1.9.2.</span> <span class="toc-text">2. 查找路由表的过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%A4%A7%E6%A6%82%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B"><span class="toc-number">1.9.3.</span> <span class="toc-text">3. 大概转发过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-IP-%E5%88%86%E7%89%87%E6%9C%BA%E5%88%B6%EF%BC%9A%E5%A4%A7%E6%8A%A5%E6%96%87%E5%A6%82%E4%BD%95%E8%A2%AB%E6%8B%86%E5%BC%80%E4%BC%A0%E8%BE%93%EF%BC%9F"><span class="toc-number">1.10.</span> <span class="toc-text">10. IP 分片机制：大报文如何被拆开传输？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%88%86%E7%89%87%EF%BC%9F"><span class="toc-number">1.10.1.</span> <span class="toc-text">1. 为什么要分片？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%86%E7%89%87%E7%9A%84%E5%AD%97%E6%AE%B5%E7%BB%93%E6%9E%84"><span class="toc-number">1.10.2.</span> <span class="toc-text">2. 分片的字段结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%86%E7%89%87%E4%B8%8E%E7%BB%84%E8%A3%85"><span class="toc-number">1.10.3.</span> <span class="toc-text">3. 分片与组装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%BB%BA%E8%AE%AE%E5%88%86%E7%89%87%EF%BC%9F"><span class="toc-number">1.10.4.</span> <span class="toc-text">4. 为什么不建议分片？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E7%AE%80%E8%BF%B0%EF%BC%9A%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85%E7%9A%84%E4%B8%80%E8%B7%B3%E9%80%9A%E4%BF%A1"><span class="toc-number">1.11.</span> <span class="toc-text">11. 数据链路层简述：局域网内的一跳通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8"><span class="toc-number">1.11.1.</span> <span class="toc-text">1. 主要作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B%EF%BC%88%E4%BB%A5%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%B8%BA%E4%BE%8B%EF%BC%89"><span class="toc-number">1.11.2.</span> <span class="toc-text">2. 通信过程（以以太网为例）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E5%B8%A7%E9%95%BF%E5%BA%A6%E4%B8%8E%E7%A2%B0%E6%92%9E"><span class="toc-number">1.11.3.</span> <span class="toc-text">3. 数据帧长度与碰撞</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/41191.html" title="免费白嫖 ChatGPT Go 套餐"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/Jci6x23.png?_r_=cd6ab6d9-777f-ddf2-7e99-67e102f8beb2" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="免费白嫖 ChatGPT Go 套餐"></a><div class="content"><a class="title" href="/posts/41191.html" title="免费白嫖 ChatGPT Go 套餐">免费白嫖 ChatGPT Go 套餐</a><time datetime="2025-11-04T16:00:00.000Z" title="发表于 2025-11-05 00:00:00">2025-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4211.html" title="057 高级 IO 之 epoll 详解与 CMake 入门"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/IB9fMsM.png?_r_=d6cd9a90-ea90-0b4a-bc6c-ade1d1774e6d" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="057 高级 IO 之 epoll 详解与 CMake 入门"></a><div class="content"><a class="title" href="/posts/4211.html" title="057 高级 IO 之 epoll 详解与 CMake 入门">057 高级 IO 之 epoll 详解与 CMake 入门</a><time datetime="2025-10-19T04:00:00.000Z" title="发表于 2025-10-19 12:00:00">2025-10-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7814.html" title="056 高级 IO"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/0k1JltC.jpeg?_r_=62a2c9b9-baa7-7f9f-8ee4-eedc6c0f4edd" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="056 高级 IO"></a><div class="content"><a class="title" href="/posts/7814.html" title="056 高级 IO">056 高级 IO</a><time datetime="2025-10-14T04:00:00.000Z" title="发表于 2025-10-14 12:00:00">2025-10-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/48372.html" title="055 其他重要协议和技术"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/fETMVUS.jpeg?_r_=7f6981c6-26e1-289f-cab6-5f8b347f400a" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="055 其他重要协议和技术"></a><div class="content"><a class="title" href="/posts/48372.html" title="055 其他重要协议和技术">055 其他重要协议和技术</a><time datetime="2025-10-12T04:00:00.000Z" title="发表于 2025-10-12 12:00:00">2025-10-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/19289.html" title="03 库的操作"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/PXXdojm.png?_r_=71de36aa-d238-3363-c614-84db659e2c15" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="03 库的操作"></a><div class="content"><a class="title" href="/posts/19289.html" title="03 库的操作">03 库的操作</a><time datetime="2025-10-10T16:00:00.000Z" title="发表于 2025-10-11 00:00:00">2025-10-11</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:hc1960074081@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://weibo.com/u/7913790969" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0,500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/minbit.png" size="50px"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="小米里的大麦" target="_blank">小米里的大麦</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType(){fetch("https://v1.hitokoto.cn").then(t=>t.json()).then(t=>{{const e="出自 "+t.from,n=["《左传》载曰：“太上有立德，其次有立功，其次有立言，虽久不废，此之谓不朽。”","纸上得来终觉浅，绝知此事要躬行！","你太专注于未来，却没有意识到，今天正是你多年前祈求的模样，因为你眺望远方视而不见。","梦想是不会发光的，发光的是追梦的你！","《答案在风中飘扬》（Blowing in The Wind）"];n.unshift(t.hitokoto,e),window.typed=new Typed("#footer-type-tips",{strings:n,startDelay:300,typeSpeed:150,loop:!0,backSpeed:50})}})}"function"==typeof Typed?subtitleType():getScript("https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js").then(subtitleType)</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub主页">GitHub主页</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">82</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">9</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">社交</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/lollipop.svg" alt="GitHub"><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://leetcode.cn/u/nifty-faradayzqn" title="力扣"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/thinking-glass.svg" alt="力扣"><span class="back-menu-item-text">力扣</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="哔哩哔哩"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/wink.svg" alt="哔哩哔哩"><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/huang-cancan-xbc" title="Gitee"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/laugh.svg" alt="Gitee"><span class="back-menu-item-text">Gitee</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.csdn.net/Huangcancan666?type=blog" title="CSDN"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/celebrate.svg" alt="CSDN"><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3230789931118109" title="稀土掘金"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/kiss.svg" alt="稀土掘金"><span class="back-menu-item-text">稀土掘金</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 外链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size:.88rem">AI<sup>1</sup></a><a href="/tags/C/" style="font-size:.88rem">C++<sup>8</sup></a><a href="/tags/ChatGPT/" style="font-size:.88rem">ChatGPT<sup>1</sup></a><a href="/tags/Git/" style="font-size:.88rem">Git<sup>3</sup></a><a href="/tags/IO/" style="font-size:.88rem">IO<sup>5</sup></a><a href="/tags/Linux/" style="font-size:.88rem">Linux<sup>58</sup></a><a href="/tags/MySQL/" style="font-size:.88rem">MySQL<sup>4</sup></a><a href="/tags/Obsidian/" style="font-size:.88rem">Obsidian<sup>1</sup></a><a href="/tags/Redis/" style="font-size:.88rem">Redis<sup>2</sup></a><a href="/tags/STL/" style="font-size:.88rem">STL<sup>2</sup></a><a href="/tags/VS-Code/" style="font-size:.88rem">VS Code<sup>1</sup></a><a href="/tags/%E4%B8%B4%E6%97%B6%E9%82%AE%E7%AE%B1/" style="font-size:.88rem">临时邮箱<sup>1</sup></a><a href="/tags/%E4%BF%A1%E5%8F%B7/" style="font-size:.88rem">信号<sup>3</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size:.88rem">内存管理<sup>1</sup></a><a href="/tags/%E5%8E%86%E7%A8%8B/" style="font-size:.88rem">历程<sup>1</sup></a><a href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" style="font-size:.88rem">地址空间<sup>6</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size:.88rem">数学<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size:.88rem">模板<sup>1</sup></a><a href="/tags/%E7%AE%A1%E9%81%93/" style="font-size:.88rem">管道<sup>2</sup></a><a href="/tags/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" style="font-size:.88rem">类与对象<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size:.88rem">线程<sup>4</sup></a><a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size:.88rem">网站<sup>3</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size:.88rem">网络<sup>11</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size:.88rem">进程<sup>15</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>var HoldLog=console.log;console.log=function(){};let now1=new Date;queueMicrotask(()=>{const o=function(){HoldLog.apply(console,arguments)},n=new Date("01/01/2025 00:00:00");now1.setTime(now1.getTime()+250);const c=(now1-n)/1e3/60/60/24,e=["这里是 小米里的大麦","芝兰生于深谷，不以无人而不芳。","\n        \n       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗\n      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║\n      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║\n      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║\n      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝\n      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝\n        \n        ","已上线",Math.floor(c),"天","©2025 By 安知鱼 V1.6.14"],t=["NCC2-036","调用前置摄像头拍照成功，识别为【小笨蛋】.","Photo captured: ","🤪"];setTimeout(o.bind(console,`\n%c${e[0]} %c ${e[1]} %c ${e[2]} %c${e[3]}%c ${e[4]}%c ${e[5]}\n\n%c ${e[6]}\n`,"color:#425AEF","","color:#425AEF","color:#425AEF","","color:#425AEF","")),setTimeout(o.bind(console,`%c ${t[0]} %c ${t[1]} %c \n${t[2]} %c\n${t[3]}\n`,"color:white; background-color:#4fd953","","",'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%')),setTimeout(o.bind(console,"%c WELCOME %c 你好，小笨蛋.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c ⚡ Powered by 安知鱼 %c 你正在访问 小米里的大麦 的博客.","color:white; background-color:#f0ad4e","")),setTimeout(o.bind(console,"%c W23-12 %c 你已打开控制台.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c S013-782 %c 你现在正处于监控中.","color:white; background-color:#d9534f",""))})</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{const t=()=>{"object"==typeof twikoo?setTimeout(o,0):getScript("https://cdn.cbd.int/twikoo@1.6.44/dist/twikoo.all.min.js").then(o)},o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.minbit.top/",path:location.pathname.replace(/index\.html$/,""),region:"ap-shanghai",onCommentLoaded:()=>{anzhiyu.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&(()=>{const t=document.getElementById("twikoo-count");t&&twikoo.getCommentsCount({envId:"https://twikoo.minbit.top/",region:"ap-shanghai",urls:[window.location.pathname],includeReply:!1}).then(o=>{t.textContent=o[0].count}).catch(t=>{console.error(t)})})()};anzhiyu.loadComment(document.getElementById("twikoo-wrap"),t)})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener("load",()=>{const e=e=>{let t="";if(e.length)for(let n=0;n<e.length;n++){t+="<div class='aside-list-item'>";{const a="data-lazy-src";t+=`<a href='${e[n].url}' class='thumbnail'><img ${a}='${e[n].avatar}' alt='${e[n].nick}'><div class='name'><span>${e[n].nick} </span></div></a>`}t+=`<div class='content'>\n        <a class='comment' href='${e[n].url}' title='${e[n].content}'>${e[n].content}</a>\n        <time datetime="${e[n].date}">${anzhiyu.diffDate(e[n].date,!0)}</time></div>\n        </div>`}else t+="没有评论";let n=document.querySelector("#card-newest-comments .aside-list");n&&(n.innerHTML=t),window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(n)},t=()=>{if(document.querySelector("#card-newest-comments .aside-list")){const t=saveToLocal.get("twikoo-newest-comments");t?e(JSON.parse(t)):(()=>{const t=()=>{twikoo.getRecentComments({envId:"https://twikoo.minbit.top/",region:"ap-shanghai",pageSize:6,includeReply:!0}).then((function(t){const n=t.map(e=>{return{content:(t=e.comment,""===t||(t=(t=(t=(t=t.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length>150&&(t=t.substring(0,150)+"..."),t),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.id,date:new Date(e.created).toISOString()};var t});saveToLocal.set("twikoo-newest-comments",JSON.stringify(n),10/1440),e(n)})).catch((function(e){document.querySelector("#card-newest-comments .aside-list").textContent="无法获取评论，请确认相关配置是否正确"}))};"object"==typeof twikoo?t():getScript("https://cdn.cbd.int/twikoo@1.6.44/dist/twikoo.all.min.js").then(t)})()}};t(),document.addEventListener("pjax:complete",t)})</script><script async data-pjax src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail="xiaomilidedamai@minbit.top"</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://cdn.cbd.int/qrcodejs@1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="https://cdn.bootcdn.net/ajax/libs/echarts/4.9.0-rc.1/echarts.min.js"></script><script src="/js/footer-animal.js" defer></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="offer,暴富,健康,offer,喜乐,成功,offer,好运,自由,offer,坚持,上岸" data-fontsize="20px" data-random="true" async></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:type"]','meta[property="og:site_name"]','meta[property="og:description"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(anzhiyu.removeGlobalFnEvent("pjax"),anzhiyu.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async data-pjax src="//npm.elemecdn.com/penndu@1.0.0/bsz.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script><script>window.addEventListener("load",()=>{const t=()=>{if(!window.location.pathname.startsWith("/comments/"))return;const t=async()=>{const t=new EasyDanmaku({page:"/comments/",el:"#danmu-wrap",line:5,speed:20,hover:!0,loop:!1,colourful:!0,coefficient:1.38,runtime:10});try{let a=saveToLocal.get("twikoo-danmu");if(a)t.batchSend(a,!0);else{const n={method:"POST",body:JSON.stringify({event:"GET_RECENT_COMMENTS",includeReply:!1,pageSize:100}),headers:{"Content-Type":"application/json"}};a=[];const o=await fetch("https://twikoo.minbit.top/",n);if(o.ok){const{data:n}=await o.json();n.forEach(t=>{null==t.avatar&&(t.avatar="https://cravatar.cn/avatar/d615d5793929e8c7d70eab5f00f7f5f1?d=mp"),a.push({avatar:t.avatar,content:t.nick+"："+e(t.comment),url:t.url+"#"+t.id})}),t.batchSend(a,!0),saveToLocal.set("twikoo-danmu",a,.5)}function e(t){return t=(t=(t=(t=(t=t.replace(/<\/*br>|[\s\uFEFF\xA0]+/g,"")).replace(/<img.*?>/g,"[图片]")).replace(/<a.*?>.*?<\/a>/g,"[链接]")).replace(/<pre.*?>.*?<\/pre>/g,"[代码块]")).replace(/<.*?>/g,"")}}}catch(t){console.error("Error fetching data:",t)}document.getElementById("danmu-Btn")&&(document.getElementById("danmu-Btn").innerHTML="<button class=\"hide-Btn\" onclick=\"document.getElementById('danmu-wrap').classList.remove('hide-danmu')\">显示弹幕</button> <button class=\"hide-Btn\" onclick=\"document.getElementById('danmu-wrap').classList.add('hide-danmu')\">隐藏弹幕</button>")};(async()=>{if("function"==typeof EasyDanmaku)await t();else{await getScript("https://npm.onmicrosoft.cn/naokuo-blog@1.2.12/js/easy-Danmaku.js");"function"==typeof EasyDanmaku?await t():console.error("EasyDanmaku function not found even after loading the script.")}})()};t(),document.addEventListener("pjax:complete",t)})</script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>