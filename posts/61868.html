<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>020 实现一个简易 Shell | 小米里的大麦</title><meta name="keywords" content="Linux"><meta name="author" content="小米里的大麦"><meta name="copyright" content="小米里的大麦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="020 实现一个简易 Shell"><meta name="application-name" content="020 实现一个简易 Shell"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="020 实现一个简易 Shell"><meta property="og:url" content="https://www.minbit.top/posts/61868.html"><meta property="og:site_name" content="小米里的大麦"><meta property="og:description" content="从零到一实现一个简易 Shell这应该是个蛮有趣的话题：“什么是 Shell”？相信只要摸过计算机，对于操作系统(不论是 Linux、Unix 或者是 Windows)有点概念的朋友们大多听过这个名词，因为只要有“操作系统“那么就离不开 Shell 这个东西。不过，在讨论 Shell 之前，我们先来"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://image-kcm.pages.dev/v2/TISblXc.png?_r_=c7e05aab-ef56-5b8c-0f71-bf02d4a5911a"><meta property="article:author" content="小米里的大麦"><meta property="article:tag" content="技术博客,Linux,C++,后端开发,编程学习,个人博客,技术分享"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://image-kcm.pages.dev/v2/TISblXc.png?_r_=c7e05aab-ef56-5b8c-0f71-bf02d4a5911a"><meta name="description" content="从零到一实现一个简易 Shell这应该是个蛮有趣的话题：“什么是 Shell”？相信只要摸过计算机，对于操作系统(不论是 Linux、Unix 或者是 Windows)有点概念的朋友们大多听过这个名词，因为只要有“操作系统“那么就离不开 Shell 这个东西。不过，在讨论 Shell 之前，我们先来"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "020 实现一个简易 Shell",
  "description": "从零到一实现一个简易 Shell这应该是个蛮有趣的话题：“什么是 Shell”？相信只要摸过计算机，对于操作系统(不论是 Linux、Unix 或者是 Windows)有点概念的朋友们大多听过这个名词，因为只要有“操作系统“那么就离不开 Shell 这个东西。不过，在讨论 Shell 之前，我们先来",
  "image": "https://image-kcm.pages.dev/v2/TISblXc.png?_r_=c7e05aab-ef56-5b8c-0f71-bf02d4a5911a",
  "datePublished": "2025-04-26T07:50:00.000Z",
  "dateModified": "2025-04-26T08:10:00.000Z",
  "author": {
    "@type": "Person",
    "name": "小米里的大麦",
    "url": "https://www.minbit.top"
  },
  "publisher": {
    "@type": "Organization",
    "name": "小米里的大麦",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.minbit.top/img/Profile%20picture.png"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.minbit.top/posts/61868.html"
  },
  "keywords": "Linux"
}</script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "首页",
      "item": "https://www.minbit.top"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "020 实现一个简易 Shell",
      "item": "https://www.minbit.top/posts/61868.html"
    }
  ]
}</script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "小米里的大麦",
  "url": "https://www.minbit.top",
  "image": "https://www.minbit.top/img/Profile%20picture.png",
  "description": "时间好像总会留下点什么，或许是一个人，或许是一个梦，或许……是一段有意义的经历~"
}</script><link rel="shortcut icon" href="/img/icons/funny.svg"><link rel="canonical" href="https://www.minbit.top/posts/61868.html"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//bsz.dusays.com:9001"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"><link rel="mask-icon" href="/img/siteicon/apple-icon-180.png" color="#5bbad5"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"><link rel="bookmark" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@6.1.6/dist/fancybox/fancybox.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={linkPageTop:{enable:!0,title:"友链 + 外链 + 无限进步！欢迎欣赏和贡献！",addFriendPlaceholder:"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},peoplecanvas:void 0,postHeadAiDescription:{enable:!0,gptName:"小米里的大麦",mode:"local",switchBtn:!1,btnLink:"https://afdian.net/item/886a79d4db6711eda42a52540025c377",randomNum:4,basicWordCount:1999,key:"93d1622eadde491eb0594b68ade51723.kaEiDD6A3KPzb7xv",Referer:"https://www.minbit.top/"},diytitle:{enable:!0,leaveTitle:"w(ﾟДﾟ)w 不要走！再看看嘛！",backTitle:"♪(^∇^*)欢迎肥来！"},LA51:{enable:!0,ck:"Jp8wwGQpp21utaFQ",LingQueMonitorID:"Jp8ztDRrxmTf7LDj"},greetingBox:{enable:!0,default:"晚上好👋",list:[{greeting:"晚安😴",startTime:0,endTime:5},{greeting:"早上好鸭👋, 祝你一天好心情！",startTime:6,endTime:9},{greeting:"上午好👋, 状态很好，鼓励一下～",startTime:10,endTime:10},{greeting:"11点多啦, 在坚持一下就吃饭啦～",startTime:11,endTime:11},{greeting:"午安👋, 宝贝",startTime:12,endTime:14},{greeting:"🌈充实的一天辛苦啦！",startTime:14,endTime:18},{greeting:"19点喽, 奖励一顿丰盛的大餐吧🍔。",startTime:19,endTime:19},{greeting:"晚上好👋, 在属于自己的时间好好放松😌~",startTime:20,endTime:24}]},twikooEnvId:"https://twikoo.minbit.top/",commentBarrageConfig:{enable:!0,maxBarrage:10,barrageTime:5e3,accessToken:"25c96851dd8a790c4819ad4bfbaf153c",mailMd5:"7b12ebc2be80f9159099f6ab0e16573c"},music_page_default:"nav_music",root:"/",preloader:{source:3},friends_vue_info:void 0,navMusic:!0,mainTone:{mode:"both",api:"https://img2color-go.vercel.app/api?img=",cover_change:!0},authorStatus:{skills:["🧐 准备中，就快好了，真的！😭","📚 正在学习中，加油！","🎵 喜欢听音乐，喜欢看动漫"]},algolia:void 0,localSearch:{path:"/search.xml",preload:!0,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简",rightMenuMsgToTraditionalChinese:"转为繁体",rightMenuMsgToSimplifiedChinese:"转为简体"},noticeOutdate:{limitDay:365,position:"top",messagePrev:"距上次更新已过去",messageNext:"天了，这篇文章的内容可能已经过时了。"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:330},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,simplehomepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{copy:!0,copyrightEbable:!0,limitCount:150,languages:{author:"作者: 小米里的大麦",link:"链接: ",source:"来源: 小米里的大麦",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。",copySuccess:"复制成功，复制和转载请标注本文地址"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#425AEF",bgDark:"#1f1f1f",position:"top-right"},source:{justifiedGallery:{js:"https://cdn.cbd.int/flickr-justified-gallery@2.2.0/dist/fjGallery.min.js",css:"https://cdn.cbd.int/flickr-justified-gallery@2.2.0/dist/fjGallery.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,shortcutKey:void 0,autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"小米里的大麦",title:"020 实现一个简易 Shell",postAI:"这篇文章讲述了如何从零开始实现一个简易的Shell，首先介绍了Shell的基本功能和重要性，包括提示符显示、命令读取、解析、执行、重定向支持、环境变量管理和退出机制。接着详细阐述了实现这些功能的具体步骤，如获取用户名、主机名和当前工作目录，定义提示符格式，实现命令读取和解析，以及区分内置命令和外部命令的执行方式。文章还介绍了如何实现内置命令如`cd`、`export`和`echo`，以及如何通过`fork`和`exec`执行外部命令。此外，还讨论了重定向的实现方法，包括输入重定向、输出重定向和追加输出重定向。最后，文章展示了Shell的主循环，该循环负责持续运行Shell并处理用户输入。整个实现过程详细且实用，为读者提供了一个完整的Shell实现参考。",pageFillDescription:"从零到一实现一个简易 Shell, 1. Shell 的基本功能, 2. 实现 Shell 的提示符, 1. 获取用户信息, 2. 定义提示符格式, 3. 实现 interact 函数, 3. 使用 strtok 分割字符串, 4. 命令执行, 5. 内置命令实现, 6. 外部命令执行, 7. 解析重定向符号, 8. 执行重定向, 9. 主循环, 3. 源码一览从零到一实现一个简易这应该是个蛮有趣的话题什么是相信只要摸过计算机对于操作系统不论是或者是有点概念的朋友们大多听过这个名词因为只要有操作系统那么就离不开这个东西不过在讨论之前我们先来了解一下计算机的运行状况吧举个例子来说当你要计算机传输出来音乐的时候你的计算机需要什么东西呢硬件当然就是需要你的硬件有声卡芯片这个配备否则怎么会有声音核心管理操作系统的核心可以支持这个芯片组当然还需要提供芯片的驱动程序啰应用程序需要使用者就是你输入发生声音的指令啰这就是基本的一个输出声音所需要的步骤也就是说你必须要输入一个指令之后硬件才会通过你下达的指令来工作那么硬件如何知道你下达的指令呢那就是核心的控制工作了也就是说我们必须要通过将我们输入的指令与沟通好让可以控制硬件来正确无误的工作基本上我们可以通过下面这张图来说明一下以上内容摘自鸟哥的私房菜基础学习篇第四版页的基本功能一个基本的需要具备以下功能提示符显示显示当前用户主机名和工作目录例如命令读取从标准输入读取用户输入的命令命令解析将输入的命令行分割为命令和参数命令执行支持内置命令如和外部命令如重定向支持支持输入重定向输出重定向和追加输出重定向环境变量管理支持查看和设置环境变量退出机制支持通过退出让我们一步步实现这些功能实现的提示符的提示符是用户交互的起点通常显示为用户名主机名当前目录我们需要获取用户名主机名和当前工作目录获取用户信息用户名使用获取当前用户名主机名使用获取主机名当前目录使用获取当前工作目录定义提示符格式我们通过宏定义设置提示符的格式左括号右括号提示符号实现函数函数负责显示提示符并读取用户输入获取当前工作目录读取用户输入确保读取成功显式标记该变量已被使用从而抑制编译器警告这是一种代码规范技巧表明有意忽略此变量去除末尾换行符检查重定向符号调用更新全局变量格式化输出提示符例如从标准输入读取命令行检查是否有重定向符号稍后实现命令行解析用户输入的命令行需要被分割成命令和参数例如输入应分割为使用分割字符串我们使用函数按空格或制表符分割命令行分隔符空格和制表符分割第一个继续分割后续返回参数个数分割第一个命令循环调用获取后续参数返回值是参数个数存储在全局数组中全局变量定义如下存储用户输入存储分割后的参数命令执行需要区分两种命令内置命令由直接处理如外部命令通过和执行系统中的可执行文件内置命令实现内置命令在进程中直接执行无需创建子进程我们在函数中实现命令切换目录切换工作目录更新环境变量表示已处理命令设置环境变量添加到环境变量表命令打印参数打印上一次命令退出码获取环境变量值直接打印参数增强命令添加颜色选项未处理交给外部命令执行使用切换目录并更新环境变量使用设置环境变量是全局缓冲区支持打印上一次退出码环境变量或普通字符串增强自动添加选项以显示彩色输出返回值表示内置命令已处理表示需要外部执行外部命令执行外部命令通过创建子进程并使用执行子进程重定向标准输入重定向标准输出追加重定向标准输出执行命令失败退出父进程记录退出码创建子进程子进程根据重定向类型打开文件并使用重定向执行命令从中查找可执行文件父进程使用等待子进程结束并记录退出码到重定向支持支持三种重定向输入重定向输出重定向追加输出重定向解析重定向符号在函数中解析重定向重定向文件名重定向类型遍历命令行检测或将符号替换为以分割命令和文件名设置全局变量和函数调用进行解析执行重定向在中根据处理重定向输入重定向打开文件并重定向到标准输入文件描述符输出重定向创建或截断文件并重定向到标准输出文件描述符追加输出重定向创建或追加文件并重定向到标准输出环境变量管理查看通过查看环境变量值设置通过设置环境变量这些功能已在的和实现中完成主循环的主循环负责持续运行重置重定向信息获取输入解析命令处理内置命令执行外部命令重置重定向状态获取并解析用户输入处理内置命令或外部命令变量控制退出当前代码中未实现命令可扩展源码一览宏定义区域显示用的左括号显示用的右括号显示用的提示符号分隔符空格和制表符每一行命令最大长度最大命令参数个数子进程执行失败退出码重定向类型定义输入重定向输出重定向追加输出重定向全局变量上一次命令的返回码控制是否退出系统环境变量表存储用户输入命令存储分割后的命令参数当前工作目录重定向的文件名当前重定向类型存储设置的环境变量工具函数获取当前用户名获取主机名获取当前路径解析重定向符号并设置和追加重定向普通输出重定向输入重定向显示提示符并获取用户输入命令获取用户输入确保输入成功显式标记该变量已被使用从而抑制编译器警告这是一种代码规范技巧表明有意忽略此变量去除换行符检查是否有重定向将命令行字符串根据空格分割成参数数组使用循环分割执行普通命令子进程执行命令标准输入重定向标准输出重定向标准输出追加重定向执行命令从路径中查找出错则退出父进程等待子进程结束记录子进程退出码构建内置命令切换工作目录更新环境变量添加或修改环境变量打印上一次命令的返回码获取环境变量值针对增加颜色选项自动加上颜色显示主函数入口初始化重定向信息获取用户输入的命令行分割命令行为参数数组处理内置命令执行普通命令这个虽简单但展示了的相对核心机制当然还有一些其他功能没有实现以及代码中还多场景考虑不周到兼容性健壮性等问题处理不够完美还是等以后学深了再完善吧",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-04-26 16:10:00",postMainColor:""}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:(e,t,a)=>{if(0===a)return;const o={value:t,expiry:Date.now()+864e5*a};localStorage.setItem(e,JSON.stringify(o))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const a=JSON.parse(t);if(!(Date.now()>a.expiry))return a.value;localStorage.removeItem(e)}},e.getScript=(e,t={})=>new Promise((a,o)=>{const c=document.createElement("script");c.src=e,c.async=!0,c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},Object.keys(t).forEach(e=>{c.setAttribute(e,t[e])}),document.head.appendChild(c)}),e.getCSS=(e,t=!1)=>new Promise((a,o)=>{const c=document.createElement("link");c.rel="stylesheet",c.href=e,t&&(c.id=t),c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},document.head.appendChild(c)}),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#18171d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#f7f9fe")};const t=saveToLocal.get("theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches,o=window.matchMedia("(prefers-color-scheme: light)").matches,c=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!a&&!o&&!c;if(void 0===t){if(o)activateLightMode();else if(a)activateDarkMode();else if(c||n){const e=(new Date).getHours();e<=10||e>=20?activateDarkMode():activateLightMode()}window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>{void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode():activateLightMode())})}else"light"===t?activateLightMode():activateDarkMode();const d=saveToLocal.get("aside-status");void 0!==d&&("hide"===d?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/custom/css/font.css"><link rel="stylesheet" href="/custom/css/bilibili.css"><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="小米里的大麦" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/Profile%20picture.png"><div class="loading-image-dot"></div></div></div><script>const preloader={endLoading:()=>{document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",()=>{preloader.endLoading()}),setTimeout((function(){preloader.endLoading()}),1e4),document.addEventListener("pjax:send",()=>{preloader.initLoading()}),document.addEventListener("pjax:complete",()=>{preloader.endLoading()})</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">社交</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub"><img class="back-menu-item-icon" src="/img/icons/lollipop.svg" alt="GitHub"><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="哔哩哔哩"><img class="back-menu-item-icon" src="/img/icons/wink.svg" alt="哔哩哔哩"><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/huang-cancan-xbc" title="Gitee"><img class="back-menu-item-icon" src="/img/icons/laugh.svg" alt="Gitee"><span class="back-menu-item-text">Gitee</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.csdn.net/Huangcancan666?type=blog" title="CSDN"><img class="back-menu-item-icon" src="/img/icons/celebrate.svg" alt="CSDN"><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3230789931118109" title="稀土掘金"><img class="back-menu-item-icon" src="/img/icons/kiss.svg" alt="稀土掘金"><span class="back-menu-item-text">稀土掘金</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">算法</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://leetcode.cn/u/nifty-faradayzqn" title="力扣"><img class="back-menu-item-icon" src="/img/icons/thinking-glass.svg" alt="力扣"><span class="back-menu-item-text">力扣</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://ac.nowcoder.com/acm/contest/profile/517073385" title="牛客"><img class="back-menu-item-icon" src="/img/icons/think.svg" alt="牛客"><span class="back-menu-item-text">牛客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/1367427" title="洛谷"><img class="back-menu-item-icon" src="/img/icons/funny.svg" alt="洛谷"><span class="back-menu-item-text">洛谷</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">小米里的大麦</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 外链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div id="nav-naoDark"><div class="container"><div class="components"><div class="main-button"><div class="moon"></div><div class="moon"></div><div class="moon"></div></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="cloud"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="cloud-light"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="stars"><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div></div></div></div></div><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/wechatANDalipay.webp" target="_blank"><img class="post-qr-code-img" alt="微信/支付宝" src="/img/wechatANDalipay.webp"></a><div class="post-qr-code-desc">微信/支付宝</div></li><li class="reward-item"><a href="/img/PayPal.webp" target="_blank"><img class="post-qr-code-img" alt="PayPal" src="/img/PayPal.webp"></a><div class="post-qr-code-desc">PayPal</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size:1.05rem">AI<sup>2</sup></a><a href="/tags/C/" style="font-size:1.05rem">C++<sup>11</sup></a><a href="/tags/Git/" style="font-size:1.05rem">Git<sup>3</sup></a><a href="/tags/IO/" style="font-size:1.05rem">IO<sup>5</sup></a><a href="/tags/Linux/" style="font-size:1.05rem">Linux<sup>59</sup></a><a href="/tags/MySQL/" style="font-size:1.05rem">MySQL<sup>9</sup></a><a href="/tags/Redis/" style="font-size:1.05rem">Redis<sup>2</sup></a><a href="/tags/STL/" style="font-size:1.05rem">STL<sup>2</sup></a><a href="/tags/VS-Code/" style="font-size:1.05rem">VS Code<sup>1</sup></a><a href="/tags/%E4%BF%A1%E5%8F%B7/" style="font-size:1.05rem">信号<sup>3</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size:1.05rem">内存管理<sup>1</sup></a><a href="/tags/%E5%8E%86%E7%A8%8B/" style="font-size:1.05rem">历程<sup>2</sup></a><a href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" style="font-size:1.05rem">地址空间<sup>6</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size:1.05rem">工具<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size:1.05rem">数学<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size:1.05rem">模板<sup>1</sup></a><a href="/tags/%E7%81%B5%E5%85%89%E8%8D%9F%E8%90%83/" style="font-size:1.05rem">灵光荟萃<sup>3</sup></a><a href="/tags/%E7%AE%A1%E9%81%93/" style="font-size:1.05rem">管道<sup>2</sup></a><a href="/tags/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" style="font-size:1.05rem">类与对象<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size:1.05rem">线程<sup>5</sup></a><a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size:1.05rem">网站<sup>3</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size:1.05rem">网络<sup>11</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size:1.05rem">进程<sup>15</sup></a></div></div><hr></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多"> <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2026/01/"><span class="card-archive-list-date">一月 2026</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/12/"><span class="card-archive-list-date">十二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/11/"><span class="card-archive-list-date">十一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">十月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">15</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">八月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Linux/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>Linux</span></a></span></div></div><h1 class="post-title" itemprop="name headline">020 实现一个简易 Shell</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-04-26T07:50:00.000Z" title="发表于 2025-04-26 15:50:00">2025-04-26</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-04-26T08:10:00.000Z" title="更新于 2025-04-26 16:10:00">2025-04-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">3.4k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" data-flag-title="020 实现一个简易 Shell"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"> </span><span class="post-meta-position" title="作者IP属地为西安"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>西安</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://image-kcm.pages.dev/v2/TISblXc.png?_r_=c7e05aab-ef56-5b8c-0f71-bf02d4a5911a"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">小米里的大麦 GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://www.minbit.top/posts/61868.html"><header><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a><a href="/tags/Linux/" tabindex="-1" itemprop="url">Linux</a><h1 id="CrawlerTitle" itemprop="name headline">020 实现一个简易 Shell</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">小米里的大麦</span><time itemprop="dateCreated datePublished" datetime="2025-04-26T07:50:00.000Z" title="发表于 2025-04-26 15:50:00">2025-04-26</time><time itemprop="dateCreated datePublished" datetime="2025-04-26T08:10:00.000Z" title="更新于 2025-04-26 16:10:00">2025-04-26</time></header><h3 id="从零到一实现一个简易-Shell"><a href="#从零到一实现一个简易-Shell" class="headerlink" title="从零到一实现一个简易 Shell"></a>从零到一实现一个简易 <code>Shell</code></h3><p>这应该是个蛮有趣的话题：“什么是 <code>Shell</code>”？相信只要摸过计算机，对于操作系统(不论是 <code>Linux</code>、<code>Unix</code> 或者是 <code>Windows</code>)有点概念的朋友们大多听过这个名词，因为只要有“操作系统“那么就离不开 <code>Shell</code> 这个东西。不过，在讨论 <code>Shell</code> 之前，我们先来了解一下计算机的运行状况吧！举个例子来说：当你要计算机传输出来“音乐”的时候，你的计算机需要什么东西呢？</p><ol><li>硬件：当然就是需要你的硬件有“声卡芯片”这个配备，否则怎么会有声音；</li><li>核心管理：操作系统的核心可以支持这个芯片组，当然还需要提供芯片的驱动程序啰；</li><li>应用程序：需要使用者（就是你）输入发生声音的指令啰！</li></ol><p>这就是基本的一个输出声音所需要的步骤！也就是说，你必须要“输入”一个指令之后，“硬件“才会通过你下达的指令来工作！那么硬件如何知道你下达的指令呢？那就是 <code>kernel</code>（核心）的控制工作了！也就是说，我们必须要通过“<code>Shell</code>”将我们输入的指令与 <code>Kernel</code> 沟通，好让 <code>Kernel</code> 可以控制硬件来正确无误的工作！基本上，我们可以通过下面这张图来说明一下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20250422201807649.png" alt="image-20250422201800429"></p><blockquote><p>以上内容摘自《鸟哥的 <code>Linux</code> 私房菜基础学习篇（第四版）》311 页。</p></blockquote><hr><h4 id="1-Shell-的基本功能"><a href="#1-Shell-的基本功能" class="headerlink" title="1. Shell 的基本功能"></a>1. <code>Shell</code> 的基本功能</h4><p>一个基本的 <code>Shell</code> 需要具备以下功能：</p><ul><li><strong>提示符显示</strong>：显示当前用户、主机名和工作目录，例如 <code>[user@host ~]#</code>。</li><li><strong>命令读取</strong>：从标准输入读取用户输入的命令。</li><li><strong>命令解析</strong>：将输入的命令行分割为命令和参数。</li><li><strong>命令执行</strong>：支持内置命令（如 <code>cd</code>、<code>export</code>）和外部命令（如 <code>ls</code>、<code>cat</code>）。</li><li><strong>重定向支持</strong>：支持输入重定向 <code>&lt;</code>、输出重定向 <code>&gt;</code> 和追加输出重定向 <code>&gt;&gt;</code>。</li><li><strong>环境变量管理</strong>：支持查看和设置环境变量。</li><li><strong>退出机制</strong>：支持通过 <code>exit</code> 退出 <code>Shell</code>。</li></ul><p>让我们一步步实现这些功能。</p><h4 id="2-实现-Shell-的提示符"><a href="#2-实现-Shell-的提示符" class="headerlink" title="2. 实现 Shell 的提示符"></a>2. 实现 <code>Shell</code> 的提示符</h4><p><code>Shell</code> 的提示符是用户交互的起点，通常显示为 <code>[用户名@主机名 当前目录]#</code>。我们需要获取用户名、主机名和当前工作目录。</p><h5 id="1-获取用户信息"><a href="#1-获取用户信息" class="headerlink" title="1. 获取用户信息"></a>1. 获取用户信息</h5><ul><li><strong>用户名</strong>：使用 <code>getenv(&quot;USER&quot;)</code> 获取当前用户名。</li><li><strong>主机名</strong>：使用 <code>getenv(&quot;HOSTNAME&quot;)</code> 获取主机名。</li><li><strong>当前目录</strong>：使用 <code>getcwd()</code> 获取当前工作目录。</li></ul><h5 id="2-定义提示符格式"><a href="#2-定义提示符格式" class="headerlink" title="2. 定义提示符格式"></a>2. 定义提示符格式</h5><p>我们通过宏定义设置提示符的格式：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LEFT <span class="string">&quot;[&quot;</span>        <span class="comment">// 左括号</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RIGHT <span class="string">&quot;]&quot;</span>       <span class="comment">// 右括号</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LABLE <span class="string">&quot;#&quot;</span>       <span class="comment">// 提示符号</span></span></span><br></pre></td></tr></table></figure><h5 id="3-实现-interact-函数"><a href="#3-实现-interact-函数" class="headerlink" title="3. 实现 interact 函数"></a>3. 实现 <code>interact</code> 函数</h5><p><code>interact</code> 函数负责显示提示符并读取用户输入：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">interact</span><span class="params">(<span class="type">char</span>* cline, <span class="type">int</span> size)</span></span><br><span class="line">&#123;</span><br><span class="line">    getpwd();  <span class="comment">// 获取当前工作目录</span></span><br><span class="line">    <span class="built_in">printf</span>(LEFT<span class="string">&quot;%s@%s %s&quot;</span>RIGHT<span class="string">&quot;&quot;</span>LABLE<span class="string">&quot; &quot;</span>, getusername(), gethostname1(), pwd);</span><br><span class="line">    <span class="type">char</span>* s = fgets(cline, size, <span class="built_in">stdin</span>);  <span class="comment">// 读取用户输入</span></span><br><span class="line">    assert(s);                            <span class="comment">// 确保读取成功</span></span><br><span class="line">    (<span class="type">void</span>)s;						    <span class="comment">// 显式标记该变量已被“使用”，从而抑制编译器警告（这是一种代码规范技巧，表明有意忽略此变量）</span></span><br><span class="line">    cline[<span class="built_in">strlen</span>(cline) - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;      <span class="comment">// 去除末尾换行符</span></span><br><span class="line">    check_redir(cline);                   <span class="comment">// 检查重定向符号</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>getpwd()</code> 调用 <code>getcwd(pwd, sizeof(pwd))</code> 更新全局变量 <code>pwd</code>。</p></li><li><p><code>printf</code> 格式化输出提示符，例如 <code>[user@host /home]#</code>。</p></li><li><p><code>fgets</code> 从标准输入读取命令行。</p></li><li><p><code>check_redir</code> 检查是否有重定向符号（稍后实现）。</p></li><li><p>命令行解析：用户输入的命令行需要被分割成命令和参数。例如，输入 <code>ls -l /home</code> 应分割为 <code>[&quot;ls&quot;, &quot;-l&quot;, &quot;/home&quot;]</code>。</p></li></ul><h5 id="3-使用-strtok-分割字符串"><a href="#3-使用-strtok-分割字符串" class="headerlink" title="3. 使用 strtok 分割字符串"></a>3. 使用 <code>strtok</code> 分割字符串</h5><p>我们使用 <code>strtok</code> 函数按空格或制表符分割命令行：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DELIM <span class="string">&quot; \t&quot;</span>  <span class="comment">// 分隔符：空格和制表符</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">splitstring</span><span class="params">(<span class="type">char</span> cline[], <span class="type">char</span>* _argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    argv[i++] = strtok(cline, DELIM);       <span class="comment">// 分割第一个 token</span></span><br><span class="line">    <span class="keyword">while</span> (_argv[i++] = strtok(<span class="literal">NULL</span>, DELIM));  <span class="comment">// 继续分割后续 token</span></span><br><span class="line">    <span class="keyword">return</span> i - <span class="number">1</span>;                           <span class="comment">// 返回参数个数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>strtok(cline, DELIM)</code> 分割第一个 <code>token</code>（命令）。</li><li>循环调用 <code>strtok(NULL, DELIM)</code> 获取后续参数。</li><li>返回值是参数个数 <code>argc</code>，存储在全局数组 <code>argv</code> 中。</li></ul><p>全局变量定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LINE_SIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ARGC_SIZE 32</span></span><br><span class="line"><span class="type">char</span> commandline[LINE_SIZE];  <span class="comment">// 存储用户输入</span></span><br><span class="line"><span class="type">char</span>* argv[ARGC_SIZE];        <span class="comment">// 存储分割后的参数</span></span><br></pre></td></tr></table></figure><h5 id="4-命令执行"><a href="#4-命令执行" class="headerlink" title="4. 命令执行"></a>4. 命令执行</h5><p><code>Shell</code> 需要区分两种命令：</p><ul><li><strong>内置命令</strong>：由 <code>Shell</code> 直接处理，如 <code>cd</code>、<code>export</code>、<code>echo</code>。</li><li><strong>外部命令</strong>：通过 <code>fork</code> 和 <code>exec</code> 执行系统中的可执行文件。</li></ul><h5 id="5-内置命令实现"><a href="#5-内置命令实现" class="headerlink" title="5. 内置命令实现"></a>5. 内置命令实现</h5><p>内置命令在 <code>Shell</code> 进程中直接执行，无需创建子进程。我们在 <code>buildCommand</code> 函数中实现：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">buildCommand</span><span class="params">(<span class="type">char</span>* _argv[], <span class="type">int</span> _argc)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// cd 命令：切换目录</span></span><br><span class="line">    <span class="keyword">if</span> (_argc == <span class="number">2</span> &amp;&amp; <span class="built_in">strcmp</span>(_argv[<span class="number">0</span>], <span class="string">&quot;cd&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        chdir(argv[<span class="number">1</span>]);              <span class="comment">// 切换工作目录</span></span><br><span class="line">        getpwd();</span><br><span class="line">        <span class="built_in">sprintf</span>(getenv(<span class="string">&quot;PWD&quot;</span>), <span class="string">&quot;%s&quot;</span>, pwd);  <span class="comment">// 更新 PWD 环境变量</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;                    <span class="comment">// 表示已处理</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// export 命令：设置环境变量</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (_argc == <span class="number">2</span> &amp;&amp; <span class="built_in">strcmp</span>(_argv[<span class="number">0</span>], <span class="string">&quot;export&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(myenv, _argv[<span class="number">1</span>]);</span><br><span class="line">        putenv(myenv);               <span class="comment">// 添加到环境变量表</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// echo 命令：打印参数</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (_argc == <span class="number">2</span> &amp;&amp; <span class="built_in">strcmp</span>(_argv[<span class="number">0</span>], <span class="string">&quot;echo&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(_argv[<span class="number">1</span>], <span class="string">&quot;$?&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, lastcode);  <span class="comment">// 打印上一次命令退出码</span></span><br><span class="line">            lastcode = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (*_argv[<span class="number">1</span>] == <span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">char</span>* val = getenv(_argv[<span class="number">1</span>] + <span class="number">1</span>);  <span class="comment">// 获取环境变量值</span></span><br><span class="line">            <span class="keyword">if</span> (val)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, _argv[<span class="number">1</span>]);  <span class="comment">// 直接打印参数</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 增强 ls 命令</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(_argv[<span class="number">0</span>], <span class="string">&quot;ls&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _argv[_argc++] = <span class="string">&quot;--color&quot;</span>;    <span class="comment">// 添加颜色选项</span></span><br><span class="line">        _argv[_argc] = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  <span class="comment">// 未处理，交给外部命令执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong><code>cd</code></strong>：使用 <code>chdir</code> 切换目录，并更新 <code>PWD</code> 环境变量。</li><li><strong><code>export</code></strong>：使用 <code>putenv</code> 设置环境变量，<code>myenv</code> 是全局缓冲区。</li><li><strong><code>echo</code></strong>：支持打印上一次退出码、环境变量 <code>VAR</code> 或普通字符串。</li><li><strong><code>ls</code> 增强</strong>：自动添加 <code>--color</code> 选项以显示彩色输出。</li><li>返回值：1 表示内置命令已处理，0 表示需要外部执行。</li></ul><h5 id="6-外部命令执行"><a href="#6-外部命令执行" class="headerlink" title="6. 外部命令执行"></a>6. 外部命令执行</h5><p>外部命令通过 <code>fork</code> 创建子进程并使用 <code>execvp</code> 执行：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">NormalExcute</span><span class="params">(<span class="type">char</span>* _argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pid_t</span> id = fork();</span><br><span class="line">    <span class="keyword">if</span> (id &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (id == <span class="number">0</span>)  <span class="comment">// 子进程</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> fd = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (rdir == IN_RDIR)</span><br><span class="line">        &#123;</span><br><span class="line">            fd = open(rdirfilename, O_RDONLY);</span><br><span class="line">            dup2(fd, <span class="number">0</span>);  <span class="comment">// 重定向标准输入</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (rdir == OUT_RDIR)</span><br><span class="line">        &#123;</span><br><span class="line">            fd = open(rdirfilename, O_CREAT | O_WRONLY | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">            dup2(fd, <span class="number">1</span>);  <span class="comment">// 重定向标准输出</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (rdir == APPEND_RDIR)</span><br><span class="line">        &#123;</span><br><span class="line">            fd = open(rdirfilename, O_CREAT | O_WRONLY | O_APPEND, <span class="number">0666</span>);</span><br><span class="line">            dup2(fd, <span class="number">1</span>);  <span class="comment">// 追加重定向标准输出</span></span><br><span class="line">        &#125;</span><br><span class="line">        execvp(_argv[<span class="number">0</span>], _argv);  <span class="comment">// 执行命令</span></span><br><span class="line">        <span class="built_in">exit</span>(EXIT_CODE);          <span class="comment">// exec 失败退出</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>  <span class="comment">// 父进程</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> status = <span class="number">0</span>;</span><br><span class="line">        <span class="type">pid_t</span> rid = waitpid(id, &amp;status, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (rid == id)</span><br><span class="line">        &#123;</span><br><span class="line">            lastcode = WEXITSTATUS(status);  <span class="comment">// 记录退出码</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>fork()</code> 创建子进程。</p></li><li><p>子进程根据重定向类型（<code>rdir</code>）打开文件并使用 <code>dup2</code> 重定向。</p></li><li><p><code>execvp</code> 执行命令，从 <code>PATH</code> 中查找可执行文件。</p></li><li><p>父进程使用 <code>waitpid</code> 等待子进程结束，并记录退出码到 <code>lastcode</code>。</p></li><li><p>重定向支持，<code>Shell</code> 支持三种重定向：</p><ul><li><p><strong>输入重定向</strong>：<code>&lt; filename</code></p></li><li><p><strong>输出重定向</strong>：<code>&gt; filename</code></p></li><li><p><strong>追加输出重定向</strong>：<code>&gt;&gt; filename</code></p></li></ul></li></ul><h5 id="7-解析重定向符号"><a href="#7-解析重定向符号" class="headerlink" title="7. 解析重定向符号"></a>7. 解析重定向符号</h5><p>在 <code>check_redir</code> 函数中解析重定向：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NONE -1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IN_RDIR 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OUT_RDIR 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> APPEND_RDIR 2</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span>* rdirfilename = <span class="literal">NULL</span>;  <span class="comment">// 重定向文件名</span></span><br><span class="line"><span class="type">int</span> rdir = NONE;            <span class="comment">// 重定向类型</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">check_redir</span><span class="params">(<span class="type">char</span>* cmd)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span>* pos = cmd;</span><br><span class="line">    <span class="keyword">while</span> (*pos)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (*pos == <span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (*(pos + <span class="number">1</span>) == <span class="string">&#x27;&gt;&#x27;</span>)  <span class="comment">// &gt;&gt;</span></span><br><span class="line">            &#123;</span><br><span class="line">                *pos++ = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                *pos++ = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                <span class="keyword">while</span> (<span class="built_in">isspace</span>(*pos)) pos++;</span><br><span class="line">                rdirfilename = pos;</span><br><span class="line">                rdir = APPEND_RDIR;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>  <span class="comment">// &gt;</span></span><br><span class="line">            &#123;</span><br><span class="line">                *pos = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                pos++;</span><br><span class="line">                <span class="keyword">while</span> (<span class="built_in">isspace</span>(*pos)) pos++;</span><br><span class="line">                rdirfilename = pos;</span><br><span class="line">                rdir = OUT_RDIR;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (*pos == <span class="string">&#x27;&lt;&#x27;</span>)  <span class="comment">// &lt;</span></span><br><span class="line">        &#123;</span><br><span class="line">            *pos = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            pos++;</span><br><span class="line">            <span class="keyword">while</span> (<span class="built_in">isspace</span>(*pos)) pos++;</span><br><span class="line">            rdirfilename = pos;</span><br><span class="line">            rdir = IN_RDIR;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        pos++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>遍历命令行，检测 <code>&lt;</code>、<code>&gt;</code> 或 <code>&gt;&gt;</code>。</li><li>将符号替换为 <code>\0</code> 以分割命令和文件名。</li><li>设置全局变量 <code>rdir</code> 和 <code>rdirfilename</code>。</li><li><code>interact</code> 函数调用 <code>check_redir</code> 进行解析。</li></ul><h5 id="8-执行重定向"><a href="#8-执行重定向" class="headerlink" title="8. 执行重定向"></a>8. 执行重定向</h5><p>在 <code>NormalExcute</code> 中根据 <code>rdir</code> 处理重定向：</p><ul><li><strong>输入重定向</strong>：打开文件并重定向到标准输入（文件描述符 0）。</li><li><strong>输出重定向</strong>：创建或截断文件并重定向到标准输出（文件描述符 1）。</li><li><strong>追加输出重定向</strong>：创建或追加文件并重定向到标准输出。</li><li><strong>环境变量管理：</strong><ul><li><strong>查看</strong>：通过 <code>echo $VAR</code> 查看环境变量值。</li><li><strong>设置</strong>：通过 <code>export VAR = VALUE</code> 设置环境变量。</li></ul></li></ul><p>这些功能已在 <code>buildCommand</code> 的 <code>echo</code> 和 <code>export</code> 实现中完成。</p><h5 id="9-主循环"><a href="#9-主循环" class="headerlink" title="9. 主循环"></a>9. 主循环</h5><p><code>Shell</code> 的主循环负责持续运行：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (!quit)</span><br><span class="line">    &#123;</span><br><span class="line">        rdirfilename = <span class="literal">NULL</span>;  <span class="comment">// 重置重定向信息</span></span><br><span class="line">        rdir = NONE;</span><br><span class="line">        interact(commandline, <span class="keyword">sizeof</span>(commandline));  <span class="comment">// 获取输入</span></span><br><span class="line">        <span class="type">int</span> argc = splitstring(commandline, argv);   <span class="comment">// 解析命令</span></span><br><span class="line">        <span class="keyword">if</span> (argc == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> n = buildCommand(argv, argc);            <span class="comment">// 处理内置命令</span></span><br><span class="line">        <span class="keyword">if</span> (!n)</span><br><span class="line">        &#123;</span><br><span class="line">            NormalExcute(argv);                      <span class="comment">// 执行外部命令</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>重置重定向状态。</li><li>获取并解析用户输入。</li><li>处理内置命令或外部命令。</li><li><code>quit</code> 变量控制退出（当前代码中未实现 <code>exit</code> 命令，可扩展）。</li></ul><h4 id="3-源码一览"><a href="#3-源码一览" class="headerlink" title="3. 源码一览"></a>3. 源码一览</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ======================== 宏定义区域 ========================</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LEFT <span class="string">&quot;[&quot;</span>                            <span class="comment">// shell 显示用的左括号</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RIGHT <span class="string">&quot;]&quot;</span>                           <span class="comment">// shell 显示用的右括号</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LABLE <span class="string">&quot;#&quot;</span>                           <span class="comment">// shell 显示用的提示符号</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELIM <span class="string">&quot; \t&quot;</span>                         <span class="comment">// 分隔符（空格和制表符）</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LINE_SIZE 1024                      <span class="comment">// 每一行命令最大长度</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ARGC_SIZE 32                        <span class="comment">// 最大命令参数个数</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXIT_CODE 44                        <span class="comment">// 子进程执行失败退出码</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重定向类型定义</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NONE -1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IN_RDIR     0                       <span class="comment">// 输入重定向（&lt;）</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OUT_RDIR    1                       <span class="comment">// 输出重定向（&gt;）</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> APPEND_RDIR 2                       <span class="comment">// 追加输出重定向（&gt;&gt;）</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ======================== 全局变量 ========================</span></span><br><span class="line"><span class="type">int</span> lastcode = <span class="number">0</span>;                           <span class="comment">// 上一次命令的返回码</span></span><br><span class="line"><span class="type">int</span> quit = <span class="number">0</span>;                               <span class="comment">// 控制是否退出 shell</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span>** environ;                      <span class="comment">// 系统环境变量表</span></span><br><span class="line"><span class="type">char</span> commandline[LINE_SIZE];                <span class="comment">// 存储用户输入命令</span></span><br><span class="line"><span class="type">char</span>* argv[ARGC_SIZE];                      <span class="comment">// 存储分割后的命令参数</span></span><br><span class="line"><span class="type">char</span> pwd[LINE_SIZE];                        <span class="comment">// 当前工作目录</span></span><br><span class="line"><span class="type">char</span>* rdirfilename = <span class="literal">NULL</span>;                  <span class="comment">// 重定向的文件名</span></span><br><span class="line"><span class="type">int</span> rdir = NONE;                            <span class="comment">// 当前重定向类型</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> myenv[LINE_SIZE];                      <span class="comment">// 存储 export 设置的环境变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ======================== 工具函数 ========================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前用户名</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* <span class="title function_">getusername</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> getenv(<span class="string">&quot;USER&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取主机名</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* <span class="title function_">gethostname1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> getenv(<span class="string">&quot;HOSTNAME&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前路径（PWD）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">getpwd</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    getcwd(pwd, <span class="keyword">sizeof</span>(pwd));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析重定向符号（&lt; &gt; &gt;&gt;）并设置 rdir 和 rdirfilename</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">check_redir</span><span class="params">(<span class="type">char</span>* cmd)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span>* pos = cmd;</span><br><span class="line">    <span class="keyword">while</span> (*pos)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (*pos == <span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (*(pos + <span class="number">1</span>) == <span class="string">&#x27;&gt;&#x27;</span>)          <span class="comment">// &gt;&gt; 追加重定向</span></span><br><span class="line">            &#123; </span><br><span class="line">                *pos++ = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                *pos++ = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                <span class="keyword">while</span> (<span class="built_in">isspace</span>(*pos))</span><br><span class="line">                &#123;</span><br><span class="line">                    pos++;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                rdirfilename = pos;</span><br><span class="line">                rdir = APPEND_RDIR;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>                            <span class="comment">// &gt; 普通输出重定向</span></span><br><span class="line">            &#123; </span><br><span class="line">                *pos = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">                pos++;</span><br><span class="line">                <span class="keyword">while</span> (<span class="built_in">isspace</span>(*pos))</span><br><span class="line">                &#123;</span><br><span class="line">                    pos++;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                rdirfilename = pos;</span><br><span class="line">                rdir = OUT_RDIR;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (*pos == <span class="string">&#x27;&lt;&#x27;</span>)               <span class="comment">// &lt; 输入重定向</span></span><br><span class="line">        &#123;</span><br><span class="line">            *pos = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            pos++;</span><br><span class="line">            <span class="keyword">while</span> (<span class="built_in">isspace</span>(*pos))</span><br><span class="line">            &#123;</span><br><span class="line">                pos++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            rdirfilename = pos;</span><br><span class="line">            rdir = IN_RDIR;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        pos++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示 shell 提示符并获取用户输入命令</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">interact</span><span class="params">(<span class="type">char</span>* cline, <span class="type">int</span> size)</span></span><br><span class="line">&#123;</span><br><span class="line">    getpwd();</span><br><span class="line">    <span class="built_in">printf</span>(LEFT<span class="string">&quot;%s@%s %s&quot;</span>RIGHT<span class="string">&quot;&quot;</span>LABLE<span class="string">&quot; &quot;</span>, getusername(), gethostname1(), pwd);</span><br><span class="line">    <span class="type">char</span>* s = fgets(cline, size, <span class="built_in">stdin</span>);    <span class="comment">// 获取用户输入</span></span><br><span class="line">    assert(s);                              <span class="comment">// 确保输入成功</span></span><br><span class="line">    (<span class="type">void</span>)s;							 <span class="comment">// 显式标记该变量已被“使用”，从而抑制编译器警告（这是一种代码规范技巧，表明有意忽略此变量）</span></span><br><span class="line"></span><br><span class="line">    cline[<span class="built_in">strlen</span>(cline) - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;        <span class="comment">// 去除换行符</span></span><br><span class="line">    check_redir(cline);                     <span class="comment">// 检查是否有重定向</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将命令行字符串根据空格分割成参数数组</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">splitstring</span><span class="params">(<span class="type">char</span> cline[], <span class="type">char</span>* _argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    argv[i++] = strtok(cline, DELIM);</span><br><span class="line">    <span class="keyword">while</span> (_argv[i++] = strtok(<span class="literal">NULL</span>, DELIM));   <span class="comment">// 使用 strtok 循环分割</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> i - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行普通命令（fork+exec）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">NormalExcute</span><span class="params">(<span class="type">char</span>* _argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pid_t</span> id = fork();</span><br><span class="line">    <span class="keyword">if</span> (id &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (id == <span class="number">0</span>)                           <span class="comment">// 子进程执行命令</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> fd = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (rdir == IN_RDIR)</span><br><span class="line">        &#123;</span><br><span class="line">            fd = open(rdirfilename, O_RDONLY);</span><br><span class="line">            dup2(fd, <span class="number">0</span>);                        <span class="comment">// 标准输入重定向</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (rdir == OUT_RDIR)</span><br><span class="line">        &#123;</span><br><span class="line">            fd = open(rdirfilename, O_CREAT | O_WRONLY | O_TRUNC, <span class="number">0666</span>);</span><br><span class="line">            dup2(fd, <span class="number">1</span>);                        <span class="comment">// 标准输出重定向</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (rdir == APPEND_RDIR) &#123;</span><br><span class="line">            fd = open(rdirfilename, O_CREAT | O_WRONLY | O_APPEND, <span class="number">0666</span>);</span><br><span class="line">            dup2(fd, <span class="number">1</span>);                        <span class="comment">// 标准输出追加重定向</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        execvp(_argv[<span class="number">0</span>], _argv);                <span class="comment">// 执行命令（从 PATH 路径中查找）</span></span><br><span class="line">        <span class="built_in">exit</span>(EXIT_CODE);                        <span class="comment">// exec 出错则退出</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>                                        <span class="comment">// 父进程等待子进程结束</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> status = <span class="number">0</span>;</span><br><span class="line">        <span class="type">pid_t</span> rid = waitpid(id, &amp;status, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (rid == id)</span><br><span class="line">        &#123;</span><br><span class="line">            lastcode = WEXITSTATUS(status);     <span class="comment">// 记录子进程退出码</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建内置命令：cd, export, echo</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">buildCommand</span><span class="params">(<span class="type">char</span>* _argv[], <span class="type">int</span> _argc)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_argc == <span class="number">2</span> &amp;&amp; <span class="built_in">strcmp</span>(_argv[<span class="number">0</span>], <span class="string">&quot;cd&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        chdir(argv[<span class="number">1</span>]);                         <span class="comment">// 切换工作目录</span></span><br><span class="line">        getpwd();</span><br><span class="line">        <span class="built_in">sprintf</span>(getenv(<span class="string">&quot;PWD&quot;</span>), <span class="string">&quot;%s&quot;</span>, pwd);      <span class="comment">// 更新环境变量 PWD</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (_argc == <span class="number">2</span> &amp;&amp; <span class="built_in">strcmp</span>(_argv[<span class="number">0</span>], <span class="string">&quot;export&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(myenv, _argv[<span class="number">1</span>]);</span><br><span class="line">        putenv(myenv);                          <span class="comment">// 添加或修改环境变量</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (_argc == <span class="number">2</span> &amp;&amp; <span class="built_in">strcmp</span>(_argv[<span class="number">0</span>], <span class="string">&quot;echo&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(_argv[<span class="number">1</span>], <span class="string">&quot;$?&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, lastcode);           <span class="comment">// 打印上一次命令的返回码</span></span><br><span class="line">            lastcode = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (*_argv[<span class="number">1</span>] == <span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">char</span>* val = getenv(_argv[<span class="number">1</span>] + <span class="number">1</span>);   <span class="comment">// 获取环境变量值</span></span><br><span class="line">            <span class="keyword">if</span> (val)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, _argv[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对 ls 增加颜色选项</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(_argv[<span class="number">0</span>], <span class="string">&quot;ls&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _argv[_argc++] = <span class="string">&quot;--color&quot;</span>; <span class="comment">// 自动加上颜色显示</span></span><br><span class="line">        _argv[_argc] = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ======================== 主函数入口 ========================</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (!quit)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 初始化重定向信息</span></span><br><span class="line">        rdirfilename = <span class="literal">NULL</span>;</span><br><span class="line">        rdir = NONE;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取用户输入的命令行</span></span><br><span class="line">        interact(commandline, <span class="keyword">sizeof</span>(commandline));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 分割命令行为参数数组</span></span><br><span class="line">        <span class="type">int</span> argc = splitstring(commandline, argv);</span><br><span class="line">        <span class="keyword">if</span> (argc == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理内置命令</span></span><br><span class="line">        <span class="type">int</span> n = buildCommand(argv, argc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行普通命令</span></span><br><span class="line">        <span class="keyword">if</span> (!n)</span><br><span class="line">        &#123;</span><br><span class="line">            NormalExcute(argv);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个 <code>Shell</code> 虽简单，但展示了 <code>Shell</code> 的相对核心机制。当然还有一些其他功能没有实现，以及代码中还多场景考虑不周到、兼容性、健壮性等问题处理不够完美，还是等以后学深了再完善吧~</p></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Profile%20picture.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Profile%20picture.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">小米里的大麦</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://www.minbit.top/posts/61868.html">原创</a><a class="post-copyright-title"><span onclick='rm.copyPageUrl("https://www.minbit.top/posts/61868.html")'>020 实现一个简易 Shell</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/wechatANDalipay.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechatANDalipay.webp" alt="微信/支付宝"></a><div class="post-qr-code-desc">微信/支付宝</div></li><li class="reward-item"><a href="/img/PayPal.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/PayPal.webp" alt="PayPal"></a><div class="post-qr-code-desc">PayPal</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.minbit.top/posts/61868.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=020 实现一个简易 Shell&amp;url=https://www.minbit.top/posts/61868.html&amp;pic=https://image-kcm.pages.dev/v2/TISblXc.png?_r_=c7e05aab-ef56-5b8c-0f71-bf02d4a5911a" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)</a> 许可协议。转载请注明来自 <a href="https://www.minbit.top" target="_blank">小米里的大麦</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Linux/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span>Linux<span class="tagsPageCount">59</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://image-kcm.pages.dev/v2/TISblXc.png?_r_=6fc4a26b-d384-a060-5b79-b0768070ba93" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/28370.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/gDpBkQU.png?_r_=1d35163d-1d6c-fad3-0529-aa408bf15765" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">019 进程控制 —— 进程程序替换</div></div></a></div><div class="next-post pull-right"><a href="/posts/47579.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/yPgfhRS.png?_r_=65afae5f-d4ab-5a32-c20e-f37aa4e8d8b8" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">021 多语言协同执行（了解）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/49772.html" title="001 环境搭建"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/IAdmxAt.png?_r_=1fd2df79-cdb8-578f-4c0c-2de95a298850" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-11</div><div class="title">001 环境搭建</div></div></a></div><div><a href="/posts/55415.html" title="002 创建普通账户（为朋友创建、删除账户）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/08taomy.jpeg?_r_=46285b48-cba0-53ff-483c-f5c71d93785b" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-17</div><div class="title">002 创建普通账户（为朋友创建、删除账户）</div></div></a></div><div><a href="/posts/42463.html" title="003 系统和入门指令"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/IAdmxAt.png?_r_=64f46250-170a-ab5b-0757-9313ccede5ed" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-22</div><div class="title">003 系统和入门指令</div></div></a></div><div><a href="/posts/15646.html" title="006 yum和Linux生态"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/12THR4h.png?_r_=cd6edb6c-8b41-69bd-7304-0cafdd89dbf6" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-17</div><div class="title">006 yum和Linux生态</div></div></a></div><div><a href="/posts/35315.html" title="005 权限的理解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/IAdmxAt.png?_r_=f310fafd-c5b7-1013-ffa8-c7bcb2dfef34" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-10</div><div class="title">005 权限的理解</div></div></a></div><div><a href="/posts/62462.html" title="007 Linux 开发工具（上）—— vim、解放sudo、gc+"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/yPgfhRS.png?_r_=0c6219b4-537d-f0c9-5db3-50d4ee9707b6" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-17</div><div class="title">007 Linux 开发工具（上）—— vim、解放sudo、gc+</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Profile%20picture.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"></div></div><div class="author-info__description">时间好像总会留下点什么,或许是一个人,或许是一个梦,或许……是一段有意义的经历~</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">小米里的大麦</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/huangcancan-xbc" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><span>👋🏻 Hi，我是 <a target="_blank" href="https://huangcancan-xbc.github.io" rel="external nofollow noreferrer noopener" style="font-weight:700;font-size:1.1em;color:#5166f0">小米里的大麦</a>，欢迎来看我的博客鸭！</span><br><span>👉 建议优先查看置顶的 <a target="_blank" href="https://huangcancan-xbc.github.io/posts/17934.html" rel="external nofollow noreferrer noopener" style="font-weight:700;font-size:1.1em;color:#5166f0">网站说明</a>，如有问题欢迎评论区交流！</span><br><span>😫 页面异常？尝试<kbd>Ctrl</kbd>+<kbd>F5</kbd></span><br><span>📩 联系我：<a href="mailto:hc1960074081@qq.com" rel="external nofollow noreferrer"><b>给我发送邮件🚀</b></a></span><br><div style="text-align:center;margin-top:10px"><style>.pp-AN88D43BPZLXN{text-align:center;border:none;border-radius:.25rem;min-width:11.625rem;padding:0 2rem;height:2.625rem;font-weight:700;background-color:#ffd140;color:#003087;font-family:"Helvetica Neue",Arial,sans-serif;font-size:1rem;line-height:1.25rem;cursor:pointer}</style><form action="https://www.paypal.com/ncp/payment/AN88D43BPZLXN" method="post" target="_blank" style="display:inline-grid;justify-items:center;align-content:start;gap:.5rem"><input class="pp-AN88D43BPZLXN" type="submit" value="打赏支持我"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.paypalobjects.com/images/Debit_Credit_APM.svg" alt="cards"><section style="font-size:.75rem">技术支持提供方： <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.paypalobjects.com/paypal-ui/logos/svg/paypal-wordmark-color.svg" alt="paypal" style="height:.875rem;vertical-align:middle"></section></form></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93-Shell"><span class="toc-number">1.</span> <span class="toc-text">从零到一实现一个简易 Shell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Shell-%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="toc-number">1.1.</span> <span class="toc-text">1. Shell 的基本功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%9E%E7%8E%B0-Shell-%E7%9A%84%E6%8F%90%E7%A4%BA%E7%AC%A6"><span class="toc-number">1.2.</span> <span class="toc-text">2. 实现 Shell 的提示符</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. 获取用户信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%AE%9A%E4%B9%89%E6%8F%90%E7%A4%BA%E7%AC%A6%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. 定义提示符格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%AE%9E%E7%8E%B0-interact-%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. 实现 interact 函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8-strtok-%E5%88%86%E5%89%B2%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.2.4.</span> <span class="toc-text">3. 使用 strtok 分割字符串</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.2.5.</span> <span class="toc-text">4. 命令执行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.6.</span> <span class="toc-text">5. 内置命令实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.2.7.</span> <span class="toc-text">6. 外部命令执行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-%E8%A7%A3%E6%9E%90%E9%87%8D%E5%AE%9A%E5%90%91%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.2.8.</span> <span class="toc-text">7. 解析重定向符号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-%E6%89%A7%E8%A1%8C%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.2.9.</span> <span class="toc-text">8. 执行重定向</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-%E4%B8%BB%E5%BE%AA%E7%8E%AF"><span class="toc-number">1.2.10.</span> <span class="toc-text">9. 主循环</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%BA%90%E7%A0%81%E4%B8%80%E8%A7%88"><span class="toc-number">1.3.</span> <span class="toc-text">3. 源码一览</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/22243.html" title="2025 年度总结"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/TISblXc.png?_r_=6fc4a26b-d384-a060-5b79-b0768070ba93" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="2025 年度总结"></a><div class="content"><a class="title" href="/posts/22243.html" title="2025 年度总结">2025 年度总结</a><time datetime="2025-12-31T16:00:00.000Z" title="发表于 2026-01-01 00:00:00">2026-01-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/39993.html" title="08 表的增删改查下"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/12THR4h.png?_r_=6678428a-7043-ada6-7336-f16c60cf0d4e" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="08 表的增删改查下"></a><div class="content"><a class="title" href="/posts/39993.html" title="08 表的增删改查下">08 表的增删改查下</a><time datetime="2025-12-12T16:00:00.000Z" title="发表于 2025-12-13 00:00:00">2025-12-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/38170.html" title="Ubuntu 22.04 中安装 thefuck 与 tldr 工具"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/08taomy.jpeg?_r_=c6628b3e-dbb9-69cf-7b52-a1592090642c" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Ubuntu 22.04 中安装 thefuck 与 tldr 工具"></a><div class="content"><a class="title" href="/posts/38170.html" title="Ubuntu 22.04 中安装 thefuck 与 tldr 工具">Ubuntu 22.04 中安装 thefuck 与 tldr 工具</a><time datetime="2025-11-22T04:00:00.000Z" title="发表于 2025-11-22 12:00:00">2025-11-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/31539.html" title="CodeX CLI 的使用备忘"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/gDpBkQU.png?_r_=de921907-5476-440e-1b3f-76a5b42fc82f" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="CodeX CLI 的使用备忘"></a><div class="content"><a class="title" href="/posts/31539.html" title="CodeX CLI 的使用备忘">CodeX CLI 的使用备忘</a><time datetime="2025-11-19T04:00:00.000Z" title="发表于 2025-11-19 12:00:00">2025-11-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/41191.html" title="免费白嫖 ChatGPT Go 套餐"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/yPgfhRS.png?_r_=42c13ae0-a861-b4a6-ba61-e7da0a973c91" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="免费白嫖 ChatGPT Go 套餐"></a><div class="content"><a class="title" href="/posts/41191.html" title="免费白嫖 ChatGPT Go 套餐">免费白嫖 ChatGPT Go 套餐</a><time datetime="2025-11-04T16:00:00.000Z" title="发表于 2025-11-05 00:00:00">2025-11-05</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:hc1960074081@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://weibo.com/u/7913790969" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0,500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Profile picture.png" size="50px"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 - 2026 By <a class="footer-bar-link" href="/" title="小米里的大麦" target="_blank">小米里的大麦</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType(){fetch("https://v1.hitokoto.cn").then(t=>t.json()).then(t=>{{const e="出自 "+t.from,n=["《左传》载曰：“太上有立德，其次有立功，其次有立言，虽久不废，此之谓不朽。”","纸上得来终觉浅，绝知此事要躬行！","《答案在风中飘扬》（Blowing in The Wind）","梦想是不会发光的，发光的是追梦的你！","你太专注于未来，却没有意识到，今天正是你多年前祈求的模样，因为你眺望远方视而不见。"];n.unshift(t.hitokoto,e),window.typed=new Typed("#footer-type-tips",{strings:n,startDelay:300,typeSpeed:150,loop:!0,backSpeed:50})}})}"function"==typeof Typed?subtitleType():getScript("https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js").then(subtitleType)</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub主页">GitHub主页</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">93</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">9</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">社交</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/lollipop.svg" alt="GitHub"><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="哔哩哔哩"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/wink.svg" alt="哔哩哔哩"><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/huang-cancan-xbc" title="Gitee"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/laugh.svg" alt="Gitee"><span class="back-menu-item-text">Gitee</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.csdn.net/Huangcancan666?type=blog" title="CSDN"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/celebrate.svg" alt="CSDN"><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3230789931118109" title="稀土掘金"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/kiss.svg" alt="稀土掘金"><span class="back-menu-item-text">稀土掘金</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">算法</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://leetcode.cn/u/nifty-faradayzqn" title="力扣"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/thinking-glass.svg" alt="力扣"><span class="back-menu-item-text">力扣</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://ac.nowcoder.com/acm/contest/profile/517073385" title="牛客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/think.svg" alt="牛客"><span class="back-menu-item-text">牛客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/1367427" title="洛谷"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/funny.svg" alt="洛谷"><span class="back-menu-item-text">洛谷</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 外链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size:.88rem">AI<sup>2</sup></a><a href="/tags/C/" style="font-size:.88rem">C++<sup>11</sup></a><a href="/tags/Git/" style="font-size:.88rem">Git<sup>3</sup></a><a href="/tags/IO/" style="font-size:.88rem">IO<sup>5</sup></a><a href="/tags/Linux/" style="font-size:.88rem">Linux<sup>59</sup></a><a href="/tags/MySQL/" style="font-size:.88rem">MySQL<sup>9</sup></a><a href="/tags/Redis/" style="font-size:.88rem">Redis<sup>2</sup></a><a href="/tags/STL/" style="font-size:.88rem">STL<sup>2</sup></a><a href="/tags/VS-Code/" style="font-size:.88rem">VS Code<sup>1</sup></a><a href="/tags/%E4%BF%A1%E5%8F%B7/" style="font-size:.88rem">信号<sup>3</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size:.88rem">内存管理<sup>1</sup></a><a href="/tags/%E5%8E%86%E7%A8%8B/" style="font-size:.88rem">历程<sup>2</sup></a><a href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" style="font-size:.88rem">地址空间<sup>6</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size:.88rem">工具<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size:.88rem">数学<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size:.88rem">模板<sup>1</sup></a><a href="/tags/%E7%81%B5%E5%85%89%E8%8D%9F%E8%90%83/" style="font-size:.88rem">灵光荟萃<sup>3</sup></a><a href="/tags/%E7%AE%A1%E9%81%93/" style="font-size:.88rem">管道<sup>2</sup></a><a href="/tags/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" style="font-size:.88rem">类与对象<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size:.88rem">线程<sup>5</sup></a><a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size:.88rem">网站<sup>3</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size:.88rem">网络<sup>11</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size:.88rem">进程<sup>15</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@6.1.6/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>var HoldLog=console.log;console.log=function(){};let now1=new Date;queueMicrotask(()=>{const o=function(){HoldLog.apply(console,arguments)},n=new Date("01/01/2025 00:00:00");now1.setTime(now1.getTime()+250);const c=(now1-n)/1e3/60/60/24,e=["这里是 小米里的大麦","芝兰生于深谷，不以无人而不芳。","\n        \n       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗\n      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║\n      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║\n      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║\n      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝\n      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝\n        \n        ","已上线",Math.floor(c),"天","©2025 By 安知鱼 V1.7.1"],t=["NCC2-036","调用前置摄像头拍照成功，识别为【小笨蛋】.","Photo captured: ","🤪"];setTimeout(o.bind(console,`\n%c${e[0]} %c ${e[1]} %c ${e[2]} %c${e[3]}%c ${e[4]}%c ${e[5]}\n\n%c ${e[6]}\n`,"color:#425AEF","","color:#425AEF","color:#425AEF","","color:#425AEF","")),setTimeout(o.bind(console,`%c ${t[0]} %c ${t[1]} %c \n${t[2]} %c\n${t[3]}\n`,"color:white; background-color:#4fd953","","",'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%')),setTimeout(o.bind(console,"%c WELCOME %c 你好，小笨蛋.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c ⚡ Powered by 安知鱼 %c 你正在访问 小米里的大麦 的博客.","color:white; background-color:#f0ad4e","")),setTimeout(o.bind(console,"%c W23-12 %c 你已打开控制台.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c S013-782 %c 你现在正处于监控中.","color:white; background-color:#d9534f",""))})</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{const t=()=>{"object"==typeof twikoo?setTimeout(o,0):getScript("https://cdn.cbd.int/twikoo@1.6.44/dist/twikoo.all.min.js").then(o)},o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.minbit.top/",path:window.location.pathname,region:"ap-shanghai",onCommentLoaded:()=>{anzhiyu.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&(()=>{const t=document.getElementById("twikoo-count");t&&twikoo.getCommentsCount({envId:"https://twikoo.minbit.top/",region:"ap-shanghai",urls:[window.location.pathname],includeReply:!1}).then(o=>{t.textContent=o[0].count}).catch(t=>{console.error(t)})})()};anzhiyu.loadComment(document.getElementById("twikoo-wrap"),t)})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener("load",()=>{const e=e=>{let t="";if(e.length)for(let n=0;n<e.length;n++){t+="<div class='aside-list-item'>";{const a="data-lazy-src";t+=`<a href='${e[n].url}' class='thumbnail'><img ${a}='${e[n].avatar}' alt='${e[n].nick}'><div class='name'><span>${e[n].nick} </span></div></a>`}t+=`<div class='content'>\n        <a class='comment' href='${e[n].url}' title='${e[n].content}'>${e[n].content}</a>\n        <time datetime="${e[n].date}">${anzhiyu.diffDate(e[n].date,!0)}</time></div>\n        </div>`}else t+="没有评论";let n=document.querySelector("#card-newest-comments .aside-list");n&&(n.innerHTML=t),window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(n)},t=()=>{if(document.querySelector("#card-newest-comments .aside-list")){const t=saveToLocal.get("twikoo-newest-comments");t?e(JSON.parse(t)):(()=>{const t=()=>{twikoo.getRecentComments({envId:"https://twikoo.minbit.top/",region:"ap-shanghai",pageSize:6,includeReply:!0}).then((function(t){const n=t.map(e=>{return{content:(t=e.comment,""===t||(t=(t=(t=(t=t.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length>150&&(t=t.substring(0,150)+"..."),t),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.id,date:new Date(e.created).toISOString()};var t});saveToLocal.set("twikoo-newest-comments",JSON.stringify(n),10/1440),e(n)})).catch((function(e){document.querySelector("#card-newest-comments .aside-list").textContent="无法获取评论，请确认相关配置是否正确"}))};"object"==typeof twikoo?t():getScript("https://cdn.cbd.int/twikoo@1.6.44/dist/twikoo.all.min.js").then(t)})()}};t(),document.addEventListener("pjax:complete",t)})</script><script async data-pjax src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail="xiaomilidedamai@minbit.top"</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://cdn.cbd.int/qrcodejs@1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="https://cdn.bootcdn.net/ajax/libs/echarts/4.9.0-rc.1/echarts.min.js"></script><script src="/js/footer-animal.js" defer></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="offer,暴富,健康,offer,喜乐,成功,offer,好运,自由,offer,坚持,上岸" data-fontsize="20px" data-random="true" async></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:type"]','meta[property="og:site_name"]','meta[property="og:description"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(anzhiyu.removeGlobalFnEvent("pjax"),anzhiyu.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async data-pjax src="https://events.vercount.one/js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script><script>window.addEventListener("load",()=>{const t=()=>{if(!window.location.pathname.startsWith("/comments/"))return;const t=async()=>{const t=new EasyDanmaku({page:"/comments/",el:"#danmu-wrap",line:5,speed:20,hover:!0,loop:!1,colourful:!0,coefficient:1.38,runtime:10});try{let a=saveToLocal.get("twikoo-danmu");if(a)t.batchSend(a,!0);else{const n={method:"POST",body:JSON.stringify({event:"GET_RECENT_COMMENTS",includeReply:!1,pageSize:100}),headers:{"Content-Type":"application/json"}};a=[];const o=await fetch("https://twikoo.minbit.top/",n);if(o.ok){const{data:n}=await o.json();n.forEach(t=>{null==t.avatar&&(t.avatar="https://cravatar.cn/avatar/d615d5793929e8c7d70eab5f00f7f5f1?d=mp"),a.push({avatar:t.avatar,content:t.nick+"："+e(t.comment),url:t.url+"#"+t.id})}),t.batchSend(a,!0),saveToLocal.set("twikoo-danmu",a,.5)}function e(t){return t=(t=(t=(t=(t=t.replace(/<\/*br>|[\s\uFEFF\xA0]+/g,"")).replace(/<img.*?>/g,"[图片]")).replace(/<a.*?>.*?<\/a>/g,"[链接]")).replace(/<pre.*?>.*?<\/pre>/g,"[代码块]")).replace(/<.*?>/g,"")}}}catch(t){console.error("Error fetching data:",t)}document.getElementById("danmu-Btn")&&(document.getElementById("danmu-Btn").innerHTML="<button class=\"hide-Btn\" onclick=\"document.getElementById('danmu-wrap').classList.remove('hide-danmu')\">显示弹幕</button> <button class=\"hide-Btn\" onclick=\"document.getElementById('danmu-wrap').classList.add('hide-danmu')\">隐藏弹幕</button>")};(async()=>{if("function"==typeof EasyDanmaku)await t();else{await getScript("https://npm.onmicrosoft.cn/naokuo-blog@1.2.12/js/easy-Danmaku.js");"function"==typeof EasyDanmaku?await t():console.error("EasyDanmaku function not found even after loading the script.")}})()};t(),document.addEventListener("pjax:complete",t)})</script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>