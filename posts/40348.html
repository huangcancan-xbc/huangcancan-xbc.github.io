<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>046 网络编程套接字 | 小米里的大麦</title><meta name="keywords" content="Linux,网络"><meta name="author" content="小米里的大麦"><meta name="copyright" content="小米里的大麦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="046 网络编程套接字"><meta name="application-name" content="046 网络编程套接字"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="046 网络编程套接字"><meta property="og:url" content="https://www.minbit.top/posts/40348.html"><meta property="og:site_name" content="小米里的大麦"><meta property="og:description" content="网络编程套接字1. 预备知识1. 源 IP 地址 &amp;amp; 目的 IP 地址 是什么： 负责 跨网络 的全球寻址，由 路由器 使用。 源 IP：发件人所在的“城市 + 街道”的网络位置。 目的 IP：收件人所在的网络位置。   理解： 在互联网中，IP 就是定位“哪台主机”。 源 IP 说的是 “"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://image-kcm.pages.dev/v2/IAdmxAt.png?_r_=cfd71b95-b3cb-c47a-e8ff-005199aa79ab"><meta property="article:author" content="小米里的大麦"><meta property="article:tag" content="技术博客,Linux,C++,后端开发,编程学习,个人博客,技术分享"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://image-kcm.pages.dev/v2/IAdmxAt.png?_r_=cfd71b95-b3cb-c47a-e8ff-005199aa79ab"><meta name="description" content="网络编程套接字1. 预备知识1. 源 IP 地址 &amp;amp; 目的 IP 地址 是什么： 负责 跨网络 的全球寻址，由 路由器 使用。 源 IP：发件人所在的“城市 + 街道”的网络位置。 目的 IP：收件人所在的网络位置。   理解： 在互联网中，IP 就是定位“哪台主机”。 源 IP 说的是 “"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "046 网络编程套接字",
  "description": "网络编程套接字1. 预备知识1. 源 IP 地址 &amp; 目的 IP 地址 是什么： 负责 跨网络 的全球寻址，由 路由器 使用。 源 IP：发件人所在的“城市 + 街道”的网络位置。 目的 IP：收件人所在的网络位置。   理解： 在互联网中，IP 就是定位“哪台主机”。 源 IP 说的是 “",
  "image": "https://image-kcm.pages.dev/v2/IAdmxAt.png?_r_=cfd71b95-b3cb-c47a-e8ff-005199aa79ab",
  "datePublished": "2025-08-15T04:00:00.000Z",
  "dateModified": "2025-08-15T04:00:00.000Z",
  "author": {
    "@type": "Person",
    "name": "小米里的大麦",
    "url": "https://www.minbit.top"
  },
  "publisher": {
    "@type": "Organization",
    "name": "小米里的大麦",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.minbit.top/img/Profile%20picture.png"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.minbit.top/posts/40348.html"
  },
  "keywords": "Linux, 网络"
}</script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "首页",
      "item": "https://www.minbit.top"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "046 网络编程套接字",
      "item": "https://www.minbit.top/posts/40348.html"
    }
  ]
}</script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "小米里的大麦",
  "url": "https://www.minbit.top",
  "image": "https://www.minbit.top/img/Profile%20picture.png",
  "description": "时间好像总会留下点什么，或许是一个人，或许是一个梦，或许……是一段有意义的经历~"
}</script><link rel="shortcut icon" href="/img/icons/funny.svg"><link rel="canonical" href="https://www.minbit.top/posts/40348.html"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//bsz.dusays.com:9001"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"><link rel="mask-icon" href="/img/siteicon/apple-icon-180.png" color="#5bbad5"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"><link rel="bookmark" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@6.1.6/dist/fancybox/fancybox.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={linkPageTop:{enable:!0,title:"友链 + 外链 + 无限进步！欢迎欣赏和贡献！",addFriendPlaceholder:"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},peoplecanvas:void 0,postHeadAiDescription:{enable:!0,gptName:"小米里的大麦",mode:"local",switchBtn:!1,btnLink:"https://afdian.net/item/886a79d4db6711eda42a52540025c377",randomNum:4,basicWordCount:1999,key:"93d1622eadde491eb0594b68ade51723.kaEiDD6A3KPzb7xv",Referer:"https://www.minbit.top/"},diytitle:{enable:!0,leaveTitle:"w(ﾟДﾟ)w 不要走！再看看嘛！",backTitle:"♪(^∇^*)欢迎肥来！"},LA51:{enable:!0,ck:"Jp8wwGQpp21utaFQ",LingQueMonitorID:"Jp8ztDRrxmTf7LDj"},greetingBox:{enable:!0,default:"晚上好👋",list:[{greeting:"晚安😴",startTime:0,endTime:5},{greeting:"早上好鸭👋, 祝你一天好心情！",startTime:6,endTime:9},{greeting:"上午好👋, 状态很好，鼓励一下～",startTime:10,endTime:10},{greeting:"11点多啦, 在坚持一下就吃饭啦～",startTime:11,endTime:11},{greeting:"午安👋, 宝贝",startTime:12,endTime:14},{greeting:"🌈充实的一天辛苦啦！",startTime:14,endTime:18},{greeting:"19点喽, 奖励一顿丰盛的大餐吧🍔。",startTime:19,endTime:19},{greeting:"晚上好👋, 在属于自己的时间好好放松😌~",startTime:20,endTime:24}]},twikooEnvId:"https://twikoo.minbit.top/",commentBarrageConfig:{enable:!0,maxBarrage:10,barrageTime:5e3,accessToken:"25c96851dd8a790c4819ad4bfbaf153c",mailMd5:"7b12ebc2be80f9159099f6ab0e16573c"},music_page_default:"nav_music",root:"/",preloader:{source:3},friends_vue_info:void 0,navMusic:!0,mainTone:{mode:"both",api:"https://img2color-go.vercel.app/api?img=",cover_change:!0},authorStatus:{skills:["🧐 准备中，就快好了，真的！😭","📚 正在学习中，加油！","🎵 喜欢听音乐，喜欢看动漫"]},algolia:void 0,localSearch:{path:"/search.xml",preload:!0,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简",rightMenuMsgToTraditionalChinese:"转为繁体",rightMenuMsgToSimplifiedChinese:"转为简体"},noticeOutdate:{limitDay:365,position:"top",messagePrev:"距上次更新已过去",messageNext:"天了，这篇文章的内容可能已经过时了。"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:330},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,simplehomepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{copy:!0,copyrightEbable:!0,limitCount:150,languages:{author:"作者: 小米里的大麦",link:"链接: ",source:"来源: 小米里的大麦",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。",copySuccess:"复制成功，复制和转载请标注本文地址"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#425AEF",bgDark:"#1f1f1f",position:"top-right"},source:{justifiedGallery:{js:"https://cdn.cbd.int/flickr-justified-gallery@2.2.0/dist/fjGallery.min.js",css:"https://cdn.cbd.int/flickr-justified-gallery@2.2.0/dist/fjGallery.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,shortcutKey:void 0,autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"小米里的大麦",title:"046 网络编程套接字",postAI:"这篇文章讲述了网络编程中的套接字概念，包括源IP地址和目的IP地址、源MAC地址和目的MAC地址、源端口号和目的端口号，以及TCP和UDP的区别。文章解释了IP地址和MAC地址在跨网络和局域网通信中的作用，以及端口号在主机内部应用程序寻址中的重要性。同时，文章还介绍了TCP和UDP协议的特点，如TCP的可靠性和有序性，以及UDP的快速和简单性。此外，文章还讨论了网络字节序的概念，解释了大小端起源和网络字节序的统一必要性，以及如何进行字节序转换。最后，文章介绍了套接字编程接口，包括创建套接字、IPv4地址结构体、字节序转换函数、IP地址转换函数、绑定套接字与地址等，为网络编程提供了基础知识和实践指导。",pageFillDescription:"网络编程套接字, 1. 预备知识, 1. 源 IP 地址 amp 目的 IP 地址, 2. 源 MAC 地址 amp 目的 MAC 地址, 3. 源端口号 amp 目的端口号, 为什么引入端口而不是直接使用进程 PID？, 1. 端口 ≠ PID, 2. 为什么不直接用 PID？, 4. TCP VS UDP（直观认识后面详细讨论）, 1. TCP：像打电话或挂号快递, 2. UDP：像发短信或普通平邮, 5. 网络字节序, 1. 发展与由来, 2. 为何没有统一解决？, 3. 发送和接收, 2. socket 编程接口, 1. 为什么要抽象套接字, 2. socket —— 创建套接字, 3. struct sockaddr_in —— IPv4 地址结构体, 4. bzero / memset —— 清零结构体内存, 5. htons/htonl/ntohs/ntohl —— 字节序转换函数（保证大小端传输x2F解析）, 6. inet_addr / inet_aton / inet_ntoa / inet_pton / inet_ntop —— IP 地址转换函数, 7. bind —— 绑定套接字与地址（服务器必做）, 8. listen —— 服务器监听, 9. accept —— 服务器接受连接, 10. connect —— 客户端连接服务器, 11. 数据传输函数 send/recv —— TCP 收发, 12. 数据传输函数 sendto/recvfrom —— UDP 收发, 13. close() —— 关闭套接字, 3. 理解协议与对应的服务器和客户端通信流程, 1. UDP, 1. UDP 服务器 (Server), 2. UDP 客户端 (Client), 3. UDP 就像发微信语音消息, 2. TCP, 1. TCP 服务器 (Server), 2. TCP 客户端 (Client), 3. TCP 就像打电话, 4. UDP 服务器和客户端 Demo, 1. UDP_Server.hpp, 2. Log.hpp, 3. UDP_Client.cc, 4. Main.cc, 5. TCP 服务器和客户端 Demo, 6. 守护进程, 1. 什么是会话（Session）？, 2. 前台进程 vs 后台进程, 3. 作业号 vs 进程 ID（PID）, 4. 作业控制命令, 5. 守护进程, 1. 什么是守护进程？, 2. 守护进程的特点, 6. /dev/null 是什么？, 7. setsid() 函数原型, 8. daemon() 方法（glibc 提供的简便函数）, 7. 配置安全组规则网络编程套接字预备知识源地址目的地址是什么负责跨网络的全球寻址由路由器使用源发件人所在的城市街道的网络位置目的收件人所在的网络位置理解在互联网中就是定位哪台主机源说的是我是从哪里发的目的说的是我要送到哪去源地址目的地址是什么是网卡的身份证唯一标识一块网卡负责局域网内的设备寻址由交换机使用源是当前发出这个数据帧的设备比如你家的路由器或你的电脑的网卡物理地址目的是当前这一跳要送达的设备比如你家的路由器或者下一个网络的交换机的网卡物理地址理解负责在同一个局域网里找到对方机器即使两个设备的地址在不同网段中间的路由器也会逐跳修改地址来转发数据示例地址只在本地有效就像快递从你家送到小区快递站靠的是小区内部的三轮车车牌号这时目的是快递站当快递从上海发往北京时负责这段运输的是一辆大货车车牌号这时目的就是北京的中转仓库地址不变收件人始终是北京的朋友但每一段路的运输车地址都在变源端口号目的端口号是什么负责主机内部的应用程序寻址由操作系统使用目的端口号是服务的电话号码比如你想访问网页就打号想传文件就打号它告诉目标主机我要找你家哪个应用程序源端口号是你这边临时生成的一个回拨号码比如你的电脑随机选了个号它告诉对方我找你家的号你回复我的话请打号理解示例一台电脑上可能同时有微信浏览器游戏等多个程序在上网地址只能把包裹送到这台电脑而端口号决定了这个包裹具体是给微信还是给浏览器的它实现了一台主机多程序同时通信为什么引入端口而不是直接使用进程我们发现端口和进程的十分相似都能用于标识程序进程的唯一那么为什么引入端口而不是直接使用进程端口进程操作系统内部标识某个正在运行的进程只在本机有效并且随调度每次执行的都不同端口号网络通信里的标识符用来告诉接收到的数据包应该交给哪一个程序它必须有几个特点跨主机一致性同一个端口号在不同机器上也能表示同类服务比如默认端口协议无关端口号只和协议挂钩不依赖操作系统的管理隔离与安全用户程序不能直接访问其他进程的而端口号可通过系统分配公开给网络层使用为什么不直接用解决跨主机问题是本地可变的不同主机没意义网络发包会搞不清楚收件程序是谁而端口是网络通用的实现服务抽象端口号提供抽象层让网络层只关心哪条程序逻辑要接收数据不关心如何调度进程端口标识服务类型如邮件而不是具体的进程实例降低耦合性传输层协议只依赖端口不依赖操作系统的实现了协议栈的分层和解耦标准化服务一些端口号有固定含义如不同机器不同系统都能互相理解服务可以更换软件重启只要端口不变对外服务就不中断而没法做到这一点所以家里某个家庭成员的身份证号对邮局毫无意义端口号房间号邮递员知道把信送到哪个房间不管家庭成员是谁端口号把进程内部细节和网络通信隔离开保证协议跨主机可用降低耦合所以他们的关系就像送快递地址总快递单从发货到收货全程都指向同一个目的地不变地址中转贴纸每经过一站都会换成下一站的发件人收件人一直变化地址出局域网之后源和目都要被丢弃让路由器重新封装端口号楼里具体的房间号找准哪个程序收直观认识后面详细讨论像打电话或挂号快递有连接就像打电话你必须先拨号建立连接等对方说喂你好连接确认之后你们才能开始说话通信结束时还要说再见断开连接传输可靠就像寄挂号快递快递公司会确保包裹数据一定能送到并且是完整无损的如果路上丢了他们会帮你找回或重寄在中数据发送后接收方必须回复我收到了确认应答如果没收到回复发送方就会重发面向字节流就像你们在电话里连续不断地说话没有明确的段落划分把数据看作一个连续的没有固定边界的字节流你发了你好和世界接收方可能收到你好世和界也可能收到你好世界它需要自己判断消息的边界这叫粘包问题需要应用层自己解决可靠有序有连接适合对数据准确性要求高的场景比如网页浏览文件下载发送邮件像发短信或普通平邮无连接就像发短信你不需要先打电话确认对方开机直接输入内容发送就行发送数据前不需要和对方建立任何连接传输不可靠就像发普通平邮你把信数据包投进邮筒就完事了至于信会不会丢会不会被撕坏会不会晚到邮局网络不保证发送数据后不会管对方有没有收到面向数据报就像每条短信都是一个独立的数据包你发一条你好就是一条完整的信息再发一条世界是另一条独立的信息接收方收到的就是一个个完整有明确边界的数据报不会出现粘包或拆包的问题快速简单无连接不保证可靠适合对速度要求高能容忍少量丢失的场景比如在线视频语音通话微信直播网络游戏查询追求必须送到且顺序正确所以慢但稳追求快立刻发出去所以快但可能丢网络字节序发展与由来大小端的起源大小端源于计算机内部多字节数据如整数在内存中的存储方式差异这种多字节数据在内存中存放顺序差异源于早期架构设计并无绝对优劣在内部处理数据时按自己的方式最方便高效却也导致不同硬件平台存在分歧大端数据的高位字节存储在低内存地址低位字节存储在高地址类似人书写数字的顺序如存储为小端数据的低位字节存储在低内存地址高位字节存储在高地址如存储为网络字节序的诞生当不同大小端的机器需要跨网络通信时若直接发送原始字节流接收方可能解析错误例如小端机发送的被大端机解读为而非为解决此问题协议强制规定网络字节序统一为大端也称网络序确保所有设备在传输层达成一致为何没有统一解决硬件设计的多样性大小端的选择涉及架构性能优化和兼容性历史上不同厂商有不同架构没办法强制统一向后兼容性改变现有系统的字节序会导致海量软件失效成本过高因此只能通过协议层如在传输时进行转换而非根除底层差异发送和接收为了在不同架构通信时保证数字解释一致网络协议规定统一字节序定义大端字节序最高有效字节在最前面从而屏蔽了硬件差异即不管本机是大端还是小端都要转换成大端再发送发送端大端机直接发送小端机先把数据转成大端再发接收端收到数据如果本机是小端机再把数据转成小端处理执行以下代码进行内存测试即可验证自己机器的大小端大端小端编程接口网络编程套接字一荐到底是什么站套接字就是操作系统给程序和网络接口之间的一层统一抽象为什么要抽象套接字套接字是操作系统提供的一个编程接口用于实现不同场景下的通信根据通信范围和需求主要分为三类域间套接字用于同一台主机内部的进程间通信不走网络协议栈通过文件系统中的一个特殊文件作为通信端点效率远高于网络套接字网络套接字用于不同主机之间的网络通信比如个人电脑和百度服务器使用地址端口号来定位目标常见广泛原始套接字允许程序直接访问底层网络协议如通常用于开发网络工具如或需要自定义协议头的场景它绕过了传输层系统调用希望函数原型统一而不是每种地址类型写一个不同函数因此套接字提供了结构体和结构体其中结构体是用于跨网络通信的而结构体是用于本地通信的为了让套接字的网络通信和本地通信能够使用同一套函数接口于是就出现了结构体它跟的结构都不相同但这三个结构体头部的个比特位都是一样的这个字段叫做协议家族创建套接字函数原型参数地址族常用本地套接字类型常用协议通常设为自动选择返回值成功返回套接字描述符文件描述符非负整数失败需检查地址结构体可以使用命令进行查询结构体原型地址族必须是位端口号网络字节序需用转换位地址网络字节序通常不用填充为使结构大小与一致位整数表示的地址网络字节序简化理解的地址结构体地址族端口号的结构体实际地址说明固定为范围为通常选择及以上原因是知名端口如的的属于系统内定的端口号一般有固定的应用层协议使用通常需要权限才能绑定是注册端口用于特定服务如的是动态临时端口通常用于客户端随机分配内部包含一个位无符号整数表示地址网络字节序网络字节序无需额外转表示绑定任意本地地址监听所有本地具体地址如需要通过或将字符串格式的转换为网络字节序直接返回网络字节序的位地址更推荐的现代方法支持不常用表示本地回环地址用于本地进程间通信注意使用时需先初始化用或清零避免随机值导致错误初始化示例清零结构体端口号主机字节序转网络字节序任意本地或指定清零结构体内存函数原型接口初始化推荐使用示例将内存块清零或字节序转换函数保证大小端传输解析函数原型主机字节序网络字节序端口用短整型主机字节序网络字节序用长整型网络字节序主机字节序短整型网络字节序主机字节序长整型要点参数就是所谓的端口号端口用位值用或地址转换函数不使用函数手动实现推荐结构体网络编程套接字一荐函数原型注意使用结构体时要注意对应的转型字符串位网络字节序参数字符串字符串结构推荐替代第二个参数就是的结构体网络字节序字符串参数的结构体通用推荐字符串地址结构参数依次是地址族字符串一个外部的缓冲区地址通用推荐地址结构字符串参数依次是地址族的结构体一个外部的缓冲区地址缓冲区大小使用示例清空结构体协议设置端口转网络字节序字符串网络字节序整数位字符串结构更安全字符串注意返回静态缓冲区字符串二进制推荐支持二进制字符串推荐线程安全简短实用转网络字节序二进制推荐一般不建议出错返回值和合法地址可能混淆转网络字节序二进制字符串返回静态区指针非线程安全推荐线程安全参数简单写兼容线程安全优先用绑定套接字与地址服务器必做参数返回的套接字描述符指向地址结构体的指针通常传入并强制转换为地址结构体的长度大小返回值成功返回失败返回注意服务器必须绑定固定端口客户端通常不需要系统自动分配临时端口的接口属于和共用算是的专用函数了服务器监听函数原型参数已绑定的套接字等待连接队列的最大长度通常设为超过则新连接被拒绝返回值成功返回失败返回服务器接受连接函数原型参数监听的套接字输出参数存储客户端地址需预先分配空间输入输出参数传入大小返回实际地址长度返回值成功返回新的套接字描述符专门用于与该客户端通信失败返回注意阻塞函数若无连接则一直等待客户端连接服务器函数原型参数要连接的服务器地址端口号超时时间用来设置连接尝试的最长时间参数与类似但是服务器的地址返回值成功返回失败返回数据传输函数收发函数原型我要把这段数据发给已经连接的对方我要从已经连接的对方那里接收一段数据参数对比参数参数参数相同点不同点文件描述符都是已连接的套接字由或得到无数据缓冲区都是存放数据的内存区域的数据是只读的要发出去的数据是可写的接收进来缓冲区长度大小字节数都表示操作的数据字节数无标志位一般为都可设置特殊行为如非阻塞等待模式一般用也可指定阻止或等到缓冲区填满才返回返回值成功返回实际发送的字节数可能小于请求长度应用层需要循环失败返回并设置如表示对方已关闭连接成功返回实际接收的字节数返回表示对方已正常关闭连接失败返回并设置如表示连接被对方重置是字节流一次不保证对方一次就读满注意循环收发数据传输函数收发函数原型我要把这段数据发给某个地址我要接收一段数据同时想知道它是从哪来的参数参数参数参数相同点不同点文件描述符都是由创建的套接字指明操作的对象无数据缓冲区都是存放数据的内存区域的数据是只读的要发出去的数据是可写的接收进来缓冲区长度大小字节数都表示操作的数据字节数无标志位一般为都可设置特殊行为如非阻塞等待模式通常默认用可能会用等地址结构需要转型都是类型用来描述网络地址需要指定目标地址发给谁获取对方地址谁发来的地址结构大小都与地址结构体长度相关传值只读告诉内核目标地址长度传指针可写内核回填实际地址长度相同的返回值成功返回实际发送接收的字节数类型正整数失败返回并设置常见如参数无效非阻塞模式下暂时无数据目标不可达等是报文一发一收天然有包界长度超可能被分片丢弃关闭套接字函数原型作用关闭套接字描述符释放资源返回值成功返回失败返回理解协议与对应的服务器和客户端通信流程服务器创建一个套接字配置服务器地址准备自己的地址信息清零结构体指定指定端口号指定地址将套接字与地址绑定正式调频道等待并接收客户端消息参数中会返回客户端地址知道是谁发来的参数中会返回消息内容得到消息内容给客户端发送回复指定目标地址回复给刚才发消息的客户端发送回复内容关闭套接字客户端创建一个套接字配置服务器地址准备要发往的服务器地址清零结构体指定服务器端口服务器可选配置客户端地址如果需要可以显式绑定客户端端口指定一个固定端口或让系统自动分配通常用任意可选显式绑定客户端端口如果第步配置了可以不需要系统会自动分配一个临时端口给服务器发送请求等待并接收服务器的回复参数中会返回服务器地址确认是预期的服务器回复参数中会返回回复内容关闭套接字就像发微信语音消息你和朋友在不同的地方你录了一段语音我在东门等你然后发给了他的微信号你们都装了微信通信工具准备好了你注册了微信号相当于绑定和端口别人能通过这个号找到你你发送语音指定了发给朋友的微信号目标端口朋友的微信收到了消息他知道是你发的也听到了内容特点你发完就不管了不确认他有没有收到不可靠如果网络卡了语音可能丢了乱了重复了你也不知道但速度快适合直播语音通话等实时场景无连接不保证送达速度快像广播喊话或发语音服务器创建一个套接字配置服务器地址准备自己的地址信息清零结构体绑定端口监听所有网卡将套接字绑定到地址上开始监听连接请求进入待接电话状态设置队列等待的连接数阻塞等待客户端连接到来成功后返回一个新的连接套接字用于与该客户端通信客户端地址信息被填充知道是谁连进来了使用接收数据从客户端读取消息内容使用发送回复向客户端发送响应数据关闭连接套接字通信结束最后关闭监听套接字程序退出时客户端创建一个套接字配置目标服务器地址指定要连接的服务器清零结构体服务器端口服务器地址发起连接请求触发三次握手成功则表示连接建立完成发送请求数据到服务器通过已连接的套接字发送消息接收服务器的回复读取返回的数据关闭连接触发四次挥手就像打电话你拿出手机拨通朋友的号码你们都有手机通信工具你的手机有号码端口别人可以打给你你拨号他接听建立连接三次握手你们开始通话你说一句他嗯一声表示听到了如果信号不好没听清他会说再说一遍你就会重说聊完后互相说拜拜才挂电话四次挥手关键特点通话前必须先建立连接数据不会丢不会乱序发出去就得确认收到如果网络差通话会卡但内容绝对准确有连接可靠传输保证顺序像打电话一样稳服务器和客户端错误码定义创建失败失败默认端口和地址接收缓冲区大小定义回调函数类型接收一个字符串请求返回一个字符串响应关闭文件描述符服务器套接字已关闭创建套接字创建错误套接字创建成功设置地址结构内存清零端口号转换为网络字节序将字符串转换为网络字节序整数绑定到本地地址绑定套接字错误错误字符串绑定套接字成功本地地址接收缓冲区客户端地址信息必须初始化长度接收客户端数据添加字符串结束符构造请求字符串调用用户自定义处理函数生成响应发送响应回客户端文件描述符服务器绑定的地址服务器监听的端口号服务运行状态标志日志对象成员管道错误码这是创建管道文件失败的错误码这是删除管道文件失败的错误码这是打开管道文件失败的错误码枚举会自动赋值为日志等级最严重级别严重错误警告调试信息普通信息是否启用日志是否分类日志存放路径是否输出到终端日志等级转换成字符串获取当前计算机的时间返回格式含微秒包含秒和微秒系统调用获取当前时间精确到微秒分解时间转格式年月日时分秒把秒转换成年月日时分秒本地时区定义字符数组作为格式化输出的缓冲区年从开始计数月从开始表示月日时分秒微秒部分取自转换成返回使用默认构造重载函数调用运算符日志未启用计算需要的缓冲区大小格式化失败分配缓冲区并格式化字符串调用原有的处理逻辑传入的分类参数错误文件路径的后缀处理函数当按照日志等级分类存储并且文件路径是这种有文件扩展名时的处理方法如果是一个目录的路径比如则最终文件名为等级名如果是一个文件路径比如则最终文件名为等级名从后往前找到第一个的位置即最后一次出现的的位置去掉后缀即我所需要的有效的前部分路径保留后缀即有效的文件扩展名组合成新的文件名如果没有文件扩展名比如则直接在文件名后面加上等级名核心写文件函数按照日志等级分类存储不分类直接使用传入的追加写入文件不存在则创建权限接收服务器响应的缓冲区大小用法服务器服务器端口号例如检查命令行参数数量的原因程序名称如服务器地址如服务器端口号如解析命令行参数获取服务器和端口获取服务器地址将端口号字符串转换为整数构造服务器地址结构内存清零设置地址族为端口号转换为网络字节序地址转换为网络字节序创建套接字创建套接字创建套接字失败创建套接字成功客户端通常不需要显式调用函数原因一个端口号只能被一个进程对是如此对于也是如此客户端的端口号其实不重要只要能保证主机上的唯一性就可以系统会在首次发送数据时自动为客户端分配一个随机端口号隐式这样可以避免端口冲突简化客户端编程获取地址结构大小用于后续的和函数存储用户输入的消息接收服务器响应的缓冲区循环发送消息并接收服务器响应请输入您要发送的消息读取用户输入的消息客户端退出发送消息参数说明文件描述符要发送的数据数据长度标志位一般为目标地址结构地址结构大小发送消息失败发送消息成功接收服务器响应服务器响应的地址结构服务器响应的地址结构大小参数说明文件描述符接收缓冲区缓冲区大小留一个字节给标志位一般为发送方地址结构地址结构大小传入时是返回时是实际大小添加字符串结束符收到服务器响应字节服务器关闭连接接收数据失败关闭套接字客户端已关闭用法端口号说明端口号建议使用以上的端口避免与系统保留端口冲突示例对命令进行安全检查可能不安全的命令可自行添加检查命令中是否包含危险命令找到危险命令返回处理收到的消息服务器收到一条消息可以直接执行命令的函数获取一个请求命令这是一个不安全的命令已经发现并且拒绝执行用于创建管道并读取命令参数要执行的命令打开管道的模式读关闭管道检查命令行参数数量的原因程序名称如监听端口号如解析端口号参数将字符串端口号转换为整数使用智能指针创建服务器对象自动内存管理避免内存泄漏初始化服务器启动服务器可选择的函数服务器和客户端这部分的代码和文件较多不便展示可前往查看服务器和客户端网络编程套接字二网络编程入门与通信实战从零构建服务器与客户端对话附简易源码新手友好阿里云守护进程什么是会话会话是中进程管理的一个逻辑单位对应一次登录会话一次登录通过登录到服务器就创建了一个会话这个会话在中对应的是一个进程如这是我们与交互的入口一个会话包含一个控制终端在中看到的命令行界面多个进程然而一些进程之间又有关联进而形成多个进程组但同一时间只有一个进程组能成为前台进程组其余均为后台进程组进程组是一组相关进程的集合比如一个程序启动的主进程和它的子进程共享同一个进程组由进程组首进程创建该组的进程的决定会话的生命周期与你的登录状态绑定当退出登录关闭窗口或执行会话会终止默认会向会话内的所有进程发送终止信号挂断信号信号除非它们被脱离了会话如使用或前台进程后台进程前台进程占据终端可以接收键盘输入如一次只能有一个前台进程在终端输入命令后直接执行的程序默认是前台进程后台进程不占用终端不能直接接收键盘输入可以同时运行多个进程任务输出仍可能打印到终端除非重定向前后台进程也称作前后台任务一个会话只能有一个前台进程键盘信号只能发给前台进程作业号进程显示的是作业号如是内部编号命令显示的是进程是系统级唯一标识可以用来引用作业如终止作业前台恢复作业后台恢复作业查看示例进程的相关信息作业控制命令如支持作业控制允许管理前台后台任务用一个简单的代码示例并编译成可执行程序来体会作业控制在命令末尾添加表示启动该命令后立即将其放入后台运行终端不等待命令执行完成直接返回提示符允许你继续输入其他命令示例将放入后台输出重定向到后台休眠秒区分用法的核心原则在于位置判断若在命令末尾且不是条件表达式的一部分后台运行命令若在两个命令之间并行启动两个后台命令若在或内部按位与运算查看当前会话中所有后台进程任务的状态是作业号表示默认作业示例将一个后台或暂停的作业调到前台继续运行示例现在在前台运行可接收给前台进程组发号信号把它暂停成可后台继续的作业状态被暂停不再运行但未退出示例前台运行按让一个被暂停的作业在后台继续运行示例或直接作用于默认作业给作业发信号是作业号和不同把作业从当前的作业表剥离不再受影响示例让进程忽略常配合重定向使用退出登录进程仍运行守护进程操作系统技巧守护进程介绍快来看看吧站什么是守护进程守护进程是一种长期运行的后台进程不依赖于任何终端或用户会话它们通常在系统启动时启动直到系统关闭才停止常见例子服务服务定时任务守护进程的特点脱离终端与会话通常是会话领导者避免被杀死双技术创建守护进程时通常两次确保不成为进程组领导者重定向标准流将重定向到或日志文件工作目录通常切换到或固定目录避免阻塞文件系统卸载是什么本质是一个特殊的字符设备文件被称为黑洞设备也叫空设备我们只要把它当作垃圾桶就好行为往它里面写任何东西直接丢弃就像写到空气里从它里面读总是立刻返回表示空文件没数据所以很多守护进程会把标准输入输出错误重定向到避免占用终端那么它到底有什么用在守护进程中标准输入标准输出标准错误必须被重定向否则如果进程尝试读会出错因为没有终端如果写输出无处可去可能引发异常或写入旧终端所以把这三个标准流重定向到是一种安全兜底措施确保不会因为读写标准流而崩溃不会干扰原终端或产生混乱输出函数原型作用创建一个新的会话并成为该会话的会话首进程同时成为新的进程组组长脱离当前控制终端不再受键盘信号影响函数原型使用条件一次的经典组合调用的进程不能是进程组组长否则会失败返回所以通常先一次让子进程保证不是组长再在子进程里代码示例忽略其他异常信号将自己变成独立的会话更改当前调用进程的工作目录标准输入标准输出标准错误重定向至重定向防止后台读键盘阻塞重定向不在终端打印重定向错误也不污染终端守护进程的本质也是孤儿进程方法提供的简便函数提供了一个库函数可以自动完成守护进程化这会简化守护进程方便我们的编码函数原型参数把工作目录切换到根目录把重定向到返回值成功返回失败返回代码示例创建守护进程守护进程的主循环写日志或者处理任务内部其实就做了手写的那些步骤到所以用起来更方便需要注意的是没有做双重也不处理所以严格场景下比如写系统级服务还是建议手写模板或用管理配置安全组规则安全组就像是一个虚拟防火墙用于控制云服务器的入站和出站流量默认情况下安全组拒绝所有来自外部的入站请求以我的华为云应用服务器实例为例在安全组中开放端口个人自定义范围后就相当于在防火墙上开了一个口子这样就允许外部设备通过这些端口与云服务器上的服务进行通信了将自己的客户端发给朋友运行本机的服务器就可以开始通信了不同厂商的配置大同小异因为这部分配置比较简单就不演示了实在不会站的教程相当多这里仅提供示例配置优先级策略允许类型协议端口源地址隐私安全考虑及时关闭不必要规则在演示完成后如果这些开放的安全组规则不再需要应及时将其关闭否则服务器可能会面临潜在的安全风险比如恶意攻击者可能会利用开放的端口尝试进行入侵扫描或其他非法操作最小权限原则在配置安全组规则时就应遵循最小权限原则即只开放那些确实需要用于演示通信的端口和协议有需要可以限制来源范围数据隐私方面除了端口规则外还要注意通信过程中涉及的数据是否包含敏感信息如果有需要确保数据在传输如采用加密协议和存储过程中的安全性避免隐私数据泄露",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-08-15 12:00:00",postMainColor:""}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:(e,t,a)=>{if(0===a)return;const o={value:t,expiry:Date.now()+864e5*a};localStorage.setItem(e,JSON.stringify(o))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const a=JSON.parse(t);if(!(Date.now()>a.expiry))return a.value;localStorage.removeItem(e)}},e.getScript=(e,t={})=>new Promise((a,o)=>{const c=document.createElement("script");c.src=e,c.async=!0,c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},Object.keys(t).forEach(e=>{c.setAttribute(e,t[e])}),document.head.appendChild(c)}),e.getCSS=(e,t=!1)=>new Promise((a,o)=>{const c=document.createElement("link");c.rel="stylesheet",c.href=e,t&&(c.id=t),c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},document.head.appendChild(c)}),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#18171d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#f7f9fe")};const t=saveToLocal.get("theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches,o=window.matchMedia("(prefers-color-scheme: light)").matches,c=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!a&&!o&&!c;if(void 0===t){if(o)activateLightMode();else if(a)activateDarkMode();else if(c||n){const e=(new Date).getHours();e<=10||e>=20?activateDarkMode():activateLightMode()}window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>{void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode():activateLightMode())})}else"light"===t?activateLightMode():activateDarkMode();const d=saveToLocal.get("aside-status");void 0!==d&&("hide"===d?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/custom/css/font.css"><link rel="stylesheet" href="/custom/css/bilibili.css"><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="小米里的大麦" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/Profile%20picture.png"><div class="loading-image-dot"></div></div></div><script>const preloader={endLoading:()=>{document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",()=>{preloader.endLoading()}),setTimeout((function(){preloader.endLoading()}),1e4),document.addEventListener("pjax:send",()=>{preloader.initLoading()}),document.addEventListener("pjax:complete",()=>{preloader.endLoading()})</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">社交</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub"><img class="back-menu-item-icon" src="/img/icons/lollipop.svg" alt="GitHub"><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="哔哩哔哩"><img class="back-menu-item-icon" src="/img/icons/wink.svg" alt="哔哩哔哩"><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/huang-cancan-xbc" title="Gitee"><img class="back-menu-item-icon" src="/img/icons/laugh.svg" alt="Gitee"><span class="back-menu-item-text">Gitee</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.csdn.net/Huangcancan666?type=blog" title="CSDN"><img class="back-menu-item-icon" src="/img/icons/celebrate.svg" alt="CSDN"><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3230789931118109" title="稀土掘金"><img class="back-menu-item-icon" src="/img/icons/kiss.svg" alt="稀土掘金"><span class="back-menu-item-text">稀土掘金</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">算法</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://leetcode.cn/u/nifty-faradayzqn" title="力扣"><img class="back-menu-item-icon" src="/img/icons/thinking-glass.svg" alt="力扣"><span class="back-menu-item-text">力扣</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://ac.nowcoder.com/acm/contest/profile/517073385" title="牛客"><img class="back-menu-item-icon" src="/img/icons/think.svg" alt="牛客"><span class="back-menu-item-text">牛客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/1367427" title="洛谷"><img class="back-menu-item-icon" src="/img/icons/funny.svg" alt="洛谷"><span class="back-menu-item-text">洛谷</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">小米里的大麦</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 外链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div id="nav-naoDark"><div class="container"><div class="components"><div class="main-button"><div class="moon"></div><div class="moon"></div><div class="moon"></div></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="cloud"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="cloud-light"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="stars"><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div></div></div></div></div><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/wechat.webp" target="_blank"><img class="post-qr-code-img" alt="微信" src="/img/wechat.webp"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.webp" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/img/alipay.webp"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size:1.05rem">AI<sup>2</sup></a><a href="/tags/C/" style="font-size:1.05rem">C++<sup>11</sup></a><a href="/tags/Git/" style="font-size:1.05rem">Git<sup>3</sup></a><a href="/tags/IO/" style="font-size:1.05rem">IO<sup>5</sup></a><a href="/tags/Linux/" style="font-size:1.05rem">Linux<sup>59</sup></a><a href="/tags/MySQL/" style="font-size:1.05rem">MySQL<sup>9</sup></a><a href="/tags/Redis/" style="font-size:1.05rem">Redis<sup>2</sup></a><a href="/tags/STL/" style="font-size:1.05rem">STL<sup>2</sup></a><a href="/tags/VS-Code/" style="font-size:1.05rem">VS Code<sup>1</sup></a><a href="/tags/%E4%BF%A1%E5%8F%B7/" style="font-size:1.05rem">信号<sup>3</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size:1.05rem">内存管理<sup>1</sup></a><a href="/tags/%E5%8E%86%E7%A8%8B/" style="font-size:1.05rem">历程<sup>2</sup></a><a href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" style="font-size:1.05rem">地址空间<sup>6</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size:1.05rem">工具<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size:1.05rem">数学<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size:1.05rem">模板<sup>1</sup></a><a href="/tags/%E7%81%B5%E5%85%89%E8%8D%9F%E8%90%83/" style="font-size:1.05rem">灵光荟萃<sup>3</sup></a><a href="/tags/%E7%AE%A1%E9%81%93/" style="font-size:1.05rem">管道<sup>2</sup></a><a href="/tags/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" style="font-size:1.05rem">类与对象<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size:1.05rem">线程<sup>5</sup></a><a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size:1.05rem">网站<sup>3</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size:1.05rem">网络<sup>11</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size:1.05rem">进程<sup>15</sup></a></div></div><hr></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多"> <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2026/01/"><span class="card-archive-list-date">一月 2026</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/12/"><span class="card-archive-list-date">十二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/11/"><span class="card-archive-list-date">十一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">十月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">15</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">八月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Linux/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>Linux</span></a><a class="article-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>网络</span></a></span></div></div><h1 class="post-title" itemprop="name headline">046 网络编程套接字</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-08-15T04:00:00.000Z" title="发表于 2025-08-15 12:00:00">2025-08-15</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-08-15T04:00:00.000Z" title="更新于 2025-08-15 12:00:00">2025-08-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">12.6k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>46分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" data-flag-title="046 网络编程套接字"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"> </span><span class="post-meta-position" title="作者IP属地为西安"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>西安</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://image-kcm.pages.dev/v2/IAdmxAt.png?_r_=cfd71b95-b3cb-c47a-e8ff-005199aa79ab"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">小米里的大麦 GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://www.minbit.top/posts/40348.html"><header><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a><a href="/tags/Linux/" tabindex="-1" itemprop="url">Linux</a><a href="/tags/%E7%BD%91%E7%BB%9C/" tabindex="-1" itemprop="url">网络</a><h1 id="CrawlerTitle" itemprop="name headline">046 网络编程套接字</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">小米里的大麦</span><time itemprop="dateCreated datePublished" datetime="2025-08-15T04:00:00.000Z" title="发表于 2025-08-15 12:00:00">2025-08-15</time><time itemprop="dateCreated datePublished" datetime="2025-08-15T04:00:00.000Z" title="更新于 2025-08-15 12:00:00">2025-08-15</time></header><h1 id="网络编程套接字"><a href="#网络编程套接字" class="headerlink" title="网络编程套接字"></a>网络编程套接字</h1><h2 id="1-预备知识"><a href="#1-预备知识" class="headerlink" title="1. 预备知识"></a>1. 预备知识</h2><h3 id="1-源-IP-地址-目的-IP-地址"><a href="#1-源-IP-地址-目的-IP-地址" class="headerlink" title="1. 源 IP 地址 &amp; 目的 IP 地址"></a>1. 源 IP 地址 &amp; 目的 IP 地址</h3><ol><li><strong>是什么</strong>：<ul><li>负责 <strong>跨网络</strong> 的全球寻址，由 <strong>路由器</strong> 使用。</li><li><strong>源 IP</strong>：发件人所在的“城市 + 街道”的网络位置。</li><li><strong>目的 IP</strong>：收件人所在的网络位置。</li></ul></li><li><strong>理解</strong>：<ul><li>在互联网中，IP 就是定位“哪台主机”。</li><li>源 IP 说的是 <strong>“我是从哪里发的”</strong>，目的 IP 说的是 <strong>“我要送到哪去”</strong>。</li></ul></li></ol><h3 id="2-源-MAC-地址-目的-MAC-地址"><a href="#2-源-MAC-地址-目的-MAC-地址" class="headerlink" title="2. 源 MAC 地址 &amp; 目的 MAC 地址"></a>2. 源 MAC 地址 &amp; 目的 MAC 地址</h3><ol><li><strong>是什么</strong>：<ul><li><strong>MAC</strong> 是网卡的身份证，唯一标识一块网卡。负责 <strong>局域网内</strong> 的设备寻址，由 <strong>交换机</strong> 使用。</li><li><strong>源 MAC</strong>：是当前发出这个数据帧的设备（比如你家的路由器或你的电脑）的网卡物理地址。</li><li><strong>目的 MAC</strong>：是 <strong>当前这一跳</strong> 要送达的设备（比如你家的路由器，或者下一个网络的交换机）的网卡物理地址。</li></ul></li><li><strong>理解</strong>：<ul><li>MAC 负责在 <strong>同一个局域网</strong> 里找到对方机器。即使两个设备的 IP 地址在不同网段，中间的路由器也会逐跳修改 MAC 地址来转发数据。</li><li><strong>示例</strong>：MAC 地址只在“本地”有效。就像快递从你家送到小区快递站，靠的是小区内部的三轮车（车牌号 A），这时“目的 MAC”是快递站；当快递从上海发往北京时，负责这段运输的是一辆大货车（车牌号 B），这时“目的 MAC”就是北京的中转仓库。<strong>IP 地址不变（收件人始终是北京的朋友），但每一段路的“运输车”（MAC 地址）都在变。</strong></li></ul></li></ol><h3 id="3-源端口号-目的端口号"><a href="#3-源端口号-目的端口号" class="headerlink" title="3. 源端口号 &amp; 目的端口号"></a>3. 源端口号 &amp; 目的端口号</h3><ol><li><strong>是什么</strong>：<ul><li>负责 <strong>主机内部</strong> 的应用程序寻址，由 <strong>操作系统</strong> 使用。</li><li><strong>目的端口号</strong>：是服务的“电话号码”。比如你想访问网页，就打 80 号（HTTP）；想传文件，就打 21 号（FTP）。它告诉目标主机：“我要找你家哪个应用程序！”</li><li><strong>源端口号</strong>：是你这边临时生成的一个“回拨号码”。比如你的电脑随机选了个 50000 号。它告诉对方：“我找你家的 21 号（FTP），你回复我的话，请打 50000 号。”</li></ul></li><li><strong>理解</strong>：<ul><li><strong>示例</strong>：一台电脑上可能同时有微信、浏览器、游戏等多个程序在上网。IP 地址只能把包裹送到“这台电脑”，而 <strong>端口号决定了这个包裹具体是给微信、还是给浏览器的</strong>。它实现了“一台主机，多程序同时通信”。</li></ul></li></ol><blockquote><p>[!NOTE]</p><h3 id="为什么引入“端口”而不是直接使用进程-PID？"><a href="#为什么引入“端口”而不是直接使用进程-PID？" class="headerlink" title="为什么引入“端口”而不是直接使用进程 PID？"></a>为什么引入“端口”而不是直接使用进程 PID？</h3><p>我们发现端口和进程的 pid 十分相似，都能用于标识程序（进程）的唯一，那么为什么引入“端口”而不是直接使用进程 PID？</p><h4 id="1-端口-≠-PID"><a href="#1-端口-≠-PID" class="headerlink" title="1. 端口 ≠ PID"></a>1. 端口 ≠ PID</h4><ul><li><strong>PID（进程 ID）</strong>：操作系统内部标识某个正在运行的进程，只在本机有效，并且随 OS 调度，每次执行的 pid 都不同。</li><li><strong>端口号</strong>：网络通信里的标识符，用来告诉 <strong>接收到的数据包应该交给哪一个程序</strong>。它必须有几个特点：<ol><li><strong>跨主机一致性</strong>：同一个端口号在不同机器上也能表示同类服务（比如 HTTP 默认端口 80）。</li><li><strong>协议无关</strong>：端口号只和 TCP&#x2F;UDP 协议挂钩，不依赖操作系统的 PID 管理。</li><li><strong>隔离与安全</strong>：用户程序不能直接访问其他进程的 PID，而端口号可通过系统分配公开给网络层使用。</li></ol></li></ul><h4 id="2-为什么不直接用-PID？"><a href="#2-为什么不直接用-PID？" class="headerlink" title="2. 为什么不直接用 PID？"></a>2. 为什么不直接用 PID？</h4><ol><li><strong>解决跨主机问题</strong>：PID 是本地可变的，<strong>不同主机 PID 没意义</strong>，网络发包会搞不清楚收件程序是谁，而端口是网络通用的。</li><li><strong>实现服务抽象</strong>：端口号提供抽象层，让网络层只关心“哪条程序逻辑要接收数据”，不关心 OS 如何调度进程。端口标识服务类型（如 Web、邮件），而不是具体的进程实例。</li><li><strong>降低耦合性</strong>：传输层协议只依赖端口，不依赖操作系统的 PID，实现了协议栈的分层和解耦。</li><li><strong>标准化服务</strong>：一些端口号有固定含义（如 HTTP 80，HTTPS 443），不同机器、不同系统都能互相理解，服务可以更换软件、重启，只要端口不变，对外服务就不中断，而 PID 没法做到这一点。</li></ol><hr><p>所以：</p><ul><li><strong>PID</strong> &#x3D; 家里某个家庭成员的身份证号 → 对邮局毫无意义。</li><li><strong>端口号</strong> &#x3D; 房间号 → 邮递员知道把信送到哪个房间，不管家庭成员是谁。</li></ul><p>端口号把“进程内部细节”和“网络通信”隔离开，保证协议跨主机可用，降低耦合。</p></blockquote><blockquote><p>所以他们的关系就像送快递：</p><ul><li><strong>IP 地址</strong> &#x3D; 总快递单 → 从发货到收货，全程都指向同一个目的地（不变）。</li><li><strong>MAC 地址</strong> &#x3D; 中转贴纸 → 每经过一站，都会换成下一站的发件人&#x2F;收件人（一直变化：Mac 地址出局域网之后，源和目都要被丢弃，让路由器重新封装）。</li><li><strong>端口号</strong> &#x3D; 楼里具体的房间号（找准哪个程序收）。</li></ul></blockquote><hr><h3 id="4-TCP-VS-UDP（直观认识，后面详细讨论）"><a href="#4-TCP-VS-UDP（直观认识，后面详细讨论）" class="headerlink" title="4. TCP VS UDP（直观认识，后面详细讨论）"></a>4. TCP VS UDP（直观认识，后面详细讨论）</h3><h4 id="1-TCP：像“打电话”或“挂号快递”"><a href="#1-TCP：像“打电话”或“挂号快递”" class="headerlink" title="1. TCP：像“打电话”或“挂号快递”"></a>1. TCP：像“打电话”或“挂号快递”</h4><ul><li><strong>有连接</strong>：就像打电话，你必须先拨号（建立连接），等对方说“喂，你好”（连接确认）之后，你们才能开始说话。通信结束时，还要说“再见”（断开连接）。</li><li><strong>传输可靠</strong>：就像寄挂号快递。快递公司会确保包裹（数据）一定能送到，并且是完整无损的。如果路上丢了，他们会帮你找回或重寄。在 TCP 中，数据发送后，接收方必须回复“我收到了”（确认应答），如果没收到回复，发送方就会重发。</li><li><strong>面向字节流</strong>：就像你们在电话里连续不断地说话，没有明确的“段落”划分。TCP 把数据看作一个连续的、没有固定边界的“字节流”。你发了“你好”和“世界”，接收方可能收到“你好世”和“界”，也可能收到“你好世界”，它需要自己判断消息的边界（这叫“粘包”问题，需要应用层自己解决）。</li></ul><blockquote><p><strong>TCP</strong>：<strong>可靠、有序、有连接</strong>。适合对数据准确性要求高的场景，比如：网页浏览（HTTP&#x2F;HTTPS）、文件下载、发送邮件。</p></blockquote><h4 id="2-UDP：像“发短信”或“普通平邮”"><a href="#2-UDP：像“发短信”或“普通平邮”" class="headerlink" title="2. UDP：像“发短信”或“普通平邮”"></a>2. UDP：像“发短信”或“普通平邮”</h4><ul><li><strong>无连接</strong>：就像发短信，你不需要先打电话确认对方开机，直接输入内容发送就行。UDP 发送数据前，不需要和对方建立任何连接。</li><li><strong>传输不可靠</strong>：就像发普通平邮。你把信（数据包）投进邮筒就完事了，至于信会不会丢、会不会被撕坏、会不会晚到，邮局（网络）不保证。UDP 发送数据后，不会管对方有没有收到。</li><li><strong>面向数据报</strong>：就像每条短信都是一个独立的“数据包”。你发一条“你好”，就是一条完整的信息；再发一条“世界”，是另一条独立的信息。接收方收到的就是一个个完整、有明确边界的“数据报”，不会出现“粘包”或“拆包”的问题。</li></ul><blockquote><p><strong>UDP</strong>：<strong>快速、简单、无连接、不保证可靠</strong>。适合对速度要求高、能容忍少量丢失的场景，比如：在线视频&#x2F;语音通话（QQ、微信）、直播、网络游戏、DNS 查询。</p></blockquote><blockquote><p>[!IMPORTANT]</p><ul><li><strong>TCP</strong>：追求“<strong>必须送到，且顺序正确</strong>”，所以慢但稳。</li><li><strong>UDP</strong>：追求“<strong>快，立刻发出去</strong>”，所以快但可能丢。</li></ul></blockquote><hr><h3 id="5-网络字节序"><a href="#5-网络字节序" class="headerlink" title="5. 网络字节序"></a>5. 网络字节序</h3><h4 id="1-发展与由来"><a href="#1-发展与由来" class="headerlink" title="1. 发展与由来"></a>1. 发展与由来</h4><ol><li><strong>大小端的起源</strong>：大小端源于计算机内部多字节数据（如整数）在内存中的存储方式差异。这种 <strong>多字节数据在内存中存放顺序</strong> 差异源于早期 CPU 架构设计，并无绝对优劣，CPU 在内部处理数据时，按自己的方式最方便，高效，却也导致不同硬件平台存在分歧。<ul><li><strong>大端</strong>：数据的 <strong>高位字节</strong> 存储在 <strong>低内存地址</strong>，低位字节存储在高地址（类似人书写数字的顺序，如 <code>0x1234</code> 存储为 <code>12 34</code>）。</li><li><strong>小端</strong>：数据的 <strong>低位字节</strong> 存储在 <strong>低内存地址</strong>，高位字节存储在高地址（如 <code>0x1234</code> 存储为 <code>34 12</code>）。</li></ul></li><li><strong>网络字节序的诞生</strong>：当不同大小端的机器需要跨网络通信时，若直接发送原始字节流，接收方可能解析错误（例如小端机发送的 <code>34 12</code> 被大端机解读为 <code>0x3412</code> 而非 <code>0x1234</code>）。为解决此问题，<strong>TCP&#x2F;IP 协议强制规定网络字节序统一为大端</strong>（也称“<strong>网络序</strong>”），确保所有设备在传输层达成一致。</li></ol><h4 id="2-为何没有统一解决？"><a href="#2-为何没有统一解决？" class="headerlink" title="2. 为何没有统一解决？"></a>2. 为何没有统一解决？</h4><ul><li><strong>硬件设计的多样性</strong>：大小端的选择涉及 CPU 架构、性能优化和兼容性，历史上不同厂商有不同架构，没办法强制统一。</li><li><strong>向后兼容性</strong>：改变现有系统的字节序会导致海量软件失效，成本过高。因此，只能通过协议层（如 TCP&#x2F;IP）在传输时进行转换，而非根除底层差异。</li></ul><h4 id="3-发送和接收"><a href="#3-发送和接收" class="headerlink" title="3. 发送和接收"></a>3. 发送和接收</h4><p>为了在不同 CPU 架构通信时，保证数字解释一致。<strong>网络协议规定统一字节序</strong>：TCP&#x2F;IP 定义 <strong>大端字节序</strong>（最高有效字节在最前面），从而屏蔽了硬件差异。即：<strong>不管本机是大端还是小端，都要转换成大端再发送。</strong></p><ol><li><strong>发送端</strong>：<ul><li>大端机 → 直接发送。</li><li>小端机 → 先把数据转成大端再发。</li></ul></li><li><strong>接收端</strong>：<ul><li>收到数据 → 如果本机是小端机，再把数据转成小端处理。</li></ul></li></ol><blockquote><p>执行以下代码，进行内存测试即可验证自己机器的大小端。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line">&gt;<span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">&gt;<span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&gt;</span>&#123;</span><br><span class="line">   <span class="type">unsigned</span> <span class="type">int</span> x = <span class="number">0x12345678</span>;</span><br><span class="line">   <span class="type">unsigned</span> <span class="type">char</span>* p = (<span class="type">unsigned</span> <span class="type">char</span>*)&amp;x;</span><br><span class="line">   <span class="keyword">if</span> (p[<span class="number">0</span>] == <span class="number">0x12</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       cout &lt;&lt; <span class="string">&quot;大端&quot;</span> &lt;&lt; endl;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">       cout &lt;&lt; <span class="string">&quot;小端&quot;</span> &lt;&lt; endl;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure></blockquote><h2 id="2-socket-编程接口"><a href="#2-socket-编程接口" class="headerlink" title="2. socket 编程接口"></a>2. socket 编程接口</h2><blockquote><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chenlong_cxy/article/details/124533429">网络编程套接字（一） | CSDN（荐）</a></p><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12A411X7gY/?share_source=copy_web&vd_source=872e5e3ccf44874c39edaf42e30ab0de">socket 到底是什么? | B 站</a></p></blockquote><blockquote><p><strong>套接字就是操作系统给程序和网络接口之间的一层统一抽象。</strong></p></blockquote><h3 id="1-为什么要抽象套接字"><a href="#1-为什么要抽象套接字" class="headerlink" title="1. 为什么要抽象套接字"></a>1. 为什么要抽象套接字</h3><p>套接字是操作系统提供的一个编程接口（API），用于实现不同场景下的通信。根据通信范围和需求，主要分为三类：</p><ol><li><strong>域间套接字</strong>：用于同一台主机内部的进程间通信（IPC）。不走网络协议栈，通过文件系统中的一个特殊文件作为通信端点，效率远高于网络套接字。</li><li><strong>网络套接字：</strong> 用于不同主机之间的网络通信，比如个人电脑和百度服务器，使用 <strong>IP 地址 + 端口号</strong> 来定位目标（常见、广泛）。</li><li><strong>原始套接字：</strong> 允许程序直接访问底层网络协议（如 IP、ICMP），通常用于开发网络工具（如 <code>ping</code>）或需要自定义协议头的场景。它绕过了传输层（TCP&#x2F;UDP）。</li></ol><p>系统调用希望 <strong>函数原型统一</strong>，而不是每种地址类型写一个不同函数。因此套接字提供了 <code>sockaddr_in</code> 结构体和 <code>sockaddr_un</code> 结构体，其中 <code>sockaddr_in</code> 结构体是用于跨网络通信的，而 <code>sockaddr_un</code> 结构体是用于本地通信的。</p><p>为了让套接字的网络通信和本地通信能够使用同一套函数接口，于是就出现了 <code>sockeaddr</code> 结构体，它跟 <code>sockaddr_in</code>、<code>sockaddr_un</code> 的结构都不相同，但这三个结构体头部的 16 个比特位都是一样的，这个字段叫做协议家族。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20250814223024612.png" alt="PixPin_2025-08-14_22-30-08"></p><h3 id="2-socket-——-创建套接字"><a href="#2-socket-——-创建套接字" class="headerlink" title="2. socket —— 创建套接字"></a>2. <code>socket</code> —— 创建套接字</h3><p><strong>函数原型：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">socket</span><span class="params">(<span class="type">int</span> domain, <span class="type">int</span> type, <span class="type">int</span> protocol)</span>;</span><br></pre></td></tr></table></figure><p><strong>参数</strong>：</p><ul><li><code>domain</code>：地址族，<strong>常用 <code>AF_INET</code>（IPv4）、<code>AF_INET6</code>（IPv6） 、<code>AF_UNIX</code>（本地）。</strong></li><li><code>type</code>：套接字类型，<strong>常用 <code>SOCK_STREAM</code>（TCP）、<code>SOCK_DGRAM</code>（UDP）。</strong></li><li><code>protocol</code>：协议，通常设为 <strong>0（自动选择）</strong>。</li></ul><p><strong>返回值</strong>：成功返回套接字描述符（文件描述符，<strong>非负整数</strong>），<strong>失败 <code>-1</code></strong>（需检查 <code>errno</code>）。</p><h3 id="3-struct-sockaddr-in-——-IPv4-地址结构体"><a href="#3-struct-sockaddr-in-——-IPv4-地址结构体" class="headerlink" title="3. struct sockaddr_in —— IPv4 地址结构体"></a>3. <code>struct sockaddr_in</code> —— IPv4 地址结构体</h3><blockquote><p>struct sockaddr_in 可以使用 <code>man 7 ip</code> 命令进行查询。</p></blockquote><p><strong>结构体原型：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">sa_family_t</span>    sin_family;   <span class="comment">// 地址族，必须是AF_INET</span></span><br><span class="line">    <span class="type">in_port_t</span>      sin_port;     <span class="comment">// 16位端口号(网络字节序)，需用htons()转换</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> <span class="title">sin_addr</span>;</span>     <span class="comment">// 32位IP地址(网络字节序)</span></span><br><span class="line">    <span class="comment">// unsigned char sin_zero[8];   // 通常不用，填充为0，使结构大小与sockaddr一致</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">uint32_t</span>       s_addr;       <span class="comment">// 32位整数表示的IP地址(网络字节序)</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong><span style="color:red">简化理解：</span></strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span>          <span class="comment">// IPv4 的地址结构体</span></span><br><span class="line">    ├── sin_family          <span class="comment">// 地址族，AF_INET</span></span><br><span class="line">    ├── sin_port            <span class="comment">// 端口号</span></span><br><span class="line">    ├── sin_addr            <span class="comment">// IP 的结构体</span></span><br><span class="line">    ├── s_addr              <span class="comment">// 实际 IP 地址</span></span><br></pre></td></tr></table></figure><p><strong>说明：</strong></p><ol><li><code>sin_family</code> 固定为 <strong>AF_INET</strong>。</li><li><code>sin_port</code>：范围为 0~65535，<strong>通常选择 1024 及以上</strong>，原因：<ul><li><code>0~1023</code> 是 <strong>知名端口</strong>（如 HTTP 的 80、FTP 的 21），属于系统内定的端口号，一般有固定的应用层协议使用，通常需要 root 权限才能绑定。</li><li><code>1024~49151</code> 是 <strong>注册端口</strong>，用于特定服务（如 MySQL 的 3306）。</li><li><code>49152~65535</code> 是 <strong>动态 &#x2F; 临时端口</strong>，通常用于客户端随机分配。</li></ul></li><li><code>struct in_addr</code> 内部包含一个 32 位无符号整数 <code>s_addr</code>，表示 IPv4 地址（网络字节序）。<ul><li><strong><code>INADDR_ANY</code>（<code>0.0.0.0</code> 网络字节序，无需额外转）：</strong> 表示绑定任意本地地址，监听所有本地 IP。</li><li><strong>具体 IPv4 地址</strong>（如 <code>192.168.1.100</code>），需要通过 <code>inet_addr()</code> 或 <code>inet_pton()</code> 将字符串格式的 IP 转换为网络字节序：<ul><li><code>inet_addr(&quot;192.168.1.100&quot;)</code>：直接返回网络字节序的 32 位地址。</li><li><code>inet_pton(AF_INET, &quot;192.168.1.100&quot;, &amp;sin_addr)</code>：更推荐的现代方法（支持 IPv6）。</li></ul></li><li><code>INADDR_LOOPBACK</code>（不常用）表示本地回环地址，用于本地进程间通信。</li></ul></li></ol><p><strong>注意：使用时需先初始化（用 <code>bzero()</code> 或 <code>memset()</code> 清零），避免随机值导致错误。初始化示例：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> addr;</span><br><span class="line"><span class="built_in">bzero</span>(&amp;addr, <span class="built_in">sizeof</span>(addr));          <span class="comment">// 清零结构体</span></span><br><span class="line">addr.sin_family = AF_INET;           <span class="comment">// IPv4</span></span><br><span class="line">addr.sin_port = <span class="built_in">htons</span>(<span class="number">8080</span>);         <span class="comment">// 端口号(主机字节序转网络字节序)</span></span><br><span class="line">addr.sin_addr.s_addr = INADDR_ANY;   <span class="comment">// 任意本地IP(0.0.0.0)</span></span><br><span class="line"><span class="comment">// 或指定IP: addr.sin_addr.s_addr = inet_addr(&quot;192.168.1.100&quot;);</span></span><br></pre></td></tr></table></figure><h3 id="4-bzero-memset-——-清零结构体内存"><a href="#4-bzero-memset-——-清零结构体内存" class="headerlink" title="4. bzero / memset —— 清零结构体内存"></a>4. <code>bzero / memset</code> —— 清零结构体内存</h3><p><strong>函数原型：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;strings.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">bzero</span><span class="params">(<span class="type">void</span> *s, <span class="type">size_t</span> n)</span>;    <span class="comment">// POSIX 接口，初始化 sockaddr_in</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">memset</span><span class="params">(<span class="type">void</span> *s, <span class="type">int</span> c, <span class="type">size_t</span> n)</span>; <span class="comment">// 推荐</span></span><br></pre></td></tr></table></figure><p><strong>使用示例（将内存块清零）：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> addr;</span><br><span class="line"><span class="built_in">bzero</span>(&amp;addr, <span class="built_in">sizeof</span>(addr));</span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="built_in">memset</span>(&amp;addr, <span class="number">0</span>, <span class="built_in">sizeof</span>(addr));</span><br></pre></td></tr></table></figure><h3 id="5-htons-htonl-ntohs-ntohl-——-字节序转换函数（保证大小端传输-解析）"><a href="#5-htons-htonl-ntohs-ntohl-——-字节序转换函数（保证大小端传输-解析）" class="headerlink" title="5. htons/htonl/ntohs/ntohl —— 字节序转换函数（保证大小端传输&#x2F;解析）"></a>5. <code>htons/htonl/ntohs/ntohl</code> —— 字节序转换函数（保证大小端传输&#x2F;解析）</h3><p><strong>函数原型：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">uint16_t</span> <span class="title">htons</span><span class="params">(<span class="type">uint16_t</span> hostshort)</span></span>;  <span class="comment">// 主机short(字节序) → 网络short(字节序，端口用，短整型）</span></span><br><span class="line"><span class="function"><span class="type">uint32_t</span> <span class="title">htonl</span><span class="params">(<span class="type">uint32_t</span> hostlong)</span></span>;   <span class="comment">// 主机long(字节序) → 网络long(字节序，IP用，长整型）</span></span><br><span class="line"><span class="function"><span class="type">uint16_t</span> <span class="title">ntohs</span><span class="params">(<span class="type">uint16_t</span> netshort)</span></span>;   <span class="comment">// 网络short(字节序) → 主机short(字节序，短整型)</span></span><br><span class="line"><span class="function"><span class="type">uint32_t</span> <span class="title">ntohl</span><span class="params">(<span class="type">uint32_t</span> netlong)</span></span>;    <span class="comment">// 网络long(字节序) → 主机long(字节序，长整型)</span></span><br></pre></td></tr></table></figure><p><strong>要点：参数就是所谓的端口号</strong>，端口用 <code>htons(port)</code>；IPv4 32 位值用 <code>htonl(x)</code> 或 <code>inet_addr()</code>。</p><h3 id="6-inet-addr-inet-aton-inet-ntoa-inet-pton-inet-ntop-——-IP-地址转换函数"><a href="#6-inet-addr-inet-aton-inet-ntoa-inet-pton-inet-ntop-——-IP-地址转换函数" class="headerlink" title="6. inet_addr / inet_aton / inet_ntoa / inet_pton / inet_ntop —— IP 地址转换函数"></a>6. <code>inet_addr / inet_aton / inet_ntoa / inet_pton / inet_ntop</code> —— IP 地址转换函数</h3><blockquote><p>不使用函数，手动实现（推荐：结构体）：<a target="_blank" rel="noopener" href="https://blog.csdn.net/chenlong_cxy/article/details/124533429">网络编程套接字（一） | CSDN（荐）</a></p></blockquote><p><strong>函数原型：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="comment">// 注意：使用 struct sockaddr_in 结构体时，要注意对应的转型！！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IPv4：字符串 → 32位网络字节序IP</span></span><br><span class="line"><span class="type">in_addr_t</span> <span class="title function_">inet_addr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* cp)</span>;                    <span class="comment">// 参数：IP 字符串(192.168.1.1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IPv4：字符串 → in_addr 结构（推荐替代 inet_addr）</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">inet_aton</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* cp, <span class="keyword">struct</span> in_addr* inp)</span>;     <span class="comment">// 第二个参数就是 IP 的结构体（struct in_addr*）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IPv4：网络字节序 in_addr → 字符串</span></span><br><span class="line"><span class="type">char</span>* <span class="title function_">inet_ntoa</span><span class="params">(<span class="keyword">struct</span> in_addr in)</span>;                     <span class="comment">// 参数：IP 的结构体（struct in_addr）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通用（推荐）：字符串 → 地址结构（IPv4/IPv6）</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">inet_pton</span><span class="params">(<span class="type">int</span> af, <span class="type">const</span> <span class="type">char</span>* src, <span class="type">void</span>* dst)</span>;      <span class="comment">// 参数依次是：地址族，IP 字符串，一个外部的缓冲区地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通用（推荐）：地址结构 → 字符串（IPv4/IPv6）</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* <span class="title function_">inet_ntop</span><span class="params">(<span class="type">int</span> af, <span class="type">const</span> <span class="type">void</span>* src, <span class="type">char</span>* dst, <span class="type">socklen_t</span> size)</span>;</span><br><span class="line"><span class="comment">// 参数依次是：地址族，IP 的结构体，一个外部的缓冲区地址，缓冲区大小</span></span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment">// 使用示例：</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">addr</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> <span class="title">ip</span>;</span></span><br><span class="line"><span class="type">char</span> buffer[<span class="number">16</span>];</span><br><span class="line">bzero(&amp;addr, <span class="keyword">sizeof</span>(addr));                          <span class="comment">// 清空结构体</span></span><br><span class="line">addr.sin_family = AF_INET;                           <span class="comment">// IPv4协议</span></span><br><span class="line">addr.sin_port = htons(<span class="number">8080</span>);                         <span class="comment">// 设置端口（转网络字节序）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. inet_addr: 字符串IP → 网络字节序整数（32位）</span></span><br><span class="line">addr.sin_addr.s_addr = inet_addr(<span class="string">&quot;192.168.1.100&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. inet_aton: 字符串IP → in_addr结构（更安全）</span></span><br><span class="line">inet_aton(<span class="string">&quot;192.168.1.100&quot;</span>, &amp;addr.sin_addr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. inet_ntoa: in_addr → 字符串IP（注意：返回静态缓冲区）</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;IP: %s\n&quot;</span>, inet_ntoa(addr.sin_addr));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. inet_pton: 字符串 → 二进制IP（推荐，支持IPv6）</span></span><br><span class="line">inet_pton(AF_INET, <span class="string">&quot;192.168.1.100&quot;</span>, &amp;addr.sin_addr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. inet_ntop: 二进制IP → 字符串（推荐，线程安全）</span></span><br><span class="line">inet_ntop(AF_INET, &amp;addr.sin_addr, buffer, <span class="keyword">sizeof</span>(buffer));</span><br></pre></td></tr></table></figure><p><strong>简短实用：</strong></p><ol><li><strong>转 IP → 网络字节序（二进制）</strong><ul><li><strong>IPv4：<code>inet_aton()</code> ✅</strong></li><li><strong>IPv4&#x2F;IPv6：<code>inet_pton()</code> ✅（推荐）</strong></li><li>一般不建议：<code>inet_addr()</code>（出错返回值和合法地址可能混淆）</li></ul></li><li><strong>转 网络字节序（二进制） → 字符串</strong><ul><li><strong>IPv4：<code>inet_ntoa()</code>（返回静态区指针，非线程安全）</strong></li><li><strong>IPv4&#x2F;IPv6：<code>inet_ntop()</code> ✅（推荐，线程安全）</strong></li></ul></li><li><strong><code>af</code> 参数：</strong><ul><li><code>AF_INET</code> → IPv4。</li><li><code>AF_INET6</code> → IPv6。</li></ul></li></ol><blockquote><ul><li>IPv4 简单写：<code>inet_aton / inet_ntoa</code>。</li><li>兼容 IPv4&#x2F;IPv6、线程安全：<strong>优先用 <code>inet_pton / inet_ntop</code></strong>。</li></ul></blockquote><h3 id="7-bind-——-绑定套接字与地址（服务器必做）"><a href="#7-bind-——-绑定套接字与地址（服务器必做）" class="headerlink" title="7. bind —— 绑定套接字与地址（服务器必做）"></a>7. <code>bind</code> —— 绑定套接字与地址（服务器必做）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">bind</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> addrlen)</span>;</span><br></pre></td></tr></table></figure><p><strong>参数：</strong></p><ul><li><code>sockfd</code>：<code>socket()</code> 返回的套接字描述符。</li><li><code>addr</code>：指向地址结构体的指针（通常传入 <code>sockaddr_in</code> 并强制转换为 <code>sockaddr*</code>）。</li><li><code>addrlen</code>：地址结构体的长度&#x2F;大小（<code>sizeof(struct sockaddr_in)</code>）。</li></ul><p><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</p><p><strong>注意：服务器必须</strong> 绑定固定端口，客户端通常不需要（系统自动分配临时端口）。</p><hr><blockquote><p><span style="color:red"><strong>1-7 的接口属于 TCP 和 UDP 共用，8-10 算是 TCP 的专用函数了。</strong></span></p></blockquote><blockquote><h3 id="8-listen-——-服务器监听"><a href="#8-listen-——-服务器监听" class="headerlink" title="8. listen —— 服务器监听"></a>8. <code>listen</code> —— 服务器监听</h3><p><strong>函数原型：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line">&gt;<span class="type">int</span> <span class="title function_">listen</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> backlog)</span>;</span><br></pre></td></tr></table></figure><p><strong>参数：</strong></p><ul><li><code>sockfd</code>：已绑定的 TCP 套接字。</li><li><code>backlog</code>：等待连接队列的最大长度，通常设为 5-10（超过则新连接被拒绝）。</li></ul><p><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</p><h3 id="9-accept-——-服务器接受连接"><a href="#9-accept-——-服务器接受连接" class="headerlink" title="9. accept —— 服务器接受连接"></a>9. <code>accept</code> —— 服务器接受连接</h3><p><strong>函数原型：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line">&gt;<span class="type">int</span> <span class="title function_">accept</span><span class="params">(<span class="type">int</span> sockfd, <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> *addrlen)</span>;</span><br></pre></td></tr></table></figure><p><strong>参数：</strong></p><ul><li><code>sockfd</code>：<code>listen()</code> 监听的套接字。</li><li><code>addr</code>：输出参数，存储客户端地址（需预先分配空间）。</li><li><code>addrlen</code>：输入输出参数，传入 <code>addr</code> 大小，返回实际地址长度。</li></ul><p><strong>返回值</strong>：成功返回 <strong>新的套接字描述符</strong>（专门用于与该客户端通信），失败返回 <code>-1</code>。</p><p><strong>注意</strong>：阻塞函数，若无连接则一直等待。</p><h3 id="10-connect-——-客户端连接服务器"><a href="#10-connect-——-客户端连接服务器" class="headerlink" title="10. connect —— 客户端连接服务器"></a>10. <code>connect</code> —— 客户端连接服务器</h3><p><strong>函数原型：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line">&gt;<span class="type">int</span> <span class="title function_">connect</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> addrlen)</span>;</span><br><span class="line">&gt;<span class="comment">// 参数：要连接的服务器地址，端口号，超时时间（用来设置连接尝试的最长时间）</span></span><br></pre></td></tr></table></figure><p><strong>参数</strong>：与 <code>bind()</code> 类似，但 <code>addr</code> 是服务器的地址。</p><p><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</p></blockquote><hr><h3 id="11-数据传输函数-send-recv-——-TCP-收发"><a href="#11-数据传输函数-send-recv-——-TCP-收发" class="headerlink" title="11. 数据传输函数 send/recv —— TCP 收发"></a>11. 数据传输函数 <code>send/recv</code> —— TCP 收发</h3><p><strong>函数原型：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">send</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags)</span>;</span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">recv</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags)</span>;</span><br></pre></td></tr></table></figure><ul><li><code>send</code> → 我要把这段数据，<strong>发</strong> 给已经连接的对方。</li><li><code>recv</code> → 我要从已经连接的对方那里 <strong>接收</strong> 一段数据。</li></ul><p><strong>参数对比：</strong></p><table><thead><tr><th>参数</th><th><code>send</code> 参数</th><th><code>recv</code> 参数</th><th>相同点</th><th>不同点</th></tr></thead><tbody><tr><td><strong>1. socket 文件描述符</strong></td><td><code>int sockfd</code></td><td><code>int sockfd</code></td><td>都是已连接的套接字（由 <code>accept()</code> 或 <code>connect()</code> 得到）</td><td>无</td></tr><tr><td><strong>2. 数据缓冲区</strong></td><td><code>const void *buf</code></td><td><code>void *buf</code></td><td>都是存放数据的内存区域</td><td><code>send</code> 的数据是 <strong>只读</strong> 的（要发出去），<code>recv</code> 的数据是 <strong>可写</strong> 的（接收进来）</td></tr><tr><td><strong>3. 缓冲区长度&#x2F;大小（字节数）</strong></td><td><code>size_t len</code></td><td><code>size_t len</code></td><td>都表示操作的数据字节数</td><td>无</td></tr><tr><td><strong>4. 标志位（一般为 0）</strong></td><td><code>int flags</code></td><td><code>int flags</code></td><td>都可设置特殊行为（如非阻塞、等待模式）</td><td>一般用 <code>0</code>，也可指定 <code>MSG_NOSIGNAL</code>（<code>send</code> 阻止 SIGPIPE）或 <code>MSG_WAITALL</code>（<code>recv</code> 等到缓冲区填满才返回）</td></tr></tbody></table><p><strong>返回值：</strong></p><ol><li><code>send()</code>：<ul><li>成功：返回实际发送的字节数（可能 <strong>小于请求长度</strong>，应用层需要循环 <code>send</code>）。</li><li>失败：返回 <code>-1</code> 并设置 <code>errno</code>（如 <code>EPIPE</code> 表示对方已关闭连接）。</li></ul></li><li><code>recv()</code>：<ul><li>成功：返回实际接收的字节数。</li><li>返回 <code>0</code>：表示对方已正常关闭连接（EOF）。</li><li>失败：返回 <code>-1</code> 并设置 <code>errno</code>（如 <code>ECONNRESET</code> 表示连接被对方重置）。</li></ul></li></ol><blockquote><p>TCP 是 <strong>字节流</strong>：一次 <code>send</code> 不保证对方一次 <code>recv</code> 就读满，注意循环收发。</p></blockquote><h3 id="12-数据传输函数-sendto-recvfrom-——-UDP-收发"><a href="#12-数据传输函数-sendto-recvfrom-——-UDP-收发" class="headerlink" title="12. 数据传输函数 sendto/recvfrom —— UDP 收发"></a>12. 数据传输函数 <code>sendto/recvfrom</code> —— UDP 收发</h3><p><strong>函数原型：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">sendto</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *dest_addr, <span class="type">socklen_t</span> addrlen)</span>;</span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">recvfrom</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags, <span class="keyword">struct</span> sockaddr *src_addr, <span class="type">socklen_t</span> *addrlen)</span>;</span><br></pre></td></tr></table></figure><ul><li><code>sendto</code> → 我要把这段数据，<strong>发</strong> 给某个地址。</li><li><code>recvfrom</code> → 我要接 <strong>收</strong> 一段数据，同时想知道它是从哪来的。</li></ul><p><strong>参数：</strong></p><table><thead><tr><th>参数</th><th><code>sendto</code> 参数</th><th><code>recvfrom</code> 参数</th><th>相同点</th><th>不同点</th></tr></thead><tbody><tr><td><strong>1. socket 文件描述符</strong></td><td><code>int sockfd</code></td><td><code>int sockfd</code></td><td>都是由 <code>socket()</code> 创建的套接字，指明操作的对象</td><td>无</td></tr><tr><td><strong>2. 数据缓冲区</strong></td><td><code>const void *buf</code></td><td><code>void *buf</code></td><td>都是存放数据的内存区域</td><td><code>sendto</code> 的数据是 <strong>只读</strong> 的（要发出去），<code>recvfrom</code> 的数据是 <strong>可写</strong> 的（接收进来）</td></tr><tr><td><strong>3. 缓冲区长度&#x2F;大小（字节数）</strong></td><td><code>size_t len</code></td><td><code>size_t len</code></td><td>都表示操作的数据字节数</td><td>无</td></tr><tr><td><strong>4. 标志位（一般为 0）</strong></td><td><code>int flags</code></td><td><code>int flags</code></td><td>都可设置特殊行为（如非阻塞、等待模式）</td><td>通常 <code>sendto</code> 默认用 <code>0</code>，<code>recvfrom</code> 可能会用 <code>MSG_WAITALL</code> 等</td></tr><tr><td><strong>5. 地址结构（需要转型）</strong></td><td><code>const struct sockaddr *dest_addr</code></td><td><code>struct sockaddr *src_addr</code></td><td>都是 <code>struct sockaddr*</code> 类型，用来描述网络地址</td><td><code>sendto</code> 需要指定 <strong>目标地址</strong>（发给谁），<code>recvfrom</code> 获取 <strong>对方地址</strong>（谁发来的）</td></tr><tr><td><strong>6. 地址结构大小</strong></td><td><code>socklen_t addrlen</code></td><td><code>socklen_t *addrlen</code></td><td>都与地址结构体长度相关</td><td><code>sendto</code> 传值（只读，告诉内核目标地址长度），<code>recvfrom</code> 传指针（可写，内核回填实际地址长度）</td></tr></tbody></table><p><strong>相同的返回值：</strong></p><ul><li><strong>成功：</strong> 返回实际发送&#x2F;接收的字节数（<code>ssize_t</code> 类型，正整数）；</li><li><strong>失败：</strong> 返回 <code>-1</code> 并设置 <code>errno</code>（常见如：<code>EINVAL</code> 参数无效，<code>EAGAIN</code> 非阻塞模式下暂时无数据，<code>ECONNREFUSED</code> 目标不可达等）。</li></ul><blockquote><p>UDP 是 <strong>报文</strong>：一发一收，天然有包界；长度超 MTU 可能被分片&#x2F;丢弃。</p></blockquote><h3 id="13-close-——-关闭套接字"><a href="#13-close-——-关闭套接字" class="headerlink" title="13. close() —— 关闭套接字"></a>13. <code>close()</code> —— 关闭套接字</h3><p><strong>函数原型：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">close</span><span class="params">(<span class="type">int</span> fd)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>作用</strong>：关闭套接字描述符，释放资源。</p><p><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</p><hr><h2 id="3-理解协议与对应的服务器和客户端通信流程"><a href="#3-理解协议与对应的服务器和客户端通信流程" class="headerlink" title="3. 理解协议与对应的服务器和客户端通信流程"></a>3. 理解协议与对应的服务器和客户端通信流程</h2><h3 id="1-UDP"><a href="#1-UDP" class="headerlink" title="1. UDP"></a>1. UDP</h3><h4 id="1-UDP-服务器-Server"><a href="#1-UDP-服务器-Server" class="headerlink" title="1. UDP 服务器 (Server)"></a>1. UDP 服务器 (Server)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── <span class="built_in">socket</span>()							<span class="comment">// 1. 创建一个UDP套接字</span></span><br><span class="line">├── 配置服务器地址(sockaddr_in)			<span class="comment">// 2. 准备自己的地址信息</span></span><br><span class="line">│   ├── bzero / memset							<span class="comment">// - 清零结构体</span></span><br><span class="line">│   ├── serv_addr.sin_family					<span class="comment">// - 指定IPv4</span></span><br><span class="line">│   ├── serv_addr.sin_port						<span class="comment">// - 指定端口号</span></span><br><span class="line">│   └── serv_addr.sin_addr.s_addr				<span class="comment">// - 指定IP地址</span></span><br><span class="line">├── <span class="built_in">bind</span>()								<span class="comment">// 3. 将套接字与地址绑定 (正式“调频道”)</span></span><br><span class="line">├── <span class="built_in">recvfrom</span>()							<span class="comment">// 4. 等待并接收客户端消息</span></span><br><span class="line">│   ├── 参数中会返回客户端地址(cli_addr)			<span class="comment">// - 知道是谁发来的</span></span><br><span class="line">│   └── 参数中会返回消息内容(buffer)				<span class="comment">// - 得到消息内容</span></span><br><span class="line">├── <span class="built_in">sendto</span>()							<span class="comment">// 5. 给客户端发送回复</span></span><br><span class="line">│   ├── 指定目标地址(cli_addr)					<span class="comment">// - 回复给刚才发消息的客户端</span></span><br><span class="line">│   └── 发送回复内容</span><br><span class="line">└── <span class="built_in">close</span>()								<span class="comment">// 6. 关闭套接字</span></span><br></pre></td></tr></table></figure><h4 id="2-UDP-客户端-Client"><a href="#2-UDP-客户端-Client" class="headerlink" title="2. UDP 客户端 (Client)"></a>2. UDP 客户端 (Client)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── <span class="built_in">socket</span>()						<span class="comment">// 1. 创建一个UDP套接字</span></span><br><span class="line">├── 配置服务器地址(sockaddr_in)		<span class="comment">// 2. 准备要发往的服务器地址</span></span><br><span class="line">│   ├── bzero / <span class="built_in">memset</span>()						<span class="comment">// - 清零结构体</span></span><br><span class="line">│   ├── serv_addr.sin_family					<span class="comment">// - 指定IPv4</span></span><br><span class="line">│   ├── serv_addr.sin_port						<span class="comment">// - 服务器端口</span></span><br><span class="line">│   └── serv_addr.sin_addr.s_addr				<span class="comment">// - 服务器IP</span></span><br><span class="line">├──(可选) 配置客户端地址				<span class="comment">// 3. 如果需要，可以显式绑定客户端端口</span></span><br><span class="line">│   ├── bzero / <span class="built_in">memset</span>()</span><br><span class="line">│   ├── cli_addr.sin_family</span><br><span class="line">│   ├── cli_addr.sin_port						<span class="comment">// 指定一个固定端口，或让系统自动分配</span></span><br><span class="line">│   └── cli_addr.sin_addr.s_addr				<span class="comment">// 通常用任意IP</span></span><br><span class="line">├──(可选) <span class="built_in">bind</span>()						<span class="comment">// 4. 显式绑定客户端端口 (如果第3步配置了)，可以不需要，系统会自动分配一个临时端口</span></span><br><span class="line">├── <span class="built_in">sendto</span>()						<span class="comment">// 5. 给服务器发送请求</span></span><br><span class="line">├── <span class="built_in">recvfrom</span>()						<span class="comment">// 6. 等待并接收服务器的回复</span></span><br><span class="line">│   ├── 参数中会返回服务器地址(serv_addr)			<span class="comment">// - 确认是预期的服务器回复</span></span><br><span class="line">│   └── 参数中会返回回复内容(buffer)</span><br><span class="line">└── <span class="built_in">close</span>()							<span class="comment">// 7. 关闭套接字</span></span><br></pre></td></tr></table></figure><h4 id="3-UDP-就像“发微信语音消息”"><a href="#3-UDP-就像“发微信语音消息”" class="headerlink" title="3. UDP 就像“发微信语音消息”"></a>3. UDP 就像“发微信语音消息”</h4><p>你和朋友在不同的地方，你录了一段语音：“我在东门等你！”，然后发给了他的微信号。</p><ol><li><strong>socket()</strong>：你们都装了微信（通信工具准备好了）。</li><li><strong>bind()</strong>：你注册了微信号（相当于绑定 IP 和端口），别人能通过这个号找到你。</li><li><strong>sendto()</strong>：你发送语音，指定了发给“朋友的微信号”（目标 IP+端口）。</li><li><strong>recvfrom()</strong>：朋友的微信收到了消息，他知道是你发的，也听到了内容。</li></ol><p><strong>特点</strong>：</p><ul><li>你发完就不管了，<strong>不确认他有没有收到</strong>（不可靠）。</li><li>如果网络卡了，语音可能 <strong>丢了、乱了、重复了</strong>，你也不知道。</li><li>但 <strong>速度快</strong>，适合直播、语音通话等实时场景。</li></ul><blockquote><p>UDP：<strong>无连接、不保证送达、速度快</strong>，像“广播喊话”或“发语音”。</p></blockquote><hr><h3 id="2-TCP"><a href="#2-TCP" class="headerlink" title="2. TCP"></a>2. TCP</h3><h4 id="1-TCP-服务器-Server"><a href="#1-TCP-服务器-Server" class="headerlink" title="1. TCP 服务器 (Server)"></a>1. TCP 服务器 (Server)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── <span class="built_in">socket</span>()								<span class="comment">// 1. 创建一个TCP套接字 (SOCK_STREAM)</span></span><br><span class="line">├── 配置服务器地址 (sockaddr_in)				<span class="comment">// 2. 准备自己的地址信息</span></span><br><span class="line">│   ├── bzero / <span class="built_in">memset</span>()							<span class="comment">// - 清零结构体</span></span><br><span class="line">│   ├── serv_addr.sin_family = AF_INET				<span class="comment">// - IPv4</span></span><br><span class="line">│   ├── serv_addr.sin_port = <span class="built_in">htons</span>(PORT)				<span class="comment">// - 绑定端口</span></span><br><span class="line">│   └── serv_addr.sin_addr.s_addr = INADDR_ANY			<span class="comment">// - 监听所有网卡</span></span><br><span class="line">├── <span class="built_in">bind</span>()									<span class="comment">// 3. 将套接字绑定到地址上</span></span><br><span class="line">├── <span class="built_in">listen</span>()								<span class="comment">// 4. 开始监听连接请求（进入“待接电话”状态）</span></span><br><span class="line">│   └── 设置 backlog 队列（等待 accept 的连接数）</span><br><span class="line">│</span><br><span class="line">├── <span class="built_in">accept</span>()								<span class="comment">// 5. 阻塞等待客户端连接到来</span></span><br><span class="line">│   ├── 成功后返回一个新的连接套接字 (connfd)			<span class="comment">// - 用于与该客户端通信</span></span><br><span class="line">│   └── 客户端地址信息 (cli_addr) 被填充				<span class="comment">// - 知道是谁连进来了</span></span><br><span class="line">│</span><br><span class="line">├── <span class="built_in">recv</span>()									<span class="comment">// 6. 使用 connfd 接收数据</span></span><br><span class="line">│   └── 从客户端读取消息内容 (buffer)</span><br><span class="line">│</span><br><span class="line">├── <span class="built_in">send</span>()									<span class="comment">// 7. 使用 connfd 发送回复</span></span><br><span class="line">│   └── 向客户端发送响应数据</span><br><span class="line">│</span><br><span class="line">├── <span class="built_in">close</span>(connfd)							<span class="comment">// 8. 关闭连接套接字（通信结束）</span></span><br><span class="line">│</span><br><span class="line">└── <span class="built_in">close</span>(sockfd)							<span class="comment">// 9. 最后关闭监听套接字（程序退出时）</span></span><br></pre></td></tr></table></figure><h4 id="2-TCP-客户端-Client"><a href="#2-TCP-客户端-Client" class="headerlink" title="2. TCP 客户端 (Client)"></a>2. TCP 客户端 (Client)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── <span class="built_in">socket</span>()								<span class="comment">// 1. 创建一个TCP套接字 (SOCK_STREAM)</span></span><br><span class="line">├── 配置目标服务器地址 (sockaddr_in)			<span class="comment">// 2. 指定要连接的服务器</span></span><br><span class="line">│   ├── bzero / <span class="built_in">memset</span>()							<span class="comment">// - 清零结构体</span></span><br><span class="line">│   ├── serv_addr.sin_family = AF_INET				<span class="comment">// - IPv4</span></span><br><span class="line">│   ├── serv_addr.sin_port = <span class="built_in">htons</span>(PORT)				<span class="comment">// - 服务器端口</span></span><br><span class="line">│   └── serv_addr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(<span class="string">&quot;IP&quot;</span>)	<span class="comment">// - 服务器IP地址</span></span><br><span class="line">│</span><br><span class="line">├── <span class="built_in">connect</span>()								<span class="comment">// 3. 发起连接请求（触发三次握手）</span></span><br><span class="line">│   └── 成功则表示连接建立完成</span><br><span class="line">│</span><br><span class="line">├── <span class="built_in">send</span>()									<span class="comment">// 4. 发送请求数据到服务器</span></span><br><span class="line">│   └── 通过已连接的套接字发送消息</span><br><span class="line">│</span><br><span class="line">├── <span class="built_in">recv</span>()									<span class="comment">// 5. 接收服务器的回复</span></span><br><span class="line">│   └── 读取返回的数据</span><br><span class="line">│</span><br><span class="line">├── <span class="built_in">close</span>()									<span class="comment">// 6. 关闭连接（触发四次挥手）</span></span><br></pre></td></tr></table></figure><h4 id="3-TCP-就像“打电话”"><a href="#3-TCP-就像“打电话”" class="headerlink" title="3. TCP 就像“打电话”"></a>3. TCP 就像“打电话”</h4><p>你拿出手机，拨通朋友的号码。</p><ol><li><strong>socket()</strong>：你们都有手机（通信工具）。</li><li><strong>bind()</strong>：你的手机有号码（IP+端口），别人可以打给你。</li><li><strong>connect()</strong>：你拨号，他接听——<strong>建立连接</strong>（三次握手）。</li><li><strong>send()&#x2F;recv()</strong>：你们开始通话。你说一句，他“嗯”一声表示听到了；如果信号不好没听清，他会说“再说一遍”，你就会 <strong>重说</strong>。</li><li><strong>close()</strong>：聊完后，互相说“拜拜”才挂电话（四次挥手）。</li></ol><p><strong>关键特点</strong>：</p><ul><li>通话前必须 <strong>先建立连接</strong>。</li><li>数据 <strong>不会丢、不会乱序</strong>，发出去就得确认收到。</li><li>如果网络差，通话会卡，但内容 <strong>绝对准确</strong>。</li></ul><blockquote><p>TCP：<strong>有连接、可靠传输、保证顺序</strong>，像“打电话”一样稳。</p></blockquote><h2 id="4-UDP-服务器和客户端-Demo"><a href="#4-UDP-服务器和客户端-Demo" class="headerlink" title="4. UDP 服务器和客户端 Demo"></a>4. UDP 服务器和客户端 Demo</h2><h3 id="1-UDP-Server-hpp"><a href="#1-UDP-Server-hpp" class="headerlink" title="1. UDP_Server.hpp"></a>1. UDP_Server.hpp</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Log.hpp&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误码定义</span></span><br><span class="line"><span class="keyword">enum</span></span><br><span class="line">&#123;</span><br><span class="line">    SOCKET_ERR = <span class="number">1</span>,                                             <span class="comment">// 创建 socket 失败</span></span><br><span class="line">    BIND_ERR                                                    <span class="comment">// bind 失败</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认端口和 IP 地址</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint16_t</span> defaultport = <span class="number">8080</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> string defaultip = <span class="string">&quot;0.0.0.0&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> BUFFER_SIZE = <span class="number">1024</span>;                            <span class="comment">// 接收缓冲区大小</span></span><br><span class="line"><span class="comment">// 定义回调函数类型：接收一个字符串请求，返回一个字符串响应</span></span><br><span class="line"><span class="keyword">typedef</span> function&lt;string(<span class="type">const</span> string&amp;)&gt; <span class="type">func_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UDP_Server</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">UDP_Server</span>(<span class="type">const</span> <span class="type">uint16_t</span> &amp;port = defaultport, <span class="type">const</span> string &amp;ip = defaultip,</span><br><span class="line">              <span class="type">int</span> enable_log = <span class="number">1</span>,</span><br><span class="line">              <span class="type">int</span> classification = <span class="number">1</span>,</span><br><span class="line">              <span class="type">const</span> string &amp;log_path = <span class="string">&quot;./log.txt&quot;</span>,</span><br><span class="line">              <span class="type">int</span> console_out = <span class="number">1</span>)</span><br><span class="line">        : <span class="built_in">sockfd_</span>(<span class="number">0</span>), <span class="built_in">port_</span>(port), <span class="built_in">ip_</span>(ip), <span class="built_in">isrunning_</span>(<span class="literal">false</span>),</span><br><span class="line">          <span class="built_in">log_</span>(enable_log, classification, log_path, console_out) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">UDP_Server</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(sockfd_ &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">close</span>(sockfd_);                                     <span class="comment">// 关闭 socket 文件描述符</span></span><br><span class="line">            <span class="built_in">log_</span>(Info, <span class="string">&quot;UDP 服务器套接字已关闭&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 创建 UDP socket</span></span><br><span class="line">        sockfd_ = <span class="built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(sockfd_ &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">log_</span>(Fatal, <span class="string">&quot;套接字创建错误，sockfd: %d&quot;</span>, sockfd_);</span><br><span class="line">            <span class="built_in">exit</span>(SOCKET_ERR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">log_</span>(Info, <span class="string">&quot;套接字创建成功，sockfd: %d&quot;</span>, sockfd_);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 设置 IPv4 地址结构</span></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> local;</span><br><span class="line">        <span class="built_in">bzero</span>(&amp;local, <span class="built_in">sizeof</span>(local));                            <span class="comment">// 内存清零</span></span><br><span class="line">        local.sin_family = AF_INET;                              <span class="comment">// IPv4</span></span><br><span class="line">        local.sin_port = <span class="built_in">htons</span>(port_);                           <span class="comment">// 端口号转换为网络字节序</span></span><br><span class="line">        local.sin_addr.s_addr = <span class="built_in">inet_addr</span>(ip_.<span class="built_in">c_str</span>());          <span class="comment">// 将字符串 IP 转换为网络字节序整数</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 绑定 socket 到本地地址</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">bind</span>(sockfd_, (<span class="type">const</span> <span class="keyword">struct</span> sockaddr *)&amp;local, <span class="built_in">sizeof</span>(local)) &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">log_</span>(Fatal, <span class="string">&quot;绑定套接字错误，errno: %d，错误字符串: %s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line">            <span class="built_in">exit</span>(BIND_ERR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">log_</span>(Info, <span class="string">&quot;绑定套接字成功，本地地址: %s:%d&quot;</span>, ip_.<span class="built_in">c_str</span>(), port_);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Run</span><span class="params">(<span class="type">func_t</span> func)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        isrunning_ = <span class="literal">true</span>;</span><br><span class="line">        <span class="type">char</span> buffer[BUFFER_SIZE];                               <span class="comment">// 接收缓冲区</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (isrunning_)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client;                          <span class="comment">// 客户端地址信息</span></span><br><span class="line">            <span class="type">socklen_t</span> len = <span class="built_in">sizeof</span>(client);                     <span class="comment">// 必须初始化长度</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 接收客户端数据</span></span><br><span class="line">            <span class="type">ssize_t</span> n = <span class="built_in">recvfrom</span>(sockfd_, buffer, <span class="built_in">sizeof</span>(buffer) - <span class="number">1</span>, <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)&amp;client, &amp;len);</span><br><span class="line">            <span class="keyword">if</span> (n &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">log_</span>(Warning, <span class="string">&quot;recvfrom error, errno: %d, err string: %s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            buffer[n] = <span class="string">&#x27;\0&#x27;</span>;                                   <span class="comment">// 添加字符串结束符</span></span><br><span class="line">            <span class="function">string <span class="title">request</span><span class="params">(buffer)</span></span>;                             <span class="comment">// 构造请求字符串</span></span><br><span class="line"></span><br><span class="line">            string response = <span class="built_in">func</span>(request);                    <span class="comment">// 调用用户自定义处理函数生成响应</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 发送响应回客户端</span></span><br><span class="line">            <span class="built_in">sendto</span>(sockfd_, response.<span class="built_in">c_str</span>(), response.<span class="built_in">size</span>(), <span class="number">0</span>, (<span class="type">const</span> <span class="keyword">struct</span> sockaddr*)&amp;client, len);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> sockfd_;         <span class="comment">// socket 文件描述符</span></span><br><span class="line">    string ip_;          <span class="comment">// 服务器绑定的 IP 地址</span></span><br><span class="line">    <span class="type">uint16_t</span> port_;      <span class="comment">// 服务器监听的端口号</span></span><br><span class="line">    <span class="type">bool</span> isrunning_;     <span class="comment">// 服务运行状态标志</span></span><br><span class="line">    Log log_;            <span class="comment">// 日志对象成员</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="2-Log-hpp"><a href="#2-Log-hpp" class="headerlink" title="2. Log.hpp"></a>2. Log.hpp</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span>                                      <span class="comment">// exit, perror</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span>                                      <span class="comment">// read, write, close</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span>                                   <span class="comment">// open, close, read, write, lseek</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span>                                    <span class="comment">// mkdir</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span>                                       <span class="comment">// open, O_RDONLY, O_WRONLY, O_CREAT, O_APPEND</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span>                                       <span class="comment">// errno</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span>                                    <span class="comment">// gettimeofday, struct timeval</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span>                                         <span class="comment">// localtime_r, struct tm</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdarg&gt;</span>                                       <span class="comment">// va_list, va_start, va_end</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管道错误码</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">FIFO_ERROR_CODE</span></span><br><span class="line">&#123;</span><br><span class="line">    FIFO_CREATE_ERR = <span class="number">1</span>,                                 <span class="comment">// 这是创建管道文件失败的错误码</span></span><br><span class="line">    FIFO_DELETE_ERR = <span class="number">2</span>,                                 <span class="comment">// 这是删除管道文件失败的错误码</span></span><br><span class="line">    FIFO_OPEN_ERR                                        <span class="comment">// 这是打开管道文件失败的错误码（枚举会自动赋值为3）</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 日志等级</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Log_Level</span></span><br><span class="line">&#123;</span><br><span class="line">    Fatal,                                               <span class="comment">// 最严重级别</span></span><br><span class="line">    Error,                                               <span class="comment">// 严重错误</span></span><br><span class="line">    Warning,                                             <span class="comment">// 警告</span></span><br><span class="line">    Debug,                                               <span class="comment">// 调试信息</span></span><br><span class="line">    Info                                                 <span class="comment">// 普通信息</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Log</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span>  enable = <span class="number">1</span>;                                     <span class="comment">// 是否启用日志</span></span><br><span class="line">    <span class="type">int</span>  classification = <span class="number">1</span>;                             <span class="comment">// 是否分类</span></span><br><span class="line">    string log_path = <span class="string">&quot;./log.txt&quot;</span>;                       <span class="comment">// 日志存放路径</span></span><br><span class="line">    <span class="type">int</span>  console_out = <span class="number">1</span>;                                <span class="comment">// 是否输出到终端</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 日志等级转换成字符串</span></span><br><span class="line">    <span class="function">string <span class="title">level_to_string</span><span class="params">(<span class="type">int</span> level)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (level)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> Fatal:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Fatal&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> Error:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Error&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> Warning:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Warning&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> Debug:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Debug&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> Info:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Info&quot;</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;None&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前计算机的时间，返回格式：YYYY-MM-DD HH:MM:SS.UUUUUU （含微秒）</span></span><br><span class="line">    <span class="function">string <span class="title">get_current_time</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">timeval</span> tv;                               <span class="comment">// timeval：包含秒和微秒</span></span><br><span class="line">        <span class="built_in">gettimeofday</span>(&amp;tv, <span class="literal">nullptr</span>);                      <span class="comment">// 系统调用：获取当前时间（精确到微秒）</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">tm</span> t;                                     <span class="comment">// tm：分解时间，转格式（年、月、日、时、分、秒）</span></span><br><span class="line">        <span class="built_in">localtime_r</span>(&amp;tv.tv_sec, &amp;t);                     <span class="comment">// 把秒转换成年月日时分秒（本地时区）</span></span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">64</span>];                                 <span class="comment">// 定义字符数组作为格式化输出的缓冲区</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">snprintf</span>(buffer, <span class="built_in">sizeof</span>(buffer),</span><br><span class="line">                <span class="string">&quot;%04d-%02d-%02d %02d:%02d:%02d.%06ld&quot;</span>,</span><br><span class="line">                t.tm_year + <span class="number">1900</span>,                        <span class="comment">// 年：tm_year 从 1900 开始计数</span></span><br><span class="line">                t.tm_mon + <span class="number">1</span>,                            <span class="comment">// 月：tm_mon 从 0 开始，0 表示 1 月</span></span><br><span class="line">                t.tm_mday,                               <span class="comment">// 日</span></span><br><span class="line">                t.tm_hour,                               <span class="comment">// 时</span></span><br><span class="line">                t.tm_min,                                <span class="comment">// 分</span></span><br><span class="line">                t.tm_sec,                                <span class="comment">// 秒</span></span><br><span class="line">                tv.tv_usec);                             <span class="comment">// 微秒部分，取自 gettimeofday</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">string</span>(buffer);                           <span class="comment">// 转换成 string 返回</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Log</span>() = <span class="keyword">default</span>;                                     <span class="comment">// 使用默认构造</span></span><br><span class="line">    <span class="built_in">Log</span>(<span class="type">int</span> enable, <span class="type">int</span> classification, string log_path, <span class="type">int</span> console_out)</span><br><span class="line">        : <span class="built_in">enable</span>(enable),</span><br><span class="line">        <span class="built_in">classification</span>(classification),</span><br><span class="line">        <span class="built_in">log_path</span>(log_path),</span><br><span class="line">        <span class="built_in">console_out</span>(console_out)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重载函数调用运算符</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> level, <span class="type">const</span> string&amp; format, ...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (enable == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;                                      <span class="comment">// 日志未启用</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        va_list args;</span><br><span class="line">        <span class="built_in">va_start</span>(args, format);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 计算需要的缓冲区大小</span></span><br><span class="line">        <span class="type">int</span> size = <span class="built_in">vsnprintf</span>(<span class="literal">nullptr</span>, <span class="number">0</span>, format.<span class="built_in">c_str</span>(), args) + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">va_end</span>(args);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (size &lt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;                                      <span class="comment">// 格式化失败</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 分配缓冲区并格式化字符串</span></span><br><span class="line">        <span class="type">char</span>* buffer = <span class="keyword">new</span> <span class="type">char</span>[size];</span><br><span class="line">        <span class="built_in">va_start</span>(args, format);</span><br><span class="line">        <span class="built_in">vsnprintf</span>(buffer, size, format.<span class="built_in">c_str</span>(), args);</span><br><span class="line">        <span class="built_in">va_end</span>(args);</span><br><span class="line">        </span><br><span class="line">        <span class="function">string <span class="title">content</span><span class="params">(buffer)</span></span>;</span><br><span class="line">        <span class="keyword">delete</span>[] buffer;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 调用原有的处理逻辑</span></span><br><span class="line">        string level_str = <span class="string">&quot;[&quot;</span> + <span class="built_in">level_to_string</span>(level) + <span class="string">&quot;] &quot;</span>;</span><br><span class="line">        string log_message;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (classification == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            log_message = level_str + <span class="string">&quot;[&quot;</span> + <span class="built_in">get_current_time</span>() + <span class="string">&quot;] &quot;</span> + content + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (classification == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            log_message = <span class="string">&quot;[&quot;</span> + <span class="built_in">get_current_time</span>() + <span class="string">&quot;] &quot;</span> + content + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;传入的分类参数错误！\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (console_out == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; log_message;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">log_to_file</span>(level, log_message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 文件路径的后缀处理函数：当按照日志等级分类存储并且文件路径是 &quot;./log.txt&quot; 这种有文件扩展名时的处理方法</span></span><br><span class="line">    <span class="function">string <span class="title">Suffix_processing</span><span class="params">(<span class="type">int</span> level, string log_path)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        string Path;</span><br><span class="line">        <span class="keyword">if</span> (log_path.<span class="built_in">back</span>() == <span class="string">&#x27;/&#x27;</span>)                      <span class="comment">// 如果是一个目录的路径，比如 &quot;./log/&quot;，则最终文件名为 &quot;log_等级名.txt&quot;</span></span><br><span class="line">        &#123;</span><br><span class="line">            Path = log_path + <span class="string">&quot;log_&quot;</span> + <span class="built_in">level_to_string</span>(level) + <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>                                             <span class="comment">// 如果是一个文件路径，比如 &quot;./log.txt&quot;，则最终文件名为 &quot;log_等级名.txt&quot;</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">size_t</span> pos = log_path.<span class="built_in">find_last_of</span>(<span class="string">&#x27;.&#x27;</span>);     <span class="comment">// 从后往前找到第一个 &#x27;.&#x27; 的位置，即最后一次出现的 &#x27;.&#x27; 的位置</span></span><br><span class="line">            <span class="keyword">if</span> (pos != string::npos)</span><br><span class="line">            &#123;</span><br><span class="line">                string left = log_path.<span class="built_in">substr</span>(<span class="number">0</span>, pos);   <span class="comment">// 去掉后缀，即我所需要的有效的前部分路径</span></span><br><span class="line">                string right = log_path.<span class="built_in">substr</span>(pos);     <span class="comment">// 保留后缀，即有效的文件扩展名</span></span><br><span class="line">                Path = left + <span class="string">&quot;_&quot;</span> + <span class="built_in">level_to_string</span>(level) + right;         <span class="comment">// 组合成新的文件名</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>                                         <span class="comment">// 如果没有文件扩展名（比如 &quot;./log&quot;），则直接在文件名后面加上 &quot;_等级名.txt&quot;</span></span><br><span class="line">            &#123;</span><br><span class="line">                Path = log_path + <span class="string">&quot;_&quot;</span> + <span class="built_in">level_to_string</span>(level) + <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Path;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 核心写文件函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log_to_file</span><span class="params">(<span class="type">int</span> level, <span class="type">const</span> string&amp; log_content)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        string Path;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (classification == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Path = <span class="built_in">Suffix_processing</span>(level, log_path);   <span class="comment">// 按照日志等级分类存储</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (classification == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Path = log_path;                             <span class="comment">// 不分类直接使用传入的 log_path</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 追加写入，文件不存在则创建，权限 0644</span></span><br><span class="line">        <span class="type">int</span> fd = <span class="built_in">open</span>(Path.<span class="built_in">c_str</span>(), O_WRONLY | O_CREAT | O_APPEND, <span class="number">0644</span>);</span><br><span class="line">        <span class="keyword">if</span> (fd &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(FIFO_OPEN_ERR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">write</span>(fd, log_content.<span class="built_in">c_str</span>(), log_content.<span class="built_in">size</span>());</span><br><span class="line">        <span class="built_in">close</span>(fd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="3-UDP-Client-cc"><a href="#3-UDP-Client-cc" class="headerlink" title="3. UDP_Client.cc"></a>3. UDP_Client.cc</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> BUFSIZE = <span class="number">1024</span>;                                  <span class="comment">// 接收服务器响应的缓冲区大小</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Usage</span><span class="params">(string proc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n\r用法: &quot;</span> &lt;&lt; proc &lt;&lt; <span class="string">&quot; 服务器IP 服务器端口号\n&quot;</span> &lt;&lt; <span class="string">&quot;例如: &quot;</span> &lt;&lt; proc &lt;&lt; <span class="string">&quot; 127.0.0.1 8080\n&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 检查命令行参数数量，argc != 3 的原因：</span></span><br><span class="line">    <span class="comment">// argv[0]: 程序名称（如 &quot;./udpclient&quot;），argv[1]: 服务器IP地址（如 &quot;127.0.0.1&quot;），argv[2]: 服务器端口号（如 &quot;8080&quot;）</span></span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Usage</span>(argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 解析命令行参数获取服务器IP和端口</span></span><br><span class="line">    string serverip = argv[<span class="number">1</span>];                              <span class="comment">// 获取服务器IP地址</span></span><br><span class="line">    <span class="type">uint16_t</span> serverport = <span class="built_in">stoi</span>(argv[<span class="number">2</span>]);                    <span class="comment">// 将端口号字符串转换为整数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 构造服务器地址结构</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server;</span><br><span class="line">    <span class="built_in">bzero</span>(&amp;server, <span class="built_in">sizeof</span>(server));                         <span class="comment">// 内存清零</span></span><br><span class="line">    server.sin_family = AF_INET;                            <span class="comment">// 设置地址族为IPv4</span></span><br><span class="line">    server.sin_port = <span class="built_in">htons</span>(serverport);                    <span class="comment">// 端口号转换为网络字节序</span></span><br><span class="line">    server.sin_addr.s_addr = <span class="built_in">inet_addr</span>(serverip.<span class="built_in">c_str</span>());   <span class="comment">// IP地址转换为网络字节序</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 创建套接字</span></span><br><span class="line">    <span class="type">int</span> sockfd = <span class="built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="number">0</span>);             <span class="comment">// 创建UDP套接字</span></span><br><span class="line">    <span class="keyword">if</span>(sockfd &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;创建套接字失败！&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; &quot;创建套接字成功！&quot; &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 客户端通常不需要显式调用bind函数！</span></span><br><span class="line">    <span class="comment">// 原因：</span></span><br><span class="line">    <span class="comment">// 1. 一个端口号只能被一个进程bind，对server是如此，对于client也是如此</span></span><br><span class="line">    <span class="comment">// 2. 客户端的端口号其实不重要，只要能保证主机上的唯一性就可以</span></span><br><span class="line">    <span class="comment">// 3. 系统会在首次发送数据时自动为客户端分配一个随机端口号（隐式bind）</span></span><br><span class="line">    <span class="comment">// 4. 这样可以避免端口冲突，简化客户端编程</span></span><br><span class="line"></span><br><span class="line">    <span class="type">socklen_t</span> server_len = <span class="built_in">sizeof</span>(server);                   <span class="comment">// 获取地址结构大小，用于后续的sendto和recvfrom函数</span></span><br><span class="line">    string message;                                          <span class="comment">// 存储用户输入的消息</span></span><br><span class="line">    <span class="type">char</span> buffer[BUFSIZE];                                    <span class="comment">// 接收服务器响应的缓冲区</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 循环发送消息并接收服务器响应</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;请输入您要发送的消息@ &quot;</span>;</span><br><span class="line">        <span class="built_in">getline</span>(cin, message);                               <span class="comment">// 读取用户输入的消息</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(message == <span class="string">&quot;q&quot;</span> || message == <span class="string">&quot;exit&quot;</span> || message == <span class="string">&quot;quit&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;客户端退出！&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 发送消息</span></span><br><span class="line">        <span class="comment">// sendto参数说明：sockfd: socket文件描述符，message.c_str(): 要发送的数据，message.size(): 数据长度，</span></span><br><span class="line">        <span class="comment">// 0: 标志位（一般为0），(struct sockaddr *)&amp;server: 目标地址结构，server_len: 地址结构大小</span></span><br><span class="line">        <span class="type">ssize_t</span> send_bytes = <span class="built_in">sendto</span>(sockfd, message.<span class="built_in">c_str</span>(), message.<span class="built_in">size</span>(), <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)&amp; server, server_len);</span><br><span class="line">        <span class="keyword">if</span>(send_bytes &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;发送消息失败！&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//cout &lt;&lt; &quot;发送消息成功！&quot; &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6. 接收服务器响应</span></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_response;                   <span class="comment">// 服务器响应的地址结构</span></span><br><span class="line">        <span class="type">socklen_t</span> server_response_len = <span class="built_in">sizeof</span>(server_response);     <span class="comment">// 服务器响应的地址结构大小</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// recvfrom参数说明：socket文件描述符，buffer: 接收缓冲区，缓冲区大小（留一个字节给&#x27;\0&#x27;），标志位（一般为0），发送方地址结构，地址结构大小（传入时是sizeof，返回时是实际大小）</span></span><br><span class="line">        <span class="type">ssize_t</span> recv_bytes = <span class="built_in">recvfrom</span>(sockfd, buffer, <span class="built_in">sizeof</span>(buffer) - <span class="number">1</span>, <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)&amp; server_response, &amp;server_response_len);</span><br><span class="line">        <span class="keyword">if</span> (recv_bytes &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            buffer[recv_bytes] = <span class="string">&#x27;\0&#x27;</span>; <span class="comment">// 添加字符串结束符</span></span><br><span class="line">            <span class="comment">//cout &lt;&lt; &quot;收到服务器响应 (&quot; &lt;&lt; recv_bytes &lt;&lt; &quot; 字节): &quot; &lt;&lt; buffer &lt;&lt; endl;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (recv_bytes == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;服务器关闭连接&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;接收数据失败&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. 关闭套接字</span></span><br><span class="line">    <span class="built_in">close</span>(sockfd);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;客户端socket已关闭&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Main-cc"><a href="#4-Main-cc" class="headerlink" title="4. Main.cc"></a>4. Main.cc</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UDP_Server.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Usage</span><span class="params">(string proc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n\r用法: &quot;</span> &lt;&lt; proc &lt;&lt; <span class="string">&quot; 端口号[1024+]\n&quot;</span> &lt;&lt; <span class="string">&quot;说明: 端口号建议使用1024以上的端口，避免与系统保留端口冲突\n&quot;</span> &lt;&lt; <span class="string">&quot;示例: &quot;</span> &lt;&lt; proc &lt;&lt; <span class="string">&quot; 8080\n&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对命令进行安全检查</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">SafeCheck</span><span class="params">(<span class="type">const</span> string&amp; cmd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 可能不安全的命令，可自行添加</span></span><br><span class="line">    vector&lt;string&gt; unsafe = &#123;</span><br><span class="line">        <span class="string">&quot;rm&quot;</span>,</span><br><span class="line">        <span class="string">&quot;mv&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cp&quot;</span>,</span><br><span class="line">        <span class="string">&quot;kill&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sudo&quot;</span>,</span><br><span class="line">        <span class="string">&quot;unlink&quot;</span>,</span><br><span class="line">        <span class="string">&quot;uninstall&quot;</span>,</span><br><span class="line">        <span class="string">&quot;yum&quot;</span>,</span><br><span class="line">        <span class="string">&quot;top&quot;</span>,</span><br><span class="line">        <span class="string">&quot;while&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span>&amp; danger_cmd : unsafe)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 检查命令中是否包含危险命令</span></span><br><span class="line">        <span class="keyword">if</span>(cmd.<span class="built_in">find</span>(danger_cmd) != string::npos)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// 找到危险命令，返回false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理收到的消息</span></span><br><span class="line"><span class="function">string <span class="title">Handler</span><span class="params">(<span class="type">const</span> string&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string ret = <span class="string">&quot;服务器收到一条消息: &quot;</span>;</span><br><span class="line">    ret += s;</span><br><span class="line">    cout &lt;&lt; ret &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以直接执行命令的函数</span></span><br><span class="line"><span class="function">string <span class="title">ExcuteCommand</span><span class="params">(<span class="type">const</span> string&amp; cmd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;获取一个请求命令: &quot;</span> &lt;&lt; cmd &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">SafeCheck</span>(cmd))</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;这是一个不安全的命令，已经发现，并且拒绝执行！&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unsafe commands!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// popen 用于创建管道并读取命令，参数：要执行的命令，打开管道的模式（&quot;r&quot;：读）</span></span><br><span class="line">    FILE *fp = <span class="built_in">popen</span>(cmd.<span class="built_in">c_str</span>(), <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">nullptr</span> == fp)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;popen&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    string ret;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">4096</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> *ok = <span class="built_in">fgets</span>(buffer, <span class="built_in">sizeof</span>(buffer), fp);</span><br><span class="line">        <span class="keyword">if</span>(ok == <span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ret += buffer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">pclose</span>(fp);                                                 <span class="comment">// 关闭管道</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 检查命令行参数数量，argc != 2 的原因：</span></span><br><span class="line">    <span class="comment">// argv[0]: 程序名称（如 &quot;./udpserver&quot;），argv[1]: 监听端口号（如 &quot;8080&quot;）</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Usage</span>(argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析端口号参数</span></span><br><span class="line">    <span class="type">uint16_t</span> port = std::<span class="built_in">stoi</span>(argv[<span class="number">1</span>]);                         <span class="comment">// 将字符串端口号转换为整数</span></span><br><span class="line"></span><br><span class="line">    <span class="function">unique_ptr&lt;UDP_Server&gt; <span class="title">svr</span><span class="params">(<span class="keyword">new</span> UDP_Server(port))</span></span>;           <span class="comment">// 使用智能指针创建UDP服务器对象,自动内存管理，避免内存泄漏</span></span><br><span class="line">    svr-&gt;<span class="built_in">Init</span>();                                                <span class="comment">// 初始化服务器</span></span><br><span class="line">    svr-&gt;<span class="built_in">Run</span>(Handler);                                          <span class="comment">// 启动服务器，可选择的函数：Handler、ExcuteCommand</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-TCP-服务器和客户端-Demo"><a href="#5-TCP-服务器和客户端-Demo" class="headerlink" title="5. TCP 服务器和客户端 Demo"></a>5. TCP 服务器和客户端 Demo</h2><p>这部分的代码和文件较多，不便展示，可前往 GitHub 查看 <a target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc/Linux/tree/master/coding/network/TCP">TCP 服务器和客户端 Demo</a>。</p><blockquote><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chenlong_cxy/article/details/124650187">网络编程套接字（二） | CSDN</a></p><p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/1560275?spm=5176.26934562.main.6.4933223ecWBbBg">【网络编程入门】TCP 与 UDP 通信实战：从零构建服务器与客户端对话（附简易源码，新手友好！） | 阿里云</a></p></blockquote><h2 id="6-守护进程"><a href="#6-守护进程" class="headerlink" title="6. 守护进程"></a>6. 守护进程</h2><h3 id="1-什么是会话（Session）？"><a href="#1-什么是会话（Session）？" class="headerlink" title="1. 什么是会话（Session）？"></a>1. 什么是会话（Session）？</h3><p>会话是 Linux 中进程管理的一个逻辑单位，对应一次 “登录会话”，<strong>一次登录（通过 SSH 登录到服务器）就创建了一个“会话”</strong>。这个“会话”在 Linux 中对应的是一个 <strong>shell 进程</strong>（如 bash），这是我们与 OS 交互的入口。一个会话包含：</p><ul><li>一个 <strong>控制终端</strong>（在 Xshell 中看到的命令行界面）；</li><li><strong>多个进程</strong>，然而一些进程之间又有关联，进而形成多个 <strong>进程组</strong>，但同一时间 <strong>只有一个进程组能成为前台进程组</strong>，其余均为后台进程组。</li></ul><blockquote><p><strong>进程组</strong> 是一组相关进程的集合（比如一个程序启动的主进程和它的子进程），共享同一个 <strong>进程组 ID（PGID）</strong>，由进程组首进程（创建该组的进程）的 PID 决定。</p></blockquote><p><strong>会话的生命周期与你的登录状态绑定：</strong> 当退出登录（关闭 Xshell 窗口或执行 <code>exit</code>），会话会终止，默认会向会话内的所有进程发送终止信号 <strong>SIGHUP</strong>（挂断信号，信号 1），除非它们被“脱离”了会话（如使用 <code>nohup</code> 或 <code>disown</code>）。</p><h3 id="2-前台进程-vs-后台进程"><a href="#2-前台进程-vs-后台进程" class="headerlink" title="2. 前台进程 vs 后台进程"></a>2. 前台进程 vs 后台进程</h3><ol><li><strong>前台进程：</strong> 占据终端，可以接收键盘输入（如 Ctrl+C、Ctrl+Z），一次只能有一个前台进程，在终端输入命令后直接执行的程序默认是前台进程。</li><li><strong>后台进程：</strong> 不占用终端，不能直接接收键盘输入，可以同时运行多个进程（任务），输出仍可能打印到终端（除非重定向）。</li></ol><blockquote><p><strong>前、后台进程也称作前、后台任务，一个会话只能有一个前台进程，键盘信号只能发给前台进程！</strong></p></blockquote><hr><h3 id="3-作业号-vs-进程-ID（PID）"><a href="#3-作业号-vs-进程-ID（PID）" class="headerlink" title="3. 作业号 vs 进程 ID（PID）"></a>3. 作业号 vs 进程 ID（PID）</h3><p><code>jobs</code> 显示的是 <strong>作业号</strong>（如 <code>%1</code>），是 shell 内部编号。<code>ps</code> 命令显示的是 <strong>进程 ID（PID）</strong>，是系统级唯一标识。可以用 <code>%1</code> 来引用作业，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> %1        <span class="comment"># 终止作业1</span></span><br><span class="line"><span class="built_in">fg</span> %1          <span class="comment"># 前台恢复作业1</span></span><br><span class="line"><span class="built_in">bg</span> %1          <span class="comment"># 后台恢复作业1</span></span><br></pre></td></tr></table></figure><p><code>ps ajx | head -n 1; ps ajx | grep a.out</code> 查看示例进程的相关信息：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20250819135425291.png" alt="PixPin_2025-08-19_13-54-00"></p><h3 id="4-作业控制命令"><a href="#4-作业控制命令" class="headerlink" title="4. 作业控制命令"></a>4. 作业控制命令</h3><p>Linux shell（如 bash）支持“作业控制”，允许管理前台&#x2F;后台任务。用一个简单的代码示例并编译成 a.out 可执行程序，来体会作业控制：</p><ul><li><p><code>&amp;</code>：在命令末尾添加 <code>&amp;</code>，表示 “启动该命令后立即将其放入后台运行”，终端不等待命令执行完成，直接返回提示符，允许你继续输入其他命令。示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./a.out &gt;&gt; log.txt &amp;  <span class="comment"># 将a.out放入后台，输出重定向到log.txt</span></span><br><span class="line"><span class="built_in">sleep</span> 100 &amp;           <span class="comment"># 后台休眠100秒</span></span><br></pre></td></tr></table></figure><ul><li><strong>区分 <code>&amp;</code> 用法的核心原则在于位置判断：</strong><ul><li>若 <code>&amp;</code> 在 <strong>命令末尾</strong>，且不是条件表达式的一部分 → 后台运行命令。</li><li>若 <code>&amp;</code> 在 <strong>两个命令之间</strong> → 并行启动两个后台命令。</li><li>若 <code>&amp;</code> 在 **<code>[[ ]]</code> 或 <code>$(( ))</code> 内部 ** → 按位与运算。</li></ul></li></ul></li><li><p><code>jobs</code>：查看当前会话中所有 <strong>后台进程（任务）的状态</strong>。<strong><code>[1]</code> 是作业号（Job ID），<code>+</code> 表示默认作业</strong>。示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1]+  Running                 ./a.out &gt;&gt; log.txt &amp;</span><br></pre></td></tr></table></figure></li><li><p><code>fg</code>：将一个后台（或暂停）的作业调到 <strong>前台（SIGCONT）继续运行</strong>。示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">fg</span> %1</span><br><span class="line">./a.out          <span class="comment"># 现在在前台运行，可接收 Ctrl+C</span></span><br></pre></td></tr></table></figure></li><li><p><code>Ctrl+Z</code>：给 <strong>前台</strong> 进程组发 <strong>SIGTSTP（19 号信号）</strong>，把它“<strong>暂停</strong>”成可后台继续的作业（<code>T</code> 状态）。<code>a.out</code> 被暂停，不再运行，但未退出，示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./a.out        <span class="comment"># 前台运行</span></span><br><span class="line">^Z               <span class="comment"># 按 Ctrl+Z</span></span><br><span class="line">[1]+  Stopped     ./a.out</span><br></pre></td></tr></table></figure></li><li><p><code>bg</code>：让一个被暂停的作业在后台 <strong>继续运行</strong>。示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">bg</span> %1          <span class="comment"># 或直接 bg（作用于默认作业）</span></span><br><span class="line">[1]+ ./a.out &gt;&gt; log.txt &amp;</span><br></pre></td></tr></table></figure></li><li><p><code>kill -SIGTERM %1</code> &#x2F; <code>kill -9 %1</code>：给作业发信号（<code>%1</code> 是作业号，和 PID 不同）。</p></li><li><p><code>disown -h %1</code>：把作业从当前 shell 的作业表 <strong>剥离</strong>，不再受 SIGHUP 影响。示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./a.out &gt;&gt; log.txt &amp;</span><br><span class="line"><span class="built_in">disown</span> %1</span><br></pre></td></tr></table></figure></li><li><p><code>nohup</code>：让进程 <strong>忽略 SIGHUP</strong>，常配合重定向使用，退出登录，进程仍运行：<code>nohup ./a.out &gt;&gt; log.txt &amp;</code>。</p></li></ul><hr><h3 id="5-守护进程"><a href="#5-守护进程" class="headerlink" title="5. 守护进程"></a>5. 守护进程</h3><blockquote><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1EG4y1d7rp/?share_source=copy_web&vd_source=872e5e3ccf44874c39edaf42e30ab0de">【linux 操作系统技巧】Linux: 守护进程介绍快来看看吧 | B 站</a></p></blockquote><h4 id="1-什么是守护进程？"><a href="#1-什么是守护进程？" class="headerlink" title="1. 什么是守护进程？"></a>1. 什么是守护进程？</h4><p><strong>守护进程（Daemon）</strong> 是一种长期运行的后台进程，<strong>不依赖于任何终端或用户会话</strong>。它们通常在系统启动时启动，直到系统关闭才停止。常见例子：<code>sshd</code>（SSH 服务）、<code>httpd</code>（Web 服务）、<code>crond</code>（定时任务）。</p><h4 id="2-守护进程的特点"><a href="#2-守护进程的特点" class="headerlink" title="2. 守护进程的特点"></a>2. 守护进程的特点</h4><ol><li><strong>脱离终端与会话</strong>：通常是会话领导者，避免被 SIGHUP 杀死。</li><li><strong>双 fork 技术</strong>：创建守护进程时通常 fork 两次，确保不成为进程组领导者。</li><li><strong>重定向标准流</strong>：将 stdin、stdout、stderr 重定向到 <code>/dev/null</code> 或日志文件。</li><li><strong>工作目录</strong>：通常切换到 <code>/</code> 或固定目录，避免阻塞文件系统卸载。</li></ol><h3 id="6-dev-null-是什么？"><a href="#6-dev-null-是什么？" class="headerlink" title="6. /dev/null 是什么？"></a>6. <code>/dev/null</code> 是什么？</h3><p><strong>本质</strong>：<code>/dev/null</code> 是一个特殊的字符设备文件，被称为 <strong>黑洞设备</strong>，也叫“<strong>空设备</strong>”，我们只要把它当作垃圾桶就好。</p><p><strong>行为</strong>：</p><ul><li>往它里面写任何东西，<strong>直接丢弃</strong>，就像写到空气里。</li><li>从它里面读，总是 <strong>立刻返回 EOF</strong>（表示空文件，没数据）。</li></ul><p>所以很多守护进程会把 <strong>标准输入&#x2F;输出&#x2F;错误</strong> 重定向到 <code>/dev/null</code>，避免占用终端。那么它到底有什么用？</p><p>在守护进程中，标准输入（stdin）、标准输出（stdout）、标准错误（stderr）必须被重定向，否则：</p><ul><li>如果进程尝试读 stdin → 会出错（因为没有终端）。</li><li>如果写 stdout&#x2F;stderr → 输出无处可去，可能引发异常或写入旧终端。</li></ul><p><strong>所以，把这三个标准流重定向到 <code>/dev/null</code> 是一种安全兜底措施，确保：不会因为读写标准流而崩溃、不会干扰原终端或产生混乱输出。</strong></p><hr><h3 id="7-setsid-函数原型"><a href="#7-setsid-函数原型" class="headerlink" title="7. setsid() 函数原型"></a>7. <code>setsid()</code> 函数原型</h3><ol><li><p><strong>作用：</strong> 创建一个新的 <strong>会话</strong>，并成为该会话的会话首进程，同时成为新的 <strong>进程组组长</strong>，脱离当前控制终端，不再受键盘信号影响。</p></li><li><p><strong>函数原型</strong></p></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">pid_t</span> <span class="title function_">setsid</span><span class="params">(<span class="type">void</span>)</span>;</span><br></pre></td></tr></table></figure><ol start="3"><li><p><strong>使用条件（fork 一次 + setsid 的经典组合）：</strong></p><ul><li><p>调用 <code>setsid()</code> 的进程 <strong>不能</strong> 是进程组组长，否则会失败返回 <code>-1</code>。</p></li><li><p>所以通常先 <code>fork()</code> 一次，让子进程保证不是组长，再在子进程里 <code>setsid()</code>。</p></li></ul></li><li><p>代码示例：</p></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> string nullfile = <span class="string">&quot;/dev/null&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Daemon</span><span class="params">(<span class="type">const</span> string &amp;cwd = <span class="string">&quot;&quot;</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1. 忽略其他异常信号</span></span><br><span class="line">    <span class="built_in">signal</span>(SIGCLD, SIG_IGN);</span><br><span class="line">    <span class="built_in">signal</span>(SIGPIPE, SIG_IGN);</span><br><span class="line">    <span class="comment">// signal(SIGSTOP, SIG_IGN);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 将自己变成独立的会话</span></span><br><span class="line">    <span class="keyword">if</span> (fork() &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">setsid</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 更改当前调用进程的工作目录</span></span><br><span class="line">    <span class="keyword">if</span> (!cwd.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">chdir</span>(cwd.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 标准输入，标准输出，标准错误重定向至/dev/null</span></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(nullfile.<span class="built_in">c_str</span>(), O_RDWR);</span><br><span class="line">    <span class="keyword">if</span>(fd &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">dup2</span>(fd, STDIN_FILENO);   <span class="comment">// stdin 重定向，防止后台读键盘阻塞</span></span><br><span class="line">        <span class="built_in">dup2</span>(fd, STDOUT_FILENO);  <span class="comment">// stdout 重定向，不在终端打印</span></span><br><span class="line">        <span class="built_in">dup2</span>(fd, STDERR_FILENO);  <span class="comment">// stderr 重定向，错误也不污染终端</span></span><br><span class="line">        <span class="built_in">close</span>(fd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>守护进程的本质也是孤儿进程！</strong></p></blockquote><h3 id="8-daemon-方法（glibc-提供的简便函数）"><a href="#8-daemon-方法（glibc-提供的简便函数）" class="headerlink" title="8. daemon() 方法（glibc 提供的简便函数）"></a>8. <code>daemon()</code> 方法（glibc 提供的简便函数）</h3><p>Linux glibc 提供了一个库函数 <strong><code>daemon()</code></strong>，可以 <strong>自动</strong> 完成守护进程化，这会简化守护进程，方便我们的编码。</p><ol><li><strong>函数原型</strong></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">daemon</span><span class="params">(<span class="type">int</span> nochdir, <span class="type">int</span> noclose)</span>;</span><br></pre></td></tr></table></figure><ol start="2"><li><p><strong>参数</strong>：</p><ul><li><p><code>nochdir = 0</code> → 把工作目录切换到根目录 <code>/</code>；</p></li><li><p><code>noclose = 0</code> → 把 <code>stdin/stdout/stderr</code> 重定向到 <code>/dev/null</code>。</p></li></ul></li><li><p><strong>返回值</strong>：成功返回 <code>0</code>，失败返回 <code>-1</code>。</p></li><li><p><strong>代码示例</strong>：</p></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 创建守护进程</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">daemon</span>(<span class="number">0</span>, <span class="number">0</span>) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;daemon&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 守护进程的主循环</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 写日志或者处理任务</span></span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>daemon()</code> 内部其实就做了手写的那些步骤：<code>fork</code>、<code>setsid</code>、<code>chdir</code>、<code>dup2</code> 到 <code>/dev/null</code>，所以用起来更方便。需要注意的是：<code>daemon()</code> 没有做 <strong>双重 fork</strong>、也不处理 <code>umask</code>，所以 <strong>严格场景</strong> 下（比如写系统级服务），还是建议手写模板或用 <strong>systemd</strong> 管理。</p></blockquote><h2 id="7-配置安全组规则"><a href="#7-配置安全组规则" class="headerlink" title="7. 配置安全组规则"></a>7. 配置安全组规则</h2><p>安全组就像是一个虚拟防火墙，用于控制云服务器的入站和出站流量。默认情况下，安全组拒绝所有来自外部的入站请求。以我的华为云 Flexus 应用服务器 L 实例为例，在安全组中开放 3000-20000 端口（个人自定义范围）后，就相当于在防火墙上开了一个 “口子”，这样就允许外部设备通过这些端口与云服务器上的服务进行通信了，将自己的客户端发给朋友运行，本机的服务器就可以开始通信了。</p><p>不同厂商的配置大同小异，因为这部分配置比较简单，就不演示了，实在不会，B 站的教程相当多，这里仅提供示例配置：</p><ul><li>优先级：1</li><li>策略：允许</li><li>类型：IPv4</li><li>协议端口：TCP : 3000-20000</li><li>源地址：0.0.0.0</li></ul><p><strong>隐私安全考虑：</strong></p><ol><li><strong>及时关闭不必要规则</strong>：在演示完成后，如果这些开放的安全组规则不再需要，应及时将其关闭。否则，服务器可能会面临潜在的安全风险，比如恶意攻击者可能会利用开放的端口尝试进行入侵、扫描或其他非法操作。</li><li><strong>最小权限原则</strong>：在配置安全组规则时就应遵循最小权限原则，即只开放那些确实需要用于演示通信的端口和协议，有需要可以限制来源 IP 范围。</li><li><strong>数据隐私方面</strong>：除了端口规则外，还要注意通信过程中涉及的数据是否包含敏感信息。如果有，需要确保数据在传输（如采用加密协议）和存储过程中的安全性，避免隐私数据泄露。</li></ol></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Profile%20picture.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Profile%20picture.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">小米里的大麦</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://www.minbit.top/posts/40348.html">原创</a><a class="post-copyright-title"><span onclick='rm.copyPageUrl("https://www.minbit.top/posts/40348.html")'>046 网络编程套接字</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/wechat.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.webp" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.webp" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.minbit.top/posts/40348.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=046 网络编程套接字&amp;url=https://www.minbit.top/posts/40348.html&amp;pic=https://image-kcm.pages.dev/v2/IAdmxAt.png?_r_=cfd71b95-b3cb-c47a-e8ff-005199aa79ab" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)</a> 许可协议。转载请注明来自 <a href="https://www.minbit.top" target="_blank">小米里的大麦</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Linux/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span>Linux<span class="tagsPageCount">59</span></a><a class="post-meta__box__tags" href="/tags/%E7%BD%91%E7%BB%9C/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>网络<span class="tagsPageCount">11</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://image-kcm.pages.dev/v2/gDpBkQU.png?_r_=62a52fd3-92ab-d4eb-8575-9f52ed7325b5" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/47537.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/12THR4h.png?_r_=79ea2183-541c-4abe-60de-9bb0a09fd0be" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">045 网络基础</div></div></a></div><div class="next-post pull-right"><a href="/posts/38905.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/gDpBkQU.png?_r_=cc1facdc-c11f-357b-ea04-b67467d0b9af" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">047 网络传输基础：TCP 连接建立与数据序列化</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/47537.html" title="045 网络基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/12THR4h.png?_r_=79ea2183-541c-4abe-60de-9bb0a09fd0be" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-12</div><div class="title">045 网络基础</div></div></a></div><div><a href="/posts/63840.html" title="048 HTTP 协议"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/gDpBkQU.png?_r_=0380f5ca-82de-865b-ac5c-4d260be6aab8" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-25</div><div class="title">048 HTTP 协议</div></div></a></div><div><a href="/posts/38905.html" title="047 网络传输基础：TCP 连接建立与数据序列化"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/gDpBkQU.png?_r_=cc1facdc-c11f-357b-ea04-b67467d0b9af" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-22</div><div class="title">047 网络传输基础：TCP 连接建立与数据序列化</div></div></a></div><div><a href="/posts/62772.html" title="050 传输层 —— UDP"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/yPgfhRS.png?_r_=859eae47-35e0-4410-66b1-f832a6417443" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-09-12</div><div class="title">050 传输层 —— UDP</div></div></a></div><div><a href="/posts/34998.html" title="049 HTTPS 协议原理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/TISblXc.png?_r_=34d9f7f3-63d9-1efd-49f1-e3e1ddad0657" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-28</div><div class="title">049 HTTPS 协议原理</div></div></a></div><div><a href="/posts/42057.html" title="051 传输层 —— TCP（上）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/IAdmxAt.png?_r_=a72169cf-3565-31bd-f165-5690e844e32d" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-09-20</div><div class="title">051 传输层 —— TCP（上）</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Profile%20picture.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"></div></div><div class="author-info__description">时间好像总会留下点什么,或许是一个人,或许是一个梦,或许……是一段有意义的经历~</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">小米里的大麦</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/huangcancan-xbc" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><span>👋🏻 Hi，我是 <a target="_blank" href="https://huangcancan-xbc.github.io" rel="external nofollow noreferrer noopener" style="font-weight:700;font-size:1.1em;color:#5166f0">小米里的大麦</a>，欢迎来看我的博客鸭！</span><br><span>👉 建议优先查看置顶的 <a target="_blank" href="https://huangcancan-xbc.github.io/posts/17934.html" rel="external nofollow noreferrer noopener" style="font-weight:700;font-size:1.1em;color:#5166f0">网站说明</a>，如有问题欢迎评论区交流！</span><br><span>😫 页面异常？尝试<kbd>Ctrl</kbd>+<kbd>F5</kbd></span><br><span>📩 联系我：<a href="mailto:hc1960074081@qq.com" rel="external nofollow noreferrer"><b>给我发送邮件🚀</b></a></span></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%A5%97%E6%8E%A5%E5%AD%97"><span class="toc-number">1.</span> <span class="toc-text">网络编程套接字</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="toc-number">1.1.</span> <span class="toc-text">1. 预备知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%BA%90-IP-%E5%9C%B0%E5%9D%80-%E7%9B%AE%E7%9A%84-IP-%E5%9C%B0%E5%9D%80"><span class="toc-number">1.1.1.</span> <span class="toc-text">1. 源 IP 地址 &amp; 目的 IP 地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%BA%90-MAC-%E5%9C%B0%E5%9D%80-%E7%9B%AE%E7%9A%84-MAC-%E5%9C%B0%E5%9D%80"><span class="toc-number">1.1.2.</span> <span class="toc-text">2. 源 MAC 地址 &amp; 目的 MAC 地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%BA%90%E7%AB%AF%E5%8F%A3%E5%8F%B7-%E7%9B%AE%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8F%B7"><span class="toc-number">1.1.3.</span> <span class="toc-text">3. 源端口号 &amp; 目的端口号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BC%95%E5%85%A5%E2%80%9C%E7%AB%AF%E5%8F%A3%E2%80%9D%E8%80%8C%E4%B8%8D%E6%98%AF%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E8%BF%9B%E7%A8%8B-PID%EF%BC%9F"><span class="toc-number">1.1.4.</span> <span class="toc-text">为什么引入“端口”而不是直接使用进程 PID？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%AB%AF%E5%8F%A3-%E2%89%A0-PID"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">1. 端口 ≠ PID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E7%9B%B4%E6%8E%A5%E7%94%A8-PID%EF%BC%9F"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">2. 为什么不直接用 PID？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-TCP-VS-UDP%EF%BC%88%E7%9B%B4%E8%A7%82%E8%AE%A4%E8%AF%86%EF%BC%8C%E5%90%8E%E9%9D%A2%E8%AF%A6%E7%BB%86%E8%AE%A8%E8%AE%BA%EF%BC%89"><span class="toc-number">1.1.5.</span> <span class="toc-text">4. TCP VS UDP（直观认识，后面详细讨论）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-TCP%EF%BC%9A%E5%83%8F%E2%80%9C%E6%89%93%E7%94%B5%E8%AF%9D%E2%80%9D%E6%88%96%E2%80%9C%E6%8C%82%E5%8F%B7%E5%BF%AB%E9%80%92%E2%80%9D"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">1. TCP：像“打电话”或“挂号快递”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-UDP%EF%BC%9A%E5%83%8F%E2%80%9C%E5%8F%91%E7%9F%AD%E4%BF%A1%E2%80%9D%E6%88%96%E2%80%9C%E6%99%AE%E9%80%9A%E5%B9%B3%E9%82%AE%E2%80%9D"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">2. UDP：像“发短信”或“普通平邮”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F"><span class="toc-number">1.1.6.</span> <span class="toc-text">5. 网络字节序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8F%91%E5%B1%95%E4%B8%8E%E7%94%B1%E6%9D%A5"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">1. 发展与由来</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%B8%BA%E4%BD%95%E6%B2%A1%E6%9C%89%E7%BB%9F%E4%B8%80%E8%A7%A3%E5%86%B3%EF%BC%9F"><span class="toc-number">1.1.6.2.</span> <span class="toc-text">2. 为何没有统一解决？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%8F%91%E9%80%81%E5%92%8C%E6%8E%A5%E6%94%B6"><span class="toc-number">1.1.6.3.</span> <span class="toc-text">3. 发送和接收</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-socket-%E7%BC%96%E7%A8%8B%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.</span> <span class="toc-text">2. socket 编程接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%8A%BD%E8%B1%A1%E5%A5%97%E6%8E%A5%E5%AD%97"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. 为什么要抽象套接字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-socket-%E2%80%94%E2%80%94-%E5%88%9B%E5%BB%BA%E5%A5%97%E6%8E%A5%E5%AD%97"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. socket —— 创建套接字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-struct-sockaddr-in-%E2%80%94%E2%80%94-IPv4-%E5%9C%B0%E5%9D%80%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. struct sockaddr_in —— IPv4 地址结构体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-bzero-memset-%E2%80%94%E2%80%94-%E6%B8%85%E9%9B%B6%E7%BB%93%E6%9E%84%E4%BD%93%E5%86%85%E5%AD%98"><span class="toc-number">1.2.4.</span> <span class="toc-text">4. bzero &#x2F; memset —— 清零结构体内存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-htons-htonl-ntohs-ntohl-%E2%80%94%E2%80%94-%E5%AD%97%E8%8A%82%E5%BA%8F%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0%EF%BC%88%E4%BF%9D%E8%AF%81%E5%A4%A7%E5%B0%8F%E7%AB%AF%E4%BC%A0%E8%BE%93-%E8%A7%A3%E6%9E%90%EF%BC%89"><span class="toc-number">1.2.5.</span> <span class="toc-text">5. htons&#x2F;htonl&#x2F;ntohs&#x2F;ntohl —— 字节序转换函数（保证大小端传输&#x2F;解析）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-inet-addr-inet-aton-inet-ntoa-inet-pton-inet-ntop-%E2%80%94%E2%80%94-IP-%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.6.</span> <span class="toc-text">6. inet_addr &#x2F; inet_aton &#x2F; inet_ntoa &#x2F; inet_pton &#x2F; inet_ntop —— IP 地址转换函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-bind-%E2%80%94%E2%80%94-%E7%BB%91%E5%AE%9A%E5%A5%97%E6%8E%A5%E5%AD%97%E4%B8%8E%E5%9C%B0%E5%9D%80%EF%BC%88%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BF%85%E5%81%9A%EF%BC%89"><span class="toc-number">1.2.7.</span> <span class="toc-text">7. bind —— 绑定套接字与地址（服务器必做）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-listen-%E2%80%94%E2%80%94-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%91%E5%90%AC"><span class="toc-number">1.2.8.</span> <span class="toc-text">8. listen —— 服务器监听</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-accept-%E2%80%94%E2%80%94-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8E%A5%E5%8F%97%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.2.9.</span> <span class="toc-text">9. accept —— 服务器接受连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-connect-%E2%80%94%E2%80%94-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.2.10.</span> <span class="toc-text">10. connect —— 客户端连接服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%87%BD%E6%95%B0-send-recv-%E2%80%94%E2%80%94-TCP-%E6%94%B6%E5%8F%91"><span class="toc-number">1.2.11.</span> <span class="toc-text">11. 数据传输函数 send&#x2F;recv —— TCP 收发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%87%BD%E6%95%B0-sendto-recvfrom-%E2%80%94%E2%80%94-UDP-%E6%94%B6%E5%8F%91"><span class="toc-number">1.2.12.</span> <span class="toc-text">12. 数据传输函数 sendto&#x2F;recvfrom —— UDP 收发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-close-%E2%80%94%E2%80%94-%E5%85%B3%E9%97%AD%E5%A5%97%E6%8E%A5%E5%AD%97"><span class="toc-number">1.2.13.</span> <span class="toc-text">13. close() —— 关闭套接字</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%90%86%E8%A7%A3%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%AF%B9%E5%BA%94%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%80%9A%E4%BF%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">3. 理解协议与对应的服务器和客户端通信流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-UDP"><span class="toc-number">1.3.1.</span> <span class="toc-text">1. UDP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-UDP-%E6%9C%8D%E5%8A%A1%E5%99%A8-Server"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1. UDP 服务器 (Server)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-UDP-%E5%AE%A2%E6%88%B7%E7%AB%AF-Client"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">2. UDP 客户端 (Client)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-UDP-%E5%B0%B1%E5%83%8F%E2%80%9C%E5%8F%91%E5%BE%AE%E4%BF%A1%E8%AF%AD%E9%9F%B3%E6%B6%88%E6%81%AF%E2%80%9D"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">3. UDP 就像“发微信语音消息”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-TCP"><span class="toc-number">1.3.2.</span> <span class="toc-text">2. TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-TCP-%E6%9C%8D%E5%8A%A1%E5%99%A8-Server"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">1. TCP 服务器 (Server)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-TCP-%E5%AE%A2%E6%88%B7%E7%AB%AF-Client"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">2. TCP 客户端 (Client)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-TCP-%E5%B0%B1%E5%83%8F%E2%80%9C%E6%89%93%E7%94%B5%E8%AF%9D%E2%80%9D"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">3. TCP 就像“打电话”</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-UDP-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF-Demo"><span class="toc-number">1.4.</span> <span class="toc-text">4. UDP 服务器和客户端 Demo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-UDP-Server-hpp"><span class="toc-number">1.4.1.</span> <span class="toc-text">1. UDP_Server.hpp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Log-hpp"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. Log.hpp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-UDP-Client-cc"><span class="toc-number">1.4.3.</span> <span class="toc-text">3. UDP_Client.cc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Main-cc"><span class="toc-number">1.4.4.</span> <span class="toc-text">4. Main.cc</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-TCP-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF-Demo"><span class="toc-number">1.5.</span> <span class="toc-text">5. TCP 服务器和客户端 Demo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.6.</span> <span class="toc-text">6. 守护进程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E4%BC%9A%E8%AF%9D%EF%BC%88Session%EF%BC%89%EF%BC%9F"><span class="toc-number">1.6.1.</span> <span class="toc-text">1. 什么是会话（Session）？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%89%8D%E5%8F%B0%E8%BF%9B%E7%A8%8B-vs-%E5%90%8E%E5%8F%B0%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">2. 前台进程 vs 后台进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%9C%E4%B8%9A%E5%8F%B7-vs-%E8%BF%9B%E7%A8%8B-ID%EF%BC%88PID%EF%BC%89"><span class="toc-number">1.6.3.</span> <span class="toc-text">3. 作业号 vs 进程 ID（PID）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%9C%E4%B8%9A%E6%8E%A7%E5%88%B6%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.4.</span> <span class="toc-text">4. 作业控制命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.6.5.</span> <span class="toc-text">5. 守护进程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%EF%BC%9F"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">1. 什么是守护进程？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">2. 守护进程的特点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-dev-null-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.6.6.</span> <span class="toc-text">6. &#x2F;dev&#x2F;null 是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-setsid-%E5%87%BD%E6%95%B0%E5%8E%9F%E5%9E%8B"><span class="toc-number">1.6.7.</span> <span class="toc-text">7. setsid() 函数原型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-daemon-%E6%96%B9%E6%B3%95%EF%BC%88glibc-%E6%8F%90%E4%BE%9B%E7%9A%84%E7%AE%80%E4%BE%BF%E5%87%BD%E6%95%B0%EF%BC%89"><span class="toc-number">1.6.8.</span> <span class="toc-text">8. daemon() 方法（glibc 提供的简便函数）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E9%85%8D%E7%BD%AE%E5%AE%89%E5%85%A8%E7%BB%84%E8%A7%84%E5%88%99"><span class="toc-number">1.7.</span> <span class="toc-text">7. 配置安全组规则</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/22243.html" title="2025 年度总结"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/gDpBkQU.png?_r_=62a52fd3-92ab-d4eb-8575-9f52ed7325b5" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="2025 年度总结"></a><div class="content"><a class="title" href="/posts/22243.html" title="2025 年度总结">2025 年度总结</a><time datetime="2025-12-31T16:00:00.000Z" title="发表于 2026-01-01 00:00:00">2026-01-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/39993.html" title="08 表的增删改查下"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/TISblXc.png?_r_=401e0f95-fdf5-2a37-24b7-9f6407238dd7" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="08 表的增删改查下"></a><div class="content"><a class="title" href="/posts/39993.html" title="08 表的增删改查下">08 表的增删改查下</a><time datetime="2025-12-12T16:00:00.000Z" title="发表于 2025-12-13 00:00:00">2025-12-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/38170.html" title="Ubuntu 22.04 中安装 thefuck 与 tldr 工具"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/IAdmxAt.png?_r_=3f4a0b21-77fc-aaa3-bb1d-ec5f7076840b" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Ubuntu 22.04 中安装 thefuck 与 tldr 工具"></a><div class="content"><a class="title" href="/posts/38170.html" title="Ubuntu 22.04 中安装 thefuck 与 tldr 工具">Ubuntu 22.04 中安装 thefuck 与 tldr 工具</a><time datetime="2025-11-22T04:00:00.000Z" title="发表于 2025-11-22 12:00:00">2025-11-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/31539.html" title="CodeX CLI 的使用备忘"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/IAdmxAt.png?_r_=96b26ab2-bd17-f853-af15-abd8e2c00565" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="CodeX CLI 的使用备忘"></a><div class="content"><a class="title" href="/posts/31539.html" title="CodeX CLI 的使用备忘">CodeX CLI 的使用备忘</a><time datetime="2025-11-19T04:00:00.000Z" title="发表于 2025-11-19 12:00:00">2025-11-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/41191.html" title="免费白嫖 ChatGPT Go 套餐"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image-kcm.pages.dev/v2/TISblXc.png?_r_=db7b3b87-966f-5550-05a4-b800999c97fe" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="免费白嫖 ChatGPT Go 套餐"></a><div class="content"><a class="title" href="/posts/41191.html" title="免费白嫖 ChatGPT Go 套餐">免费白嫖 ChatGPT Go 套餐</a><time datetime="2025-11-04T16:00:00.000Z" title="发表于 2025-11-05 00:00:00">2025-11-05</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:hc1960074081@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://weibo.com/u/7913790969" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0,500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Profile picture.png" size="50px"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 - 2026 By <a class="footer-bar-link" href="/" title="小米里的大麦" target="_blank">小米里的大麦</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType(){fetch("https://v1.hitokoto.cn").then(t=>t.json()).then(t=>{{const e="出自 "+t.from,n=["《左传》载曰：“太上有立德，其次有立功，其次有立言，虽久不废，此之谓不朽。”","纸上得来终觉浅，绝知此事要躬行！","你太专注于未来，却没有意识到，今天正是你多年前祈求的模样，因为你眺望远方视而不见。","梦想是不会发光的，发光的是追梦的你！","《答案在风中飘扬》（Blowing in The Wind）"];n.unshift(t.hitokoto,e),window.typed=new Typed("#footer-type-tips",{strings:n,startDelay:300,typeSpeed:150,loop:!0,backSpeed:50})}})}"function"==typeof Typed?subtitleType():getScript("https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js").then(subtitleType)</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub主页">GitHub主页</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">93</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">9</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">社交</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/lollipop.svg" alt="GitHub"><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="哔哩哔哩"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/wink.svg" alt="哔哩哔哩"><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/huang-cancan-xbc" title="Gitee"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/laugh.svg" alt="Gitee"><span class="back-menu-item-text">Gitee</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.csdn.net/Huangcancan666?type=blog" title="CSDN"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/celebrate.svg" alt="CSDN"><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3230789931118109" title="稀土掘金"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/kiss.svg" alt="稀土掘金"><span class="back-menu-item-text">稀土掘金</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">算法</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://leetcode.cn/u/nifty-faradayzqn" title="力扣"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/thinking-glass.svg" alt="力扣"><span class="back-menu-item-text">力扣</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://ac.nowcoder.com/acm/contest/profile/517073385" title="牛客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/think.svg" alt="牛客"><span class="back-menu-item-text">牛客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/1367427" title="洛谷"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/icons/funny.svg" alt="洛谷"><span class="back-menu-item-text">洛谷</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 外链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size:.88rem">AI<sup>2</sup></a><a href="/tags/C/" style="font-size:.88rem">C++<sup>11</sup></a><a href="/tags/Git/" style="font-size:.88rem">Git<sup>3</sup></a><a href="/tags/IO/" style="font-size:.88rem">IO<sup>5</sup></a><a href="/tags/Linux/" style="font-size:.88rem">Linux<sup>59</sup></a><a href="/tags/MySQL/" style="font-size:.88rem">MySQL<sup>9</sup></a><a href="/tags/Redis/" style="font-size:.88rem">Redis<sup>2</sup></a><a href="/tags/STL/" style="font-size:.88rem">STL<sup>2</sup></a><a href="/tags/VS-Code/" style="font-size:.88rem">VS Code<sup>1</sup></a><a href="/tags/%E4%BF%A1%E5%8F%B7/" style="font-size:.88rem">信号<sup>3</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size:.88rem">内存管理<sup>1</sup></a><a href="/tags/%E5%8E%86%E7%A8%8B/" style="font-size:.88rem">历程<sup>2</sup></a><a href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" style="font-size:.88rem">地址空间<sup>6</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size:.88rem">工具<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size:.88rem">数学<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size:.88rem">模板<sup>1</sup></a><a href="/tags/%E7%81%B5%E5%85%89%E8%8D%9F%E8%90%83/" style="font-size:.88rem">灵光荟萃<sup>3</sup></a><a href="/tags/%E7%AE%A1%E9%81%93/" style="font-size:.88rem">管道<sup>2</sup></a><a href="/tags/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" style="font-size:.88rem">类与对象<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size:.88rem">线程<sup>5</sup></a><a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size:.88rem">网站<sup>3</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size:.88rem">网络<sup>11</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size:.88rem">进程<sup>15</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@6.1.6/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>var HoldLog=console.log;console.log=function(){};let now1=new Date;queueMicrotask(()=>{const o=function(){HoldLog.apply(console,arguments)},n=new Date("01/01/2025 00:00:00");now1.setTime(now1.getTime()+250);const c=(now1-n)/1e3/60/60/24,e=["这里是 小米里的大麦","芝兰生于深谷，不以无人而不芳。","\n        \n       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗\n      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║\n      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║\n      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║\n      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝\n      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝\n        \n        ","已上线",Math.floor(c),"天","©2025 By 安知鱼 V1.7.1"],t=["NCC2-036","调用前置摄像头拍照成功，识别为【小笨蛋】.","Photo captured: ","🤪"];setTimeout(o.bind(console,`\n%c${e[0]} %c ${e[1]} %c ${e[2]} %c${e[3]}%c ${e[4]}%c ${e[5]}\n\n%c ${e[6]}\n`,"color:#425AEF","","color:#425AEF","color:#425AEF","","color:#425AEF","")),setTimeout(o.bind(console,`%c ${t[0]} %c ${t[1]} %c \n${t[2]} %c\n${t[3]}\n`,"color:white; background-color:#4fd953","","",'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%')),setTimeout(o.bind(console,"%c WELCOME %c 你好，小笨蛋.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c ⚡ Powered by 安知鱼 %c 你正在访问 小米里的大麦 的博客.","color:white; background-color:#f0ad4e","")),setTimeout(o.bind(console,"%c W23-12 %c 你已打开控制台.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c S013-782 %c 你现在正处于监控中.","color:white; background-color:#d9534f",""))})</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{const t=()=>{"object"==typeof twikoo?setTimeout(o,0):getScript("https://cdn.cbd.int/twikoo@1.6.44/dist/twikoo.all.min.js").then(o)},o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.minbit.top/",path:window.location.pathname,region:"ap-shanghai",onCommentLoaded:()=>{anzhiyu.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&(()=>{const t=document.getElementById("twikoo-count");t&&twikoo.getCommentsCount({envId:"https://twikoo.minbit.top/",region:"ap-shanghai",urls:[window.location.pathname],includeReply:!1}).then(o=>{t.textContent=o[0].count}).catch(t=>{console.error(t)})})()};anzhiyu.loadComment(document.getElementById("twikoo-wrap"),t)})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener("load",()=>{const e=e=>{let t="";if(e.length)for(let n=0;n<e.length;n++){t+="<div class='aside-list-item'>";{const a="data-lazy-src";t+=`<a href='${e[n].url}' class='thumbnail'><img ${a}='${e[n].avatar}' alt='${e[n].nick}'><div class='name'><span>${e[n].nick} </span></div></a>`}t+=`<div class='content'>\n        <a class='comment' href='${e[n].url}' title='${e[n].content}'>${e[n].content}</a>\n        <time datetime="${e[n].date}">${anzhiyu.diffDate(e[n].date,!0)}</time></div>\n        </div>`}else t+="没有评论";let n=document.querySelector("#card-newest-comments .aside-list");n&&(n.innerHTML=t),window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(n)},t=()=>{if(document.querySelector("#card-newest-comments .aside-list")){const t=saveToLocal.get("twikoo-newest-comments");t?e(JSON.parse(t)):(()=>{const t=()=>{twikoo.getRecentComments({envId:"https://twikoo.minbit.top/",region:"ap-shanghai",pageSize:6,includeReply:!0}).then((function(t){const n=t.map(e=>{return{content:(t=e.comment,""===t||(t=(t=(t=(t=t.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length>150&&(t=t.substring(0,150)+"..."),t),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.id,date:new Date(e.created).toISOString()};var t});saveToLocal.set("twikoo-newest-comments",JSON.stringify(n),10/1440),e(n)})).catch((function(e){document.querySelector("#card-newest-comments .aside-list").textContent="无法获取评论，请确认相关配置是否正确"}))};"object"==typeof twikoo?t():getScript("https://cdn.cbd.int/twikoo@1.6.44/dist/twikoo.all.min.js").then(t)})()}};t(),document.addEventListener("pjax:complete",t)})</script><script async data-pjax src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail="xiaomilidedamai@minbit.top"</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://cdn.cbd.int/qrcodejs@1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="https://cdn.bootcdn.net/ajax/libs/echarts/4.9.0-rc.1/echarts.min.js"></script><script src="/js/footer-animal.js" defer></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="offer,暴富,健康,offer,喜乐,成功,offer,好运,自由,offer,坚持,上岸" data-fontsize="20px" data-random="true" async></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:type"]','meta[property="og:site_name"]','meta[property="og:description"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(anzhiyu.removeGlobalFnEvent("pjax"),anzhiyu.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async data-pjax src="https://events.vercount.one/js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script><script>window.addEventListener("load",()=>{const t=()=>{if(!window.location.pathname.startsWith("/comments/"))return;const t=async()=>{const t=new EasyDanmaku({page:"/comments/",el:"#danmu-wrap",line:5,speed:20,hover:!0,loop:!1,colourful:!0,coefficient:1.38,runtime:10});try{let a=saveToLocal.get("twikoo-danmu");if(a)t.batchSend(a,!0);else{const n={method:"POST",body:JSON.stringify({event:"GET_RECENT_COMMENTS",includeReply:!1,pageSize:100}),headers:{"Content-Type":"application/json"}};a=[];const o=await fetch("https://twikoo.minbit.top/",n);if(o.ok){const{data:n}=await o.json();n.forEach(t=>{null==t.avatar&&(t.avatar="https://cravatar.cn/avatar/d615d5793929e8c7d70eab5f00f7f5f1?d=mp"),a.push({avatar:t.avatar,content:t.nick+"："+e(t.comment),url:t.url+"#"+t.id})}),t.batchSend(a,!0),saveToLocal.set("twikoo-danmu",a,.5)}function e(t){return t=(t=(t=(t=(t=t.replace(/<\/*br>|[\s\uFEFF\xA0]+/g,"")).replace(/<img.*?>/g,"[图片]")).replace(/<a.*?>.*?<\/a>/g,"[链接]")).replace(/<pre.*?>.*?<\/pre>/g,"[代码块]")).replace(/<.*?>/g,"")}}}catch(t){console.error("Error fetching data:",t)}document.getElementById("danmu-Btn")&&(document.getElementById("danmu-Btn").innerHTML="<button class=\"hide-Btn\" onclick=\"document.getElementById('danmu-wrap').classList.remove('hide-danmu')\">显示弹幕</button> <button class=\"hide-Btn\" onclick=\"document.getElementById('danmu-wrap').classList.add('hide-danmu')\">隐藏弹幕</button>")};(async()=>{if("function"==typeof EasyDanmaku)await t();else{await getScript("https://npm.onmicrosoft.cn/naokuo-blog@1.2.12/js/easy-Danmaku.js");"function"==typeof EasyDanmaku?await t():console.error("EasyDanmaku function not found even after loading the script.")}})()};t(),document.addEventListener("pjax:complete",t)})</script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>