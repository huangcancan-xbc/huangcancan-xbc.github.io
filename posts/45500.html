<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>015 程序地址空间入门 | 小米里的大麦</title><meta name="keywords" content="Linux,地址空间"><meta name="author" content="小米里的大麦"><meta name="copyright" content="小米里的大麦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="015 程序地址空间入门"><meta name="application-name" content="015 程序地址空间入门"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="015 程序地址空间入门"><meta property="og:url" content="https://www.minbit.top/posts/45500.html"><meta property="og:site_name" content="小米里的大麦"><meta property="og:description" content="程序地址空间入门程序的 地址空间 是操作系统为每个程序分配的内存区域，它决定了程序如何访问存储在计算机内存中的数据。程序地址空间包括了多个部分，每一部分有不同的用途。通过合理管理地址空间，操作系统可以有效地进行内存分配和保护。 1. 地址空间的划分程序的地址空间通常分为多个段，每个段具有不同的功能。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250817000335747.png?_r_=f9ed3ca5-8fd6-6b7e-e417-b4708dd0def1"><meta property="article:author" content="小米里的大麦"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250817000335747.png?_r_=f9ed3ca5-8fd6-6b7e-e417-b4708dd0def1"><meta name="description" content="程序地址空间入门程序的 地址空间 是操作系统为每个程序分配的内存区域，它决定了程序如何访问存储在计算机内存中的数据。程序地址空间包括了多个部分，每一部分有不同的用途。通过合理管理地址空间，操作系统可以有效地进行内存分配和保护。 1. 地址空间的划分程序的地址空间通常分为多个段，每个段具有不同的功能。"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://www.minbit.top/posts/45500.html"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="Cd-RTVhRO2mndEhicN2cvLXbsNxPqFC6fSn6ql80eVg"/><meta name="baidu-site-verification" content="codeva-ZG3S9QTvGO"/><meta name="msvalidate.01" content="6DF744D82FE6D1FD11CE18658760B59D"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"/><link rel="mask-icon" href="/img/siteicon/apple-icon-180.png" color="#5bbad5"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-icon-180.png"/><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-icon-180.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="bookmark" href="/img/siteicon/apple-icon-180.png"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"友链 + 外链 + 无限进步！欢迎欣赏和贡献！","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"小米里的大麦","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":4,"basicWordCount":1999,"key":"93d1622eadde491eb0594b68ade51723.kaEiDD6A3KPzb7xv","Referer":"https://www.minbit.top/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"Jp8wwGQpp21utaFQ","LingQueMonitorID":"Jp8ztDRrxmTf7LDj"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo-olive-one.vercel.app/',
  commentBarrageConfig:{"enable":true,"maxBarrage":10,"barrageTime":5000,"accessToken":"25c96851dd8a790c4819ad4bfbaf153c","mailMd5":"7b12ebc2be80f9159099f6ab0e16573c"},
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"both","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🧐 准备中，就快好了，真的！😭","📚 正在学习中，加油！","🎵 喜欢听音乐，喜欢看动漫"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 小米里的大麦","link":"链接: ","source":"来源: 小米里的大麦","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '小米里的大麦',
  title: '015 程序地址空间入门',
  postAI: '这篇文章讲述了程序的地址空间是操作系统为每个程序分配的内存区域，它决定了程序如何访问存储在计算机内存中的数据。程序地址空间通常分为多个段，每个段具有不同的功能，如内核空间、命令行参数与环境变量区、栈、保护页、内存映射段、堆、BSS段、数据段和文本段。内核空间是操作系统内核运行的地方，用户程序无法直接访问。栈用于管理函数调用，堆用于动态内存分配。虚拟地址是进程内部的逻辑地址，由编译器和链接器在程序加载时确定，而物理地址由操作系统通过MMU动态映射到物理内存。虚拟地址空间独立性使得每个进程的地址空间独立，与物理内存解耦。写时复制（COW）机制在fork()创建子进程时，子进程复制父进程的虚拟地址空间结构，但实际物理内存未被复制，只有在子进程试图修改时才会创建新的物理内存。分页机制将进程的虚拟地址映射到物理地址，实现内存的高效管理，不同进程看到的地址相同，但实际物理地址不同。',
  pageFillDescription: '程序地址空间入门, 1. 地址空间的划分, 1. 内核空间（Kernel Space）, 2. 命令行参数与环境变量区, 3. 栈（Stack）, 4. 保护页（Guard Page）, 5. 内存映射段（Memory Mapping Segment）, 6. 堆（Heap）, 7. BSS 段（未初始化数据段）, 8. 数据段（已初始化数据段）, 9. 文本段（Text Segment）, 2. 实验证明, 3. 虚拟地址 VS 物理地址, 主要了解虚拟地址不做过多解释点到为止：, Q1：为什么子进程和父进程的 g_val 地址相同？, Q2：为什么数据相互独立？, 1. 虚拟地址相同的根本原因：分页机制 —— 类比为字典或目录索引, 2. 分页表（Page Table）是如何运作的？, 3. 分页是如何影响 fork() 的？, 4. fork() + 分页 + COW 的关系, 4. 小结程序地址空间入门程序的地址空间是操作系统为每个程序分配的内存区域它决定了程序如何访问存储在计算机内存中的数据程序地址空间包括了多个部分每一部分有不同的用途通过合理管理地址空间操作系统可以有效地进行内存分配和保护地址空间的划分程序的地址空间通常分为多个段每个段具有不同的功能这些段的划分通常是由操作系统定义的下图是基于和位平台的典型空间布局图然而一个标准的程序地址空间布局图位系统包括更详细点来说则是内核空间起始用户不可访问内核空间用户空间结束栈向低地址增长主线程栈命令行参数与环境变量区位于栈的顶部下方高地址区域保护页防止栈溢出内存映射段共享库文件映射匿名映射大块堆内存线程栈多线程时其他线程栈通过分配在此区域堆向高地址增长保护页防止堆越界段未初始化数据数据段已初始化数据文本段程序代码低地址内核空间范围占用空间位系统下据搜索现在广泛使用位系统现在主流云服务商如阿里云腾讯云华为云的默认系统都是位包括等默认只提供位版本位需要手动编译非常少见怎么查看自己的服务器是几位在里运行以下命令查看返回说明是位系统返回或说明是位系统几乎不会出现在位系统下内核空间和用户空间的划分会有所不同虚拟地址空间总大小位系统最大可寻址空间是字节位系统理论上最大可寻址空间是但目前的操作系统通常不会直接使用全部位地址空间内核空间与用户空间划分在常见的位系统如中用户空间与内核空间的划分通常是内核空间占用最高的到用户程序无法访问用户空间占用最低的到程序代码堆栈共享库等都在这个范围内注意实际物理内存远小于此操作系统通过稀疏地址映射管理总结在位系统下用户空间通常是内核空间是在位系统下用户空间可以高达内核空间也可达两者远比位系统宽裕说明内核空间是操作系统内核运行的地方用户程序无法直接访问任何直接访问都会触发段错误用途管理硬件进程调度内存管理系统调用等命令行参数与环境变量区位置紧挨着栈的顶部说明当程序启动时命令行参数和以及环境变量会存储在这个区域通过来访问它们示例运行时会保存和这两个参数栈方向从高地址向低地址增长说明栈用于管理函数调用包括函数的返回地址局部变量函数参数等栈帧每次函数调用都会在栈上创建新的栈帧特点栈的内存分配是自动的函数调用结束后栈内存会自动回收如果栈空间耗尽会触发栈溢出保护页位置保护页位于栈底和堆顶防止越界说明保护页是操作系统设置的特殊内存页目的是防止栈或堆意外越界机制一旦程序试图访问保护页系统会触发段错误保护程序免受内存破坏内存映射段位置堆和栈之间说明该区域通过系统调用进行映射包含共享库动态链接库如文件映射用来映射文件到内存匿名映射用于分配大块堆内存或创建内存池线程栈在多线程程序中每个线程都有自己独立的栈分布在这个区域堆方向从低地址向高地址增长说明堆用于动态内存分配通过等操作分配释放特点堆的生命周期由程序员管理忘记释放内存会导致内存泄漏堆的大小可以动态扩展直到达到栈或内存映射段的边界段未初始化数据段说明存储程序中未初始化的全局变量和静态变量系统在程序启动时自动将它们初始化为示例未初始化的全局变量放在段数据段已初始化数据段说明存储已初始化的全局变量和静态变量示例已初始化的全局变量放在数据段文本段说明存储程序的机器指令代码部分通常是只读的防止程序运行时意外修改自身代码特点文本段不可写入任何写操作都会触发段错误共享库的代码也加载到这部分多个程序可以共享同一份代码副本实验证明代码段存放可执行指令只读数据段存放字符串常量和全局变量数据段存放已初始化全局变量段存放未初始化全局变量堆区动态分配的内存向高地址生长栈区局部变量向低地址生长命令行参数和环境变量位于栈区附近的高地址实验一代码数据段段栈数据段段堆文本段代码数据段已初始化全局变量数据段已初始化静态变量段未初始化全局变量段未初始化静态变量堆动态分配内存栈局部变量运行结果示例实验二代码未初始化全局变量段已初始化全局变量数据段只读常量可能位于文本段或只读数据段代码段和只读数据代码段和只读数据函数地址代码段字符串常量地址只读数据数据段和段数据段和段已初始化全局变量未初始化全局变量全局常量堆区堆区小堆块地址大堆块地址堆生长方向正数表示向高地址生长栈区栈区栈变量栈变量栈生长方向负数表示向低地址生长命令行参数和环境变量命令行参数和环境变量数组地址数组地址地址地址动态库加载地址动态库函数地址运行结果示例虚拟地址物理地址虚拟地址就像是邮寄地址先找到它再由内存管理单元翻译成物理地址就像邮递员最终找到具体的收件地点为了更好地理解地址空间的实际运作需深入虚拟地址与物理地址的关系先来段代码全局变量存储在数据段调用创建子进程子进程修改全局变量的值父进程父进程睡眠秒等待子进程运行失败处理错误运行结果我们发现父子进程输出地址是一致的但是变量内容不一样能得出如下结论变量内容不一样所以父子进程输出的变量绝对不是同一个变量但地址值是一样的说明该地址绝对不是物理地址在地址下这种地址叫做虚拟地址结论虚拟地址相同但值独立证明物理地址不同我们在用语言所看到的地址全部都是虚拟地址物理地址用户一概看不到由统一管理必须负责将虚拟地址转化成物理地址虚拟地址空间独立性每个进程的虚拟地址空间独立与物理内存解耦由映射到物理内存进程访问的地址是虚拟地址由内存管理单元转换为物理地址虚拟地址相同物理地址相同父子进程的相同虚拟地址可能指向不同的物理内存写时复制机制优势隔离性进程间内存互不可见防止相互干扰简化开发程序员无需关心物理内存布局高效利用支持分页交换等技术扩展可用内存创建子进程时子进程复制父进程的虚拟地址空间结构如代码段数据段实际物理内存未被复制父子进程共享同一物理页标记为只读机制内核机制源码分析内核机制源码分析在之后父子进程会共享同一块物理内存但如果任何一个进程试图修改才会创建新的物理内存从而保证它们的数据互不影响当任一进程尝试写入共享页如子进程修改触发页错误操作系统复制该物理页为子进程创建新副本更新页表映射此后父子进程的相同虚拟地址指向不同的物理内存地址相同的本质虚拟地址是进程内部的逻辑地址由编译器和链接器在程序加载时确定子进程继承父进程的虚拟地址布局因此变量地址值相同主要了解虚拟地址不做过多解释点到为止为什么子进程和父进程的地址相同在进程管理中每个进程都有独立的虚拟地址空间但是多个进程可以在各自的虚拟地址空间中看到相同的地址之后子进程获得了父进程的完整拷贝会创建一个新的进程这个新进程的地址空间是父进程的完整副本由于子进程继承了父进程的虚拟地址空间布局它的全局变量也会出现在相同的虚拟地址为什么数据相互独立虽然子进程和父进程的变量在虚拟地址上相同但它们实际上是两个独立的物理内存区域虚拟地址相同的根本原因分页机制类比为字典或目录索引上面的现象其实与分页机制有密切关系结合分页的概念再解释在和大多数现代操作系统中进程的地址空间是基于分页管理的分页的作用主要是将进程的虚拟地址映射到物理地址实现内存的高效管理隔离进程的内存空间不同进程看到的地址相同但实际物理地址不同分页表是如何运作的在的分页机制中每个进程都有一个页表它记录虚拟地址到物理地址的映射后子进程的页表会复制父进程的页表但两者指向相同的物理页直到发生写操作时才会真正分配新物理页分页是如何影响的后子进程会继承父进程的虚拟地址空间因此在虚拟地址层面它们的全局变量地址相同但是操作系统并不会立即复制父进程的所有物理内存页而是采用写时复制机制示意图分页机制父进程物理页子进程后物理页共享子进程修改后物理页物理页子进程获得新的物理页父进程的物理页分页的关系机制影响分页每个进程有独立的虚拟地址空间但可以共享物理页页表记录虚拟地址到物理地址的映射后子进程继承父进程的页表写时复制直到子进程或父进程修改数据时才会真正分配新的物理内存页进程隔离虽然地址相同但修改数据后两者的物理页不再共享小结程序地址空间是操作系统为每个进程分配的虚拟内存布局决定了代码数据堆栈等区域的访问方式虚拟地址相同但物理地址可能不同只是复制了页表不会立即复制物理内存直到子进程写入数据虚拟地址物理地址程序看到的是虚拟地址由操作系统通过内存管理单元动态映射到物理内存分页机制确保内存效率避免了不必要的物理内存复制只有修改数据时才会真正分配新内存总结一句话虚拟地址是门牌号物理地址是真实房屋后父子进程共享门牌号目录页表但房屋物理内存仅在需要时复制从而实现高效隔离',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-04-02 16:10:00',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 10 || hour >= 20
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://github.com/huangcancan-xbc/Drawing-bed/blob/master/Blog/20250307201719879.png?raw=true"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">社交</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="哔哩哔哩"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="哔哩哔哩"/><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/huang-cancan-xbc" title="Gitee"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="Gitee"/><span class="back-menu-item-text">Gitee</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.csdn.net/Huangcancan666?type=blog" title="CSDN"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="CSDN"/><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3230789931118109" title="稀土掘金"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="稀土掘金"/><span class="back-menu-item-text">稀土掘金</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">小米里的大麦</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 外链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div id="nav-naoDark"><div class="container"><div class="components"><div class="main-button"><div class="moon"></div><div class="moon"></div><div class="moon"></div></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="cloud"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="cloud-light"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="stars"><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div></div></div></div></div><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250403212543768.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250403212543768.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250403212622868.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250403212622868.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 1.05rem;">C++<sup>8</sup></a><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>3</sup></a><a href="/tags/IO/" style="font-size: 1.05rem;">IO<sup>3</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>40</sup></a><a href="/tags/Obsidian/" style="font-size: 1.05rem;">Obsidian<sup>1</sup></a><a href="/tags/STL/" style="font-size: 1.05rem;">STL<sup>2</sup></a><a href="/tags/VS-Code/" style="font-size: 1.05rem;">VS Code<sup>1</sup></a><a href="/tags/%E4%BF%A1%E5%8F%B7/" style="font-size: 1.05rem;">信号<sup>3</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">内存管理<sup>1</sup></a><a href="/tags/%E5%8E%86%E7%A8%8B/" style="font-size: 1.05rem;">历程<sup>1</sup></a><a href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" style="font-size: 1.05rem;">地址空间<sup>6</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 1.05rem;">数学<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size: 1.05rem;">模板<sup>1</sup></a><a href="/tags/%E7%AE%A1%E9%81%93/" style="font-size: 1.05rem;">管道<sup>2</sup></a><a href="/tags/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" style="font-size: 1.05rem;">类与对象<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">线程<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size: 1.05rem;">网站<sup>2</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size: 1.05rem;">进程<sup>15</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div id="console-naoDark"><div class="container"><div class="components"><div class="main-button"><div class="moon"></div><div class="moon"></div><div class="moon"></div></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="cloud"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="cloud-light"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="stars"><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div></div></div></div></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Linux</span></a><a class="article-meta__tags" href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>地址空间</span></a></span></div></div><h1 class="post-title" itemprop="name headline">015 程序地址空间入门</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-04-02T07:50:00.000Z" title="发表于 2025-04-02 15:50:00">2025-04-02</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-04-02T08:10:00.000Z" title="更新于 2025-04-02 16:10:00">2025-04-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">4.1k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="015 程序地址空间入门"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为西安"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>西安</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250817000335747.png?_r_=f9ed3ca5-8fd6-6b7e-e417-b4708dd0def1"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">小米里的大麦 GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://www.minbit.top/posts/45500.html"><header><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a><a href="/tags/Linux/" tabindex="-1" itemprop="url">Linux</a><a href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" tabindex="-1" itemprop="url">地址空间</a><h1 id="CrawlerTitle" itemprop="name headline">015 程序地址空间入门</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">小米里的大麦</span><time itemprop="dateCreated datePublished" datetime="2025-04-02T07:50:00.000Z" title="发表于 2025-04-02 15:50:00">2025-04-02</time><time itemprop="dateCreated datePublished" datetime="2025-04-02T08:10:00.000Z" title="更新于 2025-04-02 16:10:00">2025-04-02</time></header><h2 id="程序地址空间入门"><a href="#程序地址空间入门" class="headerlink" title="程序地址空间入门"></a>程序地址空间入门</h2><p>程序的 <strong>地址空间</strong> 是操作系统为每个程序分配的内存区域，它决定了程序如何访问存储在计算机内存中的数据。程序地址空间包括了多个部分，每一部分有不同的用途。通过合理管理地址空间，操作系统可以有效地进行内存分配和保护。</p>
<h3 id="1-地址空间的划分"><a href="#1-地址空间的划分" class="headerlink" title="1. 地址空间的划分"></a>1. 地址空间的划分</h3><p>程序的地址空间通常分为多个段，每个段具有不同的功能。这些段的划分通常是由操作系统定义的。下图是基于 <code>kernel 2.6.32</code> 和 <code>32位平台</code> 的典型空间布局图： </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20250323175946255.png" alt="image-20250323175946087"></p>
<p>然而，一个标准的程序地址空间布局图（32 位系统）包括：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20250402122116601.png" alt="image-20250402122116475"></p>
<p>更详细点来说则是：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">+------------------------+  &lt;-- <span class="number">0xC0000000</span>（内核空间起始，用户不可访问）  </span><br><span class="line">|        内核空间         |  </span><br><span class="line">+------------------------+  &lt;-- <span class="number">0xBFFFFFFF</span>（用户空间结束）  </span><br><span class="line">|        栈（Stack）      | ↓ 向低地址增长  </span><br><span class="line">|  - 主线程栈             |  </span><br><span class="line">+------------------------+  </span><br><span class="line">|  命令行参数与环境变量区  | ← 位于栈的顶部下方（高地址区域）  </span><br><span class="line">+------------------------+  </span><br><span class="line">|        保护页           | ← 防止栈溢出  </span><br><span class="line">+------------------------+  </span><br><span class="line">|      内存映射段         |  </span><br><span class="line">|  - 共享库（.so/.dll）   |  </span><br><span class="line">|  - 文件映射（mmap）     |  </span><br><span class="line">|  - 匿名映射（大块堆内存）|  </span><br><span class="line">|  - 线程栈（多线程时）    | ← 其他线程栈通过 mmap 分配在此区域  </span><br><span class="line">+------------------------+  </span><br><span class="line">|        堆（Heap）       | ↑ 向高地址增长  </span><br><span class="line">+------------------------+  </span><br><span class="line">|        保护页           | ← 防止堆越界  </span><br><span class="line">+------------------------+  </span><br><span class="line">|    BSS段（未初始化数据） |  </span><br><span class="line">+------------------------+  </span><br><span class="line">|   数据段（已初始化数据） |  </span><br><span class="line">+------------------------+  </span><br><span class="line">|   文本段（程序代码）     |  </span><br><span class="line">+------------------------+  &lt;-- <span class="number">0x00000000</span>（低地址）</span><br></pre></td></tr></table></figure>

<h4 id="1-内核空间（Kernel-Space）"><a href="#1-内核空间（Kernel-Space）" class="headerlink" title="1. 内核空间（Kernel Space）"></a>1. 内核空间（Kernel Space）</h4><ul>
<li>范围：<code>0xC0000000</code> ~ <code>0xFFFFFFFF</code>（占用 1GB 空间，32 位系统下）。</li>
</ul>
<blockquote>
<p>  [!NOTE]</p>
<p>  <strong>据搜索：Linux 现在广泛使用 64 位系统，</strong> 现在主流云服务商（如阿里云、腾讯云、华为云）的 默认系统都是 64 位（包括 CentOS、Ubuntu、Debian 等）。CentOS 7 默认只提供 64 位版本，32 位需要手动编译，非常少见。</p>
<p>  <strong>怎么查看自己的服务器是几位？</strong></p>
<p>  在 Xshell 里运行以下命令查看：<code>uname -m</code></p>
<ul>
<li>返回 <strong><code>x86_64</code></strong>：说明是 <strong>64 位系统</strong>。</li>
<li>返回 <strong><code>i686</code></strong> 或 <strong><code>i386</code></strong>：说明是 <strong>32 位系统</strong>（几乎不会出现）。</li>
</ul>
<p>  在 <strong>64 位系统</strong> 下，内核空间和用户空间的划分会有所不同。</p>
<ol>
<li><strong>虚拟地址空间总大小：</strong><ul>
<li>32 位系统：最大可寻址空间是 <strong>4GB</strong>（2^32^ &#x3D; 4,294,967,296 字节）。</li>
<li>64 位系统：理论上最大可寻址空间是 <strong>16 EB（Exabyte）</strong>（2^64^），但目前的操作系统通常不会直接使用全部 64 位地址空间。</li>
</ul>
</li>
<li><strong>内核空间与用户空间划分：</strong><br> 在常见的 64 位 Linux 系统（如 CentOS、Ubuntu）中，用户空间与内核空间的划分通常是：<ul>
<li><strong>内核空间（Kernel Space）：</strong> 占用最高的 <strong>128TB</strong>（<code>0xFFFF800000000000</code> 到 <code>0xFFFFFFFFFFFFFFFF</code>），用户程序无法访问。</li>
<li><strong>用户空间（User Space）：</strong> 占用最低的 <strong>128TB</strong>（<code>0x0000000000000000</code> 到 <code>0x00007FFFFFFFFFFF</code>），程序代码、堆、栈、共享库等都在这个范围内。<br><strong>注意：实际物理内存远小于此，操作系统通过稀疏地址映射管理。</strong></li>
</ul>
</li>
<li><strong>总结：</strong><ul>
<li>在 <strong>32 位系统</strong> 下，用户空间通常是 <strong>3GB</strong>，内核空间是 <strong>1GB</strong>。</li>
<li>在 <strong>64 位系统</strong> 下，用户空间可以高达 <strong>128TB</strong>，内核空间也可达 <strong>128TB</strong>，两者远比 32 位系统宽裕。</li>
</ul>
</li>
</ol>
</blockquote>
<ul>
<li><strong>说明：内核空间是操作系统内核运行的地方，用户程序无法直接访问。</strong> 任何直接访问都会触发 <strong>段错误（Segmentation Fault）</strong>。</li>
<li><strong>用途：管理硬件、进程调度、内存管理、系统调用等。</strong></li>
</ul>
<h4 id="2-命令行参数与环境变量区"><a href="#2-命令行参数与环境变量区" class="headerlink" title="2. 命令行参数与环境变量区"></a>2. 命令行参数与环境变量区</h4><ul>
<li>位置：紧挨着栈的顶部。</li>
<li><strong>说明：</strong> 当程序启动时，命令行参数（<code>argc</code> 和 <code>argv</code>）以及环境变量（<code>envp</code>）会存储在这个区域。通过 <code>getenv()</code>、<code>argc/argv</code> 来访问它们。</li>
<li>示例：运行 <code>./a.out hello world</code> 时，<code>argv</code> 会保存 <code>&quot;hello&quot;</code> 和 <code>&quot;world&quot;</code> 这两个参数。</li>
</ul>
<h4 id="3-栈（Stack）"><a href="#3-栈（Stack）" class="headerlink" title="3. 栈（Stack）"></a>3. 栈（Stack）</h4><ul>
<li><strong>方向：从高地址向低地址增长（↓）。</strong></li>
<li><strong>说明：栈用于管理函数调用</strong>，包括：<ul>
<li>函数的返回地址。</li>
<li>局部变量、函数参数等。</li>
<li>栈帧（Stack Frame）：每次函数调用都会在栈上创建新的栈帧。</li>
</ul>
</li>
<li>特点：<ul>
<li>栈的内存分配是自动的，函数调用结束后，栈内存会自动回收。</li>
<li>如果栈空间耗尽，会触发 <strong>栈溢出（Stack Overflow）</strong>。</li>
</ul>
</li>
</ul>
<h4 id="4-保护页（Guard-Page）"><a href="#4-保护页（Guard-Page）" class="headerlink" title="4. 保护页（Guard Page）"></a>4. 保护页（Guard Page）</h4><ul>
<li>位置：保护页位于栈底和堆顶，防止越界</li>
<li>说明：保护页是操作系统设置的特殊内存页，目的是防止栈或堆意外越界。</li>
<li>机制：一旦程序试图访问保护页，系统会触发段错误（<code>Segmentation Fault</code>），保护程序免受内存破坏。</li>
</ul>
<h4 id="5-内存映射段（Memory-Mapping-Segment）"><a href="#5-内存映射段（Memory-Mapping-Segment）" class="headerlink" title="5. 内存映射段（Memory Mapping Segment）"></a>5. 内存映射段（Memory Mapping Segment）</h4><ul>
<li><p><strong>位置：</strong> 堆和栈之间。</p>
</li>
<li><p>说明：该区域通过 <code>mmap()</code> 系统调用进行映射，包含：</p>
<ul>
<li><strong>共享库（Shared Libraries）</strong>：动态链接库（<code>.so</code>、<code>.dll</code>），如 <code>libc.so</code>。</li>
<li><strong>文件映射（File Mapping）</strong>：用来映射文件到内存。</li>
<li><strong>匿名映射（Anonymous Mapping）</strong>：用于分配大块堆内存或创建内存池。</li>
<li><strong>线程栈（Thread Stack）</strong>：在多线程程序中，每个线程都有自己独立的栈，分布在这个区域。</li>
</ul>
</li>
</ul>
<h4 id="6-堆（Heap）"><a href="#6-堆（Heap）" class="headerlink" title="6. 堆（Heap）"></a>6. 堆（Heap）</h4><ul>
<li><strong>方向：从低地址向高地址增长（↑）。</strong></li>
<li>说明：堆用于动态内存分配，通过 <code>malloc()</code>、<code>calloc()</code>、<code>new</code> 等操作分配，<code>free()</code>、<code>delete</code> 释放。</li>
<li>特点：<ul>
<li>堆的生命周期由程序员管理，忘记释放内存会导致 <strong>内存泄漏</strong>。</li>
<li>堆的大小可以动态扩展，直到达到栈或内存映射段的边界。</li>
</ul>
</li>
</ul>
<h4 id="7-BSS-段（未初始化数据段）"><a href="#7-BSS-段（未初始化数据段）" class="headerlink" title="7. BSS 段（未初始化数据段）"></a>7. BSS 段（未初始化数据段）</h4><ul>
<li><p><strong>说明：存储程序中未初始化的全局变量和静态变量。系统在程序启动时自动将它们初始化为 0。</strong></p>
</li>
<li><p>示例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> global_var;  		<span class="comment">// 未初始化的全局变量，放在 BSS 段</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-数据段（已初始化数据段）"><a href="#8-数据段（已初始化数据段）" class="headerlink" title="8. 数据段（已初始化数据段）"></a>8. 数据段（已初始化数据段）</h4><ul>
<li><p><strong>说明：存储已初始化的全局变量和静态变量。</strong></p>
</li>
<li><p>示例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> global_var = <span class="number">10</span>;    <span class="comment">// 已初始化的全局变量，放在数据段</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="9-文本段（Text-Segment）"><a href="#9-文本段（Text-Segment）" class="headerlink" title="9. 文本段（Text Segment）"></a>9. 文本段（Text Segment）</h4><ul>
<li><strong>说明：存储程序的机器指令（代码部分），通常是只读的，防止程序运行时意外修改自身代码。</strong></li>
<li>特点：<ul>
<li>文本段不可写入，任何写操作都会触发段错误。</li>
<li>共享库的代码也加载到这部分，多个程序可以共享同一份代码副本。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-实验证明"><a href="#2-实验证明" class="headerlink" title="2. 实验证明"></a>2. 实验证明</h3><ul>
<li><strong>代码段（.text）</strong>：存放可执行指令。</li>
<li><strong>只读数据段（.rodata）</strong>：存放字符串常量和 <code>const</code> 全局变量。</li>
<li><strong>数据段（.data）</strong>：存放已初始化全局变量。</li>
<li><strong>BSS 段（.bss）</strong>：存放未初始化全局变量。</li>
<li><strong>堆区（heap）</strong>：动态分配的内存，向高地址生长。</li>
<li><strong>栈区（stack）</strong>：局部变量，向低地址生长。</li>
<li><strong>命令行参数和环境变量</strong>：位于栈区附近的高地址。</li>
</ul>
<p>实验一代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> global_init = <span class="number">10</span>;               <span class="comment">// 数据段</span></span><br><span class="line"><span class="type">int</span> global_uninit;                  <span class="comment">// BSS段</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> stack_var;                  <span class="comment">// 栈</span></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> static_init = <span class="number">20</span>;    <span class="comment">// 数据段</span></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> static_uninit;       <span class="comment">// BSS段</span></span><br><span class="line">    <span class="type">char</span>* heap_var = <span class="built_in">malloc</span>(<span class="number">10</span>);    <span class="comment">// 堆</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;文本段（代码）: %p\n&quot;</span>, (<span class="type">void</span>*)main);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;数据段（已初始化全局变量）: %p\n&quot;</span>, (<span class="type">void</span>*)&amp;global_init);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;数据段（已初始化静态变量）: %p\n&quot;</span>, (<span class="type">void</span>*)&amp;static_init);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;BSS段（未初始化全局变量）: %p\n&quot;</span>, (<span class="type">void</span>*)&amp;global_uninit);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;BSS段（未初始化静态变量）: %p\n&quot;</span>, (<span class="type">void</span>*)&amp;static_uninit);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;堆（动态分配内存）: %p\n&quot;</span>, (<span class="type">void</span>*)heap_var);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;栈（局部变量）: %p\n&quot;</span>, (<span class="type">void</span>*)&amp;stack_var);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(heap_var);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果示例：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20250402125741895.png" alt="image-20250402125741766"></p>
<p>实验二代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> g_unval;                            <span class="comment">// 未初始化全局变量（BSS段）</span></span><br><span class="line"><span class="type">int</span> g_val = <span class="number">100</span>;                        <span class="comment">// 已初始化全局变量（数据段）</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> g_const = <span class="number">200</span>;                <span class="comment">// 只读常量（可能位于文本段或只读数据段）</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[], <span class="type">char</span>* envp[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1. 代码段和只读数据</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;==================== 代码段和只读数据 ====================\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main函数地址（代码段）          : %p\n&quot;</span>, main);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;字符串常量地址（只读数据）       : %p\n&quot;</span>, <span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 数据段和BSS段</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n==================== 数据段和BSS段 ====================\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;已初始化全局变量（g_val）        : %p\n&quot;</span>, &amp;g_val);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;未初始化全局变量（g_unval）      : %p\n&quot;</span>, &amp;g_unval);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;const全局常量（g_const）        : %p\n&quot;</span>, &amp;g_const);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 堆区</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n==================== 堆区 ====================\n&quot;</span>);</span><br><span class="line">    <span class="type">int</span>* p1 = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="type">int</span>* p2 = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="number">20</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;小堆块地址（p1）                : %p\n&quot;</span>, p1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;大堆块地址（p2）                : %p\n&quot;</span>, p2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;堆生长方向（p2 - p1）           : %ld\n&quot;</span>, p2 - p1);  <span class="comment">// 正数表示向高地址生长</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 栈区</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n==================== 栈区 ====================\n&quot;</span>);</span><br><span class="line">    <span class="type">int</span> stack_var1;</span><br><span class="line">    <span class="type">int</span> stack_var2;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;栈变量1（stack_var1）           : %p\n&quot;</span>, &amp;stack_var1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;栈变量2（stack_var2）           : %p\n&quot;</span>, &amp;stack_var2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;栈生长方向（&amp;stack_var2 - &amp;stack_var1）: %ld\n&quot;</span>,</span><br><span class="line">        (<span class="type">long</span>)&amp;stack_var2 - (<span class="type">long</span>)&amp;stack_var1);  <span class="comment">// 负数表示向低地址生长</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 命令行参数和环境变量</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n==================== 命令行参数和环境变量 ====================\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;argv数组地址                    : %p\n&quot;</span>, argv);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;envp数组地址                    : %p\n&quot;</span>, envp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; argc; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;argv[%d]地址                   : %p\n&quot;</span>, i, argv[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; envp[i]; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;envp[%d]地址                   : %p\n&quot;</span>, i, envp[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. 动态库加载地址</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n==================== 动态库 ====================\n&quot;</span>);</span><br><span class="line">    <span class="type">void</span>* libc_addr = (<span class="type">void</span>*)printf;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;libc函数（printf）地址          : %p\n&quot;</span>, libc_addr);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果示例：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20250402131235172.png" alt="image-20250402131235019"></p>
<hr>
<h3 id="3-虚拟地址-VS-物理地址"><a href="#3-虚拟地址-VS-物理地址" class="headerlink" title="3. 虚拟地址 VS 物理地址"></a>3. 虚拟地址 VS 物理地址</h3><blockquote>
<p>虚拟地址就像是邮寄地址，CPU 先找到它，再由内存管理单元（MMU）翻译成物理地址，就像邮递员最终找到具体的收件地点。</p>
</blockquote>
<p>为了更好地理解地址空间的实际运作，需深入虚拟地址与物理地址的关系。先来段代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> g_val = <span class="number">100</span>;                <span class="comment">// 全局变量，存储在数据段</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">pid_t</span> id = fork();          <span class="comment">// 调用 fork() 创建子进程</span></span><br><span class="line">    <span class="keyword">if</span> (id == <span class="number">0</span>)                <span class="comment">// 子进程</span></span><br><span class="line">    &#123;              </span><br><span class="line">        g_val = <span class="number">200</span>;            <span class="comment">// 修改全局变量的值</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;child:PID:%d, PPID:%d, g_val:%d, &amp;g_val:%p\n&quot;</span>, <span class="built_in">getpid</span>(), <span class="built_in">getppid</span>(), g_val, &amp;g_val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (id &gt; <span class="number">0</span>)            <span class="comment">// 父进程</span></span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">3</span>);               <span class="comment">// 父进程睡眠 3 秒，等待子进程运行</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;father:PID:%d, PPID:%d, g_val:%d, &amp;g_val:%p\n&quot;</span>, <span class="built_in">getpid</span>(), <span class="built_in">getppid</span>(), g_val, &amp;g_val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>                        <span class="comment">// fork() 失败</span></span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="comment">// 处理 fork() 错误</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20250402133458199.png" alt="image-20250402133458095"></p>
<p>我们发现，父子进程，输出地址是一致的，但是变量内容不一样！能得出如下结论：</p>
<ul>
<li>变量内容不一样，所以父子进程输出的变量绝对不是同一个变量。</li>
<li>但地址值是一样的，说明该地址绝对不是物理地址！</li>
<li>在 Linux 地址下，这种地址叫做虚拟地址。</li>
</ul>
<p><strong>结论</strong>：虚拟地址相同，但值独立，证明物理地址不同。我们在用 <code>C/C++</code> 语言所看到的地址，全部都是虚拟地址！物理地址用户一概看不到，由 <code>OS</code> 统一管理。<code>OS</code> 必须负责将虚拟地址转化成物理地址。</p>
<hr>
<ol>
<li><p><strong>虚拟地址空间独立性</strong></p>
<ul>
<li>每个进程的虚拟地址空间独立，与物理内存解耦，由 MMU 映射到物理内存。<ul>
<li>进程访问的地址是虚拟地址，由 <strong>MMU（内存管理单元）</strong> 转换为物理地址。</li>
</ul>
</li>
<li><strong>虚拟地址相同 ≠ 物理地址相同</strong>：父子进程的相同虚拟地址可能指向不同的物理内存。</li>
</ul>
</li>
<li><p><strong>写时复制（Copy-On-Write, COW）机制</strong></p>
<ol>
<li><p><strong>优势</strong>  </p>
<ul>
<li><strong>隔离性</strong>：进程间内存互不可见，防止相互干扰。</li>
<li><strong>简化开发</strong>：程序员无需关心物理内存布局。</li>
<li><strong>高效利用</strong>：支持分页、交换等技术，扩展可用内存。</li>
</ul>
</li>
<li><p><strong><code>fork()</code> 创建子进程时</strong>：</p>
<ul>
<li>子进程复制父进程的虚拟地址空间结构（如代码段、数据段）。</li>
<li><strong>实际物理内存未被复制</strong>，父子进程共享同一物理页，标记为 <strong>只读</strong>。</li>
</ul>
</li>
<li><p><strong>COW 机制（[Linux 5.11.4 内核 COW 机制源码分析](<a target="_blank" rel="noopener" href="https://woodpenker.github.io/2021/04/03/COW%E5%86%99%E6%97%B6%E5%A4%8D%E5%88%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%88%86%E6%9E%90/">Linux 5.11.4内核COW机制源码分析 | woodpenker’s blog</a>)）：</strong> 在 <code>fork()</code> 之后，父子进程会 <strong>共享同一块物理内存</strong>，但如果 <strong>任何一个进程试图修改</strong>，Linux <strong>才会创建新的物理内存</strong>，从而保证它们的数据互不影响。</p>
<blockquote>
<p>  [!CAUTION]</p>
<ul>
<li>当任一进程尝试写入共享页（如子进程修改 <code>g_val</code>），触发 <strong>页错误（Page Fault）</strong>。</li>
<li>操作系统 <strong>复制该物理页</strong>，为子进程创建新副本，更新页表映射。</li>
<li>此后，父子进程的相同虚拟地址指向 <strong>不同的物理内存</strong>。</li>
</ul>
</blockquote>
</li>
</ol>
</li>
<li><p><strong>地址相同的本质</strong></p>
<ul>
<li>虚拟地址是进程内部的逻辑地址，由编译器和链接器在程序加载时确定。</li>
<li><strong>子进程继承父进程的虚拟地址布局</strong>，因此变量地址值相同。</li>
</ul>
</li>
</ol>
<blockquote>
<h3 id="主要了解虚拟地址，不做过多解释，点到为止："><a href="#主要了解虚拟地址，不做过多解释，点到为止：" class="headerlink" title="主要了解虚拟地址，不做过多解释，点到为止："></a><span style="font-weight:bold; color:#CC0000;">主要了解虚拟地址，不做过多解释，点到为止：</span></h3><h4 id="Q1：为什么子进程和父进程的-g-val-地址相同？"><a href="#Q1：为什么子进程和父进程的-g-val-地址相同？" class="headerlink" title="Q1：为什么子进程和父进程的 g_val 地址相同？"></a>Q1：为什么子进程和父进程的 <code>g_val</code> 地址相同？</h4><p>在 Linux 进程管理中，每个进程都有 <strong>独立的虚拟地址空间</strong>，但是多个进程可以在 <strong>各自的虚拟地址空间</strong> 中看到相同的地址。</p>
<p><strong><code>fork()</code> 之后，子进程获得了父进程的完整拷贝</strong>。<code>fork()</code> 会创建一个 <strong>新的进程</strong>，这个新进程的 <strong>地址空间</strong> 是 <strong>父进程的完整副本</strong>，由于子进程 <strong>继承了父进程的虚拟地址空间布局</strong>，<strong>它的全局变量 <code>g_val</code> 也会出现在相同的虚拟地址</strong>。</p>
<hr>
<h4 id="Q2：为什么数据相互独立？"><a href="#Q2：为什么数据相互独立？" class="headerlink" title="Q2：为什么数据相互独立？"></a>Q2：为什么数据相互独立？</h4><p>虽然子进程和父进程的变量 <strong>在虚拟地址上相同</strong>，但它们 <strong>实际上是两个独立的物理内存区域</strong>。</p>
</blockquote>
<h4 id="1-虚拟地址相同的根本原因：分页机制-——-类比为“字典”或“目录索引”"><a href="#1-虚拟地址相同的根本原因：分页机制-——-类比为“字典”或“目录索引”" class="headerlink" title="1. 虚拟地址相同的根本原因：分页机制 —— 类比为“字典”或“目录索引”"></a>1. 虚拟地址相同的根本原因：分页机制 —— 类比为“字典”或“目录索引”</h4><p><strong>上面的现象其实与分页机制有密切关系！</strong> 结合分页的概念再解释：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Linux/20250402135849980.png" alt="image-20250402135849830"></p>
<p>在 Linux 和大多数现代操作系统中，进程的 <strong>地址空间是基于“分页（Paging）”管理的</strong>。分页的作用主要是：</p>
<ol>
<li><strong>将进程的虚拟地址映射到物理地址</strong>，实现内存的高效管理。</li>
<li><strong>隔离进程的内存空间</strong>，不同进程看到的地址相同，但实际物理地址不同。</li>
</ol>
<h4 id="2-分页表（Page-Table）是如何运作的？"><a href="#2-分页表（Page-Table）是如何运作的？" class="headerlink" title="2. 分页表（Page Table）是如何运作的？"></a>2. 分页表（Page Table）是如何运作的？</h4><ul>
<li>在 Linux 的 <strong>分页机制</strong> 中，每个进程都有一个 <strong>页表（Page Table）</strong>，它 <strong>记录虚拟地址到物理地址的映射</strong>。</li>
<li><code>fork()</code> 后，子进程 <strong>的页表会复制父进程的页表</strong>，但两者 <strong>指向相同的物理页</strong>，直到发生 <strong>写操作</strong> 时，才会真正分配新物理页。</li>
</ul>
<h4 id="3-分页是如何影响-fork-的？"><a href="#3-分页是如何影响-fork-的？" class="headerlink" title="3. 分页是如何影响 fork() 的？"></a>3. 分页是如何影响 <code>fork()</code> 的？</h4><ul>
<li><code>fork()</code> 后，子进程会 <strong>继承父进程的虚拟地址空间</strong>，因此在 <strong>虚拟地址</strong> 层面，它们的全局变量 <code>g_val</code> 地址相同（<code>0x601054</code>）。</li>
<li>但是，操作系统 <strong>并不会立即复制父进程的所有物理内存页</strong>，而是采用 <strong>写时复制（Copy-On-Write, COW）</strong> 机制。</li>
</ul>
<p><strong>示意图（分页机制 + COW）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">父进程：</span><br><span class="line">+------------+      +------------+</span><br><span class="line">| 0x601054   | ---&gt; | 物理页 A   |</span><br><span class="line">+------------+      +------------+</span><br><span class="line"></span><br><span class="line">子进程（fork后）：</span><br><span class="line">+------------+      +------------+</span><br><span class="line">| 0x601054   | ---&gt; | 物理页 A   | （共享）</span><br><span class="line">+------------+      +------------+</span><br><span class="line"></span><br><span class="line">子进程（修改 g_val = 200 后）：</span><br><span class="line">+------------+      +------------+     +------------+</span><br><span class="line">| 0x601054   | ---&gt; | 物理页 B   |     | 物理页 A   |</span><br><span class="line">+------------+      +------------+     +------------+</span><br><span class="line">  (子进程获得新的物理页)      (父进程的物理页)</span><br></pre></td></tr></table></figure>

<h4 id="4-fork-分页-COW-的关系"><a href="#4-fork-分页-COW-的关系" class="headerlink" title="4. fork() + 分页 + COW 的关系"></a>4. fork() + 分页 + COW 的关系</h4><table>
<thead>
<tr>
<th><strong>机制</strong></th>
<th><strong>影响</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>分页</strong></td>
<td>每个进程有独立的虚拟地址空间，但可以共享物理页。</td>
</tr>
<tr>
<td><strong>页表（Page Table）</strong></td>
<td>记录虚拟地址到物理地址的映射，fork() 后子进程继承父进程的页表。</td>
</tr>
<tr>
<td><strong>写时复制（COW）</strong></td>
<td>直到子进程或父进程修改数据时，才会真正分配新的物理内存页。</td>
</tr>
<tr>
<td><strong>进程隔离</strong></td>
<td>虽然地址相同，但修改数据后，两者的物理页不再共享。</td>
</tr>
</tbody></table>
<hr>
<h3 id="4-小结"><a href="#4-小结" class="headerlink" title="4. 小结"></a>4. 小结</h3><ul>
<li><p><strong>程序地址空间：</strong> 是操作系统为每个进程分配的 <strong>虚拟内存布局</strong>，决定了代码、数据、堆、栈等区域的访问方式。</p>
</li>
<li><p><strong>虚拟地址相同，但物理地址可能不同</strong>：fork() 只是复制了 <strong>页表</strong>，不会立即复制物理内存，直到子进程写入数据。</p>
</li>
<li><p><strong>虚拟地址 ≠ 物理地址</strong>：程序看到的是虚拟地址，由操作系统通过 <strong>MMU（内存管理单元）</strong> 动态映射到物理内存。</p>
</li>
<li><p><strong>分页 + COW 机制确保内存效率</strong>：避免了不必要的物理内存复制，只有修改数据时才会真正分配新内存。</p>
</li>
</ul>
<p><strong>总结一句话：虚拟地址是“门牌号”，物理地址是“真实房屋”。</strong> <code>fork()</code> 后，父子进程共享“门牌号目录”（页表），但“房屋”（物理内存）仅在需要时复制（COW），从而实现高效隔离。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://github.com/huangcancan-xbc/Drawing-bed/blob/master/Blog/20250307201719879.png?raw=true" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://github.com/huangcancan-xbc/Drawing-bed/blob/master/Blog/20250307201719879.png?raw=true" title="头像" alt="头像"></a><div class="post-copyright__author_name">小米里的大麦</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://www.minbit.top/posts/45500.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://www.minbit.top/posts/45500.html')">015 程序地址空间入门</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250403212543768.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250403212543768.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250403212622868.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250403212622868.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.minbit.top/posts/45500.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=015 程序地址空间入门&amp;url=https://www.minbit.top/posts/45500.html&amp;pic=https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250817000335747.png?_r_=f9ed3ca5-8fd6-6b7e-e417-b4708dd0def1" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">MIT</a> 许可协议。转载请注明来自 <a href="https://www.minbit.top" target="_blank">小米里的大麦</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Linux<span class="tagsPageCount">40</span></a><a class="post-meta__box__tags" href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>地址空间<span class="tagsPageCount">6</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250314125732989.png?_r_=f87ecec0-1207-3ec8-2388-061da265b5ff" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/14630.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250314125923408.png?_r_=bd06cf16-0367-4cd3-d164-5d2bcc00d0ec" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">014 Linux 2.6内核进程调度队列（了解）</div></div></a></div><div class="next-post pull-right"><a href="/posts/9600.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250314125732989.png?_r_=5102993b-89c4-abbd-51df-61a03b6eda21" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">016 进程控制 —— 进程创建</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/28370.html" title="019 进程控制 —— 进程程序替换"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250314130519403.jpg?_r_=844b3212-d26c-70c7-81cc-cce66d22a83e" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-04-22</div><div class="title">019 进程控制 —— 进程程序替换</div></div></a></div><div><a href="/posts/6493.html" title="027 动静态库 —— 静态库"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250817000335747.png?_r_=e562082b-35aa-afeb-801c-f9710d51d930" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-21</div><div class="title">027 动静态库 —— 静态库</div></div></a></div><div><a href="/posts/14104.html" title="028 动静态库 —— 动态库"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250314140243649.png?_r_=7a284260-93bc-13f9-edbd-0c895bc79cf7" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-25</div><div class="title">028 动静态库 —— 动态库</div></div></a></div><div><a href="/posts/9524.html" title="034 进程间通信 —— System V 共享内存"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250314130519403.jpg?_r_=4be24c95-9940-144f-a8c4-efb2de78680b" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-14</div><div class="title">034 进程间通信 —— System V 共享内存</div></div></a></div><div><a href="/posts/15091.html" title="038 进程信号 —— 信号的处理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250817000335747.png?_r_=f4552bad-fc46-8415-2b05-498a37f053f8" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-20</div><div class="title">038 进程信号 —— 信号的处理</div></div></a></div><div><a href="/posts/42463.html" title="003 系统和入门指令"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250314130519403.jpg?_r_=1760cd29-8630-c4e6-186c-813deb394a2c" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-22</div><div class="title">003 系统和入门指令</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://github.com/huangcancan-xbc/Drawing-bed/blob/master/Blog/20250307201719879.png?raw=true" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description">时间好像总会留下点什么,或许是一个人,或许是一个梦,或许……是一段有意义的经历~</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">小米里的大麦</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/huangcancan-xbc" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~<br></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text">程序地址空间入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4%E7%9A%84%E5%88%92%E5%88%86"><span class="toc-number">1.1.</span> <span class="toc-text">1. 地址空间的划分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%86%85%E6%A0%B8%E7%A9%BA%E9%97%B4%EF%BC%88Kernel-Space%EF%BC%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">1. 内核空间（Kernel Space）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E4%B8%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%8C%BA"><span class="toc-number">1.1.2.</span> <span class="toc-text">2. 命令行参数与环境变量区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%A0%88%EF%BC%88Stack%EF%BC%89"><span class="toc-number">1.1.3.</span> <span class="toc-text">3. 栈（Stack）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BF%9D%E6%8A%A4%E9%A1%B5%EF%BC%88Guard-Page%EF%BC%89"><span class="toc-number">1.1.4.</span> <span class="toc-text">4. 保护页（Guard Page）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84%E6%AE%B5%EF%BC%88Memory-Mapping-Segment%EF%BC%89"><span class="toc-number">1.1.5.</span> <span class="toc-text">5. 内存映射段（Memory Mapping Segment）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%A0%86%EF%BC%88Heap%EF%BC%89"><span class="toc-number">1.1.6.</span> <span class="toc-text">6. 堆（Heap）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-BSS-%E6%AE%B5%EF%BC%88%E6%9C%AA%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E6%AE%B5%EF%BC%89"><span class="toc-number">1.1.7.</span> <span class="toc-text">7. BSS 段（未初始化数据段）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E6%95%B0%E6%8D%AE%E6%AE%B5%EF%BC%88%E5%B7%B2%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E6%AE%B5%EF%BC%89"><span class="toc-number">1.1.8.</span> <span class="toc-text">8. 数据段（已初始化数据段）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E6%96%87%E6%9C%AC%E6%AE%B5%EF%BC%88Text-Segment%EF%BC%89"><span class="toc-number">1.1.9.</span> <span class="toc-text">9. 文本段（Text Segment）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%9E%E9%AA%8C%E8%AF%81%E6%98%8E"><span class="toc-number">1.2.</span> <span class="toc-text">2. 实验证明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80-VS-%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80"><span class="toc-number">1.3.</span> <span class="toc-text">3. 虚拟地址 VS 物理地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E4%BA%86%E8%A7%A3%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%EF%BC%8C%E4%B8%8D%E5%81%9A%E8%BF%87%E5%A4%9A%E8%A7%A3%E9%87%8A%EF%BC%8C%E7%82%B9%E5%88%B0%E4%B8%BA%E6%AD%A2%EF%BC%9A"><span class="toc-number">1.4.</span> <span class="toc-text">主要了解虚拟地址，不做过多解释，点到为止：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Q1%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AD%90%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%88%B6%E8%BF%9B%E7%A8%8B%E7%9A%84-g-val-%E5%9C%B0%E5%9D%80%E7%9B%B8%E5%90%8C%EF%BC%9F"><span class="toc-number">1.4.1.</span> <span class="toc-text">Q1：为什么子进程和父进程的 g_val 地址相同？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Q2%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E6%95%B0%E6%8D%AE%E7%9B%B8%E4%BA%92%E7%8B%AC%E7%AB%8B%EF%BC%9F"><span class="toc-number">1.4.2.</span> <span class="toc-text">Q2：为什么数据相互独立？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E7%9B%B8%E5%90%8C%E7%9A%84%E6%A0%B9%E6%9C%AC%E5%8E%9F%E5%9B%A0%EF%BC%9A%E5%88%86%E9%A1%B5%E6%9C%BA%E5%88%B6-%E2%80%94%E2%80%94-%E7%B1%BB%E6%AF%94%E4%B8%BA%E2%80%9C%E5%AD%97%E5%85%B8%E2%80%9D%E6%88%96%E2%80%9C%E7%9B%AE%E5%BD%95%E7%B4%A2%E5%BC%95%E2%80%9D"><span class="toc-number">1.4.3.</span> <span class="toc-text">1. 虚拟地址相同的根本原因：分页机制 —— 类比为“字典”或“目录索引”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%86%E9%A1%B5%E8%A1%A8%EF%BC%88Page-Table%EF%BC%89%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%90%E4%BD%9C%E7%9A%84%EF%BC%9F"><span class="toc-number">1.4.4.</span> <span class="toc-text">2. 分页表（Page Table）是如何运作的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%86%E9%A1%B5%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D-fork-%E7%9A%84%EF%BC%9F"><span class="toc-number">1.4.5.</span> <span class="toc-text">3. 分页是如何影响 fork() 的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-fork-%E5%88%86%E9%A1%B5-COW-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.4.6.</span> <span class="toc-text">4. fork() + 分页 + COW 的关系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%B0%8F%E7%BB%93"><span class="toc-number">1.5.</span> <span class="toc-text">4. 小结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/21804.html" title="040 线程控制"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250314125732989.png?_r_=f87ecec0-1207-3ec8-2388-061da265b5ff" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="040 线程控制"/></a><div class="content"><a class="title" href="/posts/21804.html" title="040 线程控制">040 线程控制</a><time datetime="2025-07-23T04:00:00.000Z" title="发表于 2025-07-23 12:00:00">2025-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/25951.html" title="039 线程概念"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250314131841400.png?_r_=d5f57296-ee27-f05b-9318-9da2259607c8" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="039 线程概念"/></a><div class="content"><a class="title" href="/posts/25951.html" title="039 线程概念">039 线程概念</a><time datetime="2025-07-21T04:00:00.000Z" title="发表于 2025-07-21 12:00:00">2025-07-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/15091.html" title="038 进程信号 —— 信号的处理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250817000335747.png?_r_=f4552bad-fc46-8415-2b05-498a37f053f8" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="038 进程信号 —— 信号的处理"/></a><div class="content"><a class="title" href="/posts/15091.html" title="038 进程信号 —— 信号的处理">038 进程信号 —— 信号的处理</a><time datetime="2025-07-20T04:00:00.000Z" title="发表于 2025-07-20 12:00:00">2025-07-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7454.html" title="037 进程信号 —— 信号的保存"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250314140243649.png?_r_=ae29995e-12be-9a09-7943-5acc5dd98246" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="037 进程信号 —— 信号的保存"/></a><div class="content"><a class="title" href="/posts/7454.html" title="037 进程信号 —— 信号的保存">037 进程信号 —— 信号的保存</a><time datetime="2025-07-19T04:00:00.000Z" title="发表于 2025-07-19 12:00:00">2025-07-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/62794.html" title="036 进程信号 —— 信号的产生"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/huangcancan-xbc/Drawing-bed@master/Blog/20250314125732989.png?_r_=62a12455-cb57-9563-387b-19d67f073c0f" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="036 进程信号 —— 信号的产生"/></a><div class="content"><a class="title" href="/posts/62794.html" title="036 进程信号 —— 信号的产生">036 进程信号 —— 信号的产生</a><time datetime="2025-07-17T04:10:00.000Z" title="发表于 2025-07-17 12:10:00">2025-07-17</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:hc1960074081@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://weibo.com/u/7913790969" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://github.com/huangcancan-xbc/Drawing-bed/blob/master/Blog/20250307201719879.png?raw=true" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="小米里的大麦" target="_blank">小米里的大麦</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["《左传》载曰：“太上有立德，其次有立功，其次有立言，虽久不废，此之谓不朽。”","纸上得来终觉浅，绝知此事要躬行！","你太专注于未来，却没有意识到，今天正是你多年前祈求的模样，因为你眺望远方视而不见。","梦想是不会发光的，发光的是追梦的你！"]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub主页">GitHub主页</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">54</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">社交</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="哔哩哔哩"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="哔哩哔哩"/><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/huang-cancan-xbc" title="Gitee"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="Gitee"/><span class="back-menu-item-text">Gitee</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.csdn.net/Huangcancan666?type=blog" title="CSDN"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="CSDN"/><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3230789931118109" title="稀土掘金"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="稀土掘金"/><span class="back-menu-item-text">稀土掘金</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 外链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 0.88rem;">C++<sup>8</sup></a><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>3</sup></a><a href="/tags/IO/" style="font-size: 0.88rem;">IO<sup>3</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>40</sup></a><a href="/tags/Obsidian/" style="font-size: 0.88rem;">Obsidian<sup>1</sup></a><a href="/tags/STL/" style="font-size: 0.88rem;">STL<sup>2</sup></a><a href="/tags/VS-Code/" style="font-size: 0.88rem;">VS Code<sup>1</sup></a><a href="/tags/%E4%BF%A1%E5%8F%B7/" style="font-size: 0.88rem;">信号<sup>3</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">内存管理<sup>1</sup></a><a href="/tags/%E5%8E%86%E7%A8%8B/" style="font-size: 0.88rem;">历程<sup>1</sup></a><a href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" style="font-size: 0.88rem;">地址空间<sup>6</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 0.88rem;">数学<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size: 0.88rem;">模板<sup>1</sup></a><a href="/tags/%E7%AE%A1%E9%81%93/" style="font-size: 0.88rem;">管道<sup>2</sup></a><a href="/tags/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" style="font-size: 0.88rem;">类与对象<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">线程<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size: 0.88rem;">网站<sup>2</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size: 0.88rem;">进程<sup>15</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("01/01/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 小米里的大麦 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-olive-one.vercel.app/',
      // 自己额外添加的：
      path: location.pathname.replace(/index\.html$/, ''),
      
      region: 'ap-shanghai',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.44/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-olive-one.vercel.app/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo-olive-one.vercel.app/',
        region: 'ap-shanghai',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.44/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "xiaomilidedamai@minbit.top";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="https://cdn.bootcdn.net/ajax/libs/echarts/4.9.0-rc.1/echarts.min.js"></script><script src="/js/footer-animal.js" defer></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="offer,暴富,健康,offer,喜乐,成功,offer,好运,自由,offer,坚持,上岸" data-fontsize="20px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script><script>//- 留言板页面弹幕
window.addEventListener('load', () => {
  const getnaokuo_danmu = () => {
    if (!window.location.pathname.startsWith('/comments/')) return; //- 判断是否是留言板页面
    const naokuo_danmu = async () => {
      const Danmaku = new EasyDanmaku({
        page: '/comments/', //- 即留言板地址
        el: '#danmu-wrap', //- 弹幕挂载节点
        line: 5, //- 弹幕行数
        speed: 20, //- 弹幕播放速度
        hover: true, //- 鼠标hover时是否暂停播放弹幕
        loop: false, //- 开启循环播放
        colourful: true, //- 开启彩色弹幕
        coefficient: 1.38, //- 弹幕密度系数
        runtime: 10, //- 循环弹幕播放时长
      });
      try {
        let danmuStore = saveToLocal.get('twikoo-danmu');
        if (!danmuStore) {
          const options = {
            method: "POST",
            body: JSON.stringify({
              "event": "GET_RECENT_COMMENTS",
              "includeReply": false,
              "pageSize": 100
            }),
            headers: { 'Content-Type': 'application/json' }
          }
          danmuStore = [];
          const response = await fetch(`https://twikoo-olive-one.vercel.app/`, options);
          if (response.ok) {
            const { data } = await response.json();
            //- console.info(data);
            data.forEach(i => {
              if (i.avatar == undefined) i.avatar = 'https://cravatar.cn/avatar/d615d5793929e8c7d70eab5f00f7f5f1?d=mp'
              danmuStore.push({ avatar: i.avatar, content: i.nick + '：' + formatDanmaku(i.comment), url: i.url + '#' + i.id })
            });
            Danmaku.batchSend(danmuStore, true);
            saveToLocal.set('twikoo-danmu', danmuStore, 0.5)
          }
          //- 格式化评论
          function formatDanmaku(str) {
            str = str.replace(/<\/*br>|[\s\uFEFF\xA0]+/g, '');
            str = str.replace(/<img.*?>/g, '[图片]');
            str = str.replace(/<a.*?>.*?<\/a>/g, '[链接]');
            str = str.replace(/<pre.*?>.*?<\/pre>/g, '[代码块]');
            str = str.replace(/<.*?>/g, '');
            return str
          }
        } else {
          Danmaku.batchSend(danmuStore, true);
        }
      } catch (err) {
        console.error("Error fetching data:", err);
      }

      document.getElementById('danmu-Btn') && (document.getElementById('danmu-Btn').innerHTML = `<button class="hide-Btn" onclick="document.getElementById('danmu-wrap').classList.remove('hide-danmu')">显示弹幕</button> <button class="hide-Btn" onclick="document.getElementById('danmu-wrap').classList.add('hide-danmu')">隐藏弹幕</button>`)
    }
    (async () => {
      if (typeof EasyDanmaku === 'function') {
        await naokuo_danmu();
      } else {
        const easyDanmakuScript = await getScript('https://npm.onmicrosoft.cn/naokuo-blog@1.2.12/js/easy-Danmaku.js');
        if (typeof EasyDanmaku === 'function') {
          await naokuo_danmu();
        } else {
          console.error('EasyDanmaku function not found even after loading the script.');
        }
      }
    })();
  }
  getnaokuo_danmu()
  document.addEventListener('pjax:complete', getnaokuo_danmu)
})</script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>