<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>011 Linux进程 | 小米里的大麦</title><meta name="keywords" content="Linux,进程"><meta name="author" content="小米里的大麦"><meta name="copyright" content="小米里的大麦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="011 Linux进程"><meta name="application-name" content="011 Linux进程"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="011 Linux进程"><meta property="og:url" content="https://www.minbit.top/posts/4610.html"><meta property="og:site_name" content="小米里的大麦"><meta property="og:description" content="深入理解 Linux 进程管理一、管理哲学&amp;#x2F;本质：先描述，再组织（校长如何管理学校？）一个操作系统不仅仅只能运行一个进程，可以同时运行多个进程。操作系统的进程管理：先描述，在组织 → 任何一个进程。在操作系统中，管理任何对象，最终都可以转化成为对某种数据结构的增删查改。想象你是一所大学的校"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://zycs-img-8kd.pages.dev/v2/uH1MN2u.png?_r_=d8aca62d-f18a-5698-334e-3d14589b8ae1"><meta property="article:author" content="小米里的大麦"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://zycs-img-8kd.pages.dev/v2/uH1MN2u.png?_r_=d8aca62d-f18a-5698-334e-3d14589b8ae1"><meta name="description" content="深入理解 Linux 进程管理一、管理哲学&amp;#x2F;本质：先描述，再组织（校长如何管理学校？）一个操作系统不仅仅只能运行一个进程，可以同时运行多个进程。操作系统的进程管理：先描述，在组织 → 任何一个进程。在操作系统中，管理任何对象，最终都可以转化成为对某种数据结构的增删查改。想象你是一所大学的校"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://www.minbit.top/posts/4610.html"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="Cd-RTVhRO2mndEhicN2cvLXbsNxPqFC6fSn6ql80eVg"/><meta name="baidu-site-verification" content="codeva-ZG3S9QTvGO"/><meta name="msvalidate.01" content="6DF744D82FE6D1FD11CE18658760B59D"/><meta name="baidu-site-verification" content="codeva-gIjOMzUuhV"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"/><link rel="mask-icon" href="/img/siteicon/apple-icon-180.png" color="#5bbad5"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-icon-180.png"/><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-icon-180.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="bookmark" href="/img/siteicon/apple-icon-180.png"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"友链 + 外链 + 无限进步！欢迎欣赏和贡献！","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"小米里的大麦","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":4,"basicWordCount":1999,"key":"93d1622eadde491eb0594b68ade51723.kaEiDD6A3KPzb7xv","Referer":"https://www.minbit.top/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"Jp8wwGQpp21utaFQ","LingQueMonitorID":"Jp8ztDRrxmTf7LDj"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo-olive-one.vercel.app/',
  commentBarrageConfig:{"enable":true,"maxBarrage":10,"barrageTime":5000,"accessToken":"25c96851dd8a790c4819ad4bfbaf153c","mailMd5":"7b12ebc2be80f9159099f6ab0e16573c"},
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"both","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🧐 准备中，就快好了，真的！😭","📚 正在学习中，加油！","🎵 喜欢听音乐，喜欢看动漫"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 小米里的大麦","link":"链接: ","source":"来源: 小米里的大麦","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '小米里的大麦',
  title: '011 Linux进程',
  postAI: '这篇文章讲述了Linux进程管理的核心哲学与实现机制，通过类比学校管理学生的方式，阐述了操作系统如何通过数据结构（如`task_struct`）描述、组织和管理进程。文章详细解释了进程的定义，强调进程是动态的程序运行实例，与静态的程序代码不同，每个进程都有唯一的PCB（进程控制块）存储其所有属性。深入解析了Linux中`task_struct`的结构，包括关键字段如PID、状态、优先级、程序计数器、上下文、内存与资源信息、I/O状态、记账信息等，并解释了这些字段的作用。文章还介绍了如何组织进程，即通过链表等数据结构在内核中管理`task_struct`，以及如何查看进程，包括使用`ps`、`top`、`htop`等命令和系统调用获取进程标识符。最后，文章详细讲解了`fork()`系统调用，解释了其工作原理、返回值的意义、父子进程内存共享机制（COW）以及创建子进程的目的和调度策略，强调了`fork()`在并行执行任务和隔离风险中的重要性。',
  pageFillDescription: '深入理解 Linux 进程管理, 一、管理哲学x2F本质：先描述再组织（校长如何管理学校？）, 二、进程的定义与核心概念, 1. 什么是进程？, 2. 进程管理的核心：进程控制块（PCB）, 三、Linux 的 task_struct 详解（进程控制块的实现）, 1. task_struct 的结构（进程的 DNA）, 关键字段解析（下面详解）：, 1. 标识符（Identity）, 2. 状态（State）, 3. 优先级（Priority）, 4. 程序计数器（Program Counter）, 5. 上下文（Context）, 6. 内存与资源信息, 7. Ix2FO 状态, 8. 记账信息（Accounting）, 9. 其他信息, 四、组织进程, 五、查看进程, 1. 查看进程方法, 1. ps 相关命令, 2. top 相关命令（按 q 退出）, 3. htop 相关命令, 4. 其他进程相关命令, 5. /proc 文件系统, 2. 通过系统调用获取进程标识符, 3. fork() 创建进程详解, 1. 为什么 fork() 给子进程返回 0给父进程返回子进程的 PID？, 2. fork() 作为一个函数为什么能返回两次？如何理解？, 3. 为什么同一个变量在父子进程里内容不同？, 4. fork() 究竟在干什么？系统中多了一个进程吗？, 5. 为什么要创建子进程？, 6. fork()  后谁先运行？, 六、扩展思考, Q1：为什么进程不需要直接与内核交互？, Q2：如何查看进程的 task_struct？, Q3：多个进程如何共享 CPU？深入理解进程管理一管理哲学本质先描述再组织校长如何管理学校一个操作系统不仅仅只能运行一个进程可以同时运行多个进程操作系统的进程管理先描述在组织任何一个进程在操作系统中管理任何对象最终都可以转化成为对某种数据结构的增删查改想象你是一所大学的校长管理数万名学生你不需要认识每个学生只需通过学生档案系统管理描述每个学生有专属档案学号姓名专业成绩宿舍号组织档案按学院专业班级形成链表结构管理调整专业只需修改档案中的专业字段开除学生只需删除对应档案增删查改操作系统管理进程同理描述为每个进程创建进程的档案组织通过链表队列等数据结构管理所有控制调整优先级终止进程等操作只需修改对应结构体数据结构的作用学校学生档案链表管理学生增删查改如入学转班退学操作系统进程链表管理进程的创建调度终止等二进程的定义与核心概念什么是进程进程程序员自己写的代码和数据内核数据结构对象描述进程的所有数据进程控制块程序程序员编写的代码如编译后的可执行文件进程程序被加载到内存中运行的实例如运行后生成的进程关键点进程是动态的程序本身是静态文件进程是运行时的实体每个进程都有自己的进程控制块存储进程的所有信息进程管理的核心进程控制块的作用记录进程的所有属性帮助内核管理进程中的名为的结构体语言中的结构体类比就像学生的学籍档案记录了学号成绩班级状态等三的详解进程控制块的实现的结构进程的在内核中进程属性的集合是一个庞大的结构体约有数百个字段是内核的一种数据结构它会被装载到内存里并且包含着进程的信息简化版结构内核真实结构复杂得多身份证号进程唯一标识当前状态睡觉跑步待机等级优先级家庭住址内存分配情况随身物品打开的文件相关指针信息上百个字段关键字段解析下面详解字段类比作用学号唯一标识进程查看学生状态上课请假进程状态运行睡眠僵尸等奖学金等级优先级高的进程优先使用命令调整宿舍分配表记录进程使用的内存空间代码段数据段堆栈等书包里的书本记录进程打开的所有文件查看上下文数据课堂笔记保存寄存器的值用于中断后恢复现场标识符进程唯一标识符类似学生的学号每个进程有唯一的通过命令可见父进程记录该进程的父进程形成父子进程关系类比学生档案中记录班主任的工号状态进程状态进程当前所处的阶段包括运行态正在上执行就绪态等待调度到上运行阻塞态等待如读写文件等待信号等终止态进程已结束但父进程未回收其资源成为僵尸字段示例进程状态如进程退出时的返回值优先级调度优先级决定进程获得时间的权重值用户可调整的优先级值越低优先级越高实时优先级用于需要严格实时性的进程如音频播放字段示例值到默认调度策略如普通进程程序计数器寄存器状态记录进程执行到的位置程序计数器指向当前指令的下一条指令的地址其他寄存器如栈指针基指针等保存进程执行现场作用当进程被中断如切换到其他进程内核会保存这些寄存器的值以便恢复执行上下文上下文数据进程执行时的所有硬件寄存器的值类比学生临时离开教室前记录自己写到哪页笔记用哪支笔保存场景当进程被中断如请求内核将寄存器值保存到恢复场景当进程重新调度到时内核恢复这些寄存器值继续执行内存与资源信息内存指针记录进程的代码数据堆栈的内存地址代码段段程序指令的内存区域数据段段全局变量堆栈等共享内存与其他进程共享的内存块指针资源列表打开的文件描述符如分配的设备如设备状态请求队列记录进程等待的操作如读取硬盘分配的设备进程当前占用的硬件设备记账信息时间统计用户模式下消耗的时间内核模式下消耗的时间时间限制如进程允许的最大运行时间记账用户记录进程属于哪个用户如或普通用户其他信息信号处理记录进程如何处理信号如终止信号线程信息如果是多线程程序记录线程组信息调度队列指针指向进程所在的就绪队列或阻塞队列四组织进程可以在内核源代码里找到它所有运行在系统里的进程都以链表等非常复杂的数据结构的形式存在内核里五查看进程查看进程方法在中进程是正在运行的程序实例查看进程的常用命令有最常用的进程查看工具适合快速查看进程快照静态结果输出动态监控进程适合实时观察系统状态动态查看进程变化默认秒更新增强版界面更友好适合交互式操作其他命令如等适合精准定位进程相关命令当直接输入而不带任何参数时命令会仅显示当前终端会话中的进程即与当前终端关联的进程输出内容较为简洁仅包含以下字段进程进程关联的终端如表示伪终端进程占用的时间启动进程的命令名及参数命令选项说明示例常用度显示所有用户的进程包含详细信息用户内存等显示全格式进程信息更详细的进程信息常用于系统管理和脚本含显示所有进程用户显示指定用户的进程显示指定的进程信息按需展示特定字段常与结合使用如等按指定字段排序如内存以树状结构显示进程相关命令按退出命令选项说明示例常用度实时动态查看进程状态类似任务管理器显示完整命令路径监控指定的进程用户监控指定用户的进程以批处理模式运行输出到文件次数指定刷新次数后退出相关命令命令选项说明示例常用度增强版支持鼠标操作和颜色高亮需安装用户显示指定用户的进程显示指定的进程秒设置刷新间隔时间其他进程相关命令命令选项说明示例常用度根据名称查找支持模糊匹配显示进程名和根据精确进程名查找以树状结构显示进程关系需安装终止指定进程强制杀死进程文件系统命令路径说明示例常用度查看进程的详细状态信息查看进程的启动命令查看进程对应的可执行文件查看进程打开的文件描述符通过系统调用获取进程标识符程序示例提供和获取当前进程当前进程获取父进程父进程睡眠秒编译运行示例输出当前进程父进程创建进程详解摘自鸟哥的私房菜基础学习篇第四版页的程序调用通常成为的流程进程都会借父进程以复制的方式产生一个一模一样的子进程然后被复制出来的子进程再以的方式来执行实际要执行的进程最终就成为一个子进程基础示例代码创建子进程失败将标准错误输出的信息改为中文子进程父进程子进程中打印的信息改为中文父进程创建的子进程父进程中打印的信息改为中文示例输出父进程创建的子进程子进程父进程注意输出顺序可能不固定取决于系统调度再看下面一个示例我是一个进程子进程我是子进程父进程我是父进程示例输出我是一个进程我是父进程我是子进程我是父进程我是子进程我是子进程为什么给子进程返回给父进程返回子进程的的目的是创建一个几乎完全相同的子进程一般而言之后的代码父子共享让父子进程执行不同的代码分支通过返回值区分父子进程的身份父进程需要知道子进程的以便后续管理如等待子进程退出发送信号等子进程无需知道自己的可通过获取但需要明确自己是子进程返回是最直接的方式实现意义父进程通过子进程可以追踪控制子进程如子进程通过返回值知道自己是被创建的一方从而执行子进程独有的逻辑总结父进程通过返回值区分子进程子进程通过返回值确认自己是子进程作为一个函数为什么能返回两次如何理解本质上只调用一次但返回两次调用后操作系统会复制父进程创建一个新的子进程父进程继续从返回得到子进程的子进程从返回得到示意图父进程执行子进程诞生返回子进程返回看似一次调用返回两次实际是两个独立的进程分别执行了后的代码可以把想象成一颗分叉的树调用时是同一条路径但执行后分成了两条路各自独立运行为什么同一个变量在父子进程里内容不同调用时子进程不会立即复制父进程的内存而是共享同一份物理内存标记为只读当父子进程修改内存时操作系统才会复制被修改的页内存页的最小单位具体来说就是当被调用时代码段父子进程共享这部分内存不需要复制毕竟代码是静态的读操作不会影响对方数据段堆栈父子进程看起来各自独立但实际上系统不会立刻复制这部分内存取而代之的是机制父子进程最开始共享同一片物理内存这些内存页被标记为只读写时复制当父或子进程试图写入这片内存时操作系统才会触发页面复制分配新的内存页供写操作独享这种机制大幅优化了的性能因为如果父子进程不修改内存根本就不用复制节省了大量资源综上之后父子进程共享代码段但数据堆栈在写操作时会触发写时复制举个例子子进程子进程共享内存输出写操作触发写时复制子进程独享这片内存子进程修改后父进程让子进程先跑父进程父进程的仍然是未受子进程影响输出子进程子进程修改后父进程解释之后父子进程共享内存的初始值对父子都可见子进程写入时触发系统为子进程分配新内存页把原来内存页的值复制过来子进程修改自己的副本父进程继续使用原来的内存页所以父子进程的从此各自独立互不干扰因为它们的内存空间已经分开各玩各的注如果想让父子进程共享数据得用专门的共享内存机制如究竟在干什么系统中多了一个进程吗是的让系统里多了一个新进程可通过命令观察到子进程的存在程序名它做了这几件事复制父进程的内存空间代码段数据段堆栈等全部复制子进程看起来和父进程几乎一模一样复制父进程的进程控制块生成子进程的复制父进程的虚拟地址空间通过写时复制优化分配新的进程子进程有独立的同时保留父进程的独立调度子进程作为独立的进程被调度和父进程各自执行互不干扰所以之后系统里确实多了一个进程但它们起点一致只是接下来的执行路径可能不同为什么要创建子进程创建子进程的目的是并行执行不同的任务常见用途有后台任务如守护进程服务器父进程处理请求子进程负责具体工作任务分解父进程分配工作子进程完成任务隔离风险子进程失败不会影响父进程避免整个程序崩溃简单来说父进程管理子进程干活井井有条后谁先运行这个是不确定的谁先运行完全取决于操作系统的调度策略父子进程创建完成后由操作系统的调度器决定执行顺序可能父进程先运行也可能子进程先运行甚至交替执行所以谁先跑随缘操作系统说了算让操作系统的调度器决定它才是调度大哥六扩展思考为什么进程不需要直接与内核交互答内核通过间接管理进程就像校长通过学生档案管理学生进程只需执行代码内核通过数据结构记录状态并决策如何查看进程的答用户态无法直接访问但可以通过以下命令间接查看显示状态内存使用虚拟文件系统如包含进程的详细信息映射字段多个进程如何共享答通过调度算法在间切换完全公平调度基于虚拟运行时间决定进程优先级实时调度策略如先进先出和时间片轮转调度相关字段中的调度策略动态优先级静态优先级',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-03-24 16:10:00',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 10 || hour >= 20
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/custom/css/font.css"><link rel="stylesheet" href="/custom/css/bilibili.css"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://zycs-img-8kd.pages.dev/v2/bFRjgdX.jpeg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">社交</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="哔哩哔哩"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="哔哩哔哩"/><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/huang-cancan-xbc" title="Gitee"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="Gitee"/><span class="back-menu-item-text">Gitee</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.csdn.net/Huangcancan666?type=blog" title="CSDN"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="CSDN"/><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3230789931118109" title="稀土掘金"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="稀土掘金"/><span class="back-menu-item-text">稀土掘金</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">小米里的大麦</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 外链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div id="nav-naoDark"><div class="container"><div class="components"><div class="main-button"><div class="moon"></div><div class="moon"></div><div class="moon"></div></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="cloud"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="cloud-light"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="stars"><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div></div></div></div></div><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://zycs-img-8kd.pages.dev/v2/REbVGGL.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/REbVGGL.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://zycs-img-8kd.pages.dev/v2/1UUolM0.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/1UUolM0.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 1.05rem;">C++<sup>8</sup></a><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>3</sup></a><a href="/tags/IO/" style="font-size: 1.05rem;">IO<sup>3</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>50</sup></a><a href="/tags/Obsidian/" style="font-size: 1.05rem;">Obsidian<sup>1</sup></a><a href="/tags/STL/" style="font-size: 1.05rem;">STL<sup>2</sup></a><a href="/tags/VS-Code/" style="font-size: 1.05rem;">VS Code<sup>1</sup></a><a href="/tags/%E4%BF%A1%E5%8F%B7/" style="font-size: 1.05rem;">信号<sup>3</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">内存管理<sup>1</sup></a><a href="/tags/%E5%8E%86%E7%A8%8B/" style="font-size: 1.05rem;">历程<sup>1</sup></a><a href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" style="font-size: 1.05rem;">地址空间<sup>6</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 1.05rem;">数学<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size: 1.05rem;">模板<sup>1</sup></a><a href="/tags/%E7%AE%A1%E9%81%93/" style="font-size: 1.05rem;">管道<sup>2</sup></a><a href="/tags/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" style="font-size: 1.05rem;">类与对象<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">线程<sup>4</sup></a><a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size: 1.05rem;">网站<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>6</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size: 1.05rem;">进程<sup>15</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">八月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div id="console-naoDark"><div class="container"><div class="components"><div class="main-button"><div class="moon"></div><div class="moon"></div><div class="moon"></div></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="daytime-backgrond"></div><div class="cloud"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="cloud-light"><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div><div class="cloud-son"></div></div><div class="stars"><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star big"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star medium"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div><div class="star small"><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div><div class="star-son"></div></div></div></div></div></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Linux</span></a><a class="article-meta__tags" href="/tags/%E8%BF%9B%E7%A8%8B/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>进程</span></a></span></div></div><h1 class="post-title" itemprop="name headline">011 Linux进程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-03-24T07:50:00.000Z" title="发表于 2025-03-24 15:50:00">2025-03-24</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-03-24T08:10:00.000Z" title="更新于 2025-03-24 16:10:00">2025-03-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">4.9k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="011 Linux进程"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为西安"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>西安</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://zycs-img-8kd.pages.dev/v2/uH1MN2u.png?_r_=d8aca62d-f18a-5698-334e-3d14589b8ae1"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">小米里的大麦 GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://www.minbit.top/posts/4610.html"><header><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a><a href="/tags/Linux/" tabindex="-1" itemprop="url">Linux</a><a href="/tags/%E8%BF%9B%E7%A8%8B/" tabindex="-1" itemprop="url">进程</a><h1 id="CrawlerTitle" itemprop="name headline">011 Linux进程</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">小米里的大麦</span><time itemprop="dateCreated datePublished" datetime="2025-03-24T07:50:00.000Z" title="发表于 2025-03-24 15:50:00">2025-03-24</time><time itemprop="dateCreated datePublished" datetime="2025-03-24T08:10:00.000Z" title="更新于 2025-03-24 16:10:00">2025-03-24</time></header><h2 id="深入理解-Linux-进程管理"><a href="#深入理解-Linux-进程管理" class="headerlink" title="深入理解 Linux 进程管理"></a>深入理解 Linux 进程管理</h2><h3 id="一、管理哲学-本质：先描述，再组织（校长如何管理学校？）"><a href="#一、管理哲学-本质：先描述，再组织（校长如何管理学校？）" class="headerlink" title="一、管理哲学&#x2F;本质：先描述，再组织（校长如何管理学校？）"></a>一、管理哲学&#x2F;本质：先描述，再组织（校长如何管理学校？）</h3><p>一个操作系统不仅仅只能运行一个进程，可以同时运行多个进程。操作系统的进程管理：<strong>先描述，在组织</strong> → 任何一个进程。在操作系统中，管理任何对象，最终都可以转化成为对某种数据结构的增删查改。想象你是一所大学的校长，管理数万名学生。你不需要认识每个学生，只需通过 <strong>学生档案系统</strong> 管理：</p>
<ul>
<li><strong>描述</strong>：每个学生有专属档案（学号、姓名、专业、成绩、宿舍号…）</li>
<li><strong>组织</strong>：档案按学院 → 专业 → 班级形成 <strong>链表结构</strong></li>
<li><strong>管理</strong>：调整专业只需修改档案中的“专业”字段，开除学生只需删除对应档案（<strong>增删查改</strong>）</li>
</ul>
<p><strong>操作系统管理进程同理</strong>：</p>
<ol>
<li><strong>描述</strong>：为每个进程创建 <code>task_struct</code>（进程的“档案”）</li>
<li><strong>组织</strong>：通过链表、队列等数据结构管理所有 <code>task_struct</code></li>
<li><strong>控制</strong>：调整优先级、终止进程等操作只需修改对应结构体</li>
</ol>
<p><strong>数据结构的作用</strong></p>
<ul>
<li><strong>学校</strong>：学生档案链表 → 管理学生 <strong>增删查改</strong>（如入学、转班、退学）。</li>
<li><strong>操作系统</strong>：进程 PCB 链表 → 管理进程的创建、调度、终止等。</li>
</ul>
<hr>
<h3 id="二、进程的定义与核心概念"><a href="#二、进程的定义与核心概念" class="headerlink" title="二、进程的定义与核心概念"></a>二、进程的定义与核心概念</h3><h4 id="1-什么是进程？"><a href="#1-什么是进程？" class="headerlink" title="1. 什么是进程？"></a>1. 什么是进程？</h4><ul>
<li><span style="color:#CC0000;"><strong>进程 &#x3D; 程序员自己写的代码和数据 + 内核 PCB 数据结构对象（描述进程的所有数据，process ctrl block → 进程控制块）</strong></span><ul>
<li><strong>程序</strong>：程序员编写的代码（如 <code>hello.c</code> 编译后的可执行文件 <code>hello</code>）。</li>
<li><strong>进程</strong>：程序被加载到内存中运行的实例（如运行 <code>./hello</code> 后生成的进程）。</li>
</ul>
</li>
<li><strong>关键点</strong>：<ul>
<li>进程是动态的：程序本身是静态文件，进程是运行时的实体。</li>
<li>每个进程都有自己的 <strong>PCB</strong>（进程控制块），存储进程的所有信息。</li>
</ul>
</li>
</ul>
<h4 id="2-进程管理的核心：进程控制块（PCB）"><a href="#2-进程管理的核心：进程控制块（PCB）" class="headerlink" title="2. 进程管理的核心：进程控制块（PCB）"></a>2. 进程管理的核心：进程控制块（PCB）</h4><ul>
<li><strong>PCB 的作用</strong>：记录进程的所有属性，帮助内核管理进程。</li>
<li><strong>Linux 中的 PCB</strong>：名为 <code>task_struct</code> 的结构体（C 语言中的结构体）。</li>
<li><strong>类比</strong>：就像学生的学籍档案，记录了学号、成绩、班级、状态等。</li>
</ul>
<hr>
<h3 id="三、Linux-的-task-struct-详解（进程控制块的实现）"><a href="#三、Linux-的-task-struct-详解（进程控制块的实现）" class="headerlink" title="三、Linux 的 task_struct 详解（进程控制块的实现）"></a>三、Linux 的 <code>task_struct</code> 详解（进程控制块的实现）</h3><h4 id="1-task-struct-的结构（进程的-DNA）"><a href="#1-task-struct-的结构（进程的-DNA）" class="headerlink" title="1. task_struct 的结构（进程的 DNA）"></a>1. <code>task_struct</code> 的结构（进程的 DNA）</h4><p>在 Linux 内核中，进程属性的集合 <code>task_struct</code> 是一个庞大的结构体（约有数百个字段），<code>task_struct</code> 是 Linux 内核的一种数据结构，它会被装载到 RAM(内存)里并且包含着进程的信息。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简化版 task_struct 结构（Linux内核真实结构复杂得多）</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">task_struct</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">long</span> pid;                		<span class="comment">// 身份证号（进程唯一标识）</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">long</span> state;      		<span class="comment">// 当前状态（睡觉/跑步/待机）</span></span><br><span class="line">    <span class="type">int</span> priority;            		<span class="comment">// VIP等级（优先级）</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">mm_struct</span> *mm;    		<span class="comment">// 家庭住址（内存分配情况）</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">files_struct</span> *files; 	<span class="comment">// 随身物品（打开的文件）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 相关指针信息：</span></span><br><span class="line">    structPCB *next</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">PCB</span> *queue</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">PCB</span> *xxxxx</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ... 上百个字段</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="关键字段解析（下面详解）："><a href="#关键字段解析（下面详解）：" class="headerlink" title="关键字段解析（下面详解）："></a>关键字段解析（下面详解）：</h5><table>
<thead>
<tr>
<th>字段</th>
<th>类比</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>pid</td>
<td>学号</td>
<td>唯一标识进程（<code>ps -ef</code> 查看）</td>
</tr>
<tr>
<td>state</td>
<td>学生状态（上课&#x2F;请假）</td>
<td>进程状态：运行（R）、睡眠（S）、僵尸（Z）等</td>
</tr>
<tr>
<td>priority</td>
<td>奖学金等级</td>
<td>优先级高的进程优先使用 CPU（<code>nice</code> 命令调整）</td>
</tr>
<tr>
<td>mm_struct</td>
<td>宿舍分配表</td>
<td>记录进程使用的内存空间（代码段、数据段、堆栈等）</td>
</tr>
<tr>
<td>files_struct</td>
<td>书包里的书本</td>
<td>记录进程打开的所有文件（<code>lsof -p &lt;pid&gt;</code> 查看）</td>
</tr>
<tr>
<td>上下文数据</td>
<td>课堂笔记</td>
<td>保存 CPU 寄存器的值，用于中断后恢复现场</td>
</tr>
</tbody></table>
<hr>
<h4 id="1-标识符（Identity）"><a href="#1-标识符（Identity）" class="headerlink" title="1. 标识符（Identity）"></a>1. 标识符（Identity）</h4><ul>
<li><strong>pid（进程 ID）</strong>：唯一标识符，类似学生的学号。每个进程有唯一的 PID，通过 <code>ps</code> 命令可见。</li>
<li><strong>ppid（父进程 ID）</strong>：记录该进程的父进程 PID，形成父子进程关系。类比：学生档案中记录班主任的工号。</li>
</ul>
<h4 id="2-状态（State）"><a href="#2-状态（State）" class="headerlink" title="2. 状态（State）"></a>2. 状态（State）</h4><ul>
<li><p><strong>进程状态</strong>：进程当前所处的阶段，包括：</p>
<ul>
<li><strong>运行态（Running）</strong>：正在 CPU 上执行。</li>
<li><strong>就绪态（Runnable）</strong>：等待调度到 CPU 上运行。</li>
<li><strong>阻塞态（Blocked）</strong>：等待 I&#x2F;O（如读写文件）、等待信号等。</li>
<li><strong>终止态（Zombie）</strong>：进程已结束，但父进程未回收其资源（成为“僵尸”）。</li>
</ul>
</li>
<li><p><strong>字段示例</strong>：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="type">long</span> state;  <span class="comment">// 进程状态（如TASK_RUNNING, TASK_INTERRUPTIBLE）</span></span><br><span class="line"><span class="type">int</span> exit_code;        <span class="comment">// 进程退出时的返回值</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-优先级（Priority）"><a href="#3-优先级（Priority）" class="headerlink" title="3. 优先级（Priority）"></a>3. 优先级（Priority）</h4><ul>
<li><p><strong>调度优先级</strong>：决定进程获得 CPU 时间的“权重”。</p>
<ul>
<li><strong>nice 值</strong>：用户可调整的优先级（值越低，优先级越高）。</li>
<li><strong>实时优先级</strong>：用于需要严格实时性的进程（如音频播放）。</li>
</ul>
</li>
<li><p><strong>字段示例</strong>：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> nice;             <span class="comment">// nice值（-20到19，默认0）</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> policy; <span class="comment">// 调度策略（如SCHED_OTHER普通进程）</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="4-程序计数器（Program-Counter）"><a href="#4-程序计数器（Program-Counter）" class="headerlink" title="4. 程序计数器（Program Counter）"></a>4. 程序计数器（Program Counter）</h4><ul>
<li><strong>寄存器状态</strong>：记录进程执行到的位置。<ul>
<li><strong>pc（程序计数器）</strong>：指向当前指令的下一条指令的地址。</li>
<li><strong>其他寄存器</strong>：如栈指针（<code>rsp</code>）、基指针（<code>rbp</code>）等，保存进程执行现场。</li>
</ul>
</li>
<li><strong>作用</strong>：当进程被中断（如切换到其他进程），内核会保存这些寄存器的值，以便恢复执行。</li>
</ul>
<h4 id="5-上下文（Context）"><a href="#5-上下文（Context）" class="headerlink" title="5. 上下文（Context）"></a>5. 上下文（Context）</h4><ul>
<li><strong>上下文数据</strong>：进程执行时的所有硬件寄存器的值。<ul>
<li>类比：学生临时离开教室前，记录自己写到哪页笔记、用哪支笔。</li>
<li><strong>保存场景</strong>：当进程被中断（如 I&#x2F;O 请求），内核将寄存器值保存到 <code>task_struct</code>。</li>
<li><strong>恢复场景</strong>：当进程重新调度到 CPU 时，内核恢复这些寄存器值，继续执行。</li>
</ul>
</li>
</ul>
<h4 id="6-内存与资源信息"><a href="#6-内存与资源信息" class="headerlink" title="6. 内存与资源信息"></a>6. 内存与资源信息</h4><ul>
<li><strong>内存指针</strong>：记录进程的代码、数据、堆栈的内存地址。<ul>
<li><strong>代码段（text 段）</strong>：程序指令的内存区域。</li>
<li><strong>数据段（data 段）</strong>：全局变量、堆栈等。</li>
<li><strong>共享内存</strong>：与其他进程共享的内存块指针。</li>
</ul>
</li>
<li><strong>资源列表</strong>：<ul>
<li>打开的文件描述符（如 <code>/dev/sda</code>）。</li>
<li>分配的 I&#x2F;O 设备（如 USB 设备）。</li>
</ul>
</li>
</ul>
<h4 id="7-I-O-状态"><a href="#7-I-O-状态" class="headerlink" title="7. I&#x2F;O 状态"></a>7. I&#x2F;O 状态</h4><ul>
<li><strong>I&#x2F;O 请求队列</strong>：记录进程等待的 I&#x2F;O 操作（如读取硬盘）。</li>
<li><strong>分配的设备</strong>：进程当前占用的硬件设备。</li>
</ul>
<h4 id="8-记账信息（Accounting）"><a href="#8-记账信息（Accounting）" class="headerlink" title="8. 记账信息（Accounting）"></a>8. 记账信息（Accounting）</h4><ul>
<li><strong>CPU 时间统计</strong>：<ul>
<li><code>utime</code>：用户模式下消耗的 CPU 时间。</li>
<li><code>stime</code>：内核模式下消耗的 CPU 时间。</li>
</ul>
</li>
<li><strong>时间限制</strong>：如进程允许的最大运行时间。</li>
<li><strong>记账用户</strong>：记录进程属于哪个用户（如 <code>root</code> 或普通用户）。</li>
</ul>
<h4 id="9-其他信息"><a href="#9-其他信息" class="headerlink" title="9. 其他信息"></a>9. 其他信息</h4><ul>
<li><strong>信号处理</strong>：记录进程如何处理信号（如 <code>SIGTERM</code> 终止信号）。</li>
<li><strong>线程信息</strong>：如果是多线程程序，记录线程组信息。</li>
<li><strong>调度队列指针</strong>：指向进程所在的就绪队列或阻塞队列。</li>
</ul>
<hr>
<h3 id="四、组织进程"><a href="#四、组织进程" class="headerlink" title="四、组织进程"></a>四、组织进程</h3><p>可以在内核源代码里找到它。所有运行在系统里的进程都以 <code>task_struct</code> 链表等非常复杂的数据结构的形式存在内核里。</p>
<hr>
<h3 id="五、查看进程"><a href="#五、查看进程" class="headerlink" title="五、查看进程"></a>五、查看进程</h3><h4 id="1-查看进程方法"><a href="#1-查看进程方法" class="headerlink" title="1. 查看进程方法"></a>1. 查看进程方法</h4><p>在 Linux 中，进程（Process）是正在运行的程序实例。查看进程的常用命令有：</p>
<ul>
<li><strong><code>ps</code></strong>：最常用的进程查看工具，适合快速查看进程快照（<strong>静态结果输出</strong>）。</li>
<li><strong><code>top</code></strong>：动态监控进程，适合实时观察系统状态（<strong>动态查看进程变化，默认 5 秒更新</strong>）。</li>
<li><strong><code>htop</code></strong>：增强版 <code>top</code>，界面更友好，适合交互式操作。</li>
<li><strong>其他命令</strong>：如 <code>pgrep</code>、<code>pidof</code> 等，适合精准定位进程。</li>
</ul>
<hr>
<h5 id="1-ps-相关命令"><a href="#1-ps-相关命令" class="headerlink" title="1. ps 相关命令"></a>1. <code>ps</code> 相关命令</h5><p>当直接输入 <code>ps</code> 而不带任何参数时，命令会：</p>
<ul>
<li><strong>仅显示当前终端会话中的进程</strong>，即与当前终端关联的进程。</li>
<li>输出内容较为简洁，仅包含以下字段：<ul>
<li><strong>PID</strong>：进程 ID。</li>
<li><strong>TTY</strong>：进程关联的终端（如 <code>pts/0</code> 表示伪终端）。</li>
<li><strong>TIME</strong>：进程占用的 CPU 时间。</li>
<li><strong>CMD</strong>：启动进程的命令名及参数。</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>命令&#x2F;选项</th>
<th>说明</th>
<th>示例</th>
<th>常用度</th>
</tr>
</thead>
<tbody><tr>
<td><code>ps aux</code></td>
<td>显示所有用户的进程，包含详细信息（用户、CPU、内存等）</td>
<td><code>ps aux</code></td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>ps -ef</code></td>
<td>显示全格式进程信息（更详细的进程信息，常用于系统管理和脚本，含 PPID）</td>
<td><code>ps -ef</code></td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>ps -e</code></td>
<td>显示所有进程</td>
<td><code>ps -e</code></td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><code>ps -u &lt;用户&gt;</code></td>
<td>显示指定用户的进程</td>
<td><code>ps -u root</code></td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><code>ps -p &lt;PID&gt;</code></td>
<td>显示指定 PID 的进程信息</td>
<td><code>ps -p 1234</code></td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>ps -o</code></td>
<td>按需展示特定字段，常与 <code>-p</code> 结合使用（如 PID、PPID、CMD 等）</td>
<td><code>ps -o pid,ppid,cmd,%mem,%cpu</code></td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>ps aux --sort</code></td>
<td>按指定字段排序（如内存、CPU）</td>
<td><code>ps aux --sort=-%mem</code></td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>ps auxf</code></td>
<td>以树状结构显示进程</td>
<td><code>ps auxf</code></td>
<td>⭐⭐⭐⭐</td>
</tr>
</tbody></table>
<h5 id="2-top-相关命令（按-q-退出）"><a href="#2-top-相关命令（按-q-退出）" class="headerlink" title="2. top 相关命令（按 q 退出）"></a>2. <code>top</code> 相关命令（按 <code>q</code> 退出）</h5><table>
<thead>
<tr>
<th>命令&#x2F;选项</th>
<th>说明</th>
<th>示例</th>
<th>常用度</th>
</tr>
</thead>
<tbody><tr>
<td><code>top</code></td>
<td>实时动态查看进程状态（类似任务管理器）</td>
<td><code>top</code></td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>top -c</code></td>
<td>显示完整命令路径</td>
<td><code>top -c</code></td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>top -p &lt;PID&gt;</code></td>
<td>监控指定 PID 的进程</td>
<td><code>top -p 1234</code></td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><code>top -u &lt;用户&gt;</code></td>
<td>监控指定用户的进程</td>
<td><code>top -u root</code></td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><code>top -b</code></td>
<td>以批处理模式运行，输出到文件</td>
<td><code>top -b -n 1 &gt; top.log</code></td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><code>top -n &lt;次数&gt;</code></td>
<td>指定刷新次数后退出</td>
<td><code>top -n 3</code></td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<h5 id="3-htop-相关命令"><a href="#3-htop-相关命令" class="headerlink" title="3. htop 相关命令"></a>3. <code>htop</code> 相关命令</h5><table>
<thead>
<tr>
<th>命令&#x2F;选项</th>
<th>说明</th>
<th>示例</th>
<th>常用度</th>
</tr>
</thead>
<tbody><tr>
<td><code>htop</code></td>
<td>增强版 top，支持鼠标操作和颜色高亮（需安装：<code>yum install htop</code>）</td>
<td><code>htop</code></td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>htop -u &lt;用户&gt;</code></td>
<td>显示指定用户的进程</td>
<td><code>htop -u root</code></td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>htop -p &lt;PID&gt;</code></td>
<td>显示指定 PID 的进程</td>
<td><code>htop -p 1234</code></td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><code>htop -d &lt;秒&gt;</code></td>
<td>设置刷新间隔时间</td>
<td><code>htop -d 5</code></td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<h5 id="4-其他进程相关命令"><a href="#4-其他进程相关命令" class="headerlink" title="4. 其他进程相关命令"></a>4. 其他进程相关命令</h5><table>
<thead>
<tr>
<th>命令&#x2F;选项</th>
<th>说明</th>
<th>示例</th>
<th>常用度</th>
</tr>
</thead>
<tbody><tr>
<td><code>pgrep</code></td>
<td>根据名称查找 PID（支持模糊匹配）</td>
<td><code>pgrep sshd</code></td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>pgrep -l</code></td>
<td>显示进程名和 PID</td>
<td><code>pgrep -l ssh</code></td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>pidof</code></td>
<td>根据精确进程名查找 PID</td>
<td><code>pidof nginx</code></td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><code>pstree</code></td>
<td>以树状结构显示进程关系（需安装：<code>yum install psmisc</code>）</td>
<td><code>pstree -p</code></td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><code>kill &lt;PID&gt;</code></td>
<td>终止指定进程</td>
<td><code>kill 1234</code></td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><code>kill -9 &lt;PID&gt;</code></td>
<td>强制杀死进程</td>
<td><code>kill -9 1234</code></td>
<td>⭐⭐⭐⭐</td>
</tr>
</tbody></table>
<h5 id="5-proc-文件系统"><a href="#5-proc-文件系统" class="headerlink" title="5. /proc 文件系统"></a>5. <code>/proc</code> 文件系统</h5><table>
<thead>
<tr>
<th>命令&#x2F;路径</th>
<th>说明</th>
<th>示例</th>
<th>常用度</th>
</tr>
</thead>
<tbody><tr>
<td><code>/proc/[PID]/status</code></td>
<td>查看进程的详细状态信息</td>
<td><code>cat /proc/1234/status</code></td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><code>/proc/[PID]/cmdline</code></td>
<td>查看进程的启动命令</td>
<td><code>cat /proc/1234/cmdline</code></td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><code>/proc/[PID]/exe</code></td>
<td>查看进程对应的可执行文件</td>
<td><code>ls -l /proc/1234/exe</code></td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><code>/proc/[PID]/fd</code></td>
<td>查看进程打开的文件描述符</td>
<td><code>ls -l /proc/1234/fd</code></td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<hr>
<h4 id="2-通过系统调用获取进程标识符"><a href="#2-通过系统调用获取进程标识符" class="headerlink" title="2. 通过系统调用获取进程标识符"></a>2. 通过系统调用获取进程标识符</h4><ol>
<li><strong>C 程序示例</strong></li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span>  <span class="comment">// 提供 getpid(), getppid(), 和 sleep()</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取当前进程 ID</span></span><br><span class="line">        <span class="type">pid_t</span> pid = getpid();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;当前进程 ID (PID): %d\n&quot;</span>, pid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取父进程 ID</span></span><br><span class="line">        <span class="type">pid_t</span> ppid = getppid();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;父进程 ID (PPID): %d\n&quot;</span>, ppid);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 睡眠 1 秒</span></span><br><span class="line">        sleep(<span class="number">1</span>);  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>编译</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o getpid getpid.c</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>运行</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./getpid</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>示例输出</strong></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当前进程 <span class="built_in">ID</span> (PID): <span class="number">1195</span></span><br><span class="line">父进程 <span class="built_in">ID</span> (PPID): <span class="number">481</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="3-fork-创建进程详解"><a href="#3-fork-创建进程详解" class="headerlink" title="3. fork() 创建进程详解"></a>3. <code>fork()</code> 创建进程详解</h4><blockquote>
<p><strong>摘自鸟哥的 <code>Linux</code> 私房菜基础学习篇（第四版）517页：</strong></p>
<p><strong><code>Linux</code> 的程序调用通常成为 <code>fork-and-exec</code> 的流程。进程都会借父进程以复制（<code>fork</code>）的方式产生一个一模一样的子进程，然后被复制出来的子进程再以 <code>exec</code> 的方式来执行实际要执行的进程，最终就成为一个子进程。</strong></p>
</blockquote>
<ol>
<li><strong>基础示例代码</strong></li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;创建子进程失败&quot;</span>);                             <span class="comment">// 将标准错误输出的信息改为中文</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;子进程PID=%d, 父进程PPID=%d\n&quot;</span>, getpid(), getppid());  <span class="comment">// 子进程中打印的信息改为中文</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;父进程PID=%d, 创建的子进程PID=%d\n&quot;</span>, getpid(), pid);   <span class="comment">// 父进程中打印的信息改为中文</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>示例输出：</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">父进程PID=2744, 创建的子进程PID=2745</span><br><span class="line">子进程PID=2745, 父进程PPID=2744</span><br></pre></td></tr></table></figure>
<p>注意：<strong>输出顺序可能不固定，取决于系统调度</strong>，再看下面一个示例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;begin: 我是一个进程，pid: %d, ppid: %d\n&quot;</span>, getpid(), getppid());</span><br><span class="line">    <span class="type">pid_t</span> id = fork();</span><br><span class="line">    <span class="keyword">if</span> (id == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 子进程</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;我是子进程，pid: %d, ppid: %d\n&quot;</span>, getpid(), getppid());</span><br><span class="line">            sleep(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (id &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 父进程</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;我是父进程，pid: %d, ppid: %d\n&quot;</span>, getpid(), getppid());</span><br><span class="line">            sleep(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//error</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>示例输出：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">begin: 我是一个进程，pid: 3721, ppid: 481</span><br><span class="line">我是父进程，pid: 3721, ppid: 481</span><br><span class="line">我是子进程，pid: 3722, ppid: 3721</span><br><span class="line">我是父进程，pid: 3721, ppid: 481</span><br><span class="line">我是子进程，pid: 3722, ppid: 3721</span><br><span class="line">我是子进程，pid: 3722, ppid: 3721</span><br><span class="line">……</span><br></pre></td></tr></table></figure>

<blockquote>
<p>  [!IMPORTANT]</p>
<h4 id="1-为什么-fork-给子进程返回-0，给父进程返回子进程的-PID？"><a href="#1-为什么-fork-给子进程返回-0，给父进程返回子进程的-PID？" class="headerlink" title="1. 为什么 fork() 给子进程返回 0，给父进程返回子进程的 PID？"></a>1. 为什么 <code>fork()</code> 给子进程返回 <code>0</code>，给父进程返回子进程的 <code>PID</code>？</h4><p>  <code>fork()</code> 的目的是创建一个 <strong>几乎完全相同</strong> 的子进程（一般而言 <code>fork</code> 之后的代码父子共享）。让父子进程执行不同的代码分支。通过返回值区分父子进程的身份：</p>
<ul>
<li><strong>父进程</strong>：需要知道子进程的 <code>PID</code>，以便后续管理（如等待子进程退出、发送信号等）。</li>
<li><strong>子进程</strong>：无需知道自己的 <code>PID</code>（可通过 <code>getpid()</code> 获取），但需要明确自己是子进程（返回 <code>0</code> 是最直接的方式）。</li>
</ul>
<p>  <strong>实现意义</strong>：</p>
<ul>
<li>父进程通过子进程 <code>PID</code> 可以追踪、控制子进程（如 <code>waitpid()</code>）。</li>
<li>子进程通过返回值 <code>0</code> 知道自己是被创建的一方，从而执行子进程独有的逻辑。</li>
</ul>
<p>  <strong>总结：父进程通过返回值区分子进程，子进程通过返回值确认自己是子进程。</strong></p>
<hr>
<h4 id="2-fork-作为一个函数为什么能返回两次？如何理解？"><a href="#2-fork-作为一个函数为什么能返回两次？如何理解？" class="headerlink" title="2. fork() 作为一个函数为什么能返回两次？如何理解？"></a>2. <code>fork()</code> 作为一个函数为什么能返回两次？如何理解？</h4><p>  <strong><code>fork()</code> 本质上只调用一次，但返回两次！</strong> <code>fork()</code> 调用后，操作系统会复制父进程，创建一个新的子进程。</p>
<ul>
<li><p><strong>父进程</strong>：继续从 <code>fork()</code> 返回，得到子进程的 PID。</p>
</li>
<li><p><strong>子进程</strong>：从 <code>fork()</code> 返回，得到 0。</p>
</li>
<li><p><strong>示意图</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----------------+</span><br><span class="line">| 父进程执行 fork() | --&gt; 子进程诞生</span><br><span class="line">+----------------+</span><br><span class="line">       |                  |</span><br><span class="line">       v                  v</span><br><span class="line">返回子进程 PID            返回 0</span><br></pre></td></tr></table></figure></li>
</ul>
<p>  看似一次调用返回两次，实际是两个独立的进程分别执行了 <code>fork()</code> 后的代码。可以把 <code>fork()</code> 想象成 <strong>一颗分叉的树</strong>：调用时是同一条路径，但执行后分成了两条路，各自独立运行。</p>
<hr>
<h4 id="3-为什么同一个变量在父子进程里内容不同？"><a href="#3-为什么同一个变量在父子进程里内容不同？" class="headerlink" title="3. 为什么同一个变量在父子进程里内容不同？"></a>3. 为什么同一个变量在父子进程里内容不同？</h4><p>  调用 <code>fork()</code> 时，子进程不会立即复制父进程的内存，而是共享同一份物理内存（标记为只读）。当父子进程 <strong>修改内存时</strong>，操作系统才会复制被修改的页（内存页的最小单位）。具体来说就是当 <code>fork()</code> 被调用时：</p>
<ol>
<li><strong>代码段（Code Segment）：</strong> 父子进程共享这部分内存，不需要复制。毕竟代码是静态的，读操作不会影响对方。</li>
<li><strong>数据段、堆、栈（Data, Heap, Stack）：</strong> 父子进程“看起来”各自独立，但实际上，系统不会立刻复制这部分内存！取而代之的是：<ul>
<li><strong>COW 机制：</strong> 父子进程最开始共享同一片物理内存，这些内存页被标记为 <strong>只读（Read-Only）</strong>。</li>
<li><strong>写时复制：</strong> 当父或子进程试图写入这片内存时，操作系统才会触发“页面复制”，分配新的内存页，供写操作独享。</li>
</ul>
</li>
</ol>
<p>  这种机制大幅优化了 <code>fork()</code> 的性能，因为如果父子进程不修改内存，根本就不用复制，节省了大量资源。<strong>综上：<code>fork()</code> 之后，父子进程共享代码段，但数据、堆、栈在写操作时会触发“写时复制”。</strong></p>
<p>  举个例子：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">100</span>;</span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 子进程</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;子进程 x = %d\n&quot;</span>, x);                <span class="comment">// 共享内存，输出 100</span></span><br><span class="line">        x = <span class="number">200</span>;                                    <span class="comment">// 写操作，触发写时复制，子进程独享这片内存</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;子进程修改后 x = %d\n&quot;</span>, x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 父进程</span></span><br><span class="line">        sleep(<span class="number">1</span>);                                   <span class="comment">// 让子进程先跑</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;父进程 x = %d\n&quot;</span>, x);               <span class="comment">// 父进程的 x 仍然是 100，未受子进程影响</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">子进程 x = <span class="number">100</span></span><br><span class="line">子进程修改后 x = <span class="number">200</span></span><br><span class="line">父进程 x = <span class="number">100</span></span><br></pre></td></tr></table></figure>

<p>  <strong>解释：</strong></p>
<ol>
<li><code>fork()</code> 之后，父子进程共享内存，<code>x</code> 的初始值对父子都可见（100）。</li>
<li>子进程写入 <code>x</code> 时，触发 COW：<ul>
<li>系统为子进程分配新内存页，把原来内存页的值（100）复制过来。</li>
<li>子进程修改自己的副本，父进程继续使用原来的内存页。</li>
</ul>
</li>
<li>所以，父子进程的 <code>x</code> 从此各自独立，互不干扰。因为它们的内存空间已经分开，各玩各的！</li>
</ol>
<p>  <strong>注：如果想让父子进程共享数据，得用专门的共享内存机制（如 <code>mmap()</code>）。</strong></p>
<hr>
<h4 id="4-fork-究竟在干什么？系统中多了一个进程吗？"><a href="#4-fork-究竟在干什么？系统中多了一个进程吗？" class="headerlink" title="4. fork() 究竟在干什么？系统中多了一个进程吗？"></a>4. <code>fork()</code> 究竟在干什么？系统中多了一个进程吗？</h4><p>  是的，<code>fork()</code> 让系统里多了一个新进程！可通过 <code>ps</code> 命令观察到子进程的存在：<code>ps -ef | grep &lt;程序名&gt;</code>。它做了这几件事：</p>
<ol>
<li><p><strong>复制父进程的内存空间：</strong> 代码段、数据段、堆栈等全部复制，子进程看起来和父进程几乎一模一样。</p>
<ul>
<li>复制父进程的 <strong>进程控制块（PCB）</strong>，生成子进程的 PCB。</li>
<li>复制父进程的 <strong>虚拟地址空间</strong>（通过写时复制优化）。</li>
</ul>
</li>
<li><p><strong>分配新的进程 ID（PID）：</strong> 子进程有独立的 PID，同时保留父进程的 PPID（Parent PID）。</p>
</li>
<li><p><strong>独立调度：</strong> 子进程作为独立的进程被调度，和父进程各自执行，互不干扰。</p>
</li>
</ol>
<p>  所以，<code>fork()</code> 之后，系统里确实多了一个进程！但它们起点一致，只是接下来的执行路径可能不同。</p>
<hr>
<h4 id="5-为什么要创建子进程？"><a href="#5-为什么要创建子进程？" class="headerlink" title="5. 为什么要创建子进程？"></a>5. 为什么要创建子进程？</h4><p>  创建子进程的目的是 <strong>并行执行不同的任务</strong>，常见用途有：</p>
<ol>
<li><strong>后台任务：</strong> 如守护进程、Web 服务器，父进程处理请求，子进程负责具体工作。</li>
<li><strong>任务分解：</strong> 父进程分配工作，子进程完成任务。</li>
<li><strong>隔离风险：</strong> 子进程失败不会影响父进程，避免整个程序崩溃。</li>
</ol>
<p>  简单来说，<strong>父进程管理，子进程干活</strong>，井井有条！</p>
<hr>
<h4 id="6-fork-后，谁先运行？"><a href="#6-fork-后，谁先运行？" class="headerlink" title="6. fork()  后，谁先运行？"></a>6. <code>fork() </code> 后，谁先运行？</h4><p>  这个是 <strong>不确定的</strong>！谁先运行完全取决于操作系统的调度策略：</p>
<ul>
<li>父子进程创建完成后，由操作系统的调度器决定执行顺序。</li>
<li>可能父进程先运行，也可能子进程先运行，甚至交替执行</li>
</ul>
<p>  所以，谁先跑？随缘！操作系统说了算，<strong>让操作系统的调度器决定</strong>，它才是“调度大哥”！</p>
</blockquote>
<hr>
<h3 id="六、扩展思考"><a href="#六、扩展思考" class="headerlink" title="六、扩展思考"></a>六、扩展思考</h3><h4 id="Q1：为什么进程不需要直接与内核交互？"><a href="#Q1：为什么进程不需要直接与内核交互？" class="headerlink" title="Q1：为什么进程不需要直接与内核交互？"></a>Q1：为什么进程不需要直接与内核交互？</h4><p>答：内核通过 <code>task_struct</code> 间接管理进程，就像校长通过学生档案管理学生。进程只需执行代码，内核通过数据结构记录状态并决策。</p>
<h4 id="Q2：如何查看进程的-task-struct？"><a href="#Q2：如何查看进程的-task-struct？" class="headerlink" title="Q2：如何查看进程的 task_struct？"></a>Q2：如何查看进程的 <code>task_struct</code>？</h4><p>答：用户态无法直接访问 <code>task_struct</code>，但可以通过以下命令间接查看：</p>
<ul>
<li><code>ps</code>：显示 PID、状态、CPU&#x2F;内存使用。</li>
<li><code>/proc/[pid]/stat</code>：虚拟文件系统，如 <code>cat /proc/1234/stat</code> 包含进程的详细信息（映射 <code>task_struct</code> 字段）。</li>
</ul>
<h4 id="Q3：多个进程如何共享-CPU？"><a href="#Q3：多个进程如何共享-CPU？" class="headerlink" title="Q3：多个进程如何共享 CPU？"></a>Q3：<strong>多个进程如何共享 CPU</strong>？</h4><p>答：通过调度算法在 <code>task_struct </code> 间切换。</p>
<ul>
<li><strong>完全公平调度（CFS）</strong>：基于虚拟运行时间（<code>vruntime</code>）决定进程优先级。</li>
<li><strong>实时调度策略</strong>：如 <code>SCHED_FIFO</code>（先进先出）和 <code>SCHED_RR</code>（时间片轮转）。</li>
<li><strong>调度相关字段</strong>：<code>task_struct</code> 中的 <code>policy</code>（调度策略）、<code>prio</code>（动态优先级）、<code>static_prio</code>（静态优先级）。</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/bFRjgdX.jpeg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/bFRjgdX.jpeg" title="头像" alt="头像"></a><div class="post-copyright__author_name">小米里的大麦</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://www.minbit.top/posts/4610.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://www.minbit.top/posts/4610.html')">011 Linux进程</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://zycs-img-8kd.pages.dev/v2/REbVGGL.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/REbVGGL.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://zycs-img-8kd.pages.dev/v2/1UUolM0.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/1UUolM0.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.minbit.top/posts/4610.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=011 Linux进程&amp;url=https://www.minbit.top/posts/4610.html&amp;pic=https://zycs-img-8kd.pages.dev/v2/uH1MN2u.png?_r_=d8aca62d-f18a-5698-334e-3d14589b8ae1" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)</a> 许可协议。转载请注明来自 <a href="https://www.minbit.top" target="_blank">小米里的大麦</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Linux<span class="tagsPageCount">50</span></a><a class="post-meta__box__tags" href="/tags/%E8%BF%9B%E7%A8%8B/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>进程<span class="tagsPageCount">15</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://zycs-img-8kd.pages.dev/v2/fETMVUS.jpeg?_r_=c529c723-4b01-5bf8-fe19-d1438fd9563d" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/38654.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/fETMVUS.jpeg?_r_=2ecbb11c-7530-3de4-a650-ad62f71be918" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">010 冯・诺依曼体系结构和操作系统</div></div></a></div><div class="next-post pull-right"><a href="/posts/22624.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/fETMVUS.jpeg?_r_=8e155880-809b-e75c-f6b5-d0e4dc7c05aa" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">012 进程状态和优先级</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/22624.html" title="012 进程状态和优先级"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/fETMVUS.jpeg?_r_=8e155880-809b-e75c-f6b5-d0e4dc7c05aa" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-26</div><div class="title">012 进程状态和优先级</div></div></a></div><div><a href="/posts/14630.html" title="014 Linux 2.6内核进程调度队列（了解）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/0k1JltC.jpeg?_r_=5eede737-a0bb-6d1d-9df9-52d9e557bac4" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-04-01</div><div class="title">014 Linux 2.6内核进程调度队列（了解）</div></div></a></div><div><a href="/posts/9600.html" title="016 进程控制 —— 进程创建"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/Jci6x23.png?_r_=faf0f95a-4ae7-bd43-55ff-7aab839ee21e" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-04-05</div><div class="title">016 进程控制 —— 进程创建</div></div></a></div><div><a href="/posts/59037.html" title="017 进程控制 —— 终止进程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/fETMVUS.jpeg?_r_=1cb838ba-0266-6cab-1050-784f5fac1b2b" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-04-11</div><div class="title">017 进程控制 —— 终止进程</div></div></a></div><div><a href="/posts/28370.html" title="019 进程控制 —— 进程程序替换"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/Jci6x23.png?_r_=170c9974-b1a2-cbc8-b7b1-cbb058ba500a" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-04-22</div><div class="title">019 进程控制 —— 进程程序替换</div></div></a></div><div><a href="/posts/16008.html" title="018 进程控制 —— 进程等待"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/0k1JltC.jpeg?_r_=adca2bb9-c4bd-c370-e94c-f257d67af9e4" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-04-16</div><div class="title">018 进程控制 —— 进程等待</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/bFRjgdX.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description">时间好像总会留下点什么,或许是一个人,或许是一个梦,或许……是一段有意义的经历~</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">小米里的大麦</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/huangcancan-xbc" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><span>👋🏻 Hi，我是 <a target="_blank" href="https://huangcancan-xbc.github.io" rel="external nofollow noreferrer noopener" style="font-weight:bold; font-size:1.1em; color:#5166f0;">小米里的大麦</a>，欢迎来看我的博客鸭！</span><br>
<span>👉 建议优先查看置顶的 <a target="_blank" href="https://huangcancan-xbc.github.io/posts/17934.html" rel="external nofollow noreferrer noopener" style="font-weight:bold; font-size:1.1em; color:#5166f0;">网站说明</a>，如有问题欢迎评论区交流！</span><br>
<span>😫 页面异常？尝试<kbd>Ctrl</kbd>+<kbd>F5</kbd></span><br>
<span>📩 联系我：<a href="mailto:hc1960074081@qq.com" rel="external nofollow noreferrer"><b>给我发送邮件🚀</b></a></span>  
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-Linux-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">深入理解 Linux 进程管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%AE%A1%E7%90%86%E5%93%B2%E5%AD%A6-%E6%9C%AC%E8%B4%A8%EF%BC%9A%E5%85%88%E6%8F%8F%E8%BF%B0%EF%BC%8C%E5%86%8D%E7%BB%84%E7%BB%87%EF%BC%88%E6%A0%A1%E9%95%BF%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E5%AD%A6%E6%A0%A1%EF%BC%9F%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">一、管理哲学&#x2F;本质：先描述，再组织（校长如何管理学校？）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%8E%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.</span> <span class="toc-text">二、进程的定义与核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E8%BF%9B%E7%A8%8B%EF%BC%9F"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. 什么是进程？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E7%9A%84%E6%A0%B8%E5%BF%83%EF%BC%9A%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%9D%97%EF%BC%88PCB%EF%BC%89"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. 进程管理的核心：进程控制块（PCB）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81Linux-%E7%9A%84-task-struct-%E8%AF%A6%E8%A7%A3%EF%BC%88%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%9D%97%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">三、Linux 的 task_struct 详解（进程控制块的实现）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-task-struct-%E7%9A%84%E7%BB%93%E6%9E%84%EF%BC%88%E8%BF%9B%E7%A8%8B%E7%9A%84-DNA%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">1. task_struct 的结构（进程的 DNA）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97%E6%AE%B5%E8%A7%A3%E6%9E%90%EF%BC%88%E4%B8%8B%E9%9D%A2%E8%AF%A6%E8%A7%A3%EF%BC%89%EF%BC%9A"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">关键字段解析（下面详解）：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%A0%87%E8%AF%86%E7%AC%A6%EF%BC%88Identity%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">1. 标识符（Identity）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%8A%B6%E6%80%81%EF%BC%88State%EF%BC%89"><span class="toc-number">1.3.3.</span> <span class="toc-text">2. 状态（State）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%88Priority%EF%BC%89"><span class="toc-number">1.3.4.</span> <span class="toc-text">3. 优先级（Priority）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8%EF%BC%88Program-Counter%EF%BC%89"><span class="toc-number">1.3.5.</span> <span class="toc-text">4. 程序计数器（Program Counter）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E4%B8%8A%E4%B8%8B%E6%96%87%EF%BC%88Context%EF%BC%89"><span class="toc-number">1.3.6.</span> <span class="toc-text">5. 上下文（Context）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%86%85%E5%AD%98%E4%B8%8E%E8%B5%84%E6%BA%90%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.7.</span> <span class="toc-text">6. 内存与资源信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-I-O-%E7%8A%B6%E6%80%81"><span class="toc-number">1.3.8.</span> <span class="toc-text">7. I&#x2F;O 状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E8%AE%B0%E8%B4%A6%E4%BF%A1%E6%81%AF%EF%BC%88Accounting%EF%BC%89"><span class="toc-number">1.3.9.</span> <span class="toc-text">8. 记账信息（Accounting）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E5%85%B6%E4%BB%96%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.10.</span> <span class="toc-text">9. 其他信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E7%BB%84%E7%BB%87%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">四、组织进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">五、查看进程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E6%96%B9%E6%B3%95"><span class="toc-number">1.5.1.</span> <span class="toc-text">1. 查看进程方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-ps-%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">1. ps 相关命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-top-%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4%EF%BC%88%E6%8C%89-q-%E9%80%80%E5%87%BA%EF%BC%89"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">2. top 相关命令（按 q 退出）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-htop-%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">3. htop 相关命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%85%B6%E4%BB%96%E8%BF%9B%E7%A8%8B%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">4. 其他进程相关命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-proc-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.5.1.5.</span> <span class="toc-text">5. &#x2F;proc 文件系统</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%80%9A%E8%BF%87%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%8E%B7%E5%8F%96%E8%BF%9B%E7%A8%8B%E6%A0%87%E8%AF%86%E7%AC%A6"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. 通过系统调用获取进程标识符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-fork-%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.5.3.</span> <span class="toc-text">3. fork() 创建进程详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88-fork-%E7%BB%99%E5%AD%90%E8%BF%9B%E7%A8%8B%E8%BF%94%E5%9B%9E-0%EF%BC%8C%E7%BB%99%E7%88%B6%E8%BF%9B%E7%A8%8B%E8%BF%94%E5%9B%9E%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84-PID%EF%BC%9F"><span class="toc-number">1.5.4.</span> <span class="toc-text">1. 为什么 fork() 给子进程返回 0，给父进程返回子进程的 PID？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-fork-%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%BA%E4%BB%80%E4%B9%88%E8%83%BD%E8%BF%94%E5%9B%9E%E4%B8%A4%E6%AC%A1%EF%BC%9F%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%EF%BC%9F"><span class="toc-number">1.5.5.</span> <span class="toc-text">2. fork() 作为一个函数为什么能返回两次？如何理解？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%90%8C%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%E5%9C%A8%E7%88%B6%E5%AD%90%E8%BF%9B%E7%A8%8B%E9%87%8C%E5%86%85%E5%AE%B9%E4%B8%8D%E5%90%8C%EF%BC%9F"><span class="toc-number">1.5.6.</span> <span class="toc-text">3. 为什么同一个变量在父子进程里内容不同？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-fork-%E7%A9%B6%E7%AB%9F%E5%9C%A8%E5%B9%B2%E4%BB%80%E4%B9%88%EF%BC%9F%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%A4%9A%E4%BA%86%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B%E5%90%97%EF%BC%9F"><span class="toc-number">1.5.7.</span> <span class="toc-text">4. fork() 究竟在干什么？系统中多了一个进程吗？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%88%9B%E5%BB%BA%E5%AD%90%E8%BF%9B%E7%A8%8B%EF%BC%9F"><span class="toc-number">1.5.8.</span> <span class="toc-text">5. 为什么要创建子进程？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-fork-%E5%90%8E%EF%BC%8C%E8%B0%81%E5%85%88%E8%BF%90%E8%A1%8C%EF%BC%9F"><span class="toc-number">1.5.9.</span> <span class="toc-text">6. fork()  后，谁先运行？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%89%A9%E5%B1%95%E6%80%9D%E8%80%83"><span class="toc-number">1.6.</span> <span class="toc-text">六、扩展思考</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Q1%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%9B%E7%A8%8B%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9B%B4%E6%8E%A5%E4%B8%8E%E5%86%85%E6%A0%B8%E4%BA%A4%E4%BA%92%EF%BC%9F"><span class="toc-number">1.6.1.</span> <span class="toc-text">Q1：为什么进程不需要直接与内核交互？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Q2%EF%BC%9A%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E7%9A%84-task-struct%EF%BC%9F"><span class="toc-number">1.6.2.</span> <span class="toc-text">Q2：如何查看进程的 task_struct？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Q3%EF%BC%9A%E5%A4%9A%E4%B8%AA%E8%BF%9B%E7%A8%8B%E5%A6%82%E4%BD%95%E5%85%B1%E4%BA%AB-CPU%EF%BC%9F"><span class="toc-number">1.6.3.</span> <span class="toc-text">Q3：多个进程如何共享 CPU？</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/62772.html" title="050 传输层 —— UDP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/0k1JltC.jpeg?_r_=2f802891-8784-4ddb-e5bd-9d61b1397323" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="050 传输层 —— UDP"/></a><div class="content"><a class="title" href="/posts/62772.html" title="050 传输层 —— UDP">050 传输层 —— UDP</a><time datetime="2025-09-12T04:00:00.000Z" title="发表于 2025-09-12 12:00:00">2025-09-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/34998.html" title="049 HTTPS 协议原理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/fETMVUS.jpeg?_r_=c529c723-4b01-5bf8-fe19-d1438fd9563d" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="049 HTTPS 协议原理"/></a><div class="content"><a class="title" href="/posts/34998.html" title="049 HTTPS 协议原理">049 HTTPS 协议原理</a><time datetime="2025-08-28T04:00:00.000Z" title="发表于 2025-08-28 12:00:00">2025-08-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/63840.html" title="048 HTTP 协议"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/aKlysyx.png?_r_=6011401b-b224-1423-1a89-ceeead1936d4" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="048 HTTP 协议"/></a><div class="content"><a class="title" href="/posts/63840.html" title="048 HTTP 协议">048 HTTP 协议</a><time datetime="2025-08-25T04:00:00.000Z" title="发表于 2025-08-25 12:00:00">2025-08-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/38905.html" title="047 网络传输基础：TCP 连接建立与数据序列化"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/Jci6x23.png?_r_=c7a9f229-9f6b-3f2e-87d5-e6ca5316f5f5" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="047 网络传输基础：TCP 连接建立与数据序列化"/></a><div class="content"><a class="title" href="/posts/38905.html" title="047 网络传输基础：TCP 连接建立与数据序列化">047 网络传输基础：TCP 连接建立与数据序列化</a><time datetime="2025-08-22T04:00:00.000Z" title="发表于 2025-08-22 12:00:00">2025-08-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/40348.html" title="046 网络编程套接字"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/fETMVUS.jpeg?_r_=c35415b9-7cc5-c591-5bcd-f604827a0a65" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="046 网络编程套接字"/></a><div class="content"><a class="title" href="/posts/40348.html" title="046 网络编程套接字">046 网络编程套接字</a><time datetime="2025-08-15T04:00:00.000Z" title="发表于 2025-08-15 12:00:00">2025-08-15</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:hc1960074081@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://weibo.com/u/7913790969" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://zycs-img-8kd.pages.dev/v2/bFRjgdX.jpeg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="小米里的大麦" target="_blank">小米里的大麦</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["《左传》载曰：“太上有立德，其次有立功，其次有立言，虽久不废，此之谓不朽。”","纸上得来终觉浅，绝知此事要躬行！","你太专注于未来，却没有意识到，今天正是你多年前祈求的模样，因为你眺望远方视而不见。","梦想是不会发光的，发光的是追梦的你！","答案在风中飘扬"]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub主页">GitHub主页</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">64</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">社交</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/huangcancan-xbc" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://space.bilibili.com/1918272544" title="哔哩哔哩"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="哔哩哔哩"/><span class="back-menu-item-text">哔哩哔哩</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/huang-cancan-xbc" title="Gitee"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="Gitee"/><span class="back-menu-item-text">Gitee</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.csdn.net/Huangcancan666?type=blog" title="CSDN"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="CSDN"/><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3230789931118109" title="稀土掘金"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="稀土掘金"/><span class="back-menu-item-text">稀土掘金</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 外链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 0.88rem;">C++<sup>8</sup></a><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>3</sup></a><a href="/tags/IO/" style="font-size: 0.88rem;">IO<sup>3</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>50</sup></a><a href="/tags/Obsidian/" style="font-size: 0.88rem;">Obsidian<sup>1</sup></a><a href="/tags/STL/" style="font-size: 0.88rem;">STL<sup>2</sup></a><a href="/tags/VS-Code/" style="font-size: 0.88rem;">VS Code<sup>1</sup></a><a href="/tags/%E4%BF%A1%E5%8F%B7/" style="font-size: 0.88rem;">信号<sup>3</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">内存管理<sup>1</sup></a><a href="/tags/%E5%8E%86%E7%A8%8B/" style="font-size: 0.88rem;">历程<sup>1</sup></a><a href="/tags/%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" style="font-size: 0.88rem;">地址空间<sup>6</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 0.88rem;">数学<sup>1</sup></a><a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size: 0.88rem;">模板<sup>1</sup></a><a href="/tags/%E7%AE%A1%E9%81%93/" style="font-size: 0.88rem;">管道<sup>2</sup></a><a href="/tags/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/" style="font-size: 0.88rem;">类与对象<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">线程<sup>4</sup></a><a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size: 0.88rem;">网站<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>6</sup></a><a href="/tags/%E8%BF%9B%E7%A8%8B/" style="font-size: 0.88rem;">进程<sup>15</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight, 500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("01/01/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `这里是 小米里的大麦`,
    `芝兰生于深谷，不以无人而不芳。`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 小米里的大麦 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-olive-one.vercel.app/',
      // 自己额外添加的：
      path: location.pathname.replace(/index\.html$/, ''),
      
      region: 'ap-shanghai',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.44/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-olive-one.vercel.app/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo-olive-one.vercel.app/',
        region: 'ap-shanghai',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.44/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "xiaomilidedamai@minbit.top";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://cdn.cbd.int/qrcodejs@1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="https://cdn.bootcdn.net/ajax/libs/echarts/4.9.0-rc.1/echarts.min.js"></script><script src="/js/footer-animal.js" defer></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="offer,暴富,健康,offer,喜乐,成功,offer,好运,自由,offer,坚持,上岸" data-fontsize="20px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script><script>//- 留言板页面弹幕
window.addEventListener('load', () => {
  const getnaokuo_danmu = () => {
    if (!window.location.pathname.startsWith('/comments/')) return; //- 判断是否是留言板页面
    const naokuo_danmu = async () => {
      const Danmaku = new EasyDanmaku({
        page: '/comments/', //- 即留言板地址
        el: '#danmu-wrap', //- 弹幕挂载节点
        line: 5, //- 弹幕行数
        speed: 20, //- 弹幕播放速度
        hover: true, //- 鼠标hover时是否暂停播放弹幕
        loop: false, //- 开启循环播放
        colourful: true, //- 开启彩色弹幕
        coefficient: 1.38, //- 弹幕密度系数
        runtime: 10, //- 循环弹幕播放时长
      });
      try {
        let danmuStore = saveToLocal.get('twikoo-danmu');
        if (!danmuStore) {
          const options = {
            method: "POST",
            body: JSON.stringify({
              "event": "GET_RECENT_COMMENTS",
              "includeReply": false,
              "pageSize": 100
            }),
            headers: { 'Content-Type': 'application/json' }
          }
          danmuStore = [];
          const response = await fetch(`https://twikoo-olive-one.vercel.app/`, options);
          if (response.ok) {
            const { data } = await response.json();
            //- console.info(data);
            data.forEach(i => {
              if (i.avatar == undefined) i.avatar = 'https://cravatar.cn/avatar/d615d5793929e8c7d70eab5f00f7f5f1?d=mp'
              danmuStore.push({ avatar: i.avatar, content: i.nick + '：' + formatDanmaku(i.comment), url: i.url + '#' + i.id })
            });
            Danmaku.batchSend(danmuStore, true);
            saveToLocal.set('twikoo-danmu', danmuStore, 0.5)
          }
          //- 格式化评论
          function formatDanmaku(str) {
            str = str.replace(/<\/*br>|[\s\uFEFF\xA0]+/g, '');
            str = str.replace(/<img.*?>/g, '[图片]');
            str = str.replace(/<a.*?>.*?<\/a>/g, '[链接]');
            str = str.replace(/<pre.*?>.*?<\/pre>/g, '[代码块]');
            str = str.replace(/<.*?>/g, '');
            return str
          }
        } else {
          Danmaku.batchSend(danmuStore, true);
        }
      } catch (err) {
        console.error("Error fetching data:", err);
      }

      document.getElementById('danmu-Btn') && (document.getElementById('danmu-Btn').innerHTML = `<button class="hide-Btn" onclick="document.getElementById('danmu-wrap').classList.remove('hide-danmu')">显示弹幕</button> <button class="hide-Btn" onclick="document.getElementById('danmu-wrap').classList.add('hide-danmu')">隐藏弹幕</button>`)
    }
    (async () => {
      if (typeof EasyDanmaku === 'function') {
        await naokuo_danmu();
      } else {
        const easyDanmakuScript = await getScript('https://npm.onmicrosoft.cn/naokuo-blog@1.2.12/js/easy-Danmaku.js');
        if (typeof EasyDanmaku === 'function') {
          await naokuo_danmu();
        } else {
          console.error('EasyDanmaku function not found even after loading the script.');
        }
      }
    })();
  }
  getnaokuo_danmu()
  document.addEventListener('pjax:complete', getnaokuo_danmu)
})</script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>